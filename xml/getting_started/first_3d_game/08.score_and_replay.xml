<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.21.2 -->
<document source="/home/runner/work/godot-docs-cn/godot-docs-cn/godot-docs/docs/getting_started/first_3d_game/08.score_and_replay.rst" translation_progress="{'total': 0, 'translated': 0}" xmlns:c="https://www.sphinx-doc.org/" xmlns:changeset="https://www.sphinx-doc.org/" xmlns:citation="https://www.sphinx-doc.org/" xmlns:cpp="https://www.sphinx-doc.org/" xmlns:index="https://www.sphinx-doc.org/" xmlns:js="https://www.sphinx-doc.org/" xmlns:math="https://www.sphinx-doc.org/" xmlns:py="https://www.sphinx-doc.org/" xmlns:rst="https://www.sphinx-doc.org/" xmlns:std="https://www.sphinx-doc.org/">
    <target refid="doc-first-3d-game-score-and-replay"></target>
    <section ids="score-and-replay doc-first-3d-game-score-and-replay" names="score\ and\ replay doc_first_3d_game_score_and_replay">
        <title>Score and replay</title>
        <paragraph>In this part, we'll add the score, music playback, and the ability to restart
            the game.</paragraph>
        <paragraph>We have to keep track of the current score in a variable and display it on
            screen using a minimal interface. We will use a text label to do that.</paragraph>
        <paragraph>In the main scene, add a new child node <reference internal="True" refuri="../../classes/class_control#class-control"><inline classes="std std-ref">Control</inline></reference> to <literal>Main</literal> and name it
            <literal>UserInterface</literal>. Ensure you are on the 2D screen, where you can edit your User Interface (UI).</paragraph>
        <paragraph>Add a <reference internal="True" refuri="../../classes/class_label#class-label"><inline classes="std std-ref">Label</inline></reference> node and name it <literal>ScoreLabel</literal></paragraph>
        <paragraph><image alt="image1" candidates="{'*': 'getting_started/first_3d_game/img/08.score_and_replay/01_label_node.webp'}" original_uri="img/08.score_and_replay/01_label_node.webp" uri="getting_started/first_3d_game/img/08.score_and_replay/01_label_node.webp"></image></paragraph>
        <paragraph>In the <emphasis>Inspector</emphasis>, set the <emphasis>Label</emphasis>'s <emphasis>Text</emphasis> to a placeholder like "Score: 0".</paragraph>
        <paragraph><image alt="image2" candidates="{'*': 'getting_started/first_3d_game/img/08.score_and_replay/02_score_placeholder.webp'}" original_uri="img/08.score_and_replay/02_score_placeholder.webp" uri="getting_started/first_3d_game/img/08.score_and_replay/02_score_placeholder.webp"></image></paragraph>
        <paragraph>Also, the text is white by default, like our game's background. We need to
            change its color to see it at runtime.</paragraph>
        <paragraph>Scroll down to <emphasis>Theme Overrides</emphasis>, and expand <emphasis>Colors</emphasis>
            and enable <emphasis>Font Color</emphasis> in order to tint the text to black
            (which contrasts well with the white 3D scene)</paragraph>
        <paragraph><image alt="image3" candidates="{'*': 'getting_started/first_3d_game/img/08.score_and_replay/03_score_font_color.webp'}" original_uri="img/08.score_and_replay/03_score_font_color.webp" uri="getting_started/first_3d_game/img/08.score_and_replay/03_score_font_color.webp"></image></paragraph>
        <paragraph>Finally, click and drag on the text in the viewport to move it away from the
            top-left corner.</paragraph>
        <paragraph><image alt="image4" candidates="{'*': 'getting_started/first_3d_game/img/08.score_and_replay/04_score_label_moved.webp'}" original_uri="img/08.score_and_replay/04_score_label_moved.webp" uri="getting_started/first_3d_game/img/08.score_and_replay/04_score_label_moved.webp"></image></paragraph>
        <paragraph>The <literal>UserInterface</literal> node allows us to group our UI in a branch of the scene tree
            and use a theme resource that will propagate to all its children. We'll use it
            to set our game's font.</paragraph>
        <section ids="creating-a-ui-theme" names="creating\ a\ ui\ theme">
            <title>Creating a UI theme</title>
            <paragraph>Once again, select the <literal>UserInterface</literal> node. In the <emphasis>Inspector</emphasis>, create a new
                theme resource in <emphasis>Theme -&gt; Theme</emphasis>.</paragraph>
            <paragraph><image alt="image5" candidates="{'*': 'getting_started/first_3d_game/img/08.score_and_replay/05_creating_theme.webp'}" original_uri="img/08.score_and_replay/05_creating_theme.webp" uri="getting_started/first_3d_game/img/08.score_and_replay/05_creating_theme.webp"></image></paragraph>
            <paragraph>Click on it to open the theme editor In the bottom panel. It gives you a preview
                of how all the built-in UI widgets will look with your theme resource.</paragraph>
            <paragraph><image alt="image6" candidates="{'*': 'getting_started/first_3d_game/img/08.score_and_replay/06_theme_preview.webp'}" original_uri="img/08.score_and_replay/06_theme_preview.webp" uri="getting_started/first_3d_game/img/08.score_and_replay/06_theme_preview.webp"></image></paragraph>
            <paragraph>By default, a theme only has a few properties: <emphasis>Default Base Scale</emphasis>, <emphasis>Default Font</emphasis>
                and <emphasis>Default Font Size</emphasis>.</paragraph>
            <seealso>
                <paragraph>You can add more properties to the theme resource to design complex user
                    interfaces, but that is beyond the scope of this series. To learn more about
                    creating and editing themes, see <reference internal="True" refuri="../../tutorials/ui/gui_skinning#doc-gui-skinning"><inline classes="std std-ref">Introduction to GUI skinning</inline></reference>.</paragraph>
            </seealso>
            <paragraph>The <emphasis>Default Font</emphasis> expects a font file like the ones you have on your computer.
                Two common font file formats are TrueType Font (TTF) and OpenType Font (OTF).</paragraph>
            <paragraph>In the <emphasis>FileSystem</emphasis> dock, expand the <literal>fonts</literal> directory and click and drag the
                <literal>Montserrat-Medium.ttf</literal> file we included in the project onto the <emphasis>Default Font</emphasis>.
                The text will reappear in the theme preview.</paragraph>
            <paragraph>The text is a bit small. Set the <emphasis>Default Font Size</emphasis> to <literal>22</literal> pixels to increase the text's size.</paragraph>
            <paragraph><image alt="image7" candidates="{'*': 'getting_started/first_3d_game/img/08.score_and_replay/07_font_size.webp'}" original_uri="img/08.score_and_replay/07_font_size.webp" uri="getting_started/first_3d_game/img/08.score_and_replay/07_font_size.webp"></image></paragraph>
        </section>
        <section ids="keeping-track-of-the-score" names="keeping\ track\ of\ the\ score">
            <title>Keeping track of the score</title>
            <paragraph>Let's work on the score next. Attach a new script to the <literal>ScoreLabel</literal> and define
                the <literal>score</literal> variable.</paragraph>
            <container classes="sphinx-tabs" type="tab-element">
                <div aria-label="Tabbed content" role="tablist">
                    <button aria-controls="panel-0-R0RTY3JpcHQ=" aria-selected="true" classes="sphinx-tabs-tab code-tab group-tab" ids="tab-0-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tab" tabindex="0">GDScript</button>
                    <button aria-controls="panel-0-QyM=" aria-selected="false" classes="sphinx-tabs-tab code-tab group-tab" ids="tab-0-QyM=" name="QyM=" role="tab" tabindex="-1">C#</button>
                </div>
                <div aria-labelledby="tab-0-R0RTY3JpcHQ=" classes="sphinx-tabs-panel code-tab group-tab" ids="panel-0-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tabpanel" tabindex="0">
                    <literal_block force="False" highlight_args="{}" language="gdscript" linenos="False" xml:space="preserve">extends Label

var score = 0</literal_block>
                </div>
                <div aria-labelledby="tab-0-QyM=" classes="sphinx-tabs-panel code-tab group-tab" hidden="true" ids="panel-0-QyM=" name="QyM=" role="tabpanel" tabindex="0">
                    <literal_block force="False" highlight_args="{}" language="csharp" linenos="False" xml:space="preserve">using Godot;

public partial class ScoreLabel : Label
{
    private int _score = 0;
}</literal_block>
                </div>
            </container>
            <paragraph>The score should increase by <literal>1</literal> every time we squash a monster. We can use
                their <literal>squashed</literal> signal to know when that happens. However, because we instantiate
                monsters from the code, we cannot connect the mob signal to the <literal>ScoreLabel</literal> via the editor.</paragraph>
            <paragraph>Instead, we have to make the connection from the code every time we spawn a
                monster.</paragraph>
            <paragraph>Open the script <literal>main.gd</literal>. If it's still open, you can click on its name in
                the script editor's left column.</paragraph>
            <paragraph><image alt="image8" candidates="{'*': 'getting_started/first_3d_game/img/08.score_and_replay/08_open_main_script.webp'}" original_uri="img/08.score_and_replay/08_open_main_script.webp" uri="getting_started/first_3d_game/img/08.score_and_replay/08_open_main_script.webp"></image></paragraph>
            <paragraph>Alternatively, you can double-click the <literal>main.gd</literal> file in the <emphasis>FileSystem</emphasis>
                dock.</paragraph>
            <paragraph>At the bottom of the <literal>_on_mob_timer_timeout()</literal> function, add the following
                line:</paragraph>
            <container classes="sphinx-tabs" type="tab-element">
                <div aria-label="Tabbed content" role="tablist">
                    <button aria-controls="panel-1-R0RTY3JpcHQ=" aria-selected="true" classes="sphinx-tabs-tab code-tab group-tab" ids="tab-1-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tab" tabindex="0">GDScript</button>
                    <button aria-controls="panel-1-QyM=" aria-selected="false" classes="sphinx-tabs-tab code-tab group-tab" ids="tab-1-QyM=" name="QyM=" role="tab" tabindex="-1">C#</button>
                </div>
                <div aria-labelledby="tab-1-R0RTY3JpcHQ=" classes="sphinx-tabs-panel code-tab group-tab" ids="panel-1-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tabpanel" tabindex="0">
                    <literal_block force="False" highlight_args="{}" language="gdscript" linenos="False" xml:space="preserve">func _on_mob_timer_timeout():
    #...
    # We connect the mob to the score label to update the score upon squashing one.
    mob.squashed.connect($UserInterface/ScoreLabel._on_mob_squashed.bind())</literal_block>
                </div>
                <div aria-labelledby="tab-1-QyM=" classes="sphinx-tabs-panel code-tab group-tab" hidden="true" ids="panel-1-QyM=" name="QyM=" role="tabpanel" tabindex="0">
                    <literal_block force="False" highlight_args="{}" language="csharp" linenos="False" xml:space="preserve">private void OnMobTimerTimeout()
{
    // ...
    // We connect the mob to the score label to update the score upon squashing one.
    mob.Squashed += GetNode&lt;ScoreLabel&gt;("UserInterface/ScoreLabel").OnMobSquashed;
}</literal_block>
                </div>
            </container>
            <paragraph>This line means that when the mob emits the <literal>squashed</literal> signal, the
                <literal>ScoreLabel</literal> node will receive it and call the function <literal>_on_mob_squashed()</literal>.</paragraph>
            <paragraph>Head back to the <literal>score_label.gd</literal> script to define the <literal>_on_mob_squashed()</literal>
                callback function.</paragraph>
            <paragraph>There, we increment the score and update the displayed text.</paragraph>
            <container classes="sphinx-tabs" type="tab-element">
                <div aria-label="Tabbed content" role="tablist">
                    <button aria-controls="panel-2-R0RTY3JpcHQ=" aria-selected="true" classes="sphinx-tabs-tab code-tab group-tab" ids="tab-2-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tab" tabindex="0">GDScript</button>
                    <button aria-controls="panel-2-QyM=" aria-selected="false" classes="sphinx-tabs-tab code-tab group-tab" ids="tab-2-QyM=" name="QyM=" role="tab" tabindex="-1">C#</button>
                </div>
                <div aria-labelledby="tab-2-R0RTY3JpcHQ=" classes="sphinx-tabs-panel code-tab group-tab" ids="panel-2-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tabpanel" tabindex="0">
                    <literal_block force="False" highlight_args="{}" language="gdscript" linenos="False" xml:space="preserve">func _on_mob_squashed():
    score += 1
    text = "Score: %s" % score</literal_block>
                </div>
                <div aria-labelledby="tab-2-QyM=" classes="sphinx-tabs-panel code-tab group-tab" hidden="true" ids="panel-2-QyM=" name="QyM=" role="tabpanel" tabindex="0">
                    <literal_block force="False" highlight_args="{}" language="csharp" linenos="False" xml:space="preserve">public void OnMobSquashed()
{
    _score += 1;
    Text = $"Score: {_score}";
}</literal_block>
                </div>
            </container>
            <paragraph>The second line uses the value of the <literal>score</literal> variable to replace the
                placeholder <literal>%s</literal>. When using this feature, Godot automatically converts values
                to string text, which is convenient when outputting text in labels or
                when using the <literal>print()</literal> function.</paragraph>
            <seealso>
                <paragraph>You can learn more about string formatting here: <reference internal="True" refuri="../../tutorials/scripting/gdscript/gdscript_format_string#doc-gdscript-printf"><inline classes="std std-ref">GDScript format strings</inline></reference>.
                    In C#, consider using <reference name='string interpolation with "$"' refuri="https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/tokens/interpolated">string interpolation with "$"</reference><target ids="string-interpolation-with" names='string\ interpolation\ with\ "$"' refuri="https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/tokens/interpolated"></target>.</paragraph>
            </seealso>
            <paragraph>You can now play the game and squash a few enemies to see the score
                increase.</paragraph>
            <paragraph><image alt="image9" candidates="{'*': 'getting_started/first_3d_game/img/08.score_and_replay/09_score_in_game.png'}" original_uri="img/08.score_and_replay/09_score_in_game.png" uri="getting_started/first_3d_game/img/08.score_and_replay/09_score_in_game.png"></image></paragraph>
            <note>
                <paragraph>In a complex game, you may want to completely separate your user interface
                    from the game world. In that case, you would not keep track of the score on
                    the label. Instead, you may want to store it in a separate, dedicated
                    object. But when prototyping or when your project is simple, it is fine to
                    keep your code simple. Programming is always a balancing act.</paragraph>
            </note>
        </section>
        <section ids="retrying-the-game" names="retrying\ the\ game">
            <title>Retrying the game</title>
            <paragraph>We'll now add the ability to play again after dying. When the player dies, we'll
                display a message on the screen and wait for input.</paragraph>
            <paragraph>Head back to the <literal>main.tscn</literal> scene, select the <literal>UserInterface</literal> node, add a
                child node <reference internal="True" refuri="../../classes/class_colorrect#class-colorrect"><inline classes="std std-ref">ColorRect</inline></reference>, and name it <literal>Retry</literal>. This node fills a
                rectangle with a uniform color and will serve as an overlay to darken the
                screen.</paragraph>
            <paragraph>To make it span over the whole viewport, you can use the <emphasis>Anchor Preset</emphasis> menu in the
                toolbar.</paragraph>
            <paragraph><image alt="image10" candidates="{'*': 'getting_started/first_3d_game/img/08.score_and_replay/10_anchor_preset.webp'}" original_uri="img/08.score_and_replay/10_anchor_preset.webp" uri="getting_started/first_3d_game/img/08.score_and_replay/10_anchor_preset.webp"></image></paragraph>
            <paragraph>Open it and apply the <emphasis>Full Rect</emphasis> command.</paragraph>
            <paragraph><image alt="image11" candidates="{'*': 'getting_started/first_3d_game/img/08.score_and_replay/11_full_rect_option.webp'}" original_uri="img/08.score_and_replay/11_full_rect_option.webp" uri="getting_started/first_3d_game/img/08.score_and_replay/11_full_rect_option.webp"></image></paragraph>
            <paragraph>Nothing happens. Well, almost nothing; only the four green pins move to the
                corners of the selection box.</paragraph>
            <paragraph><image alt="image12" candidates="{'*': 'getting_started/first_3d_game/img/08.score_and_replay/12_anchors_updated.webp'}" original_uri="img/08.score_and_replay/12_anchors_updated.webp" uri="getting_started/first_3d_game/img/08.score_and_replay/12_anchors_updated.webp"></image></paragraph>
            <paragraph>This is because UI nodes (all the ones with a green icon) work with anchors and
                margins relative to their parent's bounding box. Here, the <literal>UserInterface</literal> node
                has a small size and the <literal>Retry</literal> one is limited by it.</paragraph>
            <paragraph>Select the <literal>UserInterface</literal> and apply <emphasis>Anchor Preset -&gt; Full Rect</emphasis> to it as well. The
                <literal>Retry</literal> node should now span the whole viewport.</paragraph>
            <paragraph>Let's change its color so it darkens the game area. Select <literal>Retry</literal> and in the
                <emphasis>Inspector</emphasis>, set its <emphasis>Color</emphasis> to something both dark and transparent. To do so,
                in the color picker, drag the <emphasis>A</emphasis> slider to the left. It controls the color's
                Alpha channel, that is to say, its opacity/transparency.</paragraph>
            <paragraph><image alt="image13" candidates="{'*': 'getting_started/first_3d_game/img/08.score_and_replay/13_retry_color_picker.webp'}" original_uri="img/08.score_and_replay/13_retry_color_picker.webp" uri="getting_started/first_3d_game/img/08.score_and_replay/13_retry_color_picker.webp"></image></paragraph>
            <paragraph>Next, add a <reference internal="True" refuri="../../classes/class_label#class-label"><inline classes="std std-ref">Label</inline></reference> as a child of <literal>Retry</literal> and give it the <emphasis>Text</emphasis>
                "Press Enter to retry."
                To move it and anchor it in the center of the screen, apply <emphasis>Anchor Preset -&gt; Center</emphasis>
                to it.</paragraph>
            <paragraph><image alt="image14" candidates="{'*': 'getting_started/first_3d_game/img/08.score_and_replay/14_center_option.webp'}" original_uri="img/08.score_and_replay/14_center_option.webp" uri="getting_started/first_3d_game/img/08.score_and_replay/14_center_option.webp"></image></paragraph>
            <section ids="coding-the-retry-option" names="coding\ the\ retry\ option">
                <title>Coding the retry option</title>
                <paragraph>We can now head to the code to show and hide the <literal>Retry</literal> node when the player
                    dies and plays again.</paragraph>
                <paragraph>Open the script <literal>main.gd</literal>. First, we want to hide the overlay at the start of
                    the game. Add this line to the <literal>_ready()</literal> function.</paragraph>
                <container classes="sphinx-tabs" type="tab-element">
                    <div aria-label="Tabbed content" role="tablist">
                        <button aria-controls="panel-3-R0RTY3JpcHQ=" aria-selected="true" classes="sphinx-tabs-tab code-tab group-tab" ids="tab-3-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tab" tabindex="0">GDScript</button>
                        <button aria-controls="panel-3-QyM=" aria-selected="false" classes="sphinx-tabs-tab code-tab group-tab" ids="tab-3-QyM=" name="QyM=" role="tab" tabindex="-1">C#</button>
                    </div>
                    <div aria-labelledby="tab-3-R0RTY3JpcHQ=" classes="sphinx-tabs-panel code-tab group-tab" ids="panel-3-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tabpanel" tabindex="0">
                        <literal_block force="False" highlight_args="{}" language="gdscript" linenos="False" xml:space="preserve">func _ready():
    $UserInterface/Retry.hide()</literal_block>
                    </div>
                    <div aria-labelledby="tab-3-QyM=" classes="sphinx-tabs-panel code-tab group-tab" hidden="true" ids="panel-3-QyM=" name="QyM=" role="tabpanel" tabindex="0">
                        <literal_block force="False" highlight_args="{}" language="csharp" linenos="False" xml:space="preserve">public override void _Ready()
{
    GetNode&lt;Control&gt;("UserInterface/Retry").Hide();
}</literal_block>
                    </div>
                </container>
                <paragraph>Then, when the player gets hit, we show the overlay.</paragraph>
                <container classes="sphinx-tabs" type="tab-element">
                    <div aria-label="Tabbed content" role="tablist">
                        <button aria-controls="panel-4-R0RTY3JpcHQ=" aria-selected="true" classes="sphinx-tabs-tab code-tab group-tab" ids="tab-4-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tab" tabindex="0">GDScript</button>
                        <button aria-controls="panel-4-QyM=" aria-selected="false" classes="sphinx-tabs-tab code-tab group-tab" ids="tab-4-QyM=" name="QyM=" role="tab" tabindex="-1">C#</button>
                    </div>
                    <div aria-labelledby="tab-4-R0RTY3JpcHQ=" classes="sphinx-tabs-panel code-tab group-tab" ids="panel-4-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tabpanel" tabindex="0">
                        <literal_block force="False" highlight_args="{}" language="gdscript" linenos="False" xml:space="preserve">func _on_player_hit():
    #...
    $UserInterface/Retry.show()</literal_block>
                    </div>
                    <div aria-labelledby="tab-4-QyM=" classes="sphinx-tabs-panel code-tab group-tab" hidden="true" ids="panel-4-QyM=" name="QyM=" role="tabpanel" tabindex="0">
                        <literal_block force="False" highlight_args="{}" language="csharp" linenos="False" xml:space="preserve">private void OnPlayerHit()
{
    //...
    GetNode&lt;Control&gt;("UserInterface/Retry").Show();
}</literal_block>
                    </div>
                </container>
                <paragraph>Finally, when the <literal>Retry</literal> node is visible, we need to listen to the player's
                    input and restart the game if they press enter. To do this, we use the built-in
                    <literal>_unhandled_input()</literal> callback, which is triggered on any input.</paragraph>
                <paragraph>If the player pressed the predefined <literal>ui_accept</literal> input action and <literal>Retry</literal> is
                    visible, we reload the current scene.</paragraph>
                <container classes="sphinx-tabs" type="tab-element">
                    <div aria-label="Tabbed content" role="tablist">
                        <button aria-controls="panel-5-R0RTY3JpcHQ=" aria-selected="true" classes="sphinx-tabs-tab code-tab group-tab" ids="tab-5-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tab" tabindex="0">GDScript</button>
                        <button aria-controls="panel-5-QyM=" aria-selected="false" classes="sphinx-tabs-tab code-tab group-tab" ids="tab-5-QyM=" name="QyM=" role="tab" tabindex="-1">C#</button>
                    </div>
                    <div aria-labelledby="tab-5-R0RTY3JpcHQ=" classes="sphinx-tabs-panel code-tab group-tab" ids="panel-5-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tabpanel" tabindex="0">
                        <literal_block force="False" highlight_args="{}" language="gdscript" linenos="False" xml:space="preserve">func _unhandled_input(event):
    if event.is_action_pressed("ui_accept") and $UserInterface/Retry.visible:
        # This restarts the current scene.
        get_tree().reload_current_scene()</literal_block>
                    </div>
                    <div aria-labelledby="tab-5-QyM=" classes="sphinx-tabs-panel code-tab group-tab" hidden="true" ids="panel-5-QyM=" name="QyM=" role="tabpanel" tabindex="0">
                        <literal_block force="False" highlight_args="{}" language="csharp" linenos="False" xml:space="preserve">public override void _UnhandledInput(InputEvent @event)
{
    if (@event.IsActionPressed("ui_accept") &amp;&amp; GetNode&lt;Control&gt;("UserInterface/Retry").Visible)
    {
        // This restarts the current scene.
        GetTree().ReloadCurrentScene();
    }
}</literal_block>
                    </div>
                </container>
                <paragraph>The function <literal>get_tree()</literal> gives us access to the global <reference internal="True" refuri="../../classes/class_scenetree#class-scenetree"><inline classes="std std-ref">SceneTree</inline></reference> object, which allows us to reload and restart the current
                    scene.</paragraph>
            </section>
        </section>
        <section ids="adding-music" names="adding\ music">
            <title>Adding music</title>
            <paragraph>To add music that plays continuously in the background, we're going to use
                another feature in Godot: <reference internal="True" refuri="../../tutorials/scripting/singletons_autoload#doc-singletons-autoload"><inline classes="std std-ref">autoloads</inline></reference>.</paragraph>
            <paragraph>To play audio, all you need to do is add an <reference internal="True" refuri="../../classes/class_audiostreamplayer#class-audiostreamplayer"><inline classes="std std-ref">AudioStreamPlayer</inline></reference> node to your
                scene and attach an audio file to it. When you start the scene, it can play
                automatically. However, when you reload the scene, like we do to play again, the
                audio nodes are also reset, and the music starts back from the beginning.</paragraph>
            <paragraph>You can use the autoload feature to have Godot load a node or a scene
                automatically at the start of the game, outside the current scene. You can also
                use it to create globally accessible objects.</paragraph>
            <paragraph>Create a new scene by going to the <emphasis>Scene</emphasis> menu and clicking <emphasis>New Scene</emphasis>
                or by using the <emphasis>+</emphasis> icon next to your currently opened scene.</paragraph>
            <paragraph><image alt="image15" candidates="{'*': 'getting_started/first_3d_game/img/08.score_and_replay/15_new_scene.webp'}" original_uri="img/08.score_and_replay/15_new_scene.webp" uri="getting_started/first_3d_game/img/08.score_and_replay/15_new_scene.webp"></image></paragraph>
            <paragraph>Click the <emphasis>Other Node</emphasis> button to create an <reference internal="True" refuri="../../classes/class_audiostreamplayer#class-audiostreamplayer"><inline classes="std std-ref">AudioStreamPlayer</inline></reference> and rename it to
                <literal>MusicPlayer</literal>.</paragraph>
            <paragraph><image alt="image16" candidates="{'*': 'getting_started/first_3d_game/img/08.score_and_replay/16_music_player_node.webp'}" original_uri="img/08.score_and_replay/16_music_player_node.webp" uri="getting_started/first_3d_game/img/08.score_and_replay/16_music_player_node.webp"></image></paragraph>
            <paragraph>We included a music soundtrack in the <literal>art/</literal> directory, <literal>House In a Forest
Loop.ogg</literal>. Click and drag it onto the <emphasis>Stream</emphasis> property in the <emphasis>Inspector</emphasis>.
                Also, turn on <emphasis>Autoplay</emphasis> so the music plays automatically at the start of the
                game.</paragraph>
            <paragraph><image alt="image17" candidates="{'*': 'getting_started/first_3d_game/img/08.score_and_replay/17_music_node_properties.webp'}" original_uri="img/08.score_and_replay/17_music_node_properties.webp" uri="getting_started/first_3d_game/img/08.score_and_replay/17_music_node_properties.webp"></image></paragraph>
            <paragraph>Save the scene as <literal>music_player.tscn</literal>.</paragraph>
            <paragraph>We have to register it as an autoload. Head to the <emphasis>Project -&gt; Project
                    Settingsâ€¦</emphasis> menu and click on the <emphasis>Globals -&gt; Autoload</emphasis> tab.</paragraph>
            <paragraph>In the <emphasis>Path</emphasis> field, you want to enter the path to your scene. Click the folder
                icon to open the file browser and double-click on <literal>music_player.tscn</literal>. Then,
                click the <emphasis>Add</emphasis> button on the right to register the node.</paragraph>
            <paragraph><image alt="image18" candidates="{'*': 'getting_started/first_3d_game/img/08.score_and_replay/18_register_autoload.webp'}" original_uri="img/08.score_and_replay/18_register_autoload.webp" uri="getting_started/first_3d_game/img/08.score_and_replay/18_register_autoload.webp"></image></paragraph>
            <paragraph><literal>music_player.tscn</literal> now loads into any scene you open or play.
                So if you run the game now, the music will play automatically in any scene.</paragraph>
            <paragraph>Before we wrap up this lesson, here's a quick look at how it works under the
                hood. When you run the game, your <emphasis>Scene</emphasis> dock changes to give you two tabs:
                <emphasis>Remote</emphasis> and <emphasis>Local</emphasis>.</paragraph>
            <paragraph><image alt="image19" candidates="{'*': 'getting_started/first_3d_game/img/08.score_and_replay/19_scene_dock_tabs.webp'}" original_uri="img/08.score_and_replay/19_scene_dock_tabs.webp" uri="getting_started/first_3d_game/img/08.score_and_replay/19_scene_dock_tabs.webp"></image></paragraph>
            <paragraph>The <emphasis>Remote</emphasis> tab allows you to visualize the node tree of your running game.
                There, you will see the <emphasis>Main</emphasis> node and everything the scene contains and the
                instantiated mobs at the bottom.</paragraph>
            <paragraph><image alt="image20" candidates="{'*': 'getting_started/first_3d_game/img/08.score_and_replay/20_remote_scene_tree.webp'}" original_uri="img/08.score_and_replay/20_remote_scene_tree.webp" uri="getting_started/first_3d_game/img/08.score_and_replay/20_remote_scene_tree.webp"></image></paragraph>
            <paragraph>At the top are the autoloaded <literal>MusicPlayer</literal> and a <emphasis>root</emphasis> node, which is your
                game's viewport.</paragraph>
            <paragraph>And that does it for this lesson. In the next part, we'll add an animation to
                make the game both look and feel much nicer.</paragraph>
            <paragraph>Here is the complete <literal>main.gd</literal> script for reference.</paragraph>
            <container classes="sphinx-tabs" type="tab-element">
                <div aria-label="Tabbed content" role="tablist">
                    <button aria-controls="panel-6-R0RTY3JpcHQ=" aria-selected="true" classes="sphinx-tabs-tab code-tab group-tab" ids="tab-6-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tab" tabindex="0">GDScript</button>
                    <button aria-controls="panel-6-QyM=" aria-selected="false" classes="sphinx-tabs-tab code-tab group-tab" ids="tab-6-QyM=" name="QyM=" role="tab" tabindex="-1">C#</button>
                </div>
                <div aria-labelledby="tab-6-R0RTY3JpcHQ=" classes="sphinx-tabs-panel code-tab group-tab" ids="panel-6-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tabpanel" tabindex="0">
                    <literal_block force="False" highlight_args="{}" language="gdscript" linenos="False" xml:space="preserve">extends Node

@export var mob_scene: PackedScene

func _ready():
    $UserInterface/Retry.hide()


func _on_mob_timer_timeout():
    # Create a new instance of the Mob scene.
    var mob = mob_scene.instantiate()

    # Choose a random location on the SpawnPath.
    # We store the reference to the SpawnLocation node.
    var mob_spawn_location = get_node("SpawnPath/SpawnLocation")
    # And give it a random offset.
    mob_spawn_location.progress_ratio = randf()

    var player_position = $Player.position
    mob.initialize(mob_spawn_location.position, player_position)

    # Spawn the mob by adding it to the Main scene.
    add_child(mob)

    # We connect the mob to the score label to update the score upon squashing one.
    mob.squashed.connect($UserInterface/ScoreLabel._on_mob_squashed.bind())

func _on_player_hit():
    $MobTimer.stop()
    $UserInterface/Retry.show()

func _unhandled_input(event):
    if event.is_action_pressed("ui_accept") and $UserInterface/Retry.visible:
        # This restarts the current scene.
        get_tree().reload_current_scene()</literal_block>
                </div>
                <div aria-labelledby="tab-6-QyM=" classes="sphinx-tabs-panel code-tab group-tab" hidden="true" ids="panel-6-QyM=" name="QyM=" role="tabpanel" tabindex="0">
                    <literal_block force="False" highlight_args="{}" language="csharp" linenos="False" xml:space="preserve">using Godot;

public partial class Main : Node
{
    [Export]
    public PackedScene MobScene { get; set; }

    public override void _Ready()
    {
        GetNode&lt;Control&gt;("UserInterface/Retry").Hide();
    }

    public override void _UnhandledInput(InputEvent @event)
    {
        if (@event.IsActionPressed("ui_accept") &amp;&amp; GetNode&lt;Control&gt;("UserInterface/Retry").Visible)
        {
            // This restarts the current scene.
            GetTree().ReloadCurrentScene();
        }
    }

    private void OnMobTimerTimeout()
    {
        // Create a new instance of the Mob scene.
        Mob mob = MobScene.Instantiate&lt;Mob&gt;();

        // Choose a random location on the SpawnPath.
        // We store the reference to the SpawnLocation node.
        var mobSpawnLocation = GetNode&lt;PathFollow3D&gt;("SpawnPath/SpawnLocation");
        // And give it a random offset.
        mobSpawnLocation.ProgressRatio = GD.Randf();

        Vector3 playerPosition = GetNode&lt;Player&gt;("Player").position;
        mob.Initialize(mobSpawnLocation.Position, playerPosition);

        // Spawn the mob by adding it to the Main scene.
        AddChild(mob);

        // We connect the mob to the score label to update the score upon squashing one.
        mob.Squashed += GetNode&lt;ScoreLabel&gt;("UserInterface/ScoreLabel").OnMobSquashed;
    }

    private void OnPlayerHit()
    {
        GetNode&lt;Timer&gt;("MobTimer").Stop();
        GetNode&lt;Control&gt;("UserInterface/Retry").Show();
    }
}</literal_block>
                </div>
            </container>
            <substitution_definition names="image1"><image alt="image1" candidates="{'*': 'getting_started/first_3d_game/img/08.score_and_replay/01_label_node.webp'}" original_uri="img/08.score_and_replay/01_label_node.webp" uri="getting_started/first_3d_game/img/08.score_and_replay/01_label_node.webp"></image></substitution_definition>
            <substitution_definition names="image2"><image alt="image2" candidates="{'*': 'getting_started/first_3d_game/img/08.score_and_replay/02_score_placeholder.webp'}" original_uri="img/08.score_and_replay/02_score_placeholder.webp" uri="getting_started/first_3d_game/img/08.score_and_replay/02_score_placeholder.webp"></image></substitution_definition>
            <substitution_definition names="image3"><image alt="image3" candidates="{'*': 'getting_started/first_3d_game/img/08.score_and_replay/03_score_font_color.webp'}" original_uri="img/08.score_and_replay/03_score_font_color.webp" uri="getting_started/first_3d_game/img/08.score_and_replay/03_score_font_color.webp"></image></substitution_definition>
            <substitution_definition names="image4"><image alt="image4" candidates="{'*': 'getting_started/first_3d_game/img/08.score_and_replay/04_score_label_moved.webp'}" original_uri="img/08.score_and_replay/04_score_label_moved.webp" uri="getting_started/first_3d_game/img/08.score_and_replay/04_score_label_moved.webp"></image></substitution_definition>
            <substitution_definition names="image5"><image alt="image5" candidates="{'*': 'getting_started/first_3d_game/img/08.score_and_replay/05_creating_theme.webp'}" original_uri="img/08.score_and_replay/05_creating_theme.webp" uri="getting_started/first_3d_game/img/08.score_and_replay/05_creating_theme.webp"></image></substitution_definition>
            <substitution_definition names="image6"><image alt="image6" candidates="{'*': 'getting_started/first_3d_game/img/08.score_and_replay/06_theme_preview.webp'}" original_uri="img/08.score_and_replay/06_theme_preview.webp" uri="getting_started/first_3d_game/img/08.score_and_replay/06_theme_preview.webp"></image></substitution_definition>
            <substitution_definition names="image7"><image alt="image7" candidates="{'*': 'getting_started/first_3d_game/img/08.score_and_replay/07_font_size.webp'}" original_uri="img/08.score_and_replay/07_font_size.webp" uri="getting_started/first_3d_game/img/08.score_and_replay/07_font_size.webp"></image></substitution_definition>
            <substitution_definition names="image8"><image alt="image8" candidates="{'*': 'getting_started/first_3d_game/img/08.score_and_replay/08_open_main_script.webp'}" original_uri="img/08.score_and_replay/08_open_main_script.webp" uri="getting_started/first_3d_game/img/08.score_and_replay/08_open_main_script.webp"></image></substitution_definition>
            <substitution_definition names="image9"><image alt="image9" candidates="{'*': 'getting_started/first_3d_game/img/08.score_and_replay/09_score_in_game.png'}" original_uri="img/08.score_and_replay/09_score_in_game.png" uri="getting_started/first_3d_game/img/08.score_and_replay/09_score_in_game.png"></image></substitution_definition>
            <substitution_definition names="image10"><image alt="image10" candidates="{'*': 'getting_started/first_3d_game/img/08.score_and_replay/10_anchor_preset.webp'}" original_uri="img/08.score_and_replay/10_anchor_preset.webp" uri="getting_started/first_3d_game/img/08.score_and_replay/10_anchor_preset.webp"></image></substitution_definition>
            <substitution_definition names="image11"><image alt="image11" candidates="{'*': 'getting_started/first_3d_game/img/08.score_and_replay/11_full_rect_option.webp'}" original_uri="img/08.score_and_replay/11_full_rect_option.webp" uri="getting_started/first_3d_game/img/08.score_and_replay/11_full_rect_option.webp"></image></substitution_definition>
            <substitution_definition names="image12"><image alt="image12" candidates="{'*': 'getting_started/first_3d_game/img/08.score_and_replay/12_anchors_updated.webp'}" original_uri="img/08.score_and_replay/12_anchors_updated.webp" uri="getting_started/first_3d_game/img/08.score_and_replay/12_anchors_updated.webp"></image></substitution_definition>
            <substitution_definition names="image13"><image alt="image13" candidates="{'*': 'getting_started/first_3d_game/img/08.score_and_replay/13_retry_color_picker.webp'}" original_uri="img/08.score_and_replay/13_retry_color_picker.webp" uri="getting_started/first_3d_game/img/08.score_and_replay/13_retry_color_picker.webp"></image></substitution_definition>
            <substitution_definition names="image14"><image alt="image14" candidates="{'*': 'getting_started/first_3d_game/img/08.score_and_replay/14_center_option.webp'}" original_uri="img/08.score_and_replay/14_center_option.webp" uri="getting_started/first_3d_game/img/08.score_and_replay/14_center_option.webp"></image></substitution_definition>
            <substitution_definition names="image15"><image alt="image15" candidates="{'*': 'getting_started/first_3d_game/img/08.score_and_replay/15_new_scene.webp'}" original_uri="img/08.score_and_replay/15_new_scene.webp" uri="getting_started/first_3d_game/img/08.score_and_replay/15_new_scene.webp"></image></substitution_definition>
            <substitution_definition names="image16"><image alt="image16" candidates="{'*': 'getting_started/first_3d_game/img/08.score_and_replay/16_music_player_node.webp'}" original_uri="img/08.score_and_replay/16_music_player_node.webp" uri="getting_started/first_3d_game/img/08.score_and_replay/16_music_player_node.webp"></image></substitution_definition>
            <substitution_definition names="image17"><image alt="image17" candidates="{'*': 'getting_started/first_3d_game/img/08.score_and_replay/17_music_node_properties.webp'}" original_uri="img/08.score_and_replay/17_music_node_properties.webp" uri="getting_started/first_3d_game/img/08.score_and_replay/17_music_node_properties.webp"></image></substitution_definition>
            <substitution_definition names="image18"><image alt="image18" candidates="{'*': 'getting_started/first_3d_game/img/08.score_and_replay/18_register_autoload.webp'}" original_uri="img/08.score_and_replay/18_register_autoload.webp" uri="getting_started/first_3d_game/img/08.score_and_replay/18_register_autoload.webp"></image></substitution_definition>
            <substitution_definition names="image19"><image alt="image19" candidates="{'*': 'getting_started/first_3d_game/img/08.score_and_replay/19_scene_dock_tabs.webp'}" original_uri="img/08.score_and_replay/19_scene_dock_tabs.webp" uri="getting_started/first_3d_game/img/08.score_and_replay/19_scene_dock_tabs.webp"></image></substitution_definition>
            <substitution_definition names="image20"><image alt="image20" candidates="{'*': 'getting_started/first_3d_game/img/08.score_and_replay/20_remote_scene_tree.webp'}" original_uri="img/08.score_and_replay/20_remote_scene_tree.webp" uri="getting_started/first_3d_game/img/08.score_and_replay/20_remote_scene_tree.webp"></image></substitution_definition>
            <substitution_definition names="weblate_widget"><reference refuri="https://hosted.weblate.org/engage/godot-engine/?utm_source=widget"><image alt="Translation status" candidates="{'?': 'https://hosted.weblate.org/widgets/godot-engine/-/godot-docs/287x66-white.png'}" height="66" uri="https://hosted.weblate.org/widgets/godot-engine/-/godot-docs/287x66-white.png" width="287"></image></reference></substitution_definition>
        </section>
    </section>
</document>
