<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.21.2 -->
<document source="/home/runner/work/godot-docs-cn/godot-docs-cn/godot-docs/docs/tutorials/2d/2d_transforms.rst" translation_progress="{'total': 0, 'translated': 0}" xmlns:c="https://www.sphinx-doc.org/" xmlns:changeset="https://www.sphinx-doc.org/" xmlns:citation="https://www.sphinx-doc.org/" xmlns:cpp="https://www.sphinx-doc.org/" xmlns:index="https://www.sphinx-doc.org/" xmlns:js="https://www.sphinx-doc.org/" xmlns:math="https://www.sphinx-doc.org/" xmlns:py="https://www.sphinx-doc.org/" xmlns:rst="https://www.sphinx-doc.org/" xmlns:std="https://www.sphinx-doc.org/">
    <target refid="doc-viewport-and-canvas-transforms"></target>
    <section ids="viewport-and-canvas-transforms doc-viewport-and-canvas-transforms" names="viewport\ and\ canvas\ transforms doc_viewport_and_canvas_transforms">
        <title>Viewport and canvas transforms</title>
        <section ids="introduction" names="introduction">
            <title>Introduction</title>
            <paragraph>This is an overview of the 2D transforms going on for nodes from the
                moment they draw their content locally to the time they are drawn onto
                the screen. This overview discusses very low-level details of the engine.</paragraph>
            <paragraph>The goal of this tutorial is to teach a way for feeding input events to the
                Input with a position in the correct coordinate system.</paragraph>
            <paragraph>A more extensive description of all coordinate systems and 2d transforms is
                available in <reference internal="True" refuri="../../engine_details/architecture/2d_coordinate_systems#doc-2d-coordinate-systems"><inline classes="std std-ref">2D coordinate systems and 2D transforms</inline></reference>.</paragraph>
        </section>
        <section ids="canvas-transform" names="canvas\ transform">
            <title>Canvas transform</title>
            <paragraph>As mentioned in the previous tutorial, <reference internal="True" refuri="canvas_layers#doc-canvas-layers"><inline classes="std std-ref">Canvas layers</inline></reference>, every
                CanvasItem node (remember that Node2D and Control based nodes use
                CanvasItem as their common root) will reside in a <emphasis>Canvas Layer</emphasis>. Every
                canvas layer has a transform (translation, rotation, scale, etc.) that
                can be accessed as a <reference internal="True" refuri="../../classes/class_transform2d#class-transform2d"><inline classes="std std-ref">Transform2D</inline></reference>.</paragraph>
            <paragraph>Also covered in the previous tutorial, nodes are drawn by default in Layer 0,
                in the built-in canvas. To put nodes in a different layer, a <reference internal="True" refuri="../../classes/class_canvaslayer#class-canvaslayer"><inline classes="std std-ref">CanvasLayer</inline></reference> node can be used.</paragraph>
        </section>
        <section ids="global-canvas-transform" names="global\ canvas\ transform">
            <title>Global canvas transform</title>
            <paragraph>Viewports also have a Global Canvas transform (also a
                <reference internal="True" refuri="../../classes/class_transform2d#class-transform2d"><inline classes="std std-ref">Transform2D</inline></reference>). This is the master transform and
                affects all individual <emphasis>Canvas Layer</emphasis> transforms. Generally, this is primarily
                used in Godot's CanvasItem Editor.</paragraph>
        </section>
        <section ids="stretch-transform" names="stretch\ transform">
            <title>Stretch transform</title>
            <paragraph>Finally, viewports have a <emphasis>Stretch Transform</emphasis>, which is used when
                resizing or stretching the screen. This transform is used internally (as
                described in <reference internal="True" refuri="../rendering/multiple_resolutions#doc-multiple-resolutions"><inline classes="std std-ref">Multiple resolutions</inline></reference>), but can also be manually set
                on each viewport.</paragraph>
            <paragraph>Input events are multiplied by this transform, but lack the ones above. To
                convert InputEvent coordinates to local CanvasItem coordinates, the
                <reference internal="True" refuri="../../classes/class_canvasitem#class-canvasitem-method-make-input-local"><inline classes="std std-ref">CanvasItem.make_input_local()</inline></reference>
                function was added for convenience.</paragraph>
        </section>
        <section ids="window-transform" names="window\ transform">
            <title>Window transform</title>
            <paragraph>The root viewport is a <reference internal="True" refuri="../../classes/class_window#class-window"><inline classes="std std-ref">Window</inline></reference>. In order to scale and
                position the <emphasis>Window's</emphasis> content as described in <reference internal="True" refuri="../rendering/multiple_resolutions#doc-multiple-resolutions"><inline classes="std std-ref">Multiple resolutions</inline></reference>,
                each <reference internal="True" refuri="../../classes/class_window#class-window"><inline classes="std std-ref">Window</inline></reference> contains a <emphasis>window transform</emphasis>. It is for
                example responsible for the black bars at the <emphasis>Window's</emphasis> sides so that the
                <emphasis>Viewport</emphasis> is displayed with a fixed aspect ratio.</paragraph>
        </section>
        <section ids="transform-order" names="transform\ order">
            <title>Transform order</title>
            <paragraph>To convert a CanvasItem local coordinate to an actual screen coordinate,
                the following chain of transforms must be applied:</paragraph>
            <image candidates="{'*': 'tutorials/2d/img/viewport_transforms3.webp'}" original_uri="img/viewport_transforms3.webp" uri="tutorials/2d/img/viewport_transforms3.webp"></image>
        </section>
        <section ids="transform-functions" names="transform\ functions">
            <title>Transform functions</title>
            <paragraph>The above graphic shows some available transform functions. All transforms are directed from right
                to left, this means multiplying a transform with a coordinate results in a coordinate system
                further to the left, multiplying the <reference internal="True" refuri="../../classes/class_transform2d#class-transform2d-method-affine-inverse"><inline classes="std std-ref">affine inverse</inline></reference>
                of a transform results in a coordinate system further to the right:</paragraph>
            <container classes="sphinx-tabs" type="tab-element">
                <div aria-label="Tabbed content" role="tablist">
                    <button aria-controls="panel-0-R0RTY3JpcHQ=" aria-selected="true" classes="sphinx-tabs-tab code-tab group-tab" ids="tab-0-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tab" tabindex="0">GDScript</button>
                    <button aria-controls="panel-0-QyM=" aria-selected="false" classes="sphinx-tabs-tab code-tab group-tab" ids="tab-0-QyM=" name="QyM=" role="tab" tabindex="-1">C#</button>
                </div>
                <div aria-labelledby="tab-0-R0RTY3JpcHQ=" classes="sphinx-tabs-panel code-tab group-tab" ids="panel-0-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tabpanel" tabindex="0">
                    <literal_block force="False" highlight_args="{}" language="gdscript" linenos="False" xml:space="preserve"># Called from a CanvasItem.
canvas_pos = get_global_transform() * local_pos
local_pos = get_global_transform().affine_inverse() * canvas_pos</literal_block>
                </div>
                <div aria-labelledby="tab-0-QyM=" classes="sphinx-tabs-panel code-tab group-tab" hidden="true" ids="panel-0-QyM=" name="QyM=" role="tabpanel" tabindex="0">
                    <literal_block force="False" highlight_args="{}" language="csharp" linenos="False" xml:space="preserve">// Called from a CanvasItem.
canvasPos = GetGlobalTransform() * localPos;
localPos = GetGlobalTransform().AffineInverse() * canvasPos;</literal_block>
                </div>
            </container>
            <paragraph>Finally, then, to convert a CanvasItem local coordinates to screen coordinates, just multiply in
                the following order:</paragraph>
            <container classes="sphinx-tabs" type="tab-element">
                <div aria-label="Tabbed content" role="tablist">
                    <button aria-controls="panel-1-R0RTY3JpcHQ=" aria-selected="true" classes="sphinx-tabs-tab code-tab group-tab" ids="tab-1-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tab" tabindex="0">GDScript</button>
                    <button aria-controls="panel-1-QyM=" aria-selected="false" classes="sphinx-tabs-tab code-tab group-tab" ids="tab-1-QyM=" name="QyM=" role="tab" tabindex="-1">C#</button>
                </div>
                <div aria-labelledby="tab-1-R0RTY3JpcHQ=" classes="sphinx-tabs-panel code-tab group-tab" ids="panel-1-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tabpanel" tabindex="0">
                    <literal_block force="False" highlight_args="{}" language="gdscript" linenos="False" xml:space="preserve">var screen_coord = get_viewport().get_screen_transform() * get_global_transform_with_canvas() * local_pos</literal_block>
                </div>
                <div aria-labelledby="tab-1-QyM=" classes="sphinx-tabs-panel code-tab group-tab" hidden="true" ids="panel-1-QyM=" name="QyM=" role="tabpanel" tabindex="0">
                    <literal_block force="False" highlight_args="{}" language="csharp" linenos="False" xml:space="preserve">var screenCoord = GetViewport().GetScreenTransform() * GetGlobalTransformWithCanvas() * localPos;</literal_block>
                </div>
            </container>
            <paragraph>Keep in mind, however, that it is generally not desired to work with screen coordinates. The
                recommended approach is to simply work in Canvas coordinates
                (<literal>CanvasItem.get_global_transform()</literal>), to allow automatic screen resolution resizing to work
                properly.</paragraph>
        </section>
        <section ids="feeding-custom-input-events" names="feeding\ custom\ input\ events">
            <title>Feeding custom input events</title>
            <paragraph>It is often desired to feed custom input events to the game. With the above knowledge, to correctly
                do this in the focused window, it must be done the following way:</paragraph>
            <container classes="sphinx-tabs" type="tab-element">
                <div aria-label="Tabbed content" role="tablist">
                    <button aria-controls="panel-2-R0RTY3JpcHQ=" aria-selected="true" classes="sphinx-tabs-tab code-tab group-tab" ids="tab-2-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tab" tabindex="0">GDScript</button>
                    <button aria-controls="panel-2-QyM=" aria-selected="false" classes="sphinx-tabs-tab code-tab group-tab" ids="tab-2-QyM=" name="QyM=" role="tab" tabindex="-1">C#</button>
                </div>
                <div aria-labelledby="tab-2-R0RTY3JpcHQ=" classes="sphinx-tabs-panel code-tab group-tab" ids="panel-2-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tabpanel" tabindex="0">
                    <literal_block force="False" highlight_args="{}" language="gdscript" linenos="False" xml:space="preserve">var local_pos = Vector2(10, 20) # Local to Control/Node2D.
var ie = InputEventMouseButton.new()
ie.button_index = MOUSE_BUTTON_LEFT
ie.position = get_viewport().get_screen_transform() * get_global_transform_with_canvas() * local_pos
Input.parse_input_event(ie)</literal_block>
                </div>
                <div aria-labelledby="tab-2-QyM=" classes="sphinx-tabs-panel code-tab group-tab" hidden="true" ids="panel-2-QyM=" name="QyM=" role="tabpanel" tabindex="0">
                    <literal_block force="False" highlight_args="{}" language="csharp" linenos="False" xml:space="preserve">var localPos = new Vector2(10,20); // Local to Control/Node2D.
var ie = new InputEventMouseButton()
{
    ButtonIndex = MouseButton.Left,
    Position = GetViewport().GetScreenTransform() * GetGlobalTransformWithCanvas() * localPos,
};
Input.ParseInputEvent(ie);</literal_block>
                </div>
            </container>
            <substitution_definition names="weblate_widget"><reference refuri="https://hosted.weblate.org/engage/godot-engine/?utm_source=widget"><image alt="Translation status" candidates="{'?': 'https://hosted.weblate.org/widgets/godot-engine/-/godot-docs/287x66-white.png'}" height="66" uri="https://hosted.weblate.org/widgets/godot-engine/-/godot-docs/287x66-white.png" width="287"></image></reference></substitution_definition>
        </section>
    </section>
</document>
