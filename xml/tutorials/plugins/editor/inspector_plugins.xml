<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.21.2 -->
<document source="/home/runner/work/godot-docs-cn/godot-docs-cn/godot-docs/docs/tutorials/plugins/editor/inspector_plugins.rst" translation_progress="{'total': 0, 'translated': 0}" xmlns:c="https://www.sphinx-doc.org/" xmlns:changeset="https://www.sphinx-doc.org/" xmlns:citation="https://www.sphinx-doc.org/" xmlns:cpp="https://www.sphinx-doc.org/" xmlns:index="https://www.sphinx-doc.org/" xmlns:js="https://www.sphinx-doc.org/" xmlns:math="https://www.sphinx-doc.org/" xmlns:py="https://www.sphinx-doc.org/" xmlns:rst="https://www.sphinx-doc.org/" xmlns:std="https://www.sphinx-doc.org/">
    <target refid="doc-inspector-plugins"></target>
    <section ids="inspector-plugins doc-inspector-plugins" names="inspector\ plugins doc_inspector_plugins">
        <title>Inspector plugins</title>
        <paragraph>The inspector dock allows you to create custom widgets to edit properties
            through plugins. This can be beneficial when working with custom datatypes and
            resources, although you can use the feature to change the inspector widgets for
            built-in types. You can design custom controls for specific properties, entire
            objects, and even separate controls associated with particular datatypes.</paragraph>
        <paragraph>This guide explains how to use the <reference internal="True" refuri="../../../classes/class_editorinspectorplugin#class-editorinspectorplugin"><inline classes="std std-ref">EditorInspectorPlugin</inline></reference> and
            <reference internal="True" refuri="../../../classes/class_editorproperty#class-editorproperty"><inline classes="std std-ref">EditorProperty</inline></reference> classes to create a custom interface for integers,
            replacing the default behavior with a button that generates random values
            between 0 and 99.</paragraph>
        <figure align="center" ids="id1">
            <image candidates="{'*': 'tutorials/plugins/editor/img/inspector_plugin_example.png'}" original_uri="img/inspector_plugin_example.png" uri="tutorials/plugins/editor/img/inspector_plugin_example.png"></image>
            <caption>The default behavior on the left and the end result on the right.</caption>
        </figure>
        <section ids="setting-up-your-plugin" names="setting\ up\ your\ plugin">
            <title>Setting up your plugin</title>
            <paragraph>Create a new empty plugin to get started.</paragraph>
            <seealso>
                <paragraph>See <reference internal="True" refuri="making_plugins#doc-making-plugins"><inline classes="std std-ref">Making plugins</inline></reference> guide to set up your new plugin.</paragraph>
            </seealso>
            <paragraph>Let's assume you've called your plugin folder <literal>my_inspector_plugin</literal>. If so,
                you should end up with a new <literal>addons/my_inspector_plugin</literal> folder that contains
                two files: <literal>plugin.cfg</literal> and <literal>plugin.gd</literal>.</paragraph>
            <paragraph>As before, <literal>plugin.gd</literal> is a script extending <reference internal="True" refuri="../../../classes/class_editorplugin#class-editorplugin"><inline classes="std std-ref">EditorPlugin</inline></reference> and you
                need to introduce new code for its <literal>_enter_tree</literal> and <literal>_exit_tree</literal> methods.
                To set up your inspector plugin, you must load its script, then create and add
                the instance by calling <literal>add_inspector_plugin()</literal>. If the plugin is disabled,
                you should remove the instance you have added by calling
                <literal>remove_inspector_plugin()</literal>.</paragraph>
            <note>
                <paragraph>Here, you are loading a script and not a packed scene. Therefore you
                    should use <literal>new()</literal> instead of <literal>instantiate()</literal>.</paragraph>
            </note>
            <container classes="sphinx-tabs" type="tab-element">
                <div aria-label="Tabbed content" role="tablist">
                    <button aria-controls="panel-0-R0RTY3JpcHQ=" aria-selected="true" classes="sphinx-tabs-tab code-tab group-tab" ids="tab-0-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tab" tabindex="0">GDScript</button>
                    <button aria-controls="panel-0-QyM=" aria-selected="false" classes="sphinx-tabs-tab code-tab group-tab" ids="tab-0-QyM=" name="QyM=" role="tab" tabindex="-1">C#</button>
                </div>
                <div aria-labelledby="tab-0-R0RTY3JpcHQ=" classes="sphinx-tabs-panel code-tab group-tab" ids="panel-0-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tabpanel" tabindex="0">
                    <literal_block force="False" highlight_args="{}" language="gdscript" linenos="False" xml:space="preserve"># plugin.gd
@tool
extends EditorPlugin

var plugin


func _enter_tree():
    plugin = preload("res://addons/my_inspector_plugin/my_inspector_plugin.gd").new()
    add_inspector_plugin(plugin)


func _exit_tree():
    remove_inspector_plugin(plugin)</literal_block>
                </div>
                <div aria-labelledby="tab-0-QyM=" classes="sphinx-tabs-panel code-tab group-tab" hidden="true" ids="panel-0-QyM=" name="QyM=" role="tabpanel" tabindex="0">
                    <literal_block force="False" highlight_args="{}" language="csharp" linenos="False" xml:space="preserve">// Plugin.cs
#if TOOLS
using Godot;

[Tool]
public partial class Plugin : EditorPlugin
{
    private MyInspectorPlugin _plugin;

    public override void _EnterTree()
    {
        _plugin = new MyInspectorPlugin();
        AddInspectorPlugin(_plugin);
    }

    public override void _ExitTree()
    {
        RemoveInspectorPlugin(_plugin);
    }
}
#endif</literal_block>
                </div>
            </container>
        </section>
        <section ids="interacting-with-the-inspector" names="interacting\ with\ the\ inspector">
            <title>Interacting with the inspector</title>
            <paragraph>To interact with the inspector dock, your <literal>my_inspector_plugin.gd</literal> script must
                extend the <reference internal="True" refuri="../../../classes/class_editorinspectorplugin#class-editorinspectorplugin"><inline classes="std std-ref">EditorInspectorPlugin</inline></reference> class. This class provides several
                virtual methods that affect how the inspector handles properties.</paragraph>
            <paragraph>To have any effect at all, the script must implement the <literal>_can_handle()</literal>
                method. This function is called for each edited <reference internal="True" refuri="../../../classes/class_object#class-object"><inline classes="std std-ref">Object</inline></reference> and must
                return <literal>true</literal> if this plugin should handle the object or its properties.</paragraph>
            <note>
                <paragraph>This includes any <reference internal="True" refuri="../../../classes/class_resource#class-resource"><inline classes="std std-ref">Resource</inline></reference> attached to the object.</paragraph>
            </note>
            <paragraph>You can implement four other methods to add controls to the inspector at
                specific positions. The <literal>_parse_begin()</literal> and <literal>_parse_end()</literal> methods are called
                only once at the beginning and the end of parsing for each object, respectively.
                They can add controls at the top or bottom of the inspector layout by calling
                <literal>add_custom_control()</literal>.</paragraph>
            <paragraph>As the editor parses the object, it calls the <literal>_parse_category()</literal> and
                <literal>_parse_property()</literal> methods. There, in addition to <literal>add_custom_control()</literal>,
                you can call both <literal>add_property_editor()</literal> and
                <literal>add_property_editor_for_multiple_properties()</literal>. Use these last two methods to
                specifically add <reference internal="True" refuri="../../../classes/class_editorproperty#class-editorproperty"><inline classes="std std-ref">EditorProperty</inline></reference>-based controls.</paragraph>
            <container classes="sphinx-tabs" type="tab-element">
                <div aria-label="Tabbed content" role="tablist">
                    <button aria-controls="panel-1-R0RTY3JpcHQ=" aria-selected="true" classes="sphinx-tabs-tab code-tab group-tab" ids="tab-1-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tab" tabindex="0">GDScript</button>
                    <button aria-controls="panel-1-QyM=" aria-selected="false" classes="sphinx-tabs-tab code-tab group-tab" ids="tab-1-QyM=" name="QyM=" role="tab" tabindex="-1">C#</button>
                </div>
                <div aria-labelledby="tab-1-R0RTY3JpcHQ=" classes="sphinx-tabs-panel code-tab group-tab" ids="panel-1-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tabpanel" tabindex="0">
                    <literal_block force="False" highlight_args="{}" language="gdscript" linenos="False" xml:space="preserve"># my_inspector_plugin.gd
extends EditorInspectorPlugin

var RandomIntEditor = preload("res://addons/my_inspector_plugin/random_int_editor.gd")


func _can_handle(object):
    # We support all objects in this example.
    return true


func _parse_property(object, type, name, hint_type, hint_string, usage_flags, wide):
    # We handle properties of type integer.
    if type == TYPE_INT:
        # Create an instance of the custom property editor and register
        # it to a specific property path.
        add_property_editor(name, RandomIntEditor.new())
        # Inform the editor to remove the default property editor for
        # this property type.
        return true
    else:
        return false</literal_block>
                </div>
                <div aria-labelledby="tab-1-QyM=" classes="sphinx-tabs-panel code-tab group-tab" hidden="true" ids="panel-1-QyM=" name="QyM=" role="tabpanel" tabindex="0">
                    <literal_block force="False" highlight_args="{}" language="csharp" linenos="False" xml:space="preserve">// MyInspectorPlugin.cs
#if TOOLS
using Godot;

public partial class MyInspectorPlugin : EditorInspectorPlugin
{
    public override bool _CanHandle(GodotObject @object)
    {
        // We support all objects in this example.
        return true;
    }

    public override bool _ParseProperty(GodotObject @object, Variant.Type type,
        string name, PropertyHint hintType, string hintString,
        PropertyUsageFlags usageFlags, bool wide)
    {
        // We handle properties of type integer.
        if (type == Variant.Type.Int)
        {
            // Create an instance of the custom property editor and register
            // it to a specific property path.
            AddPropertyEditor(name, new RandomIntEditor());
            // Inform the editor to remove the default property editor for
            // this property type.
            return true;
        }

        return false;
    }
}
#endif</literal_block>
                </div>
            </container>
        </section>
        <section ids="adding-an-interface-to-edit-properties" names="adding\ an\ interface\ to\ edit\ properties">
            <title>Adding an interface to edit properties</title>
            <paragraph>The <reference internal="True" refuri="../../../classes/class_editorproperty#class-editorproperty"><inline classes="std std-ref">EditorProperty</inline></reference> class is a special type of <reference internal="True" refuri="../../../classes/class_control#class-control"><inline classes="std std-ref">Control</inline></reference>
                that can interact with the inspector dock's edited objects. It doesn't display
                anything but can house any other control nodes, including complex scenes.</paragraph>
            <paragraph>There are three essential parts to the script extending
                <reference internal="True" refuri="../../../classes/class_editorproperty#class-editorproperty"><inline classes="std std-ref">EditorProperty</inline></reference>:</paragraph>
            <enumerated_list enumtype="arabic" prefix="" suffix=".">
                <list_item>
                    <paragraph>You must define the <literal>_init()</literal> method to set up the control nodes'
                        structure.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>You should implement the <literal>_update_property()</literal> to handle changes to the data
                        from the outside.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>A signal must be emitted at some point to inform the inspector that the
                        control has changed the property using <literal>emit_changed</literal>.</paragraph>
                </list_item>
            </enumerated_list>
            <paragraph>You can display your custom widget in two ways. Use just the default <literal>add_child()</literal>
                method to display it to the right of the property name, and use <literal>add_child()</literal>
                followed by <literal>set_bottom_editor()</literal> to position it below the name.</paragraph>
            <comment xml:space="preserve">FIXME: The second tab has the C# lexer for highlighting disabled for now, as the provided code causes errors.</comment>
            <container classes="sphinx-tabs" type="tab-element">
                <div aria-label="Tabbed content" role="tablist">
                    <button aria-controls="panel-2-R0RTY3JpcHQ=" aria-selected="true" classes="sphinx-tabs-tab code-tab group-tab" ids="tab-2-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tab" tabindex="0">GDScript</button>
                    <button aria-controls="panel-2-QyM=" aria-selected="false" classes="sphinx-tabs-tab code-tab group-tab" ids="tab-2-QyM=" name="QyM=" role="tab" tabindex="-1">C#</button>
                </div>
                <div aria-labelledby="tab-2-R0RTY3JpcHQ=" classes="sphinx-tabs-panel code-tab group-tab" ids="panel-2-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tabpanel" tabindex="0">
                    <literal_block force="False" highlight_args="{}" language="gdscript" linenos="False" xml:space="preserve"># random_int_editor.gd
extends EditorProperty


# The main control for editing the property.
var property_control = Button.new()
# An internal value of the property.
var current_value = 0
# A guard against internal changes when the property is updated.
var updating = false


func _init():
    # Add the control as a direct child of EditorProperty node.
    add_child(property_control)
    # Make sure the control is able to retain the focus.
    add_focusable(property_control)
    # Setup the initial state and connect to the signal to track changes.
    refresh_control_text()
    property_control.pressed.connect(_on_button_pressed)


func _on_button_pressed():
    # Ignore the signal if the property is currently being updated.
    if (updating):
        return

    # Generate a new random integer between 0 and 99.
    current_value = randi() % 100
    refresh_control_text()
    emit_changed(get_edited_property(), current_value)


func _update_property():
    # Read the current value from the property.
    var new_value = get_edited_object()[get_edited_property()]
    if (new_value == current_value):
        return

    # Update the control with the new value.
    updating = true
    current_value = new_value
    refresh_control_text()
    updating = false

func refresh_control_text():
    property_control.text = "Value: " + str(current_value)</literal_block>
                </div>
                <div aria-labelledby="tab-2-QyM=" classes="sphinx-tabs-panel code-tab group-tab" hidden="true" ids="panel-2-QyM=" name="QyM=" role="tabpanel" tabindex="0">
                    <literal_block force="False" highlight_args="{}" language="csharp" linenos="False" xml:space="preserve">// RandomIntEditor.cs
#if TOOLS
using Godot;

public partial class RandomIntEditor : EditorProperty
{
    // The main control for editing the property.
    private Button _propertyControl = new Button();
    // An internal value of the property.
    private int _currentValue = 0;
    // A guard against internal changes when the property is updated.
    private bool _updating = false;

    public RandomIntEditor()
    {
        // Add the control as a direct child of EditorProperty node.
        AddChild(_propertyControl);
        // Make sure the control is able to retain the focus.
        AddFocusable(_propertyControl);
        // Setup the initial state and connect to the signal to track changes.
        RefreshControlText();
        _propertyControl.Pressed += OnButtonPressed;
    }

    private void OnButtonPressed()
    {
        // Ignore the signal if the property is currently being updated.
        if (_updating)
        {
            return;
        }

        // Generate a new random integer between 0 and 99.
        _currentValue = (int)GD.Randi() % 100;
        RefreshControlText();
        EmitChanged(GetEditedProperty(), _currentValue);
    }

    public override void _UpdateProperty()
    {
        // Read the current value from the property.
        var newValue = (int)GetEditedObject().Get(GetEditedProperty());
        if (newValue == _currentValue)
        {
            return;
        }

        // Update the control with the new value.
        _updating = true;
        _currentValue = newValue;
        RefreshControlText();
        _updating = false;
    }

    private void RefreshControlText()
    {
        _propertyControl.Text = $"Value: {_currentValue}";
    }
}
#endif</literal_block>
                </div>
            </container>
            <paragraph>Using the example code above you should be able to make a custom widget that
                replaces the default <reference internal="True" refuri="../../../classes/class_spinbox#class-spinbox"><inline classes="std std-ref">SpinBox</inline></reference> control for integers with a
                <reference internal="True" refuri="../../../classes/class_button#class-button"><inline classes="std std-ref">Button</inline></reference> that generates random values.</paragraph>
            <substitution_definition names="weblate_widget"><reference refuri="https://hosted.weblate.org/engage/godot-engine/?utm_source=widget"><image alt="Translation status" candidates="{'?': 'https://hosted.weblate.org/widgets/godot-engine/-/godot-docs/287x66-white.png'}" height="66" uri="https://hosted.weblate.org/widgets/godot-engine/-/godot-docs/287x66-white.png" width="287"></image></reference></substitution_definition>
        </section>
    </section>
</document>
