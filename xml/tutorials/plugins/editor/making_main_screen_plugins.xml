<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.21.2 -->
<document source="/home/runner/work/godot-docs-cn/godot-docs-cn/godot-docs/docs/tutorials/plugins/editor/making_main_screen_plugins.rst" translation_progress="{'total': 0, 'translated': 0}" xmlns:c="https://www.sphinx-doc.org/" xmlns:changeset="https://www.sphinx-doc.org/" xmlns:citation="https://www.sphinx-doc.org/" xmlns:cpp="https://www.sphinx-doc.org/" xmlns:index="https://www.sphinx-doc.org/" xmlns:js="https://www.sphinx-doc.org/" xmlns:math="https://www.sphinx-doc.org/" xmlns:py="https://www.sphinx-doc.org/" xmlns:rst="https://www.sphinx-doc.org/" xmlns:std="https://www.sphinx-doc.org/">
    <target refid="doc-making-main-screen-plugins"></target>
    <section ids="making-main-screen-plugins doc-making-main-screen-plugins" names="making\ main\ screen\ plugins doc_making_main_screen_plugins">
        <title>Making main screen plugins</title>
        <section ids="what-this-tutorial-covers" names="what\ this\ tutorial\ covers">
            <title>What this tutorial covers</title>
            <paragraph>Main screen plugins allow you to create
                new UIs in the central part of the editor, which appear next to the
                "2D", "3D", "Script", "Game", and "AssetLib" buttons. Such editor plugins are
                referred as "Main screen plugins".</paragraph>
            <paragraph>This tutorial leads you through the creation of a basic main screen plugin.
                For the sake of simplicity, our main screen plugin will contain a single
                button that prints text to the console.</paragraph>
        </section>
        <section ids="initializing-the-plugin" names="initializing\ the\ plugin">
            <title>Initializing the plugin</title>
            <paragraph>First create a new plugin from the Plugins menu. For this tutorial, we'll put
                it in a folder called <literal>main_screen</literal>, but you can use any name you'd like.</paragraph>
            <paragraph>The plugin script will come with <literal>_enter_tree()</literal> and <literal>_exit_tree()</literal>
                methods, but for a main screen plugin we need to add a few extra methods.
                Add five extra methods such that the script looks like this:</paragraph>
            <container classes="sphinx-tabs" type="tab-element">
                <div aria-label="Tabbed content" role="tablist">
                    <button aria-controls="panel-0-R0RTY3JpcHQ=" aria-selected="true" classes="sphinx-tabs-tab code-tab group-tab" ids="tab-0-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tab" tabindex="0">GDScript</button>
                    <button aria-controls="panel-0-QyM=" aria-selected="false" classes="sphinx-tabs-tab code-tab group-tab" ids="tab-0-QyM=" name="QyM=" role="tab" tabindex="-1">C#</button>
                </div>
                <div aria-labelledby="tab-0-R0RTY3JpcHQ=" classes="sphinx-tabs-panel code-tab group-tab" ids="panel-0-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tabpanel" tabindex="0">
                    <literal_block force="False" highlight_args="{}" language="gdscript" linenos="False" xml:space="preserve">@tool
extends EditorPlugin


func _enter_tree():
    pass


func _exit_tree():
    pass


func _has_main_screen():
    return true


func _make_visible(visible):
    pass


func _get_plugin_name():
    return "Main Screen Plugin"


func _get_plugin_icon():
    return EditorInterface.get_editor_theme().get_icon("Node", "EditorIcons")</literal_block>
                </div>
                <div aria-labelledby="tab-0-QyM=" classes="sphinx-tabs-panel code-tab group-tab" hidden="true" ids="panel-0-QyM=" name="QyM=" role="tabpanel" tabindex="0">
                    <literal_block force="False" highlight_args="{}" language="csharp" linenos="False" xml:space="preserve">#if TOOLS
using Godot;

[Tool]
public partial class MainScreenPlugin : EditorPlugin
{
    public override void _EnterTree()
    {

    }

    public override void _ExitTree()
    {

    }

    public override bool _HasMainScreen()
    {
        return true;
    }

    public override void _MakeVisible(bool visible)
    {

    }

    public override string _GetPluginName()
    {
        return "Main Screen Plugin";
    }

    public override Texture2D _GetPluginIcon()
    {
        return EditorInterface.Singleton.GetEditorTheme().GetIcon("Node", "EditorIcons");
    }
}
#endif</literal_block>
                </div>
            </container>
            <paragraph>The important part in this script is the <literal>_has_main_screen()</literal> function,
                which is overloaded so it returns <literal>true</literal>. This function is automatically
                called by the editor on plugin activation, to tell it that this plugin
                adds a new center view to the editor. For now, we'll leave this script
                as-is and we'll come back to it later.</paragraph>
        </section>
        <section ids="main-screen-scene" names="main\ screen\ scene">
            <title>Main screen scene</title>
            <paragraph>Create a new scene with a root node derived from <literal>Control</literal> (for this
                example plugin, we'll make the root node a <literal>CenterContainer</literal>).
                Select this root node, and in the viewport, click the <literal>Layout</literal> menu
                and select <literal>Full Rect</literal>. You also need to enable the <literal>Expand</literal>
                vertical size flag in the inspector.
                The panel now uses all the space available in the main viewport.</paragraph>
            <paragraph>Next, let's add a button to our example main screen plugin.
                Add a <literal>Button</literal> node, and set the text to "Print Hello" or similar.
                Add a script to the button like this:</paragraph>
            <container classes="sphinx-tabs" type="tab-element">
                <div aria-label="Tabbed content" role="tablist">
                    <button aria-controls="panel-1-R0RTY3JpcHQ=" aria-selected="true" classes="sphinx-tabs-tab code-tab group-tab" ids="tab-1-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tab" tabindex="0">GDScript</button>
                    <button aria-controls="panel-1-QyM=" aria-selected="false" classes="sphinx-tabs-tab code-tab group-tab" ids="tab-1-QyM=" name="QyM=" role="tab" tabindex="-1">C#</button>
                </div>
                <div aria-labelledby="tab-1-R0RTY3JpcHQ=" classes="sphinx-tabs-panel code-tab group-tab" ids="panel-1-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tabpanel" tabindex="0">
                    <literal_block force="False" highlight_args="{}" language="gdscript" linenos="False" xml:space="preserve">@tool
extends Button


func _on_print_hello_pressed():
    print("Hello from the main screen plugin!")</literal_block>
                </div>
                <div aria-labelledby="tab-1-QyM=" classes="sphinx-tabs-panel code-tab group-tab" hidden="true" ids="panel-1-QyM=" name="QyM=" role="tabpanel" tabindex="0">
                    <literal_block force="False" highlight_args="{}" language="csharp" linenos="False" xml:space="preserve">using Godot;

[Tool]
public partial class PrintHello : Button
{
    private void OnPrintHelloPressed()
    {
        GD.Print("Hello from the main screen plugin!");
    }
}</literal_block>
                </div>
            </container>
            <paragraph>Then connect the "pressed" signal to itself. If you need help with signals,
                see the <reference internal="True" refuri="../../../getting_started/step_by_step/signals#doc-signals"><inline classes="std std-ref">Using signals</inline></reference> article.</paragraph>
            <paragraph>We are done with the main screen panel. Save the scene as <literal>main_panel.tscn</literal>.</paragraph>
        </section>
        <section ids="update-the-plugin-script" names="update\ the\ plugin\ script">
            <title>Update the plugin script</title>
            <paragraph>We need to update the <literal>main_screen_plugin.gd</literal> script so the plugin
                instances our main panel scene and places it where it needs to be.
                Here is the full plugin script:</paragraph>
            <container classes="sphinx-tabs" type="tab-element">
                <div aria-label="Tabbed content" role="tablist">
                    <button aria-controls="panel-2-R0RTY3JpcHQ=" aria-selected="true" classes="sphinx-tabs-tab code-tab group-tab" ids="tab-2-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tab" tabindex="0">GDScript</button>
                    <button aria-controls="panel-2-QyM=" aria-selected="false" classes="sphinx-tabs-tab code-tab group-tab" ids="tab-2-QyM=" name="QyM=" role="tab" tabindex="-1">C#</button>
                </div>
                <div aria-labelledby="tab-2-R0RTY3JpcHQ=" classes="sphinx-tabs-panel code-tab group-tab" ids="panel-2-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tabpanel" tabindex="0">
                    <literal_block force="False" highlight_args="{}" language="gdscript" linenos="False" xml:space="preserve">@tool
extends EditorPlugin


const MainPanel = preload("res://addons/main_screen/main_panel.tscn")

var main_panel_instance


func _enter_tree():
    main_panel_instance = MainPanel.instantiate()
    # Add the main panel to the editor's main viewport.
    EditorInterface.get_editor_main_screen().add_child(main_panel_instance)
    # Hide the main panel. Very much required.
    _make_visible(false)


func _exit_tree():
    if main_panel_instance:
        main_panel_instance.queue_free()


func _has_main_screen():
    return true


func _make_visible(visible):
    if main_panel_instance:
        main_panel_instance.visible = visible


func _get_plugin_name():
    return "Main Screen Plugin"


func _get_plugin_icon():
    # Must return some kind of Texture for the icon.
    return EditorInterface.get_editor_theme().get_icon("Node", "EditorIcons")</literal_block>
                </div>
                <div aria-labelledby="tab-2-QyM=" classes="sphinx-tabs-panel code-tab group-tab" hidden="true" ids="panel-2-QyM=" name="QyM=" role="tabpanel" tabindex="0">
                    <literal_block force="False" highlight_args="{}" language="csharp" linenos="False" xml:space="preserve">#if TOOLS
using Godot;

[Tool]
public partial class MainScreenPlugin : EditorPlugin
{
    PackedScene MainPanel = ResourceLoader.Load&lt;PackedScene&gt;("res://addons/main_screen/main_panel.tscn");
    Control MainPanelInstance;

    public override void _EnterTree()
    {
        MainPanelInstance = (Control)MainPanel.Instantiate();
        // Add the main panel to the editor's main viewport.
        EditorInterface.Singleton.GetEditorMainScreen().AddChild(MainPanelInstance);
        // Hide the main panel. Very much required.
        _MakeVisible(false);
    }

    public override void _ExitTree()
    {
        if (MainPanelInstance != null)
        {
            MainPanelInstance.QueueFree();
        }
    }

    public override bool _HasMainScreen()
    {
        return true;
    }

    public override void _MakeVisible(bool visible)
    {
        if (MainPanelInstance != null)
        {
            MainPanelInstance.Visible = visible;
        }
    }

    public override string _GetPluginName()
    {
        return "Main Screen Plugin";
    }

    public override Texture2D _GetPluginIcon()
    {
        // Must return some kind of Texture for the icon.
        return EditorInterface.Singleton.GetEditorTheme().GetIcon("Node", "EditorIcons");
    }
}
#endif</literal_block>
                </div>
            </container>
            <paragraph>A couple of specific lines were added. <literal>MainPanel</literal> is a constant that holds
                a reference to the scene, and we instance it into <title_reference>main_panel_instance</title_reference>.</paragraph>
            <paragraph>The <literal>_enter_tree()</literal> function is called before <literal>_ready()</literal>. This is where
                we instance the main panel scene, and add them as children of specific parts
                of the editor. We use <literal>EditorInterface.get_editor_main_screen()</literal> to
                obtain the main editor screen and add our main panel instance as a child to it.
                We call the <literal>_make_visible(false)</literal> function to hide the main panel so
                it doesn't compete for space when first activating the plugin.</paragraph>
            <paragraph>The <literal>_exit_tree()</literal> function is called when the plugin is deactivated.
                If the main screen still exists, we call <literal>queue_free()</literal> to free the
                instance and remove it from memory.</paragraph>
            <paragraph>The <literal>_make_visible()</literal> function is overridden to hide or show the main
                panel as needed. This function is automatically called by the editor when the
                user clicks on the main viewport buttons at the top of the editor.</paragraph>
            <paragraph>The <literal>_get_plugin_name()</literal> and <literal>_get_plugin_icon()</literal> functions control
                the displayed name and icon for the plugin's main viewport button.</paragraph>
            <paragraph>Another function you can add is the <literal>handles()</literal> function, which
                allows you to handle a node type, automatically focusing the main
                screen when the type is selected. This is similar to how clicking
                on a 3D node will automatically switch to the 3D viewport.</paragraph>
        </section>
        <section ids="try-the-plugin" names="try\ the\ plugin">
            <title>Try the plugin</title>
            <paragraph>Activate the plugin in the Project Settings. You'll observe a new button next
                to 2D, 3D, Script above the main viewport. Clicking it will take you to your
                new main screen plugin, and the button in the middle will print text.</paragraph>
            <paragraph>If you would like to try a finished version of this plugin,
                check out the plugin demos here:
                <reference refuri="https://github.com/godotengine/godot-demo-projects/tree/master/plugins">https://github.com/godotengine/godot-demo-projects/tree/master/plugins</reference></paragraph>
            <paragraph>If you would like to see a more complete example of what main screen plugins
                are capable of, check out the 2.5D demo projects here:
                <reference refuri="https://github.com/godotengine/godot-demo-projects/tree/master/misc/2.5d">https://github.com/godotengine/godot-demo-projects/tree/master/misc/2.5d</reference></paragraph>
            <substitution_definition names="weblate_widget"><reference refuri="https://hosted.weblate.org/engage/godot-engine/?utm_source=widget"><image alt="Translation status" candidates="{'?': 'https://hosted.weblate.org/widgets/godot-engine/-/godot-docs/287x66-white.png'}" height="66" uri="https://hosted.weblate.org/widgets/godot-engine/-/godot-docs/287x66-white.png" width="287"></image></reference></substitution_definition>
        </section>
    </section>
</document>
