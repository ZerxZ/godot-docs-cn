<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.21.2 -->
<document source="/home/runner/work/godot-docs-cn/godot-docs-cn/godot-docs/docs/tutorials/i18n/localization_using_gettext.rst" translation_progress="{'total': 0, 'translated': 0}" xmlns:c="https://www.sphinx-doc.org/" xmlns:changeset="https://www.sphinx-doc.org/" xmlns:citation="https://www.sphinx-doc.org/" xmlns:cpp="https://www.sphinx-doc.org/" xmlns:index="https://www.sphinx-doc.org/" xmlns:js="https://www.sphinx-doc.org/" xmlns:math="https://www.sphinx-doc.org/" xmlns:py="https://www.sphinx-doc.org/" xmlns:rst="https://www.sphinx-doc.org/" xmlns:std="https://www.sphinx-doc.org/">
    <target refid="doc-localization-using-gettext"></target>
    <section ids="localization-using-gettext-po-files doc-localization-using-gettext" names="localization\ using\ gettext\ (po\ files) doc_localization_using_gettext">
        <title>Localization using gettext (PO files)</title>
        <paragraph>In addition to importing translations in
            <reference internal="True" refuri="localization_using_spreadsheets#doc-localization-using-spreadsheets"><inline classes="std std-ref">CSV format</inline></reference>, Godot also
            supports loading translation files written in the GNU gettext format
            (text-based <literal>.po</literal> and compiled <literal>.mo</literal>).</paragraph>
        <note>
            <paragraph>For an introduction to gettext, check out
                <reference name="A Quick Gettext Tutorial" refuri="https://www.labri.fr/perso/fleury/posts/programming/a-quick-gettext-tutorial.html">A Quick Gettext Tutorial</reference><target ids="a-quick-gettext-tutorial" names="a\ quick\ gettext\ tutorial" refuri="https://www.labri.fr/perso/fleury/posts/programming/a-quick-gettext-tutorial.html"></target>.
                It's written with C projects in mind, but much of the advice
                also applies to Godot (with the exception of <literal>xgettext</literal>).</paragraph>
            <paragraph>For the complete documentation, see <reference name="GNU Gettext" refuri="https://www.gnu.org/software/gettext/manual/gettext.html">GNU Gettext</reference><target ids="gnu-gettext" names="gnu\ gettext" refuri="https://www.gnu.org/software/gettext/manual/gettext.html"></target>.</paragraph>
        </note>
        <section ids="advantages" names="advantages">
            <title>Advantages</title>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph>gettext is a standard format, which can be edited using any text editor
                        or GUI editors such as <reference name="Poedit" refuri="https://poedit.net/">Poedit</reference><target ids="poedit" names="poedit" refuri="https://poedit.net/"></target>. This can be significant
                        as it provides a lot of tools for translators, such as marking outdated
                        strings, finding strings that haven't been translated, etc.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>gettext is supported by translation platforms such as
                        <reference name="Transifex" refuri="https://www.transifex.com/">Transifex</reference><target ids="transifex" names="transifex" refuri="https://www.transifex.com/"></target> and <reference name="Weblate" refuri="https://weblate.org/">Weblate</reference><target ids="weblate" names="weblate" refuri="https://weblate.org/"></target>,
                        which makes it easier for people to collaborate to localization.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Compared to CSV, gettext files work better with version control systems like Git,
                        as each locale has its own messages file.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Multiline strings are more convenient to edit in gettext PO files compared
                        to CSV files.</paragraph>
                </list_item>
            </bullet_list>
        </section>
        <section ids="disadvantages" names="disadvantages">
            <title>Disadvantages</title>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph>gettext PO files have a more complex format than CSV and can be harder to grasp for
                        people new to software localization.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>People who maintain localization files will have to install gettext tools
                        on their system. However, as Godot supports using text-based message files
                        (<literal>.po</literal>), translators can test their work without having to install gettext tools.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>gettext PO files usually use English as the base language. Translators will use
                        this base language to translate to other languages. You could still user other
                        languages as the base language, but this is not common.</paragraph>
                </list_item>
            </bullet_list>
        </section>
        <section ids="installing-gettext-tools" names="installing\ gettext\ tools">
            <title>Installing gettext tools</title>
            <paragraph>The command line gettext tools are required to perform maintenance operations,
                such as updating message files. Therefore, it's strongly recommended to
                install them.</paragraph>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph><strong>Windows:</strong> Download an installer from
                        <reference name="this page" refuri="https://mlocati.github.io/articles/gettext-iconv-windows.html">this page</reference><target ids="this-page" names="this\ page" refuri="https://mlocati.github.io/articles/gettext-iconv-windows.html"></target>.
                        Any architecture and binary type (shared or static) works;
                        if in doubt, choose the 64-bit static installer.</paragraph>
                </list_item>
                <list_item>
                    <paragraph><strong>macOS:</strong> Install gettext either using <reference name="Homebrew" refuri="https://brew.sh/">Homebrew</reference><target ids="homebrew" names="homebrew" refuri="https://brew.sh/"></target>
                        with the <literal>brew install gettext</literal> command, or using
                        <reference name="MacPorts" refuri="https://www.macports.org/">MacPorts</reference><target ids="macports" names="macports" refuri="https://www.macports.org/"></target> with the
                        <literal>sudo port install gettext</literal> command.</paragraph>
                </list_item>
                <list_item>
                    <paragraph><strong>Linux:</strong> On most distributions, install the <literal>gettext</literal> package from
                        your distribution's package manager.</paragraph>
                </list_item>
            </bullet_list>
            <paragraph>For a GUI tool you can get Poedit from its <reference name="Official website" refuri="https://poedit.net/">Official website</reference><target ids="official-website" names="official\ website" refuri="https://poedit.net/"></target>.
                The basic version is open source and available under the MIT license.</paragraph>
        </section>
        <section ids="creating-the-po-template" names="creating\ the\ po\ template">
            <title>Creating the PO template</title>
            <section ids="automatic-generation-using-the-editor" names="automatic\ generation\ using\ the\ editor">
                <title>Automatic generation using the editor</title>
                <paragraph>The editor can generate a PO template automatically from
                    specified scene and GDScript files. This POT generation also supports translation
                    contexts and pluralization if used in a script, with the optional second
                    argument of <literal>tr()</literal> and the <literal>tr_n()</literal> method.</paragraph>
                <paragraph>Open <inline classes="role-menu role-ui">Project &gt; Project Settings &gt; Localization &gt; Template Generation</inline>, then use the
                    <inline classes="role-button role-ui">Add…</inline> button to specify the path to your project's scenes and scripts that
                    contain localizable strings:</paragraph>
                <figure align="center" ids="id1">
                    <image alt="Creating a PO template in the Localization &gt; Template Generation tab of the Project Settings" candidates="{'*': 'tutorials/i18n/img/localization_using_gettext_pot_generation.webp'}" original_uri="img/localization_using_gettext_pot_generation.webp" uri="tutorials/i18n/img/localization_using_gettext_pot_generation.webp"></image>
                    <caption>Creating a PO template in the <inline classes="role-menu role-ui">Localization &gt; Template Generation</inline> tab of the <inline classes="role-ui">Project Settings</inline></caption>
                </figure>
                <paragraph>After adding at least one scene or script, click <inline classes="role-button role-ui">Generate</inline> in the
                    top-right corner, then specify the path to the output file with a <literal>pot</literal> file extension. This file can be
                    placed anywhere in the project directory, but it's recommended to keep it in a
                    subdirectory such as <literal>locale</literal>, as each locale will be defined in its own file.</paragraph>
                <paragraph>See <reference internal="True" refid="doc-localization-using-gettext-gdscript"><inline classes="std std-ref">below</inline></reference> for how to add comments for translators
                    or exclude some strings from being added to the PO template for GDScript files.</paragraph>
                <paragraph>You can then move over to
                    <reference internal="True" refid="doc-localization-using-gettext-messages-file"><inline classes="std std-ref">creating a messages file from a PO template</inline></reference>.</paragraph>
                <note>
                    <paragraph>Remember to regenerate the PO template after making any changes to
                        localizable strings, or after adding new scenes or scripts. Otherwise, newly
                        added strings will not be localizable and translators won't be able to
                        update translations for outdated strings.</paragraph>
                </note>
            </section>
            <section ids="manual-creation" names="manual\ creation">
                <title>Manual creation</title>
                <paragraph>If the automatic generation approach doesn't work out for your needs, you can
                    create a PO template by hand in a text editor. This file can be placed anywhere
                    in the project directory, but it's recommended to keep it in a subdirectory, as
                    each locale will be defined in its own file.</paragraph>
                <paragraph>Create a directory named <literal>locale</literal> in the project directory. In this directory,
                    save a file named <literal>messages.pot</literal> with the following content:</paragraph>
                <literal_block force="False" language="gdscript" linenos="False" xml:space="preserve"># Don't remove the two lines below, they're required for gettext to work correctly.
msgid ""
msgstr ""

# Example of a regular string.
msgid "Hello world!"
msgstr ""

# Example of a string with pluralization.
msgid "There is %d apple."
msgid_plural "There are %d apples."
msgstr[0] ""
msgstr[1] ""

# Example of a string with a translation context.
msgctxt "Actions"
msgid "Close"
msgstr ""</literal_block>
                <paragraph>Messages in gettext are made of <literal>msgid</literal> and <literal>msgstr</literal> pairs.
                    <literal>msgid</literal> is the source string (usually in English), <literal>msgstr</literal> will be
                    the translated string.</paragraph>
                <warning>
                    <paragraph>The <literal>msgstr</literal> value in PO template files (<literal>.pot</literal>) should <strong>always</strong> be
                        empty. Localization will be done in the generated <literal>.po</literal> files instead.</paragraph>
                </warning>
                <target refid="doc-localization-using-gettext-messages-file"></target>
            </section>
        </section>
        <section ids="creating-a-messages-file-from-a-po-template doc-localization-using-gettext-messages-file" names="creating\ a\ messages\ file\ from\ a\ po\ template doc_localization_using_gettext_messages_file">
            <title>Creating a messages file from a PO template</title>
            <paragraph>The <literal>msginit</literal> command is used to turn a PO template into a messages file.
                For instance, to create a French localization file, use the following command
                while in the <literal>locale</literal> directory:</paragraph>
            <literal_block force="False" highlight_args="{}" language="shell" linenos="False" xml:space="preserve">msginit --no-translator --input=messages.pot --locale=fr</literal_block>
            <paragraph>The command above will create a file named <literal>fr.po</literal> in the same directory
                as the PO template.</paragraph>
            <paragraph>Alternatively, you can do that graphically using Poedit, or by uploading the
                POT file to your web platform of choice.</paragraph>
        </section>
        <section ids="loading-a-messages-file-in-godot" names="loading\ a\ messages\ file\ in\ godot">
            <title>Loading a messages file in Godot</title>
            <paragraph>To register a messages file as a translation in a project, open the
                <inline classes="role-ui">Project Settings</inline>, then go to <inline classes="role-menu role-ui">Localization &gt; Translations</inline>,
                click <inline classes="role-button role-ui">Add…</inline> then choose the <literal>.po</literal> or <literal>.mo</literal> file
                in the file dialog. The locale will be inferred from the
                <literal>"Language: &lt;code&gt;\n"</literal> property in the messages file.</paragraph>
            <note>
                <paragraph>See <reference internal="True" refuri="internationalizing_games#doc-internationalizing-games"><inline classes="std std-ref">Internationalizing games</inline></reference> for more information on
                    importing and testing translations in Godot.</paragraph>
            </note>
        </section>
        <section ids="updating-message-files-to-follow-the-po-template" names="updating\ message\ files\ to\ follow\ the\ po\ template">
            <title>Updating message files to follow the PO template</title>
            <paragraph>After updating the PO template, you will have to update message files so
                that they contain new strings, while removing strings that are no longer
                present in the PO template. This can be done automatically using the
                <literal>msgmerge</literal> tool:</paragraph>
            <literal_block force="False" highlight_args="{}" language="shell" linenos="False" xml:space="preserve"># The order matters: specify the message file *then* the PO template!
msgmerge --update --backup=none fr.po messages.pot</literal_block>
            <paragraph>If you want to keep a backup of the original message file (which would be
                saved as <literal>fr.po~</literal> in this example), remove the <literal>--backup=none</literal> argument.</paragraph>
            <note>
                <paragraph>After running <literal>msgmerge</literal>, strings which were modified in the source language
                    will have a "fuzzy" comment added before them in the <literal>.po</literal> file. This comment
                    denotes that the translation should be updated to match the new source string,
                    as the translation will most likely be inaccurate until it's updated.</paragraph>
                <paragraph>Strings with "fuzzy" comments will <strong>not</strong> be read by Godot until the
                    translation is updated and the "fuzzy" comment is removed.</paragraph>
            </note>
        </section>
        <section ids="checking-the-validity-of-a-po-file-or-template" names="checking\ the\ validity\ of\ a\ po\ file\ or\ template">
            <title>Checking the validity of a PO file or template</title>
            <paragraph>It is possible to check whether a gettext file's syntax is valid.</paragraph>
            <paragraph>If you open with Poeditor, it will display the appropriate warnings if there's some
                syntax errors. You can also verify by running the gettext command below:</paragraph>
            <literal_block force="False" highlight_args="{}" language="shell" linenos="False" xml:space="preserve">msgfmt fr.po --check</literal_block>
            <paragraph>If there are syntax errors or warnings, they will be displayed in the console.
                Otherwise, <literal>msgfmt</literal> won't output anything.</paragraph>
        </section>
        <section ids="using-binary-mo-files-useful-for-large-projects-only" names="using\ binary\ mo\ files\ (useful\ for\ large\ projects\ only)">
            <title>Using binary MO files (useful for large projects only)</title>
            <paragraph>For large projects with several thousands of strings to translate or more,
                it can be worth it to use binary (compiled) MO message files instead of text-based
                PO files. Binary MO files are smaller and faster to read than the equivalent
                PO files.</paragraph>
            <paragraph>You can generate an MO file with the command below:</paragraph>
            <literal_block force="False" highlight_args="{}" language="shell" linenos="False" xml:space="preserve">msgfmt fr.po --no-hash -o fr.mo</literal_block>
            <paragraph>If the PO file is valid, this command will create an <literal>fr.mo</literal> file besides
                the PO file. This MO file can then be loaded in Godot as described above.</paragraph>
            <paragraph>The original PO file should be kept in version control so you can update
                your translation in the future. In case you lose the original PO file and
                wish to decompile an MO file into a text-based PO file, you can do so with:</paragraph>
            <literal_block force="False" highlight_args="{}" language="shell" linenos="False" xml:space="preserve">msgunfmt fr.mo &gt; fr.po</literal_block>
            <paragraph>The decompiled file will not include comments or fuzzy strings, as these are
                never compiled in the MO file in the first place.</paragraph>
            <target refid="doc-localization-using-gettext-gdscript"></target>
        </section>
        <section ids="extracting-localizable-strings-from-gdscript-files doc-localization-using-gettext-gdscript" names="extracting\ localizable\ strings\ from\ gdscript\ files doc_localization_using_gettext_gdscript">
            <title>Extracting localizable strings from GDScript files</title>
            <paragraph>The built-in <reference name="editor plugin" refuri="https://github.com/godotengine/godot/blob/master/modules/gdscript/editor/gdscript_translation_parser_plugin.h">editor plugin</reference><target ids="editor-plugin" names="editor\ plugin" refuri="https://github.com/godotengine/godot/blob/master/modules/gdscript/editor/gdscript_translation_parser_plugin.h"></target>
                recognizes a variety of patterns in source code to extract localizable strings
                from GDScript files, including but not limited to the following:</paragraph>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph><literal>tr()</literal>, <literal>tr_n()</literal>, <literal>atr()</literal>, and <literal>atr_n()</literal> calls;</paragraph>
                </list_item>
                <list_item>
                    <paragraph>assigning properties <literal>text</literal>, <literal>placeholder_text</literal>, and <literal>tooltip_text</literal>;</paragraph>
                </list_item>
                <list_item>
                    <paragraph><literal>add_tab()</literal>, <literal>add_item()</literal>, <literal>set_tab_title()</literal>, and other calls;</paragraph>
                </list_item>
                <list_item>
                    <paragraph><literal>FileDialog</literal> filters like <literal>"*.png ; PNG Images"</literal>.</paragraph>
                </list_item>
            </bullet_list>
            <note>
                <paragraph>The argument or right operand must be a constant string, otherwise the plugin
                    will not be able to evaluate the expression and will ignore it.</paragraph>
            </note>
            <paragraph>If the plugin extracts unnecessary strings, you can ignore them with the <literal>NO_TRANSLATE</literal> comment.
                You can also provide additional information for translators using the <literal>TRANSLATORS:</literal> comment.
                These comments must be placed either on the same line as the recognized pattern or precede it.</paragraph>
            <literal_block force="False" language="gdscript" linenos="False" xml:space="preserve">$CharacterName.text = "???" # NO_TRANSLATE

# NO_TRANSLATE: Language name.
$TabContainer.set_tab_title(0, "Python")

item.text = "Tool" # TRANSLATORS: Up to 10 characters.

# TRANSLATORS: This is a reference to Lewis Carroll's poem "Jabberwocky",
# make sure to keep this as it is important to the plot.
say(tr("He took his vorpal sword in hand. The end?"))</literal_block>
        </section>
        <section ids="using-context" names="using\ context">
            <title>Using context</title>
            <paragraph>The <literal>context</literal> parameter can be used to differentiate the situation where a translation
                is used, or to differentiate polysemic words (words with multiple meanings).</paragraph>
            <paragraph>For example:</paragraph>
            <literal_block force="False" language="gdscript" linenos="False" xml:space="preserve">tr("Start", "Main Menu")
tr("End", "Main Menu")
tr("Shop", "Main Menu")
tr("Shop", "In Game")</literal_block>
            <paragraph>In a gettext PO file, a string with a context can be defined as follows:</paragraph>
            <literal_block force="False" language="gdscript" linenos="False" xml:space="preserve"># Example of a string with a translation context.
msgctxt "Main Menu"
msgid "Shop"
msgstr ""

# A different source string that is identical, but with a different context.
msgctxt "In Game"
msgid "Shop"
msgstr ""</literal_block>
        </section>
        <section ids="updating-po-files" names="updating\ po\ files">
            <title>Updating PO files</title>
            <paragraph>Some time or later, you'll add new content to our game, and there will
                be new strings that need to be translated. When this happens, you'll
                need to update the existing PO files to include the new strings.</paragraph>
            <paragraph>First, generate a new POT file containing all the existing strings plus
                the newly added strings. After that, merge the existing PO files
                with the new POT file. There are two ways to do this:</paragraph>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph>Use a gettext editor, and it should have an option to update a PO file
                        from a POT file.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Use the gettext <literal>msgmerge</literal> tool:</paragraph>
                </list_item>
            </bullet_list>
            <literal_block force="False" highlight_args="{}" language="shell" linenos="False" xml:space="preserve"># The order matters: specify the message file *then* the PO template!
msgmerge --update --backup=none fr.po messages.pot</literal_block>
            <paragraph>If you want to keep a backup of the original message file (which would be saved
                as <literal>fr.po~</literal> in this example), remove the <literal>--backup=none</literal> argument.</paragraph>
        </section>
        <section ids="pot-generation-custom-plugin" names="pot\ generation\ custom\ plugin">
            <title>POT generation custom plugin</title>
            <paragraph>If you have any extra file format to deal with, you could write a custom plugin
                to parse and and extract the strings from the custom file. This custom plugin
                will extract the strings and write into the POT file when you hit <strong>Generate POT</strong>.
                To learn more about how to create the translation parser plugin, see
                <reference internal="True" refuri="../../classes/class_editortranslationparserplugin#class-editortranslationparserplugin"><inline classes="std std-ref">EditorTranslationParserPlugin</inline></reference>.</paragraph>
            <substitution_definition names="weblate_widget"><reference refuri="https://hosted.weblate.org/engage/godot-engine/?utm_source=widget"><image alt="Translation status" candidates="{'?': 'https://hosted.weblate.org/widgets/godot-engine/-/godot-docs/287x66-white.png'}" height="66" uri="https://hosted.weblate.org/widgets/godot-engine/-/godot-docs/287x66-white.png" width="287"></image></reference></substitution_definition>
        </section>
    </section>
</document>
