<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.17.1 -->
<document source="/home/runner/work/godot-docs-cn/godot-docs-cn/godot-docs/docs/tutorials/audio/recording_with_microphone.rst" xmlns:c="https://www.sphinx-doc.org/" xmlns:changeset="https://www.sphinx-doc.org/" xmlns:citation="https://www.sphinx-doc.org/" xmlns:cpp="https://www.sphinx-doc.org/" xmlns:index="https://www.sphinx-doc.org/" xmlns:js="https://www.sphinx-doc.org/" xmlns:math="https://www.sphinx-doc.org/" xmlns:py="https://www.sphinx-doc.org/" xmlns:rst="https://www.sphinx-doc.org/" xmlns:std="https://www.sphinx-doc.org/">
    <target refid="doc-recording-with-microphone"></target>
    <section ids="recording-with-microphone doc-recording-with-microphone" names="recording\ with\ microphone 使用麦克风录音 doc_recording_with_microphone">
        <title>使用麦克风录音</title>
        <paragraph>Godot支持Windows, macOS, Linux, Android和iOS的游戏内音频录制.</paragraph>
        <paragraph>一定要查看Viewport演示！ 可以下载演示档案中的Viewport文件夹, 或: <reference name="https://github.com/godotengine/godot-demo-projects/tree/master/audio/mic_record" refuri="https://github.com/godotengine/godot-demo-projects/tree/master/audio/mic_record">https://github.com/godotengine/godot-demo-projects/tree/master/audio/mic_record</reference><target ids="https-github-com-godotengine-godot-demo-projects-tree-master-audio-mic-record" names="https://github.com/godotengine/godot-demo-projects/tree/master/audio/mic_record" refuri="https://github.com/godotengine/godot-demo-projects/tree/master/audio/mic_record"></target>.</paragraph>
        <paragraph>你需要在项目设置中启用音频输入，否则只能获得空的音频文件。</paragraph>
        <section ids="the-structure-of-the-demo" names="the\ structure\ of\ the\ demo 根节点的结构">
            <title>根节点的结构</title>
            <paragraph>该演示由单一场景组成, 这个场景包括两个主要部分:GUI和音频.</paragraph>
            <paragraph>我们将重点介绍音频部分. 在本演示中, 创建了一个名为 <literal>Record</literal> 的总线, 效果为 <literal>Record</literal>, 用于处理音频录制. 用一个名为 <literal>AudioStreamPlayer</literal> 的 <literal>AudioStreamRecord</literal> 进行录音.</paragraph>
            <image candidates="{'*': 'tutorials/audio/img/record_bus.png'}" uri="tutorials/audio/img/record_bus.png"></image>
            <image candidates="{'*': 'tutorials/audio/img/record_stream_player.png'}" uri="tutorials/audio/img/record_stream_player.png"></image>
            <container classes="sphinx-tabs" type="tab-element">
                <div aria-label="Tabbed content" role="tablist">
                    <button aria-controls="panel-0-R0RTY3JpcHQ=" aria-selected="true" classes="sphinx-tabs-tab code-tab group-tab" ids="tab-0-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tab" tabindex="0">GDScript</button>
                    <button aria-controls="panel-0-QyM=" aria-selected="false" classes="sphinx-tabs-tab code-tab group-tab" ids="tab-0-QyM=" name="QyM=" role="tab" tabindex="-1">C#</button>
                </div>
                <div aria-labelledby="tab-0-R0RTY3JpcHQ=" classes="sphinx-tabs-panel code-tab group-tab" ids="panel-0-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tabpanel" tabindex="0">
                    <literal_block force="False" highlight_args="{}" language="gdscript" linenos="False" xml:space="preserve">var effect
var recording


func _ready():
    # We get the index of the "Record" bus.
    var idx = AudioServer.get_bus_index("Record")
    # And use it to retrieve its first effect, which has been defined
    # as an "AudioEffectRecord" resource.
    effect = AudioServer.get_bus_effect(idx, 0)</literal_block>
                </div>
                <div aria-labelledby="tab-0-QyM=" classes="sphinx-tabs-panel code-tab group-tab" hidden="true" ids="panel-0-QyM=" name="QyM=" role="tabpanel" tabindex="0">
                    <literal_block force="False" highlight_args="{}" language="csharp" linenos="False" xml:space="preserve">private AudioEffectRecord _effect;
private AudioStreamSample _recording;

public override void _Ready()
{
    // We get the index of the "Record" bus.
    int idx = AudioServer.GetBusIndex("Record");
    // And use it to retrieve its first effect, which has been defined
    // as an "AudioEffectRecord" resource.
    _effect = (AudioEffectRecord)AudioServer.GetBusEffect(idx, 0);
}</literal_block>
                </div>
            </container>
            <paragraph>音频录制由 <reference internal="True" refuri="../../classes/class_audioeffectrecord#class-audioeffectrecord"><inline classes="std std-ref">AudioEffectRecord</inline></reference> 资源处理, 它有三个方法: <reference internal="True" refuri="../../classes/class_audioeffectrecord#class-audioeffectrecord-method-get-recording"><inline classes="std std-ref">get_recording()</inline></reference>, <reference internal="True" refuri="../../classes/class_audioeffectrecord#class-audioeffectrecord-method-is-recording-active"><inline classes="std std-ref">is_recording_active()</inline></reference>, 以及 <reference internal="True" refuri="../../classes/class_audioeffectrecord#class-audioeffectrecord-method-set-recording-active"><inline classes="std std-ref">set_recording_active()</inline></reference>.</paragraph>
            <container classes="sphinx-tabs" type="tab-element">
                <div aria-label="Tabbed content" role="tablist">
                    <button aria-controls="panel-1-R0RTY3JpcHQ=" aria-selected="true" classes="sphinx-tabs-tab code-tab group-tab" ids="tab-1-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tab" tabindex="0">GDScript</button>
                    <button aria-controls="panel-1-QyM=" aria-selected="false" classes="sphinx-tabs-tab code-tab group-tab" ids="tab-1-QyM=" name="QyM=" role="tab" tabindex="-1">C#</button>
                </div>
                <div aria-labelledby="tab-1-R0RTY3JpcHQ=" classes="sphinx-tabs-panel code-tab group-tab" ids="panel-1-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tabpanel" tabindex="0">
                    <literal_block force="False" highlight_args="{}" language="gdscript" linenos="False" xml:space="preserve">func _on_record_button_pressed():
    if effect.is_recording_active():
        recording = effect.get_recording()
        $PlayButton.disabled = false
        $SaveButton.disabled = false
        effect.set_recording_active(false)
        $RecordButton.text = "Record"
        $Status.text = ""
    else:
        $PlayButton.disabled = true
        $SaveButton.disabled = true
        effect.set_recording_active(true)
        $RecordButton.text = "Stop"
        $Status.text = "Recording..."</literal_block>
                </div>
                <div aria-labelledby="tab-1-QyM=" classes="sphinx-tabs-panel code-tab group-tab" hidden="true" ids="panel-1-QyM=" name="QyM=" role="tabpanel" tabindex="0">
                    <literal_block force="False" highlight_args="{}" language="csharp" linenos="False" xml:space="preserve">private void OnRecordButtonPressed()
{
    if (_effect.IsRecordingActive())
    {
        _recording = _effect.GetRecording();
        GetNode&lt;Button&gt;("PlayButton").Disabled = false;
        GetNode&lt;Button&gt;("SaveButton").Disabled = false;
        _effect.SetRecordingActive(false);
        GetNode&lt;Button&gt;("RecordButton").Text = "Record";
        GetNode&lt;Label&gt;("Status").Text = "";
    }
    else
    {
        GetNode&lt;Button&gt;("PlayButton").Disabled = true;
        GetNode&lt;Button&gt;("SaveButton").Disabled = true;
        _effect.SetRecordingActive(true);
        GetNode&lt;Button&gt;("RecordButton").Text = "Stop";
        GetNode&lt;Label&gt;("Status").Text = "Recording...";
    }
}</literal_block>
                </div>
            </container>
            <paragraph>在演示开始时, 录音效果是未激活. 当用户按下 <literal>RecordButton</literal> 时, 用 <literal>set_recording_active(true)</literal> 启用该效果.</paragraph>
            <paragraph>在下一次按下按钮时, 由于 <literal>effect.is_recording_active()</literal> 为 <literal>true</literal>, 可以通过调用 <literal>effect.get_recording()</literal> 将录制的流存储到 <literal>recording</literal> 变量中.</paragraph>
            <container classes="sphinx-tabs" type="tab-element">
                <div aria-label="Tabbed content" role="tablist">
                    <button aria-controls="panel-2-R0RTY3JpcHQ=" aria-selected="true" classes="sphinx-tabs-tab code-tab group-tab" ids="tab-2-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tab" tabindex="0">GDScript</button>
                    <button aria-controls="panel-2-QyM=" aria-selected="false" classes="sphinx-tabs-tab code-tab group-tab" ids="tab-2-QyM=" name="QyM=" role="tab" tabindex="-1">C#</button>
                </div>
                <div aria-labelledby="tab-2-R0RTY3JpcHQ=" classes="sphinx-tabs-panel code-tab group-tab" ids="panel-2-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tabpanel" tabindex="0">
                    <literal_block force="False" highlight_args="{}" language="gdscript" linenos="False" xml:space="preserve">func _on_play_button_pressed():
    print(recording)
    print(recording.format)
    print(recording.mix_rate)
    print(recording.stereo)
    var data = recording.get_data()
    print(data.size())
    $AudioStreamPlayer.stream = recording
    $AudioStreamPlayer.play()</literal_block>
                </div>
                <div aria-labelledby="tab-2-QyM=" classes="sphinx-tabs-panel code-tab group-tab" hidden="true" ids="panel-2-QyM=" name="QyM=" role="tabpanel" tabindex="0">
                    <literal_block force="False" highlight_args="{}" language="csharp" linenos="False" xml:space="preserve">private void OnPlayButtonPressed()
{
    GD.Print(_recording);
    GD.Print(_recording.Format);
    GD.Print(_recording.MixRate);
    GD.Print(_recording.Stereo);
    byte[] data = _recording.Data;
    GD.Print(data.Length);
    var audioStreamPlayer = GetNode&lt;AudioStreamPlayer&gt;("AudioStreamPlayer");
    audioStreamPlayer.Stream = _recording;
    audioStreamPlayer.Play();
}</literal_block>
                </div>
            </container>
            <paragraph>要回放录音, 你可以将录音指定为 <literal>AudioStreamPlayer</literal> 的流, 并调用 <literal>play()</literal>.</paragraph>
            <container classes="sphinx-tabs" type="tab-element">
                <div aria-label="Tabbed content" role="tablist">
                    <button aria-controls="panel-3-R0RTY3JpcHQ=" aria-selected="true" classes="sphinx-tabs-tab code-tab group-tab" ids="tab-3-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tab" tabindex="0">GDScript</button>
                    <button aria-controls="panel-3-QyM=" aria-selected="false" classes="sphinx-tabs-tab code-tab group-tab" ids="tab-3-QyM=" name="QyM=" role="tab" tabindex="-1">C#</button>
                </div>
                <div aria-labelledby="tab-3-R0RTY3JpcHQ=" classes="sphinx-tabs-panel code-tab group-tab" ids="panel-3-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tabpanel" tabindex="0">
                    <literal_block force="False" highlight_args="{}" language="gdscript" linenos="False" xml:space="preserve">func _on_save_button_pressed():
    var save_path = $SaveButton/Filename.text
    recording.save_to_wav(save_path)
    $Status.text = "Saved WAV file to: %s\n(%s)" % [save_path, ProjectSettings.globalize_path(save_path)]</literal_block>
                </div>
                <div aria-labelledby="tab-3-QyM=" classes="sphinx-tabs-panel code-tab group-tab" hidden="true" ids="panel-3-QyM=" name="QyM=" role="tabpanel" tabindex="0">
                    <literal_block force="False" highlight_args="{}" language="csharp" linenos="False" xml:space="preserve">private void OnSaveButtonPressed()
{
    string savePath = GetNode&lt;LineEdit&gt;("SaveButton/Filename").Text;
    _recording.SaveToWav(savePath);
    GetNode&lt;Label&gt;("Status").Text = string.Format("Saved WAV file to: {0}\n({1})", savePath, ProjectSettings.GlobalizePath(savePath));
}</literal_block>
                </div>
            </container>
            <paragraph>要保存录音, 你需要调用 <literal>save_to_wav()</literal>, 并提供文件的路径. 在本演示中, 路径由用户通过 <literal>LineEdit</literal> 输入框定义.</paragraph>
            <substitution_definition names="weblate_widget"><reference refuri="https://hosted.weblate.org/engage/godot-engine/zh_CN/?utm_source=widget"><image alt="翻译状态" candidates="{'?': 'https://hosted.weblate.org/widgets/godot-engine/zh_CN/godot-docs/287x66-white.png'}" height="66" uri="https://hosted.weblate.org/widgets/godot-engine/zh_CN/godot-docs/287x66-white.png" width="287"></image></reference></substitution_definition>
        </section>
    </section>
</document>
