<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.21.2 -->
<document source="/home/runner/work/godot-docs-cn/godot-docs-cn/godot-docs/docs/tutorials/audio/recording_with_microphone.rst" translation_progress="{'total': 0, 'translated': 0}" xmlns:c="https://www.sphinx-doc.org/" xmlns:changeset="https://www.sphinx-doc.org/" xmlns:citation="https://www.sphinx-doc.org/" xmlns:cpp="https://www.sphinx-doc.org/" xmlns:index="https://www.sphinx-doc.org/" xmlns:js="https://www.sphinx-doc.org/" xmlns:math="https://www.sphinx-doc.org/" xmlns:py="https://www.sphinx-doc.org/" xmlns:rst="https://www.sphinx-doc.org/" xmlns:std="https://www.sphinx-doc.org/">
    <target refid="doc-recording-with-microphone"></target>
    <section ids="recording-with-microphone doc-recording-with-microphone" names="recording\ with\ microphone doc_recording_with_microphone">
        <title>Recording with microphone</title>
        <paragraph>Godot supports in-game audio recording for Windows, macOS, Linux, Android and
            iOS.</paragraph>
        <paragraph>A simple demo is included in the official demo projects and will be used as
            support for this tutorial:
            <reference name="https://github.com/godotengine/godot-demo-projects/tree/master/audio/mic_record" refuri="https://github.com/godotengine/godot-demo-projects/tree/master/audio/mic_record">https://github.com/godotengine/godot-demo-projects/tree/master/audio/mic_record</reference><target ids="https-github-com-godotengine-godot-demo-projects-tree-master-audio-mic-record" names="https://github.com/godotengine/godot-demo-projects/tree/master/audio/mic_record" refuri="https://github.com/godotengine/godot-demo-projects/tree/master/audio/mic_record"></target>.</paragraph>
        <paragraph>You will need to enable audio input in the <reference internal="True" refuri="../../classes/class_projectsettings#class-projectsettings-property-audio-driver-enable-input"><inline classes="std std-ref">Audio &gt; Driver &gt; Enable Input</inline></reference> project setting, or you'll just get empty audio files.</paragraph>
        <paragraph>On iOS and iPadOS, it is also important to set the advanced <strong>Audio &gt; General &gt; iOS &gt; Session Category</strong> setting to include <strong>Record</strong> or <strong>Play and Record</strong>.</paragraph>
        <section ids="the-structure-of-the-demo" names="the\ structure\ of\ the\ demo">
            <title>The structure of the demo</title>
            <paragraph>The demo consists of a single scene. This scene includes two major parts: the
                GUI and the audio.</paragraph>
            <paragraph>We will focus on the audio part. In this demo, a bus named <literal>Record</literal> with the
                effect <literal>Record</literal> is created to handle the audio recording.
                An <literal>AudioStreamPlayer</literal> named <literal>AudioStreamRecord</literal> is used for recording.</paragraph>
            <image candidates="{'*': 'tutorials/audio/img/record_bus.png'}" original_uri="img/record_bus.png" uri="tutorials/audio/img/record_bus.png"></image>
            <image candidates="{'*': 'tutorials/audio/img/record_stream_player.png'}" original_uri="img/record_stream_player.png" uri="tutorials/audio/img/record_stream_player.png"></image>
            <container classes="sphinx-tabs" type="tab-element">
                <div aria-label="Tabbed content" role="tablist">
                    <button aria-controls="panel-0-R0RTY3JpcHQ=" aria-selected="true" classes="sphinx-tabs-tab code-tab group-tab" ids="tab-0-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tab" tabindex="0">GDScript</button>
                    <button aria-controls="panel-0-QyM=" aria-selected="false" classes="sphinx-tabs-tab code-tab group-tab" ids="tab-0-QyM=" name="QyM=" role="tab" tabindex="-1">C#</button>
                </div>
                <div aria-labelledby="tab-0-R0RTY3JpcHQ=" classes="sphinx-tabs-panel code-tab group-tab" ids="panel-0-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tabpanel" tabindex="0">
                    <literal_block force="False" highlight_args="{}" language="gdscript" linenos="False" xml:space="preserve">var effect
var recording


func _ready():
    # We get the index of the "Record" bus.
    var idx = AudioServer.get_bus_index("Record")
    # And use it to retrieve its first effect, which has been defined
    # as an "AudioEffectRecord" resource.
    effect = AudioServer.get_bus_effect(idx, 0)</literal_block>
                </div>
                <div aria-labelledby="tab-0-QyM=" classes="sphinx-tabs-panel code-tab group-tab" hidden="true" ids="panel-0-QyM=" name="QyM=" role="tabpanel" tabindex="0">
                    <literal_block force="False" highlight_args="{}" language="csharp" linenos="False" xml:space="preserve">private AudioEffectRecord _effect;
private AudioStreamSample _recording;

public override void _Ready()
{
    // We get the index of the "Record" bus.
    int idx = AudioServer.GetBusIndex("Record");
    // And use it to retrieve its first effect, which has been defined
    // as an "AudioEffectRecord" resource.
    _effect = (AudioEffectRecord)AudioServer.GetBusEffect(idx, 0);
}</literal_block>
                </div>
            </container>
            <paragraph>The audio recording is handled by the <reference internal="True" refuri="../../classes/class_audioeffectrecord#class-audioeffectrecord"><inline classes="std std-ref">AudioEffectRecord</inline></reference> resource
                which has three methods:
                <reference internal="True" refuri="../../classes/class_audioeffectrecord#class-audioeffectrecord-method-get-recording"><inline classes="std std-ref">get_recording()</inline></reference>,
                <reference internal="True" refuri="../../classes/class_audioeffectrecord#class-audioeffectrecord-method-is-recording-active"><inline classes="std std-ref">is_recording_active()</inline></reference>,
                and <reference internal="True" refuri="../../classes/class_audioeffectrecord#class-audioeffectrecord-method-set-recording-active"><inline classes="std std-ref">set_recording_active()</inline></reference>.</paragraph>
            <container classes="sphinx-tabs" type="tab-element">
                <div aria-label="Tabbed content" role="tablist">
                    <button aria-controls="panel-1-R0RTY3JpcHQ=" aria-selected="true" classes="sphinx-tabs-tab code-tab group-tab" ids="tab-1-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tab" tabindex="0">GDScript</button>
                    <button aria-controls="panel-1-QyM=" aria-selected="false" classes="sphinx-tabs-tab code-tab group-tab" ids="tab-1-QyM=" name="QyM=" role="tab" tabindex="-1">C#</button>
                </div>
                <div aria-labelledby="tab-1-R0RTY3JpcHQ=" classes="sphinx-tabs-panel code-tab group-tab" ids="panel-1-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tabpanel" tabindex="0">
                    <literal_block force="False" highlight_args="{}" language="gdscript" linenos="False" xml:space="preserve">func _on_record_button_pressed():
    if effect.is_recording_active():
        recording = effect.get_recording()
        $PlayButton.disabled = false
        $SaveButton.disabled = false
        effect.set_recording_active(false)
        $RecordButton.text = "Record"
        $Status.text = ""
    else:
        $PlayButton.disabled = true
        $SaveButton.disabled = true
        effect.set_recording_active(true)
        $RecordButton.text = "Stop"
        $Status.text = "Recording..."</literal_block>
                </div>
                <div aria-labelledby="tab-1-QyM=" classes="sphinx-tabs-panel code-tab group-tab" hidden="true" ids="panel-1-QyM=" name="QyM=" role="tabpanel" tabindex="0">
                    <literal_block force="False" highlight_args="{}" language="csharp" linenos="False" xml:space="preserve">private void OnRecordButtonPressed()
{
    if (_effect.IsRecordingActive())
    {
        _recording = _effect.GetRecording();
        GetNode&lt;Button&gt;("PlayButton").Disabled = false;
        GetNode&lt;Button&gt;("SaveButton").Disabled = false;
        _effect.SetRecordingActive(false);
        GetNode&lt;Button&gt;("RecordButton").Text = "Record";
        GetNode&lt;Label&gt;("Status").Text = "";
    }
    else
    {
        GetNode&lt;Button&gt;("PlayButton").Disabled = true;
        GetNode&lt;Button&gt;("SaveButton").Disabled = true;
        _effect.SetRecordingActive(true);
        GetNode&lt;Button&gt;("RecordButton").Text = "Stop";
        GetNode&lt;Label&gt;("Status").Text = "Recording...";
    }
}</literal_block>
                </div>
            </container>
            <paragraph>At the start of the demo, the recording effect is not active. When the user
                presses the <literal>RecordButton</literal>, the effect is enabled with
                <literal>set_recording_active(true)</literal>.</paragraph>
            <paragraph>On the next button press, as <literal>effect.is_recording_active()</literal> is <literal>true</literal>,
                the recorded stream can be stored into the <literal>recording</literal> variable by calling
                <literal>effect.get_recording()</literal>.</paragraph>
            <container classes="sphinx-tabs" type="tab-element">
                <div aria-label="Tabbed content" role="tablist">
                    <button aria-controls="panel-2-R0RTY3JpcHQ=" aria-selected="true" classes="sphinx-tabs-tab code-tab group-tab" ids="tab-2-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tab" tabindex="0">GDScript</button>
                    <button aria-controls="panel-2-QyM=" aria-selected="false" classes="sphinx-tabs-tab code-tab group-tab" ids="tab-2-QyM=" name="QyM=" role="tab" tabindex="-1">C#</button>
                </div>
                <div aria-labelledby="tab-2-R0RTY3JpcHQ=" classes="sphinx-tabs-panel code-tab group-tab" ids="panel-2-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tabpanel" tabindex="0">
                    <literal_block force="False" highlight_args="{}" language="gdscript" linenos="False" xml:space="preserve">func _on_play_button_pressed():
    print(recording)
    print(recording.format)
    print(recording.mix_rate)
    print(recording.stereo)
    var data = recording.get_data()
    print(data.size())
    $AudioStreamPlayer.stream = recording
    $AudioStreamPlayer.play()</literal_block>
                </div>
                <div aria-labelledby="tab-2-QyM=" classes="sphinx-tabs-panel code-tab group-tab" hidden="true" ids="panel-2-QyM=" name="QyM=" role="tabpanel" tabindex="0">
                    <literal_block force="False" highlight_args="{}" language="csharp" linenos="False" xml:space="preserve">private void OnPlayButtonPressed()
{
    GD.Print(_recording);
    GD.Print(_recording.Format);
    GD.Print(_recording.MixRate);
    GD.Print(_recording.Stereo);
    byte[] data = _recording.Data;
    GD.Print(data.Length);
    var audioStreamPlayer = GetNode&lt;AudioStreamPlayer&gt;("AudioStreamPlayer");
    audioStreamPlayer.Stream = _recording;
    audioStreamPlayer.Play();
}</literal_block>
                </div>
            </container>
            <paragraph>To playback the recording, you assign the recording as the stream of the
                <literal>AudioStreamPlayer</literal> and call <literal>play()</literal>.</paragraph>
            <container classes="sphinx-tabs" type="tab-element">
                <div aria-label="Tabbed content" role="tablist">
                    <button aria-controls="panel-3-R0RTY3JpcHQ=" aria-selected="true" classes="sphinx-tabs-tab code-tab group-tab" ids="tab-3-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tab" tabindex="0">GDScript</button>
                    <button aria-controls="panel-3-QyM=" aria-selected="false" classes="sphinx-tabs-tab code-tab group-tab" ids="tab-3-QyM=" name="QyM=" role="tab" tabindex="-1">C#</button>
                </div>
                <div aria-labelledby="tab-3-R0RTY3JpcHQ=" classes="sphinx-tabs-panel code-tab group-tab" ids="panel-3-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tabpanel" tabindex="0">
                    <literal_block force="False" highlight_args="{}" language="gdscript" linenos="False" xml:space="preserve">func _on_save_button_pressed():
    var save_path = $SaveButton/Filename.text
    recording.save_to_wav(save_path)
    $Status.text = "Saved WAV file to: %s\n(%s)" % [save_path, ProjectSettings.globalize_path(save_path)]</literal_block>
                </div>
                <div aria-labelledby="tab-3-QyM=" classes="sphinx-tabs-panel code-tab group-tab" hidden="true" ids="panel-3-QyM=" name="QyM=" role="tabpanel" tabindex="0">
                    <literal_block force="False" highlight_args="{}" language="csharp" linenos="False" xml:space="preserve">private void OnSaveButtonPressed()
{
    string savePath = GetNode&lt;LineEdit&gt;("SaveButton/Filename").Text;
    _recording.SaveToWav(savePath);
    GetNode&lt;Label&gt;("Status").Text = string.Format("Saved WAV file to: {0}\n({1})", savePath, ProjectSettings.GlobalizePath(savePath));
}</literal_block>
                </div>
            </container>
            <paragraph>To save the recording, you call <literal>save_to_wav()</literal> with the path to a file.
                In this demo, the path is defined by the user via a <literal>LineEdit</literal> input box.</paragraph>
            <substitution_definition names="weblate_widget"><reference refuri="https://hosted.weblate.org/engage/godot-engine/?utm_source=widget"><image alt="Translation status" candidates="{'?': 'https://hosted.weblate.org/widgets/godot-engine/-/godot-docs/287x66-white.png'}" height="66" uri="https://hosted.weblate.org/widgets/godot-engine/-/godot-docs/287x66-white.png" width="287"></image></reference></substitution_definition>
        </section>
    </section>
</document>
