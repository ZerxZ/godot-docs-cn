<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.21.2 -->
<document source="/home/runner/work/godot-docs-cn/godot-docs-cn/godot-docs/docs/tutorials/physics/ragdoll_system.rst" translation_progress="{'total': 0, 'translated': 0}" xmlns:c="https://www.sphinx-doc.org/" xmlns:changeset="https://www.sphinx-doc.org/" xmlns:citation="https://www.sphinx-doc.org/" xmlns:cpp="https://www.sphinx-doc.org/" xmlns:index="https://www.sphinx-doc.org/" xmlns:js="https://www.sphinx-doc.org/" xmlns:math="https://www.sphinx-doc.org/" xmlns:py="https://www.sphinx-doc.org/" xmlns:rst="https://www.sphinx-doc.org/" xmlns:std="https://www.sphinx-doc.org/">
    <target refid="doc-ragdoll-system"></target>
    <section ids="ragdoll-system doc-ragdoll-system" names="ragdoll\ system doc_ragdoll_system">
        <title>Ragdoll system</title>
        <section ids="introduction" names="introduction">
            <title>Introduction</title>
            <paragraph>Godot supports ragdoll physics. Ragdolls rely on physics simulation to create
                realistic procedural animation. They are used for death animations in many games.</paragraph>
            <paragraph>In this tutorial, we will be using the Platformer 3D demo to set up a ragdoll.</paragraph>
            <note>
                <paragraph>You can download the Platformer 3D demo on
                    <reference name="GitHub" refuri="https://github.com/godotengine/godot-demo-projects/tree/master/3d/platformer">GitHub</reference><target ids="github" names="github" refuri="https://github.com/godotengine/godot-demo-projects/tree/master/3d/platformer"></target>
                    or using the <reference name="Asset Library" refuri="https://godotengine.org/asset-library/asset/2748">Asset Library</reference><target ids="asset-library" names="asset\ library" refuri="https://godotengine.org/asset-library/asset/2748"></target>.</paragraph>
                <paragraph>You can also check out an example of a complete ragdoll setup in the
                    <reference name="Ragdoll Physics demo" refuri="https://github.com/godotengine/godot-demo-projects/tree/master/3d/ragdoll_physics">Ragdoll Physics demo</reference><target ids="ragdoll-physics-demo" names="ragdoll\ physics\ demo" refuri="https://github.com/godotengine/godot-demo-projects/tree/master/3d/ragdoll_physics"></target>.</paragraph>
            </note>
        </section>
        <section ids="setting-up-the-ragdoll" names="setting\ up\ the\ ragdoll">
            <title>Setting up the ragdoll</title>
            <section ids="creating-physical-bones" names="creating\ physical\ bones">
                <title>Creating physical bones</title>
                <paragraph>Like many other features in the engine, there are two nodes which are used
                    to set up a ragdoll:</paragraph>
                <bullet_list bullet="-">
                    <list_item>
                        <paragraph>A <reference internal="True" refuri="../../classes/class_physicalbonesimulator3d#class-physicalbonesimulator3d"><inline classes="std std-ref">PhysicalBoneSimulator3D</inline></reference> node.
                            This node is the parent of all physical bones and is responsible
                            for controlling the simulation.</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>One or more <reference internal="True" refuri="../../classes/class_physicalbone3d#class-physicalbone3d"><inline classes="std std-ref">PhysicalBone3D</inline></reference> children.
                            Each node represents a single bone in the ragdoll.</paragraph>
                    </list_item>
                </bullet_list>
                <paragraph>Open the platformer demo in Godot, and then the <literal>player/player.tscn</literal> scene.
                    Select the <literal>Skeleton3D</literal> node. A skeleton button appears at the top of the
                    3D editor viewport:</paragraph>
                <figure align="center" ids="id1">
                    <image alt="Creating a physical skeleton in the editor" candidates="{'*': 'tutorials/physics/img/ragdoll_system_create_physical_skeleton.webp'}" original_uri="img/ragdoll_system_create_physical_skeleton.webp" uri="tutorials/physics/img/ragdoll_system_create_physical_skeleton.webp"></image>
                    <caption>Creating a physical skeleton in the editor</caption>
                </figure>
                <paragraph>Click it and select the <inline classes="role-menu role-ui">Create Physical Skeleton</inline> option. Godot will generate
                    PhysicalBone3D nodes and collision shapes for each bone in the skeleton and
                    pin joints to connect them together:</paragraph>
                <figure align="center" ids="id2">
                    <image alt="Scene tree of the player scene after creating a physical skeleton" candidates="{'*': 'tutorials/physics/img/ragdoll_system_skeleton_scene_tree.webp'}" original_uri="img/ragdoll_system_skeleton_scene_tree.webp" uri="tutorials/physics/img/ragdoll_system_skeleton_scene_tree.webp"></image>
                    <caption>Scene tree of the player scene after creating a physical skeleton</caption>
                </figure>
                <paragraph>Some of the generated bones aren't necessary, such as the <literal>MASTER</literal> bone in this scene.
                    We're going to clean up the skeleton by removing them.</paragraph>
            </section>
            <section ids="clean-up-and-optimize-the-skeleton" names="clean\ up\ and\ optimize\ the\ skeleton">
                <title>Clean up and optimize the skeleton</title>
                <paragraph>For each PhysicalBone3D the engine needs to simulate, there is a performance cost.
                    You'll want to remove every bone that is too small to make a difference in the simulation,
                    as well as all utility bones.</paragraph>
                <paragraph>For example, if we take a humanoid, you don't need to have physical bones for each finger.
                    You can use a single bone for the entire hand instead, or one for the palm, one for the thumb,
                    and a last one for the other four fingers.</paragraph>
                <paragraph>Remove these PhysicalBone3D nodes: <literal>MASTER</literal>, <literal>waist</literal>, <literal>neck</literal>, <literal>headtracker</literal>.
                    This gives us an optimized skeleton and makes it easier to control the ragdoll.</paragraph>
            </section>
            <section ids="adjust-joints-and-constraints" names="adjust\ joints\ and\ constraints">
                <title>Adjust joints and constraints</title>
                <paragraph>Once you adjusted the collision shapes, your ragdoll is almost ready. Now, you need
                    to adjust the pin joints to get a better simulation. PhysicalBone3D nodes have an
                    unconstrained pin joint assigned to them by default. To change the pin joint,
                    select a PhysicalBone3D node and change the constraint type in the <inline classes="role-menu role-ui">Joint</inline> section
                    of the inspector. There, you can change the constraint's orientation and its limits.</paragraph>
                <paragraph>Joints have a gizmo visible in the 3D editor as well, so you can see their constraints
                    in action.</paragraph>
                <figure align="center" ids="id3">
                    <image alt="Adjusting joints in the inspector after selecting a PhysicalBone3D node" candidates="{'*': 'tutorials/physics/img/ragdoll_system_adjust_joints_inspector.webp'}" original_uri="img/ragdoll_system_adjust_joints_inspector.webp" uri="tutorials/physics/img/ragdoll_system_adjust_joints_inspector.webp"></image>
                    <caption>Adjusting joints in the inspector after selecting a PhysicalBone3D node</caption>
                </figure>
                <tip>
                    <paragraph>To get a better view when editing joints and collision shapes, you can do the following:</paragraph>
                    <bullet_list bullet="-">
                        <list_item>
                            <paragraph>Hide PhysicalBone3D nodes you aren't currently working on, so you can focus
                                on the ones you're adjusting.</paragraph>
                        </list_item>
                        <list_item>
                            <paragraph>Hide the MeshInstance3D of the character by clicking the eye icon next to it
                                in the scene tree dock.</paragraph>
                        </list_item>
                        <list_item>
                            <paragraph>Hide the Skeleton3D gizmos, so that the orange triangles that represent the skeleton
                                don't clutter the viewport while leaving the rest visible.
                                To do so, click <inline classes="role-menu role-ui">View &gt; Gizmos &gt; Skeleton3D</inline> at the top of the 3D editor
                                viewport until the eye icon appears closed.</paragraph>
                        </list_item>
                        <list_item>
                            <paragraph>Disable the preview environment by clicking the globe icon at the top of
                                the 3D editor viewport.</paragraph>
                        </list_item>
                        <list_item>
                            <paragraph>Set the <strong>Default Clear Color</strong> project setting to pure black in the Project Settings.
                                This is only effective if the preview environment is disabled.</paragraph>
                        </list_item>
                        <list_item>
                            <paragraph>Change the debug draw mode using the <inline classes="role-menu role-ui">Perspective</inline> button
                                in the top-left corner of the 3D editor viewport. The <inline classes="role-menu role-ui">Display Wireframe</inline>
                                and <inline classes="role-menu role-ui">Display Overdraw</inline> options are particularly useful when adjusting
                                collision shapes, as they allow you to see through the original mesh.</paragraph>
                        </list_item>
                        <list_item>
                            <paragraph>Use the orthographic camera by clicking the <inline classes="role-button role-ui">X</inline>/<inline classes="role-button role-ui">Y</inline>/<inline classes="role-button role-ui">Z</inline>
                                buttons in the top-right corner of the 3D editor viewport.</paragraph>
                        </list_item>
                    </bullet_list>
                </tip>
                <paragraph>Here is the list of joints available:</paragraph>
                <bullet_list bullet="-">
                    <list_item>
                        <paragraph><strong>None:</strong> Does not perform any constraint.</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph><strong>ConeJoint:</strong> Ball-and-socket. Useful for shoulders, hips, neck.</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph><strong>HingeJoint:</strong> Provides an angular constraint; think of it like a door hinge.
                            Useful for elbows and knees.</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph><strong>PinJoint:</strong> Keeps two bodies connected <emphasis>(default)</emphasis>.
                            Leads to "crumpling" of the bones, so it's recommended to use other joint types
                            for most characters instead.</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph><strong>SliderJoint:</strong> Slides one bone along another on a specific axis.</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph><strong>6DOFJoint:</strong> Most powerful joint, offering both linear and angular constraints,
                            but also the most complex to configure.</paragraph>
                    </list_item>
                </bullet_list>
                <paragraph>If in doubt, start with HingeJoint and ConeJoint, as they cover most use cases:</paragraph>
                <bullet_list bullet="-">
                    <list_item>
                        <paragraph>For HingeJoint, make sure to enable <strong>Angular Limit</strong> in the
                            <inline classes="role-menu role-ui">Joint Constraints</inline> section of the inspector. After enabling it,
                            you can see the angle that it's being constrained to in the viewport.
                            You can rotate the PhysicalBone3D to change the axis where the joint
                            is constrained, then adjust the angles.</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>For ConeJoint, it's usually best to limit <strong>Swing Span</strong> between 20 and
                            90 degrees, and the <strong>Twist Span</strong> between 20 and 45 degrees.</paragraph>
                    </list_item>
                </bullet_list>
            </section>
            <section ids="adjust-collision-shapes" names="adjust\ collision\ shapes">
                <title>Adjust collision shapes</title>
                <paragraph>The next task is adjusting the collision shape and the size of the physical bones
                    to match the part of the body that each bone should simulate.</paragraph>
                <paragraph>It's recommended to adjust collision shapes <emphasis>after</emphasis> adjusting joints and constraints,
                    as rotating a joint will also rotate the collision shape. To avoid having
                    to adjust collision shapes twice, it's better to adjust joints first.</paragraph>
                <paragraph>Note that it's possible to have multiple collision shapes as a child of a
                    PhysicalBone3D node. This can be useful to represent particularly complex
                    shapes of limbs that are otherwise rigid.</paragraph>
                <tip>
                    <paragraph>To pause animation playback while adjusting the ragdoll, select the
                        <literal>AnimationTree</literal> node and disable the <strong>Active</strong> property in the Inspector.
                        Remember to enable it again when you're done, as it controls animation playback
                        during gameplay.</paragraph>
                </tip>
                <figure align="center" ids="id4">
                    <image alt="Adjusting collision shapes in the 3D editor" candidates="{'*': 'tutorials/physics/img/ragdoll_system_adjust_collision_shapes.webp'}" original_uri="img/ragdoll_system_adjust_collision_shapes.webp" uri="tutorials/physics/img/ragdoll_system_adjust_collision_shapes.webp"></image>
                    <caption>Adjusting collision shapes in the 3D editor</caption>
                </figure>
                <paragraph>This is the final result:</paragraph>
                <figure align="center" ids="id5">
                    <image alt="Result after adjusting joints and collision shapes (player mesh is hidden for visibility)" candidates="{'*': 'tutorials/physics/img/ragdoll_system_result.webp'}" original_uri="img/ragdoll_system_result.webp" uri="tutorials/physics/img/ragdoll_system_result.webp"></image>
                    <caption>Result after adjusting joints and collision shapes (player mesh is hidden for visibility)</caption>
                </figure>
            </section>
        </section>
        <section ids="simulate-the-ragdoll" names="simulate\ the\ ragdoll">
            <title>Simulate the ragdoll</title>
            <paragraph>The ragdoll is now ready to use. To start the simulation and play the ragdoll animation,
                you need to call the
                <reference internal="True" refuri="../../classes/class_physicalbonesimulator3d#class-physicalbonesimulator3d-method-physical-bones-start-simulation"><inline classes="std std-ref">PhysicalBoneSimulator3D.physical_bones_start_simulation()</inline></reference>
                method. Attach a script to the <reference internal="True" refuri="../../classes/class_physicalbonesimulator3d#class-physicalbonesimulator3d"><inline classes="std std-ref">PhysicalBoneSimulator3D</inline></reference> node
                that is the parent of all the PhysicalBone3D nodes in our scene, then call it in the script's
                <literal>_ready</literal> method:</paragraph>
            <container classes="sphinx-tabs" type="tab-element">
                <div aria-label="Tabbed content" role="tablist">
                    <button aria-controls="panel-0-R0RTY3JpcHQ=" aria-selected="true" classes="sphinx-tabs-tab code-tab group-tab" ids="tab-0-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tab" tabindex="0">GDScript</button>
                    <button aria-controls="panel-0-QyM=" aria-selected="false" classes="sphinx-tabs-tab code-tab group-tab" ids="tab-0-QyM=" name="QyM=" role="tab" tabindex="-1">C#</button>
                </div>
                <div aria-labelledby="tab-0-R0RTY3JpcHQ=" classes="sphinx-tabs-panel code-tab group-tab" ids="panel-0-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tabpanel" tabindex="0">
                    <literal_block force="False" highlight_args="{}" language="gdscript" linenos="False" xml:space="preserve">func _ready():
    physical_bones_start_simulation()</literal_block>
                </div>
                <div aria-labelledby="tab-0-QyM=" classes="sphinx-tabs-panel code-tab group-tab" hidden="true" ids="panel-0-QyM=" name="QyM=" role="tabpanel" tabindex="0">
                    <literal_block force="False" highlight_args="{}" language="csharp" linenos="False" xml:space="preserve">public override void _Ready()
{
    PhysicalBonesStartSimulation();
}</literal_block>
                </div>
            </container>
            <paragraph>To stop the simulation, call the
                <reference internal="True" refuri="../../classes/class_physicalbonesimulator3d#class-physicalbonesimulator3d-method-physical-bones-stop-simulation"><inline classes="std std-ref">PhysicalBoneSimulator3D.physical_bones_stop_simulation()</inline></reference>
                method.</paragraph>
            <video_node align="default" alt="Full simulation of ragdoll system, with the player falling to the ground" autoplay="True" caption="" controls="True" controlslist="" figwidth="" height="" klass="" loop="True" muted="True" playsinline="False" poster="" preload="auto" sources="['tutorials/physics/video/ragdoll_system_full_simulation.webm',\ 'video/webm',\ False]" width="100%">
            </video_node>
            <paragraph>You can also limit the simulation to only a few bones. This can be useful
                to create effects such as ragdoll limbs or attachments that can interact
                with the world. To do so, pass the bone names (<emphasis>not</emphasis> the PhysicalBone3D
                node names) as a parameter. To see the bone name, look at the
                <strong>Bone Name</strong> property in the inspector after selecting a PhysicalBone3D node.</paragraph>
            <tip>
                <paragraph>When using an automatically generated physical skeleton as shown in this tutorial,
                    the bone name is also contained in the node name. For example, in
                    <literal>Physical Bone l-arm</literal>, <literal>l-arm</literal> is the bone name.</paragraph>
            </tip>
            <container classes="sphinx-tabs" type="tab-element">
                <div aria-label="Tabbed content" role="tablist">
                    <button aria-controls="panel-1-R0RTY3JpcHQ=" aria-selected="true" classes="sphinx-tabs-tab code-tab group-tab" ids="tab-1-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tab" tabindex="0">GDScript</button>
                    <button aria-controls="panel-1-QyM=" aria-selected="false" classes="sphinx-tabs-tab code-tab group-tab" ids="tab-1-QyM=" name="QyM=" role="tab" tabindex="-1">C#</button>
                </div>
                <div aria-labelledby="tab-1-R0RTY3JpcHQ=" classes="sphinx-tabs-panel code-tab group-tab" ids="panel-1-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tabpanel" tabindex="0">
                    <literal_block force="False" highlight_args="{}" language="gdscript" linenos="False" xml:space="preserve">func _ready():
    physical_bones_start_simulation(["l-arm", "r-arm"])</literal_block>
                </div>
                <div aria-labelledby="tab-1-QyM=" classes="sphinx-tabs-panel code-tab group-tab" hidden="true" ids="panel-1-QyM=" name="QyM=" role="tabpanel" tabindex="0">
                    <literal_block force="False" highlight_args="{}" language="csharp" linenos="False" xml:space="preserve">public override void _Ready()
{
    PhysicalBonesStartSimulation(["l-arm", "r-arm"]);
}</literal_block>
                </div>
            </container>
            <paragraph>Note that nonexistent bone names will not print any error or warning. If
                nothing happens when starting the simulation (or if the whole body is ragdolled
                instead of only specific bones), double-check the list of provided bones.</paragraph>
            <paragraph>Here's an example of partial ragdoll simulation:</paragraph>
            <video_node align="default" alt="Partial simulation of ragdoll system, with arms flailing while the player is walking" autoplay="True" caption="" controls="True" controlslist="" figwidth="" height="" klass="" loop="True" muted="True" playsinline="False" poster="" preload="auto" sources="['tutorials/physics/video/ragdoll_system_partial_simulation.webm',\ 'video/webm',\ False]" width="100%">
            </video_node>
            <tip>
                <paragraph>To control how strongly the partial ragdoll simulation affects the overall animation,
                    you can adjust the <strong>Influence</strong> property in the
                    <reference internal="True" refuri="../../classes/class_physicalbonesimulator3d#class-physicalbonesimulator3d"><inline classes="std std-ref">PhysicalBoneSimulator3D</inline></reference> node that is the
                    parent of all PhysicalBone3D nodes. By default, it's set to <literal>1.0</literal>, which means
                    the ragdoll simulation fully overrides the rest of the animation.</paragraph>
            </tip>
            <section ids="collision-layer-and-mask" names="collision\ layer\ and\ mask">
                <title>Collision layer and mask</title>
                <paragraph>Make sure to set up your collision layers and masks properly so the
                    CharacterBody3D's capsule doesn't get in the way of the physics simulation.
                    Remember to adjust the collision layer and mask in the coin scene
                    as well, so that the player can still collect coins:</paragraph>
                <figure align="center" ids="id6">
                    <image alt="Layers and masks must be adjusted to these values in the inspector for each node" candidates="{'*': 'tutorials/physics/img/ragdoll_system_collision_layers_masks.webp'}" original_uri="img/ragdoll_system_collision_layers_masks.webp" uri="tutorials/physics/img/ragdoll_system_collision_layers_masks.webp"></image>
                    <caption>Layers and masks must be adjusted to these values in the inspector for each node</caption>
                </figure>
                <paragraph>You can find the GridMap in the 3D platformer demo in <literal>stage/grid_map.scn</literal>.
                    The coin's Area3D node (on which the layers and masks must be adjusted)
                    can be found at <literal>coin/coin.tscn</literal>.</paragraph>
                <tip>
                    <paragraph>To select all PhysicalBone3D nodes quickly, enter <literal>t:PhysicalBone3D</literal> in the
                        search bar at the top of the scene tree dock. This filters the scene tree
                        to only show PhysicalBone3D nodes, which allows you to select them all at once
                        using <literal classes="kbd">Shift + Left mouse button</literal> on the first and last entries.</paragraph>
                </tip>
                <paragraph>If this is not done, collision will behave incorrectly as the player will collide
                    with its own (inactive) ragdoll. This can cause the player to wildly
                    bounce around or get stuck.</paragraph>
                <paragraph>Like RigidBody3D, PhysicalBone3D supports collision exceptions through code
                    using the <reference internal="True" refuri="../../classes/class_physicalbonesimulator3d#class-physicalbonesimulator3d-method-physical-bones-add-collision-exception"><inline classes="std std-ref">physical_bones_add_collision_exception()</inline></reference>
                    and <reference internal="True" refuri="../../classes/class_physicalbonesimulator3d#class-physicalbonesimulator3d-method-physical-bones-remove-collision-exception"><inline classes="std std-ref">physical_bones_remove_collision_exception()</inline></reference>
                    methods. This can be used to prevent collisions with a specific object
                    without relying on layers and masks.</paragraph>
                <seealso>
                    <paragraph>For more information, see <reference internal="True" refuri="physics_introduction#doc-physics-introduction-collision-layers-and-masks"><inline classes="std std-ref">Collision layers and masks</inline></reference>.</paragraph>
                </seealso>
                <substitution_definition names="weblate_widget"><reference refuri="https://hosted.weblate.org/engage/godot-engine/?utm_source=widget"><image alt="Translation status" candidates="{'?': 'https://hosted.weblate.org/widgets/godot-engine/-/godot-docs/287x66-white.png'}" height="66" uri="https://hosted.weblate.org/widgets/godot-engine/-/godot-docs/287x66-white.png" width="287"></image></reference></substitution_definition>
            </section>
        </section>
    </section>
</document>
