<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.21.2 -->
<document source="/home/runner/work/godot-docs-cn/godot-docs-cn/godot-docs/docs/tutorials/physics/large_world_coordinates.rst" translation_progress="{'total': 0, 'translated': 0}" xmlns:c="https://www.sphinx-doc.org/" xmlns:changeset="https://www.sphinx-doc.org/" xmlns:citation="https://www.sphinx-doc.org/" xmlns:cpp="https://www.sphinx-doc.org/" xmlns:index="https://www.sphinx-doc.org/" xmlns:js="https://www.sphinx-doc.org/" xmlns:math="https://www.sphinx-doc.org/" xmlns:py="https://www.sphinx-doc.org/" xmlns:rst="https://www.sphinx-doc.org/" xmlns:std="https://www.sphinx-doc.org/">
    <target refid="doc-large-world-coordinates"></target>
    <section ids="large-world-coordinates doc-large-world-coordinates" names="large\ world\ coordinates doc_large_world_coordinates">
        <title>Large world coordinates</title>
        <note>
            <paragraph>Large world coordinates are mainly useful in 3D projects; they are rarely
                required in 2D projects. Also, unlike 3D rendering, 2D rendering currently
                doesn't benefit from increased precision when large world coordinates are
                enabled.</paragraph>
        </note>
        <section ids="why-use-large-world-coordinates" names="why\ use\ large\ world\ coordinates?">
            <title>Why use large world coordinates?</title>
            <paragraph>In Godot, physics simulation and rendering both rely on <emphasis>floating-point</emphasis> numbers.
                However, in computing, floating-point numbers have <strong>limited precision and range</strong>.
                This can be a problem for games with huge worlds, such as space or planetary-scale
                simulation games.</paragraph>
            <paragraph>Precision is the greatest when the value is close to <literal>0.0</literal>. Precision becomes
                gradually lower as the value increases or decreases away from <literal>0.0</literal>. This
                occurs every time the floating-point number's <emphasis>exponent</emphasis> increases, which
                happens when the floating-point number surpasses a power of 2 value (2, 4, 8,
                16, …). Every time this occurs, the number's minimum step will <emphasis>increase</emphasis>,
                resulting in a loss of precision.</paragraph>
            <paragraph>In practice, this means that as the player moves away from the world origin
                (<literal>Vector2(0, 0)</literal> in 2D games or <literal>Vector3(0, 0, 0)</literal> in 3D games), precision
                will decrease.</paragraph>
            <paragraph>This loss of precision can result in objects appearing to "vibrate" when far
                away from the world origin, as the model's position will snap to the
                nearest value that can be represented in a floating-point number. This can also
                result in physics glitches that only occur when the player is far from the world
                origin.</paragraph>
            <paragraph>The range determines the minimum and maximum values that can be stored in the
                number. If the player tries to move past this range, they will simply not be
                able to. However, in practice, floating-point precision almost always becomes
                a problem before the range does.</paragraph>
            <paragraph>The range and precision (minimum step between two exponent intervals) are
                determined by the floating-point number type. The <emphasis>theoretical</emphasis> range allows
                extremely high values to be stored in single-precision floats, but with very low
                precision. In practice, a floating-point type that cannot represent all integer
                values is not very useful. At extreme values, precision becomes so low that the
                number cannot even distinguish two separate <emphasis>integer</emphasis> values from each other.</paragraph>
            <paragraph>This is the range where individual integer values can be represented in a
                floating-point number:</paragraph>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph><strong>Single-precision float range (represent all integers):</strong> Between -16,777,216 and 16,777,216</paragraph>
                </list_item>
                <list_item>
                    <paragraph><strong>Double-precision float range (represent all integers):</strong> Between -9 quadrillion and 9 quadrillion</paragraph>
                </list_item>
            </bullet_list>
            <table>
                <tgroup cols="4">
                    <colspec colwidth="22"></colspec>
                    <colspec colwidth="23"></colspec>
                    <colspec colwidth="23"></colspec>
                    <colspec colwidth="77"></colspec>
                    <tbody>
                        <row>
                            <entry>
                                <paragraph>Range</paragraph>
                            </entry>
                            <entry>
                                <paragraph>Single step</paragraph>
                            </entry>
                            <entry>
                                <paragraph>Double step</paragraph>
                            </entry>
                            <entry>
                                <paragraph>Comment</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>[1; 2]</paragraph>
                            </entry>
                            <entry>
                                <paragraph>~0.0000001</paragraph>
                            </entry>
                            <entry>
                                <paragraph>~1e-15</paragraph>
                            </entry>
                            <entry>
                                <paragraph>Precision becomes greater near 0.0 (this table is abbreviated).</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>[2; 4]</paragraph>
                            </entry>
                            <entry>
                                <paragraph>~0.0000002</paragraph>
                            </entry>
                            <entry>
                                <paragraph>~1e-15</paragraph>
                            </entry>
                            <entry>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>[4; 8]</paragraph>
                            </entry>
                            <entry>
                                <paragraph>~0.0000005</paragraph>
                            </entry>
                            <entry>
                                <paragraph>~1e-15</paragraph>
                            </entry>
                            <entry>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>[8; 16]</paragraph>
                            </entry>
                            <entry>
                                <paragraph>~0.000001</paragraph>
                            </entry>
                            <entry>
                                <paragraph>~1e-14</paragraph>
                            </entry>
                            <entry>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>[16; 32]</paragraph>
                            </entry>
                            <entry>
                                <paragraph>~0.000002</paragraph>
                            </entry>
                            <entry>
                                <paragraph>~1e-14</paragraph>
                            </entry>
                            <entry>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>[32; 64]</paragraph>
                            </entry>
                            <entry>
                                <paragraph>~0.000004</paragraph>
                            </entry>
                            <entry>
                                <paragraph>~1e-14</paragraph>
                            </entry>
                            <entry>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>[64; 128]</paragraph>
                            </entry>
                            <entry>
                                <paragraph>~0.000008</paragraph>
                            </entry>
                            <entry>
                                <paragraph>~1e-13</paragraph>
                            </entry>
                            <entry>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>[128; 256]</paragraph>
                            </entry>
                            <entry>
                                <paragraph>~0.000015</paragraph>
                            </entry>
                            <entry>
                                <paragraph>~1e-13</paragraph>
                            </entry>
                            <entry>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>[256; 512]</paragraph>
                            </entry>
                            <entry>
                                <paragraph>~0.00003</paragraph>
                            </entry>
                            <entry>
                                <paragraph>~1e-13</paragraph>
                            </entry>
                            <entry>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>[512; 1024]</paragraph>
                            </entry>
                            <entry>
                                <paragraph>~0.00006</paragraph>
                            </entry>
                            <entry>
                                <paragraph>~1e-12</paragraph>
                            </entry>
                            <entry>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>[1024; 2048]</paragraph>
                            </entry>
                            <entry>
                                <paragraph>~0.0001</paragraph>
                            </entry>
                            <entry>
                                <paragraph>~1e-12</paragraph>
                            </entry>
                            <entry>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>[2048; 4096]</paragraph>
                            </entry>
                            <entry>
                                <paragraph>~0.0002</paragraph>
                            </entry>
                            <entry>
                                <paragraph>~1e-12</paragraph>
                            </entry>
                            <entry>
                                <paragraph>Maximum <emphasis>recommended</emphasis> single-precision range for a first-person 3D game
                                    without rendering artifacts or physics glitches.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>[4096; 8192]</paragraph>
                            </entry>
                            <entry>
                                <paragraph>~0.0005</paragraph>
                            </entry>
                            <entry>
                                <paragraph>~1e-12</paragraph>
                            </entry>
                            <entry>
                                <paragraph>Maximum <emphasis>recommended</emphasis> single-precision range for a third-person 3D game
                                    without rendering artifacts or physics glitches.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>[8192; 16384]</paragraph>
                            </entry>
                            <entry>
                                <paragraph>~0.001</paragraph>
                            </entry>
                            <entry>
                                <paragraph>~1e-12</paragraph>
                            </entry>
                            <entry>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>[16384; 32768]</paragraph>
                            </entry>
                            <entry>
                                <paragraph>~0.0019</paragraph>
                            </entry>
                            <entry>
                                <paragraph>~1e-11</paragraph>
                            </entry>
                            <entry>
                                <paragraph>Maximum <emphasis>recommended</emphasis> single-precision range for a top-down 3D game
                                    without rendering artifacts or physics glitches.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>[32768; 65536]</paragraph>
                            </entry>
                            <entry>
                                <paragraph>~0.0039</paragraph>
                            </entry>
                            <entry>
                                <paragraph>~1e-11</paragraph>
                            </entry>
                            <entry>
                                <paragraph>Maximum <emphasis>recommended</emphasis> single-precision range for any 3D game. Double
                                    precision (large world coordinates) is usually required past this point.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>[65536; 131072]</paragraph>
                            </entry>
                            <entry>
                                <paragraph>~0.0078</paragraph>
                            </entry>
                            <entry>
                                <paragraph>~1e-11</paragraph>
                            </entry>
                            <entry>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>[131072; 262144]</paragraph>
                            </entry>
                            <entry>
                                <paragraph>~0.0156</paragraph>
                            </entry>
                            <entry>
                                <paragraph>~1e-10</paragraph>
                            </entry>
                            <entry>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>&gt; 262144</paragraph>
                            </entry>
                            <entry>
                                <paragraph>&gt; ~0.0313</paragraph>
                            </entry>
                            <entry>
                                <paragraph>~1e-10 (0.0000000001)</paragraph>
                            </entry>
                            <entry>
                                <paragraph>Double-precision remains far more precise than single-precision
                                    past this value.</paragraph>
                            </entry>
                        </row>
                    </tbody>
                </tgroup>
            </table>
            <paragraph>When using single-precision floats, it is possible to go past the suggested
                ranges, but more visible artifacting will occur and physics glitches will be
                more common (such as the player not walking straight in certain directions).</paragraph>
            <seealso>
                <paragraph>See the <reference name="Demystifying Floating Point Precision" refuri="https://blog.demofox.org/2017/11/21/">Demystifying Floating Point Precision</reference>
                    article for more information.</paragraph>
            </seealso>
        </section>
        <section ids="how-large-world-coordinates-work" names="how\ large\ world\ coordinates\ work">
            <title>How large world coordinates work</title>
            <paragraph>Large world coordinates (also known as <strong>double-precision physics</strong>) increase
                the precision level of all floating-point computations within the engine.</paragraph>
            <paragraph>By default, <reference internal="True" refuri="../../classes/class_float#class-float"><inline classes="std std-ref">float</inline></reference> is 64-bit in GDScript, but <reference internal="True" refuri="../../classes/class_vector2#class-vector2"><inline classes="std std-ref">Vector2</inline></reference>,
                <reference internal="True" refuri="../../classes/class_vector3#class-vector3"><inline classes="std std-ref">Vector3</inline></reference> and <reference internal="True" refuri="../../classes/class_vector4#class-vector4"><inline classes="std std-ref">Vector4</inline></reference> are 32-bit. This means that the
                precision of vector types is much more limited. To resolve this, we can increase
                the number of bits used to represent a floating-point number in a Vector type.
                This results in an <emphasis>exponential</emphasis> increase in precision, which means the final
                value is not just twice as precise, but potentially thousands of times more
                precise at high values. The maximum value that can be represented is also
                greatly increased by going from a single-precision float to a double-precision
                float.</paragraph>
            <paragraph>To avoid model snapping issues when far away from the world origin, Godot's 3D
                rendering engine will increase its precision for rendering operations when large
                world coordinates are enabled. The shaders do not use double-precision floats
                for performance reasons, but an <reference name="alternative solution" refuri="https://github.com/godotengine/godot/pull/66178">alternative solution</reference>
                is used to emulate double precision for rendering using single-precision floats.</paragraph>
            <note>
                <paragraph>Enabling large world coordinates comes with a performance and memory usage
                    penalty, especially on 32-bit CPUs. Only enable large world coordinates if
                    you actually need them.</paragraph>
                <paragraph>This feature is tailored towards mid-range/high-end desktop platforms. Large
                    world coordinates may not perform well on low-end mobile devices, unless you
                    take steps to reduce CPU usage with other means (such as decreasing the
                    number of physics ticks per second).</paragraph>
                <paragraph>On low-end platforms, an <emphasis>origin shifting</emphasis> approach can be used instead to
                    allow for large worlds without using double-precision physics and rendering.
                    Origin shifting works with single-precision floats, but it introduces more
                    complexity to game logic, especially in multiplayer games. Therefore, origin
                    shifting is not detailed on this page.</paragraph>
            </note>
        </section>
        <section ids="who-are-large-world-coordinates-for" names="who\ are\ large\ world\ coordinates\ for?">
            <title>Who are large world coordinates for?</title>
            <paragraph>Large world coordinates are typically required for 3D space or planetary-scale
                simulation games. This extends to games that require supporting <emphasis>very</emphasis> fast
                movement speeds, but also very slow <emphasis>and</emphasis> precise movements at times.</paragraph>
            <paragraph>On the other hand, it's important to only use large world coordinates when
                actually required (for performance reasons). Large world coordinates are usually
                <strong>not</strong> required for:</paragraph>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph>2D games, as precision issues are usually less noticeable.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Games with small-scale or medium-scale worlds.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Games with large worlds, but split into different levels with loading
                        sequences in between. You can center each level portion around the world
                        origin to avoid precision issues without a performance penalty.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Open world games with a <emphasis>playable on-foot area</emphasis> not exceeding 8192×8192 meters
                        (centered around the world origin). As shown in the above table, the level of
                        precision remains acceptable within that range, even for a first-person game.</paragraph>
                </list_item>
            </bullet_list>
            <paragraph><strong>If in doubt</strong>, you probably don't need to use large world coordinates in your
                project. For reference, most modern AAA open world titles don't use a large
                world coordinates system and still rely on single-precision floats for both
                rendering and physics.</paragraph>
        </section>
        <section ids="enabling-large-world-coordinates" names="enabling\ large\ world\ coordinates">
            <title>Enabling large world coordinates</title>
            <paragraph>This process requires recompiling the editor and all export template binaries
                you intend to use. If you only intend to export your project in release mode,
                you can skip the compilation of debug export templates. In any case, you'll need
                to compile an editor build so you can test your large precision world without
                having to export the project every time.</paragraph>
            <paragraph>See the <reference internal="True" refuri="../../engine_details/development/compiling/index#toc-devel-compiling"><inline classes="std std-ref">Compiling</inline></reference> section for compiling
                instructions for each target platform. You will need to add the <literal>precision=double</literal>
                SCons option when compiling the editor and export templates.</paragraph>
            <paragraph>The resulting binaries will be named with a <literal>.double</literal> suffix to distinguish
                them from single-precision binaries (which lack any precision suffix). You can
                then specify the binaries as custom export templates in your project's export
                presets in the Export dialog.</paragraph>
        </section>
        <section ids="compatibility-between-single-precision-and-double-precision-builds" names="compatibility\ between\ single-precision\ and\ double-precision\ builds">
            <title>Compatibility between single-precision and double-precision builds</title>
            <paragraph>When saving a <emphasis>binary</emphasis> resource using the <reference internal="True" refuri="../../classes/class_resourcesaver#class-resourcesaver"><inline classes="std std-ref">ResourceSaver</inline></reference> singleton,
                a special flag is stored in the file if the resource was saved using a build
                that uses double-precision numbers. As a result, all binary resources will
                change on disk when you switch to a double-precision build and save over them.</paragraph>
            <paragraph>Both single-precision and double-precision builds support using the
                <reference internal="True" refuri="../../classes/class_resourceloader#class-resourceloader"><inline classes="std std-ref">ResourceLoader</inline></reference> singleton on resources that use this special flag.
                This means single-precision builds can load resources saved using
                double-precision builds and vice versa. Text-based resources don't store a
                double-precision flag, as they don't require such a flag for correct reading.</paragraph>
            <section ids="known-incompatibilities" names="known\ incompatibilities">
                <title>Known incompatibilities</title>
                <bullet_list bullet="-">
                    <list_item>
                        <paragraph>In a networked multiplayer game, the server and all clients should be using
                            the same build type to ensure precision remains consistent across clients.
                            Using different build types <emphasis>may</emphasis> work, but various issues can occur.</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>The GDExtension API changes in an incompatible way in double-precision builds.
                            This means extensions <strong>must</strong> be rebuilt to work with double-precision
                            builds. On the extension developer's end, the <literal>REAL_T_IS_DOUBLE</literal> define is
                            enabled when building a GDExtension with <literal>precision=double</literal>.
                            <literal>real_t</literal> can be used as an alias for <literal>float</literal> in single-precision builds,
                            and <literal>double</literal> in double-precision builds.</paragraph>
                    </list_item>
                </bullet_list>
            </section>
        </section>
        <section ids="limitations" names="limitations">
            <title>Limitations</title>
            <paragraph>Since 3D rendering shaders don't actually use double-precision floats, there are
                some limitations when it comes to 3D rendering precision:</paragraph>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph>Shaders using the <literal>skip_vertex_transform</literal> or <literal>world_vertex_coords</literal> don't
                        benefit from increased precision.</paragraph>
                </list_item>
                <list_item>
                    <paragraph><reference internal="True" refuri="../3d/standard_material_3d#doc-standard-material-3d-triplanar-mapping"><inline classes="std std-ref">Triplanar mapping</inline></reference> doesn't
                        benefit from increased precision. Materials using triplanar mapping will exhibit
                        visible jittering when far away from the world origin.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>In double-precision builds, world space coordinates in a shader <literal>fragment()</literal>
                        function can't be reconstructed from view space, for example:</paragraph>
                    <literal_block force="False" highlight_args="{}" language="glsl" linenos="False" xml:space="preserve">vec3 world = (INV_VIEW_MATRIX * vec4(VERTEX, 1.0)).xyz;</literal_block>
                    <paragraph>Instead, calculate the world space coordinates in the <literal>vertex()</literal> function and
                        pass them using a <reference internal="True" refuri="../shaders/shader_reference/shading_language#doc-shading-language-varyings"><inline classes="std std-ref">varying</inline></reference>, for example:</paragraph>
                    <literal_block force="False" highlight_args="{}" language="glsl" linenos="False" xml:space="preserve">varying vec3 world;
void vertex() {
    world = (MODEL_MATRIX * vec4(VERTEX, 1.0)).xyz;
}</literal_block>
                </list_item>
            </bullet_list>
            <paragraph>2D rendering currently doesn't benefit from increased precision when large world
                coordinates are enabled. This can cause visible model snapping to occur when
                far away from the world origin (starting from a few million pixels at typical
                zoom levels). 2D physics calculations will still benefit from increased
                precision though.</paragraph>
            <substitution_definition names="weblate_widget"><reference refuri="https://hosted.weblate.org/engage/godot-engine/?utm_source=widget"><image alt="Translation status" candidates="{'?': 'https://hosted.weblate.org/widgets/godot-engine/-/godot-docs/287x66-white.png'}" height="66" uri="https://hosted.weblate.org/widgets/godot-engine/-/godot-docs/287x66-white.png" width="287"></image></reference></substitution_definition>
        </section>
    </section>
</document>
