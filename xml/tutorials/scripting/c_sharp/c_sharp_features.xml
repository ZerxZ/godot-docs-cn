<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.21.2 -->
<document source="/home/runner/work/godot-docs-cn/godot-docs-cn/godot-docs/docs/tutorials/scripting/c_sharp/c_sharp_features.rst" translation_progress="{'total': 0, 'translated': 0}" xmlns:c="https://www.sphinx-doc.org/" xmlns:changeset="https://www.sphinx-doc.org/" xmlns:citation="https://www.sphinx-doc.org/" xmlns:cpp="https://www.sphinx-doc.org/" xmlns:index="https://www.sphinx-doc.org/" xmlns:js="https://www.sphinx-doc.org/" xmlns:math="https://www.sphinx-doc.org/" xmlns:py="https://www.sphinx-doc.org/" xmlns:rst="https://www.sphinx-doc.org/" xmlns:std="https://www.sphinx-doc.org/">
    <target refid="doc-c-sharp-features"></target>
    <section ids="c-language-features doc-c-sharp-features" names="c#\ language\ features doc_c_sharp_features">
        <title>C# language features</title>
        <paragraph>This page provides an overview of the commonly used features of both C# and Godot
            and how they are used together.</paragraph>
        <target refid="doc-c-sharp-features-type-conversion-and-casting"></target>
        <section ids="type-conversion-and-casting doc-c-sharp-features-type-conversion-and-casting" names="type\ conversion\ and\ casting doc_c_sharp_features_type_conversion_and_casting">
            <title>Type conversion and casting</title>
            <paragraph>C# is a statically typed language. Therefore, you can't do the following:</paragraph>
            <literal_block force="False" highlight_args="{}" language="csharp" linenos="False" xml:space="preserve">var mySprite = GetNode("MySprite");
mySprite.SetFrame(0);</literal_block>
            <paragraph>The method <literal>GetNode()</literal> returns a <literal>Node</literal> instance.
                You must explicitly convert it to the desired derived type, <literal>Sprite2D</literal> in this case.</paragraph>
            <paragraph>For this, you have various options in C#.</paragraph>
            <paragraph><strong>Casting and Type Checking</strong></paragraph>
            <paragraph>Throws <literal>InvalidCastException</literal> if the returned node cannot be cast to Sprite2D.
                You would use it instead of the <literal>as</literal> operator if you are pretty sure it won't fail.</paragraph>
            <literal_block force="False" highlight_args="{}" language="csharp" linenos="False" xml:space="preserve">Sprite2D mySprite = (Sprite2D)GetNode("MySprite");
mySprite.SetFrame(0);</literal_block>
            <paragraph><strong>Using the AS operator</strong></paragraph>
            <paragraph>The <literal>as</literal> operator returns <literal>null</literal> if the node cannot be cast to Sprite2D,
                and for that reason, it cannot be used with value types.</paragraph>
            <literal_block force="False" highlight_args="{}" language="csharp" linenos="False" xml:space="preserve">Sprite2D mySprite = GetNode("MySprite") as Sprite2D;
// Only call SetFrame() if mySprite is not null
mySprite?.SetFrame(0);</literal_block>
            <paragraph><strong>Using the generic methods</strong></paragraph>
            <paragraph>Generic methods are also provided to make this type conversion transparent.</paragraph>
            <paragraph><literal>GetNode&lt;T&gt;()</literal> casts the node before returning it. It will throw an <literal>InvalidCastException</literal> if the node cannot be cast to the desired type.</paragraph>
            <literal_block force="False" highlight_args="{}" language="csharp" linenos="False" xml:space="preserve">Sprite2D mySprite = GetNode&lt;Sprite2D&gt;("MySprite");
mySprite.SetFrame(0);</literal_block>
            <paragraph><literal>GetNodeOrNull&lt;T&gt;()</literal> uses the <literal>as</literal> operator and will return <literal>null</literal> if the node cannot be cast to the desired type.</paragraph>
            <literal_block force="False" highlight_args="{}" language="csharp" linenos="False" xml:space="preserve">Sprite2D mySprite = GetNodeOrNull&lt;Sprite2D&gt;("MySprite");
// Only call SetFrame() if mySprite is not null
mySprite?.SetFrame(0);</literal_block>
            <paragraph><strong>Type checking using the IS operator</strong></paragraph>
            <paragraph>To check if the node can be cast to Sprite2D, you can use the <literal>is</literal> operator.
                The <literal>is</literal> operator returns false if the node cannot be cast to Sprite2D,
                otherwise it returns true. Note that when the <literal>is</literal> operator is used against <literal>null</literal>
                the result is always going to be <literal>false</literal>.</paragraph>
            <literal_block force="False" highlight_args="{}" language="csharp" linenos="False" xml:space="preserve">if (GetNode("MySprite") is Sprite2D)
{
    // Yup, it's a Sprite2D!
}

if (null is Sprite2D)
{
    // This block can never happen.
}</literal_block>
            <paragraph>You can also declare a new variable to conditionally store the result of the cast
                if the <literal>is</literal> operator returns <literal>true</literal>.</paragraph>
            <literal_block force="False" highlight_args="{}" language="csharp" linenos="False" xml:space="preserve">if (GetNode("MySprite") is Sprite2D mySprite)
{
    // The mySprite variable only exists inside this block, and it's never null.
    mySprite.SetFrame(0);
}</literal_block>
            <paragraph>For more advanced type checking, you can look into <reference name="Pattern Matching" refuri="https://docs.microsoft.com/en-us/dotnet/csharp/pattern-matching">Pattern Matching</reference><target ids="pattern-matching" names="pattern\ matching" refuri="https://docs.microsoft.com/en-us/dotnet/csharp/pattern-matching"></target>.</paragraph>
        </section>
        <section ids="preprocessor-defines" names="preprocessor\ defines">
            <title>Preprocessor defines</title>
            <paragraph>Godot has a set of defines that allow you to change your C# code
                depending on the environment you are compiling to.</paragraph>
            <section ids="examples" names="examples">
                <title>Examples</title>
                <paragraph>For example, you can change code based on the platform:</paragraph>
                <literal_block force="False" highlight_args="{}" language="csharp" linenos="False" xml:space="preserve">    public override void _Ready()
    {
#if (GODOT_MOBILE || GODOT_WEB)
        // Use simple objects when running on less powerful systems.
        SpawnSimpleObjects();
#else
        SpawnComplexObjects();
#endif
    }</literal_block>
                <paragraph>Or you can detect which engine your code is in, useful for making cross-engine libraries:</paragraph>
                <literal_block force="False" highlight_args="{}" language="csharp" linenos="False" xml:space="preserve">    public void MyPlatformPrinter()
    {
#if GODOT
        GD.Print("This is Godot.");
#elif UNITY_5_3_OR_NEWER
        print("This is Unity.");
#else
        throw new NotSupportedException("Only Godot and Unity are supported.");
#endif
    }</literal_block>
                <paragraph>Or you can write scripts that target multiple Godot versions and take
                    advantage of features that are only available on some of those versions:</paragraph>
                <literal_block force="False" highlight_args="{}" language="csharp" linenos="False" xml:space="preserve">    public void UseCoolFeature()
    {
#if GODOT4_3_OR_GREATER || GODOT4_2_2_OR_GREATER
        // Use CoolFeature, that was added to Godot in 4.3 and cherry-picked into 4.2.2, here.
#else
        // Use a workaround for the absence of CoolFeature here.
#endif
    }</literal_block>
            </section>
            <section ids="full-list-of-defines" names="full\ list\ of\ defines">
                <title>Full list of defines</title>
                <bullet_list bullet="*">
                    <list_item>
                        <paragraph><literal>GODOT</literal> is always defined for Godot projects.</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph><literal>TOOLS</literal> is defined when building with the Debug configuration (editor and editor player).</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph><literal>GODOT_REAL_T_IS_DOUBLE</literal> is defined when the <literal>GodotFloat64</literal> property is set to <literal>true</literal>.</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>One of <literal>GODOT_LINUXBSD</literal>, <literal>GODOT_WINDOWS</literal>, <literal>GODOT_OSX</literal>,
                            <literal>GODOT_ANDROID</literal>, <literal>GODOT_IOS</literal>, <literal>GODOT_WEB</literal>
                            depending on the OS. These names may change in the future.
                            These are created from the <literal>get_name()</literal> method of the
                            <reference internal="True" refuri="../../../classes/class_os#class-os"><inline classes="std std-ref">OS</inline></reference> singleton, but not every possible OS
                            the method returns is an OS that Godot with .NET runs on.</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph><literal>GODOTX</literal>, <literal>GODOTX_Y</literal>, <literal>GODOTX_Y_Z</literal>, <literal>GODOTx_OR_GREATER</literal>,
                            <literal>GODOTX_y_OR_GREATER</literal>, and <literal>GODOTX_Y_z_OR_GREATER</literal>, where <literal>X</literal>, <literal>Y</literal>,
                            and <literal>Z</literal> are replaced by the current major, minor and patch version of Godot.
                            <literal>x</literal>, <literal>y</literal>, and <literal>z</literal> are replaced by all values from 0 to the current version number for that
                            component.</paragraph>
                        <note>
                            <paragraph>These defines were first added in Godot 4.0.4 and 4.1. Version defines for
                                prior versions do not exist, regardless of the current Godot version.</paragraph>
                        </note>
                        <paragraph>For example: Godot 4.0.5 defines <literal>GODOT4</literal>, <literal>GODOT4_OR_GREATER</literal>,
                            <literal>GODOT4_0</literal>, <literal>GODOT4_0_OR_GREATER</literal>, <literal>GODOT4_0_5</literal>,
                            <literal>GODOT4_0_4_OR_GREATER</literal>, and <literal>GODOT4_0_5_OR_GREATER</literal>. Godot 4.3.2 defines
                            <literal>GODOT4</literal>, <literal>GODOT4_OR_GREATER</literal>, <literal>GODOT4_3</literal>, <literal>GODOT4_0_OR_GREATER</literal>,
                            <literal>GODOT4_1_OR_GREATER</literal>, <literal>GODOT4_2_OR_GREATER</literal>, <literal>GODOT4_3_OR_GREATER</literal>,
                            <literal>GODOT4_3_2</literal>, <literal>GODOT4_3_0_OR_GREATER</literal>, <literal>GODOT4_3_1_OR_GREATER</literal>, and
                            <literal>GODOT4_3_2_OR_GREATER</literal>.</paragraph>
                    </list_item>
                </bullet_list>
                <paragraph>When <strong>exporting</strong>, the following may also be defined depending on the export features:</paragraph>
                <bullet_list bullet="*">
                    <list_item>
                        <paragraph>One of <literal>GODOT_PC</literal>, <literal>GODOT_MOBILE</literal>, or <literal>GODOT_WEB</literal> depending on the platform type.</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>One of <literal>GODOT_WINDOWS</literal>, <literal>GODOT_LINUXBSD</literal>, <literal>GODOT_MACOS</literal>, <literal>GODOT_ANDROID</literal>, <literal>GODOT_IOS</literal>, or <literal>GODOT_WEB</literal> depending on the platform.</paragraph>
                    </list_item>
                </bullet_list>
                <paragraph>To see an example project, see the OS testing demo:
                    <reference refuri="https://github.com/godotengine/godot-demo-projects/tree/master/misc/os_test">https://github.com/godotengine/godot-demo-projects/tree/master/misc/os_test</reference></paragraph>
                <substitution_definition names="weblate_widget"><reference refuri="https://hosted.weblate.org/engage/godot-engine/?utm_source=widget"><image alt="Translation status" candidates="{'?': 'https://hosted.weblate.org/widgets/godot-engine/-/godot-docs/287x66-white.png'}" height="66" uri="https://hosted.weblate.org/widgets/godot-engine/-/godot-docs/287x66-white.png" width="287"></image></reference></substitution_definition>
            </section>
        </section>
    </section>
</document>
