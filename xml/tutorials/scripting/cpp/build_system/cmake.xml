<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.21.2 -->
<document source="/home/runner/work/godot-docs-cn/godot-docs-cn/godot-docs/docs/tutorials/scripting/cpp/build_system/cmake.rst" translation_progress="{'total': 0, 'translated': 0}" xmlns:c="https://www.sphinx-doc.org/" xmlns:changeset="https://www.sphinx-doc.org/" xmlns:citation="https://www.sphinx-doc.org/" xmlns:cpp="https://www.sphinx-doc.org/" xmlns:index="https://www.sphinx-doc.org/" xmlns:js="https://www.sphinx-doc.org/" xmlns:math="https://www.sphinx-doc.org/" xmlns:py="https://www.sphinx-doc.org/" xmlns:rst="https://www.sphinx-doc.org/" xmlns:std="https://www.sphinx-doc.org/">
    <target refid="doc-godot-cpp-build-system-cmake"></target>
    <section ids="secondary-build-system-working-with-cmake doc-godot-cpp-build-system-cmake" names="secondary\ build\ system:\ working\ with\ cmake doc_godot_cpp_build_system_cmake">
        <title>Secondary build system: Working with CMake</title>
        <seealso>
            <paragraph>This page documents how to compile godot-cpp. If you're looking to compile
                Godot instead, see <reference internal="True" refuri="../../../../engine_details/development/compiling/introduction_to_the_buildsystem#doc-introduction-to-the-buildsystem"><inline classes="std std-ref">Introduction to the buildsystem</inline></reference>.</paragraph>
        </seealso>
        <paragraph>Beside the <reference name="SCons" refuri="http://cmake.org">SCons</reference> based build system, godot-cpp also provides a <reference name="CMakeLists.txt" refuri="https://github.com/godotengine/godot-cpp/blob/master/CMakeLists.txt">CMakeLists.txt</reference>
            file to support users that prefer using <reference name="CMake" refuri="http://scons.org">CMake</reference> over SCons for their build
            system.</paragraph>
        <paragraph>While actively supported, the CMake system is considered secondary to the
            SCons build system. This means it may lack some features that are available to
            projects using SCons.</paragraph>
        <target ids="cmakelists-txt" names="cmakelists.txt" refuri="https://github.com/godotengine/godot-cpp/blob/master/CMakeLists.txt"></target>
        <target ids="cmake" names="cmake" refuri="http://scons.org"></target>
        <target ids="scons" names="scons" refuri="http://cmake.org"></target>
        <section ids="introduction" names="introduction">
            <title>Introduction</title>
            <paragraph>Compiling godot-cpp independently of an extension project is mainly for
                godot-cpp developers, package maintainers, and CI/CD.</paragraph>
            <paragraph>Examples of how to use CMake to consume the godot-cpp library as part of an
                extension project:</paragraph>
            <bullet_list bullet="*">
                <list_item>
                    <paragraph><reference name="godot-cpp-template" refuri="https://github.com/godotengine/godot-cpp-template/">godot-cpp-template</reference></paragraph>
                </list_item>
                <list_item>
                    <paragraph><reference name="godot_roguelite" refuri="https://github.com/vorlac/godot-roguelite/">godot_roguelite</reference></paragraph>
                </list_item>
                <list_item>
                    <paragraph><reference name="godot-orchestrator" refuri="https://github.com/CraterCrash/godot-orchestrator/">godot-orchestrator</reference></paragraph>
                </list_item>
            </bullet_list>
            <paragraph>Examples for configuring godot-cpp are listed at the bottom of the page, many
                of which may help with configuring your project.</paragraph>
        </section>
        <section ids="cmake-s-debug-vs-godot-s-template-debug" names="cmake's\ debug\ vs\ godot's\ template_debug">
            <title>CMake's <literal>Debug</literal> vs Godot's <literal>template_debug</literal></title>
            <paragraph>Something that has come up during many discussions is the conflation of a
                compilation of C++ source code with debug symbols enabled, and compiling a
                Godot extension with debug features enabled. The two concepts are not mutually
                exclusive.</paragraph>
            <section ids="debug-features" names="debug\ features">
                <title>Debug Features</title>
                <paragraph>Enables a pre-processor definition to selectively compile code to help users of
                    a Godot extension with their own project.</paragraph>
                <paragraph>Debug features are enabled in <literal>editor</literal> and <literal>template_debug</literal> builds, which
                    can be specified during the configure phase like so:</paragraph>
                <literal_block force="False" highlight_args="{}" language="shell" linenos="False" xml:space="preserve">cmake -S godot-cpp -B cmake-build -DGODOTCPP_TARGET=&lt;target choice&gt;</literal_block>
            </section>
            <section ids="debug" names="debug">
                <title>Debug</title>
                <paragraph>Sets compiler flags so that debug symbols are generated to help godot extension
                    developers debug their extension.</paragraph>
                <paragraph><literal>Debug</literal> is the default build type for CMake projects, the way to select another
                    depends on the generator used:</paragraph>
                <bullet_list bullet="*">
                    <list_item>
                        <paragraph>For single configuration generators, add <literal>-DCMAKE_BUILD_TYPE=&lt;type&gt;</literal> to the
                            configure command.</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>For multi-config generators, add <literal>--config &lt;type&gt;</literal> to the build command.</paragraph>
                    </list_item>
                </bullet_list>
                <paragraph>Where <literal>&lt;type&gt;</literal> is one of <literal>Debug</literal>, <literal>Release</literal>, <literal>RelWithDebInfo</literal>, and
                    <literal>MinSizeRel</literal>.</paragraph>
            </section>
        </section>
        <section ids="scons-deviations" names="scons\ deviations">
            <title>SCons Deviations</title>
            <paragraph>Not all code from the SCons system can be perfectly represented in CMake, here
                are the notable differences:</paragraph>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph><literal>debug_symbols</literal></paragraph>
                    <block_quote>
                        <paragraph>Is no longer an explicit option, and is enabled when using CMake build
                            configurations; <literal>Debug</literal>, <literal>RelWithDebInfo</literal>.</paragraph>
                    </block_quote>
                </list_item>
                <list_item>
                    <paragraph><literal>dev_build</literal></paragraph>
                    <block_quote>
                        <paragraph>Does not define <literal>NDEBUG</literal> when disabled, <literal>NDEBUG</literal> is set when using
                            CMake build configurations; <literal>Release</literal>, <literal>MinSizeRel</literal>.</paragraph>
                    </block_quote>
                </list_item>
                <list_item>
                    <paragraph><literal>arch</literal></paragraph>
                    <block_quote>
                        <paragraph>CMake sets the architecture via the toolchain files, macOS universal is
                            controlled via the <literal>CMAKE_OSX_ARCHITECTURES</literal> property which is copied to
                            targets when they are defined.</paragraph>
                    </block_quote>
                </list_item>
                <list_item>
                    <paragraph><literal>debug_crt</literal></paragraph>
                    <block_quote>
                        <paragraph>CMake controls linking to Windows runtime libraries by copying the value of
                            <literal>CMAKE_MSVC_RUNTIME_LIBRARIES</literal> to targets as they are defined. godot-cpp
                            will set this variable if it isn't already set. So, include it before other
                            dependencies to have the value propagate across the projects.</paragraph>
                    </block_quote>
                </list_item>
            </bullet_list>
        </section>
        <section ids="basic-walk-through" names="basic\ walk-through">
            <title>Basic Walk-Through</title>
            <section ids="clone-the-git-repository" names="clone\ the\ git\ repository">
                <title>Clone the git repository</title>
                <literal_block force="False" highlight_args="{}" language="shell" linenos="False" xml:space="preserve">git clone https://github.com/godotengine/godot-cpp.git
Cloning into 'godot-cpp'...
...</literal_block>
            </section>
            <section ids="configure-the-build" names="configure\ the\ build">
                <title>Configure the build</title>
                <literal_block force="False" highlight_args="{}" language="shell" linenos="False" xml:space="preserve">cmake -S godot-cpp -B cmake-build -G Ninja</literal_block>
                <bullet_list bullet="-">
                    <list_item>
                        <paragraph><literal>-S</literal> Specifies the source directory as <literal>godot-cpp</literal></paragraph>
                    </list_item>
                    <list_item>
                        <paragraph><literal>-B</literal> Specifies the build directory as <literal>cmake-build</literal></paragraph>
                    </list_item>
                    <list_item>
                        <paragraph><literal>-G</literal> Specifies the Generator as <literal>Ninja</literal></paragraph>
                    </list_item>
                </bullet_list>
                <paragraph>The source directory in this example is the source root for the freshly cloned
                    godot-cpp. CMake will also interpret the first path in the command as the
                    source path, or if an existing build path is specified it will deduce the
                    source path from the build cache.</paragraph>
                <paragraph>The following three commands are equivalent:</paragraph>
                <literal_block force="False" highlight_args="{}" language="shell" linenos="False" xml:space="preserve"># Current working directory is the godot-cpp source root.
cmake . -B build-dir

# Current working directory is an empty godot-cpp/build-dir.
cmake ../

# Current working directory is an existing build path.
cmake .</literal_block>
                <paragraph>The build directory is specified so that generated files do not clutter the
                    source tree with build artifacts.</paragraph>
                <paragraph>CMake doesn't build the code, it generates the files that a build tool uses, in
                    this case the <literal>Ninja</literal> generator creates <reference name="Ninja" refuri="https://ninja-build.org/">Ninja</reference> build files.</paragraph>
                <paragraph>To see the list of generators run <literal>cmake --help</literal>.</paragraph>
                <target ids="ninja" names="ninja" refuri="https://ninja-build.org/"></target>
            </section>
            <section ids="build-options" names="build\ options">
                <title>Build Options</title>
                <paragraph>To list the available options use the <literal>-L[AH]</literal> command flags. <literal>A</literal> is for
                    advanced, and <literal>H</literal> is for help strings:</paragraph>
                <literal_block force="False" highlight_args="{}" language="shell" linenos="False" xml:space="preserve">cmake -S godot-cpp -LH</literal_block>
                <paragraph>Options are specified on the command line when configuring, for example:</paragraph>
                <literal_block force="False" highlight_args="{}" language="shell" linenos="False" xml:space="preserve">cmake -S godot-cpp -DGODOTCPP_USE_HOT_RELOAD:BOOL=ON \
    -DGODOTCPP_PRECISION:STRING=double \
    -DCMAKE_BUILD_TYPE:STRING=Debug</literal_block>
                <paragraph>See <reference name="setting-build-variables" refuri="https://cmake.org/cmake/help/latest/guide/user-interaction/index.html#setting-build-variables">setting-build-variables</reference> and <reference name="build-configurations" refuri="https://cmake.org/cmake/help/latest/manual/cmake-buildsystem.7.html#build-configurations">build-configurations</reference> for more information.</paragraph>
                <target ids="setting-build-variables" names="setting-build-variables" refuri="https://cmake.org/cmake/help/latest/guide/user-interaction/index.html#setting-build-variables"></target>
                <target ids="build-configurations" names="build-configurations" refuri="https://cmake.org/cmake/help/latest/manual/cmake-buildsystem.7.html#build-configurations"></target>
                <section ids="a-non-exhaustive-list-of-options" names="a\ non-exhaustive\ list\ of\ options:">
                    <title>A non-exhaustive list of options:</title>
                    <literal_block force="False" highlight_args="{}" language="text" linenos="False" xml:space="preserve">// Path to a custom GDExtension API JSON file.
// (takes precedence over GODOTCPP_GDEXTENSION_DIR)
// ( /path/to/custom_api_file )
GODOTCPP_CUSTOM_API_FILE:FILEPATH=

// Force disabling exception handling code. (ON|OFF)
GODOTCPP_DISABLE_EXCEPTIONS:BOOL=ON

// Path to a custom directory containing the GDExtension interface
// header and API JSON file. ( /path/to/gdextension_dir )
GODOTCPP_GDEXTENSION_DIR:PATH=gdextension

// Set the floating-point precision level. (single|double)
GODOTCPP_PRECISION:STRING=single

// Enable the extra accounting required to support hot reload. (ON|OFF)
GODOTCPP_USE_HOT_RELOAD:BOOL=</literal_block>
                </section>
            </section>
            <section ids="compiling" names="compiling">
                <title>Compiling</title>
                <paragraph>Tell CMake to invoke the build system it generated in the specified directory.
                    The default target is <literal>template_debug</literal> and the default build configuration is
                    Debug.</paragraph>
                <literal_block force="False" highlight_args="{}" language="shell" linenos="False" xml:space="preserve">cmake --build cmake-build</literal_block>
            </section>
        </section>
        <section ids="examples" names="examples">
            <title>Examples</title>
            <paragraph>These examples, while intended for godot-cpp developers, package maintainers,
                and CI/CD may help you configure your own extension project.</paragraph>
            <paragraph>Practical examples for how to consume the godot-cpp library as part of an
                extension project are listed in the <reference name="Introduction" refid="introduction">Introduction</reference>.</paragraph>
            <section ids="enabling-integration-testing" names="enabling\ integration\ testing">
                <title>Enabling Integration Testing</title>
                <paragraph>The testing target <literal>godot-cpp-test</literal> is guarded by <literal>GODOTCPP_ENABLE_TESTING</literal>
                    which is off by default.</paragraph>
                <paragraph>To configure and build the godot-cpp project to enable the integration
                    testing targets the command will look something like:</paragraph>
                <literal_block force="False" highlight_args="{}" language="shell" linenos="False" xml:space="preserve">cmake -S godot-cpp -B cmake-build -DGODOTCPP_ENABLE_TESTING=YES
cmake --build cmake-build --target godot-cpp-test</literal_block>
            </section>
            <section ids="windows-and-msvc-release" names="windows\ and\ msvc\ -\ release">
                <title>Windows and MSVC - Release</title>
                <paragraph>So long as CMake is installed from the <reference name="CMake Downloads" refuri="https://cmake.org/download/">CMake Downloads</reference> page and in the PATH,
                    and Microsoft Visual Studio is installed with C++ support, CMake will detect
                    the MSVC compiler.</paragraph>
                <paragraph>Note that Visual Studio is a Multi-Config Generator so the build configuration
                    needs to be specified at build time, for example, <literal>--config Release</literal>.</paragraph>
                <target ids="cmake-downloads" names="cmake\ downloads" refuri="https://cmake.org/download/"></target>
                <literal_block force="False" highlight_args="{}" language="shell" linenos="False" xml:space="preserve">cmake -S godot-cpp -B cmake-build -DGODOTCPP_ENABLE_TESTING=YES
cmake --build cmake-build -t godot-cpp-test --config Release</literal_block>
            </section>
            <section ids="msys2-clang64-ninja-debug" names='msys2/clang64,\ "ninja"\ -\ debug'>
                <title>MSys2/clang64, "Ninja" - Debug</title>
                <paragraph>Assumes the <literal>ming-w64-clang-x86_64</literal>-toolchain is installed.</paragraph>
                <paragraph>Note that Ninja is a Single-Config Generator so the build type needs to be
                    specified at configuration time.</paragraph>
                <paragraph>Using the <literal>msys2/clang64</literal> shell:</paragraph>
                <literal_block force="False" highlight_args="{}" language="shell" linenos="False" xml:space="preserve">cmake -S godot-cpp -B cmake-build -G"Ninja" \
    -DGODOTCPP_ENABLE_TESTING=YES -DCMAKE_BUILD_TYPE=Release
cmake --build cmake-build -t godot-cpp-test</literal_block>
            </section>
            <section ids="msys2-clang64-ninja-multi-config-dev-build-debug-symbols" names='msys2/clang64,\ "ninja\ multi-config"\ -\ dev_build,\ debug\ symbols'>
                <title>MSys2/clang64, "Ninja Multi-Config" - dev_build, Debug Symbols</title>
                <paragraph>Assumes the <literal>ming-w64-clang-x86_64</literal>-toolchain is installed.</paragraph>
                <paragraph>This time we are choosing the 'Ninja Multi-Config' generator, so the build
                    type is specified at build time.</paragraph>
                <paragraph>Using the <literal>msys2/clang64</literal> shell:</paragraph>
                <literal_block force="False" highlight_args="{}" language="shell" linenos="False" xml:space="preserve">cmake -S godot-cpp -B cmake-build -G"Ninja Multi-Config" \
    -DGODOTCPP_ENABLE_TESTING=YES -DGODOTCPP_DEV_BUILD:BOOL=ON
cmake --build cmake-build -t godot-cpp-test --config Debug</literal_block>
            </section>
            <section ids="emscripten-for-web-platform" names="emscripten\ for\ web\ platform">
                <title>Emscripten for web platform</title>
                <paragraph>This has only been tested on Windows so far. You can use this example workflow:</paragraph>
                <bullet_list bullet="-">
                    <list_item>
                        <paragraph>Clone and install the latest Emscripten tools to <literal>c:\emsdk</literal>.</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>Use <literal>C:\emsdk\emsdk.ps1 activate latest</literal> to enable the environment from
                            powershell in the current shell.</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>The <literal>emcmake.bat</literal> utility adds the emscripten toolchain to the CMake
                            command. It can also be added manually;
                            the location is listed inside the <literal>emcmake.bat</literal> file</paragraph>
                    </list_item>
                </bullet_list>
                <literal_block force="False" highlight_args="{}" language="powershell" linenos="False" xml:space="preserve">C:\emsdk\emsdk.ps1 activate latest
emcmake.bat cmake -S godot-cpp -B cmake-build-web -DCMAKE_BUILD_TYPE=Release
cmake --build cmake-build-web</literal_block>
            </section>
            <section ids="android-cross-compile-from-windows" names="android\ cross\ compile\ from\ windows">
                <title>Android Cross Compile from Windows</title>
                <paragraph>There are two separate paths you can choose when configuring for android.</paragraph>
                <paragraph>Use the <literal>CMAKE_ANDROID_*</literal> variables specified on the command line or in your
                    own toolchain file as listed in the <reference name="cmake-toolchains" refuri="https://cmake.org/cmake/help/latest/manual/cmake-toolchains.7.html#cross-compiling-for-android-with-the-ndk">cmake-toolchains</reference> documentation.</paragraph>
                <target ids="cmake-toolchains" names="cmake-toolchains" refuri="https://cmake.org/cmake/help/latest/manual/cmake-toolchains.7.html#cross-compiling-for-android-with-the-ndk"></target>
                <paragraph>Or use the toolchain and scripts provided by the Android SDK and make changes
                    using the <literal>ANDROID_*</literal> variables listed there. Where <literal>&lt;version&gt;</literal> is whatever
                    NDK version you have installed (tested with <title_reference>28.1.13356709</title_reference>) and <literal>&lt;platform&gt;</literal>
                    is for the Android sdk platform, (tested with <literal>android-29</literal>).</paragraph>
                <warning>
                    <paragraph>The Android SDK <reference name="website" refuri="https://developer.android.com/ndk/guides/cmake">website</reference> explicitly states that they do not support using
                        the CMake built-in method, and recommends you stick with their toolchain
                        files.</paragraph>
                    <target ids="website" names="website" refuri="https://developer.android.com/ndk/guides/cmake"></target>
                </warning>
                <section ids="using-your-own-toolchain-file" names="using\ your\ own\ toolchain\ file">
                    <title>Using your own toolchain file</title>
                    <paragraph>As described in the CMake documentation:</paragraph>
                    <literal_block force="False" highlight_args="{}" language="shell" linenos="False" xml:space="preserve">cmake -S godot-cpp -B cmake-build --toolchain my_toolchain.cmake
cmake --build cmake-build -t template_release</literal_block>
                    <paragraph>Doing the equivalent just using the command line:</paragraph>
                    <literal_block force="False" highlight_args="{}" language="shell" linenos="False" xml:space="preserve">cmake -S godot-cpp -B cmake-build \
    -DCMAKE_SYSTEM_NAME=Android \
    -DCMAKE_SYSTEM_VERSION=&lt;platform&gt; \
    -DCMAKE_ANDROID_ARCH_ABI=&lt;arch&gt; \
    -DCMAKE_ANDROID_NDK=/path/to/android-ndk
cmake --build cmake-build</literal_block>
                </section>
                <section ids="using-the-android-sdk-toolchain-file" names="using\ the\ android\ sdk\ toolchain\ file">
                    <title>Using the Android SDK toolchain file</title>
                    <paragraph>This defaults to the minimum supported version and armv7-a:</paragraph>
                    <literal_block force="False" highlight_args="{}" language="shell" linenos="False" xml:space="preserve">cmake -S godot-cpp -B cmake-build \
    --toolchain $ANDROID_HOME/ndk/&lt;version&gt;/build/cmake/android.toolchain.cmake
cmake --build cmake-build</literal_block>
                    <paragraph>Specifying the Android platform and ABI:</paragraph>
                    <literal_block force="False" highlight_args="{}" language="shell" linenos="False" xml:space="preserve">cmake -S godot-cpp -B cmake-build \
    --toolchain $ANDROID_HOME/ndk/&lt;version&gt;/build/cmake/android.toolchain.cmake \
    -DANDROID_PLATFORM:STRING=android-29 \
    -DANDROID_ABI:STRING=armeabi-v7a
cmake --build cmake-build</literal_block>
                    <substitution_definition names="weblate_widget"><reference refuri="https://hosted.weblate.org/engage/godot-engine/?utm_source=widget"><image alt="Translation status" candidates="{'?': 'https://hosted.weblate.org/widgets/godot-engine/-/godot-docs/287x66-white.png'}" height="66" uri="https://hosted.weblate.org/widgets/godot-engine/-/godot-docs/287x66-white.png" width="287"></image></reference></substitution_definition>
                </section>
            </section>
        </section>
    </section>
</document>
