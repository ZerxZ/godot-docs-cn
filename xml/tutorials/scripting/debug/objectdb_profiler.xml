<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.21.2 -->
<document source="/home/runner/work/godot-docs-cn/godot-docs-cn/godot-docs/docs/tutorials/scripting/debug/objectdb_profiler.rst" translation_progress="{'total': 0, 'translated': 0}" xmlns:c="https://www.sphinx-doc.org/" xmlns:changeset="https://www.sphinx-doc.org/" xmlns:citation="https://www.sphinx-doc.org/" xmlns:cpp="https://www.sphinx-doc.org/" xmlns:index="https://www.sphinx-doc.org/" xmlns:js="https://www.sphinx-doc.org/" xmlns:math="https://www.sphinx-doc.org/" xmlns:py="https://www.sphinx-doc.org/" xmlns:rst="https://www.sphinx-doc.org/" xmlns:std="https://www.sphinx-doc.org/">
    <target refid="doc-objectdb-profiler"></target>
    <section ids="using-the-objectdb-profiler doc-objectdb-profiler" names="using\ the\ objectdb\ profiler doc_objectdb_profiler">
        <title>Using the ObjectDB profiler</title>
        <paragraph>Since Godot 4.6, there is a new <strong>ObjectDB Profiler</strong> tab in the Debugger bottom panel.
            This profiler allows you to take snapshots of the current state of the ObjectDB,
            which is the database that contains all the <reference internal="True" refuri="../../../classes/class_object#class-object"><inline classes="std std-ref">Object</inline></reference>-derived classes
            currently allocated in memory. This is useful for identifying memory leaks and
            understanding the memory usage of your project.</paragraph>
        <paragraph>Additionally, this tool is able to visualize differences between two snapshots.
            This can be used to identify improvements or regressions in memory usage after
            making changes to your project. Reducing memory usage can lead to better performance,
            even in cases where memory is not a bottleneck. By reducing memory usage,
            you can perform fewer allocations, which can be a costly operation, especially
            if performed in large amounts during gameplay.</paragraph>
        <seealso>
            <paragraph>See <reference internal="True" refuri="../../best_practices/node_alternatives#doc-node-alternatives"><inline classes="std std-ref">When and how to avoid using nodes for everything</inline></reference> for information on using lighter-weight
                alternatives to nodes, which can help reduce memory usage in your project.</paragraph>
        </seealso>
        <warning>
            <paragraph>The ObjectDB profiler does <strong>not</strong> track every bit of memory used by the engine or
                by external libraries. Native engine classes that are not exposed to the scripting
                API will not appear in snapshots.</paragraph>
            <paragraph>Consider using external memory profiling tools if you need access to this information.</paragraph>
        </warning>
        <section ids="usage" names="usage">
            <title>Usage</title>
            <paragraph>Open the ObjectDB Profiler tab in the <inline classes="role-menu role-ui">Debugger</inline> bottom panel.
                You will land on the summary page with no snapshots taken yet.</paragraph>
            <figure align="center" ids="id1">
                <image alt="ObjectDB profiler summary with no snapshots taken" candidates="{'*': 'tutorials/scripting/debug/img/objectdb_profiler_summary_no_snapshots.webp'}" original_uri="img/objectdb_profiler_summary_no_snapshots.webp" uri="tutorials/scripting/debug/img/objectdb_profiler_summary_no_snapshots.webp"></image>
                <caption>ObjectDB profiler summary with no snapshots taken</caption>
            </figure>
            <paragraph>Run the project, then get to a point where you'd like to take a snapshot
                (for example, after loading a level). Click <inline classes="role-button role-ui">Take ObjectDB Snapshot</inline>
                to take a snapshot at the current point in time. If the button appears grayed out,
                make sure the project is running first.</paragraph>
            <figure align="center" ids="id2">
                <image alt="ObjectDB profiler summary with one snapshot taken" candidates="{'*': 'tutorials/scripting/debug/img/objectdb_profiler_summary_snapshot.webp'}" original_uri="img/objectdb_profiler_summary_snapshot.webp" uri="tutorials/scripting/debug/img/objectdb_profiler_summary_snapshot.webp"></image>
                <caption>ObjectDB profiler summary with one snapshot taken</caption>
            </figure>
            <paragraph>You can take multiple snapshots during a single run of the project.
                Also, you can right-click a snapshot in the snapshot list to rename it,
                show it in the file manager, or delete it.</paragraph>
            <tip>
                <paragraph>It's a good idea to rename snapshots
                    after taking them to give them descriptive names (e.g., <literal>before_optimization</literal>,
                    <literal>after_optimization</literal>). Regardless of the name, the date at which the snapshot
                    was taken remains saved in the snapshot file itself.</paragraph>
                <paragraph>Snapshot files have a <literal>.odb_snapshot</literal> extension and are located in
                    <literal>user://objectdb_snapshots/</literal> (see <reference internal="True" refuri="../../io/data_paths#doc-data-paths-accessing-persistent-user-data"><inline classes="std std-ref">Data paths</inline></reference>
                    details). These can safely be copied across devices, as they're platform-independent.</paragraph>
            </tip>
            <section ids="viewing-differences-between-snapshots" names="viewing\ differences\ between\ snapshots">
                <title>Viewing differences between snapshots</title>
                <paragraph>After taking at least two snapshots, the <inline classes="role-menu role-ui">Diff Against</inline> dropdown becomes
                    available. Here, you can select another snapshot to compare the currently selected
                    snapshot with.</paragraph>
                <figure align="center" ids="id3">
                    <image alt="Diff Against dropdown in the bottom-left corner of the ObjectDB profiler" candidates="{'*': 'tutorials/scripting/debug/img/objectdb_profiler_summary_diff_against.webp'}" original_uri="img/objectdb_profiler_summary_diff_against.webp" uri="tutorials/scripting/debug/img/objectdb_profiler_summary_diff_against.webp"></image>
                    <caption>Diff Against dropdown in the bottom-left corner of the ObjectDB profiler</caption>
                </figure>
                <paragraph>The summary page will then show the differences between the two snapshots:</paragraph>
                <figure align="center" ids="id4">
                    <image alt="Two snapshots being compared in the Summary tab" candidates="{'*': 'tutorials/scripting/debug/img/objectdb_profiler_summary_snapshot_diff.webp'}" original_uri="img/objectdb_profiler_summary_snapshot_diff.webp" uri="tutorials/scripting/debug/img/objectdb_profiler_summary_snapshot_diff.webp"></image>
                    <caption>Two snapshots being compared in the Summary tab</caption>
                </figure>
                <paragraph>This also applies to every other tab in the ObjectDB profiler, which will show
                    the differences between the two snapshots in additional columns.</paragraph>
            </section>
            <section ids="classes" names="classes">
                <title>Classes</title>
                <paragraph>In the Classes tab, you can view how many instances of each class have been
                    created at the moment the snapshot was taken:</paragraph>
                <figure align="center" ids="id5">
                    <image alt="One snapshots being viewed in the Classes tab" candidates="{'*': 'tutorials/scripting/debug/img/objectdb_profiler_classes.webp'}" original_uri="img/objectdb_profiler_classes.webp" uri="tutorials/scripting/debug/img/objectdb_profiler_classes.webp"></image>
                    <caption>One snapshots being viewed in the Classes tab</caption>
                </figure>
                <paragraph>When in diff mode, it will show the class instance count for the currently
                    selected snapshot (column A) and the snapshot that is being diffed against
                    (column B). It will also show the difference in instance count in the column Delta.</paragraph>
                <figure align="center" ids="id6">
                    <image alt="Two snapshots being compared in the Classes tab. Here, column A is ``second_session``, column B is ``first_session``" candidates="{'*': 'tutorials/scripting/debug/img/objectdb_profiler_classes_diff.webp'}" original_uri="img/objectdb_profiler_classes_diff.webp" uri="tutorials/scripting/debug/img/objectdb_profiler_classes_diff.webp"></image>
                    <caption>Two snapshots being compared in the Classes tab. Here, column A is <literal>second_session</literal>, column B is <literal>first_session</literal></caption>
                </figure>
                <paragraph>You can click on a class in the list on the right to view it in the inspector.</paragraph>
                <figure align="center" ids="id7">
                    <image alt="A selected class instance being viewed in the inspector" candidates="{'*': 'tutorials/scripting/debug/img/objectdb_profiler_classes_inspector.webp'}" original_uri="img/objectdb_profiler_classes_inspector.webp" uri="tutorials/scripting/debug/img/objectdb_profiler_classes_inspector.webp"></image>
                    <caption>A selected class instance being viewed in the inspector</caption>
                </figure>
                <tip>
                    <paragraph>Previewing instances in the inspector is also available in other tabs
                        (Nodes, Objects, and RefCounted).</paragraph>
                </tip>
            </section>
            <section ids="objects" names="objects">
                <title>Objects</title>
                <paragraph>The Objects tab is similar, but differs in the way it presents data. Here,
                    every instance is listed in a linear fashion, instead of grouping them by class.
                    When selecting an object, you will see a list of other objects it references
                    on the right (<inline classes="role-menu role-ui">Outbound References</inline>), as well as a list of objects
                    it's being referenced by (<inline classes="role-menu role-ui">Inbound References</inline>).</paragraph>
                <paragraph>This allows you to view objects either in a "top-down" manner (viewing
                    what objects a given object references) or in a "bottom-up" manner (viewing
                    what objects reference a given object).</paragraph>
                <figure align="center" ids="id8">
                    <image alt='The Objects tab being used to view objects in a "top-down" manner' candidates="{'*': 'tutorials/scripting/debug/img/objectdb_profiler_objects_top_down.webp'}" original_uri="img/objectdb_profiler_objects_top_down.webp" uri="tutorials/scripting/debug/img/objectdb_profiler_objects_top_down.webp"></image>
                    <caption>The Objects tab being used to view objects in a "top-down" manner</caption>
                </figure>
                <paragraph>In the above image, clicking the <literal>default_font</literal> object in the list will
                    switch the view to the perspective of that object. This object is being
                    referenced by a lot of other objects as well, which effectively switches
                    to a "bottom-up" perspective.</paragraph>
                <figure align="center" ids="id9">
                    <image alt='The Objects tab being used to view objects in a "bottom-up" manner' candidates="{'*': 'tutorials/scripting/debug/img/objectdb_profiler_objects_bottom_up.webp'}" original_uri="img/objectdb_profiler_objects_bottom_up.webp" uri="tutorials/scripting/debug/img/objectdb_profiler_objects_bottom_up.webp"></image>
                    <caption>The Objects tab being used to view objects in a "bottom-up" manner</caption>
                </figure>
            </section>
            <section ids="nodes" names="nodes">
                <title>Nodes</title>
                <paragraph>Next, the Nodes tab shows the scene tree at the time the snapshot was taken.</paragraph>
                <figure align="center" ids="id10">
                    <image alt="The Nodes tab being used to view the scene tree" candidates="{'*': 'tutorials/scripting/debug/img/objectdb_profiler_nodes.webp'}" original_uri="img/objectdb_profiler_nodes.webp" uri="tutorials/scripting/debug/img/objectdb_profiler_nodes.webp"></image>
                    <caption>The Nodes tab being used to view the scene tree</caption>
                </figure>
                <paragraph>This tab is particularly interesting in diff view, since it supports showing
                    the difference between the two snapshots in a more visual manner.
                    When <inline classes="role-button role-ui">Combined Diff</inline> is unchecked, you can see the differences side by side.</paragraph>
                <figure align="center" ids="id11">
                    <image alt="Separate diff view in the Nodes tab" candidates="{'*': 'tutorials/scripting/debug/img/objectdb_profiler_nodes_diff_separate.webp'}" original_uri="img/objectdb_profiler_nodes_diff_separate.webp" uri="tutorials/scripting/debug/img/objectdb_profiler_nodes_diff_separate.webp"></image>
                    <caption>Separate diff view in the Nodes tab</caption>
                </figure>
                <paragraph>When <inline classes="role-button role-ui">Combined Diff</inline> is checked, you can see the differences merged
                    into a single tree, with added nodes highlighted in green and removed nodes
                    highlighted in red.</paragraph>
                <figure align="center" ids="id12">
                    <image alt="Combined diff view in the Nodes tab" candidates="{'*': 'tutorials/scripting/debug/img/objectdb_profiler_nodes_diff_combined.webp'}" original_uri="img/objectdb_profiler_nodes_diff_combined.webp" uri="tutorials/scripting/debug/img/objectdb_profiler_nodes_diff_combined.webp"></image>
                    <caption>Combined diff view in the Nodes tab</caption>
                </figure>
                <paragraph>Additionally, you can view a list of orphan nodes (nodes that are not
                    attached to the scene tree root) at the end of the tree view. You can view
                    it more easily by collapsing the root node, since these are listed outside
                    the main scene tree.</paragraph>
                <figure align="center" ids="id13">
                    <image alt="Orphan nodes at the end of the nodes tree in the ObjectDB profiler" candidates="{'*': 'tutorials/scripting/debug/img/objectdb_profiler_nodes_orphan.webp'}" original_uri="img/objectdb_profiler_nodes_orphan.webp" uri="tutorials/scripting/debug/img/objectdb_profiler_nodes_orphan.webp"></image>
                    <caption>Orphan nodes at the end of the nodes tree in the ObjectDB profiler</caption>
                </figure>
            </section>
            <section ids="refcounted" names="refcounted">
                <title>RefCounted</title>
                <paragraph>The last tab is the RefCounted tab. This tab is similar to the Objects
                    tab, but it shows the reference counts of <reference internal="True" refuri="../../../classes/class_refcounted#class-refcounted"><inline classes="std std-ref">RefCounted</inline></reference>-derived
                    classes directly in the table. The table has four columns:</paragraph>
                <bullet_list bullet="-">
                    <list_item>
                        <paragraph><strong>Native Refs:</strong> The number of native engine references to the object.</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph><strong>ObjectDB Refs:</strong> The number of ObjectDB references to the object.</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph><strong>Total Refs:</strong> The sum of native references and ObjectDB references.</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph><strong>ObjectDB Cycles:</strong> The number of circular references detected.</paragraph>
                    </list_item>
                </bullet_list>
                <paragraph>When in diff view, snapshot B is always listed <emphasis>above</emphasis> snapshot A
                    if a RefCounted instance exists in both snapshots.</paragraph>
                <paragraph>The list on the right shows details on the selected instance,
                    including a list of references and whether these are duplicates.</paragraph>
                <figure align="center" ids="id14">
                    <image alt="The RefCounted tab being used to view RefCounted instances" candidates="{'*': 'tutorials/scripting/debug/img/objectdb_profiler_refcounted.webp'}" original_uri="img/objectdb_profiler_refcounted.webp" uri="tutorials/scripting/debug/img/objectdb_profiler_refcounted.webp"></image>
                    <caption>The RefCounted tab being used to view RefCounted instances</caption>
                </figure>
                <note>
                    <paragraph>The RefCounted tab does <strong>not</strong> list objects that derive directly from
                        <reference internal="True" refuri="../../../classes/class_object#class-object"><inline classes="std std-ref">Object</inline></reference>, as these don't use reference counting.</paragraph>
                </note>
                <substitution_definition names="weblate_widget"><reference refuri="https://hosted.weblate.org/engage/godot-engine/?utm_source=widget"><image alt="Translation status" candidates="{'?': 'https://hosted.weblate.org/widgets/godot-engine/-/godot-docs/287x66-white.png'}" height="66" uri="https://hosted.weblate.org/widgets/godot-engine/-/godot-docs/287x66-white.png" width="287"></image></reference></substitution_definition>
            </section>
        </section>
    </section>
</document>
