<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.21.2 -->
<document source="/home/runner/work/godot-docs-cn/godot-docs-cn/godot-docs/docs/tutorials/platform/android/javaclasswrapper_and_androidruntimeplugin.rst" translation_progress="{'total': 0, 'translated': 0}" xmlns:c="https://www.sphinx-doc.org/" xmlns:changeset="https://www.sphinx-doc.org/" xmlns:citation="https://www.sphinx-doc.org/" xmlns:cpp="https://www.sphinx-doc.org/" xmlns:index="https://www.sphinx-doc.org/" xmlns:js="https://www.sphinx-doc.org/" xmlns:math="https://www.sphinx-doc.org/" xmlns:py="https://www.sphinx-doc.org/" xmlns:rst="https://www.sphinx-doc.org/" xmlns:std="https://www.sphinx-doc.org/">
    <target refid="doc-javaclasswrapper-and-androidruntimeplugin"></target>
    <section ids="integrating-with-android-apis doc-javaclasswrapper-and-androidruntimeplugin" names="integrating\ with\ android\ apis doc_javaclasswrapper_and_androidruntimeplugin">
        <title>Integrating with Android APIs</title>
        <paragraph>The Android platform has numerous APIs as well as a rich ecosystem of third-party libraries with wide and
            diverse functionality, like push notifications, analytics, authentication, ads, etc...</paragraph>
        <paragraph>These don't make sense in Godot core itself so Godot has long provided an <reference internal="True" refuri="android_plugin#doc-android-plugin"><inline classes="std std-ref">Android plugin system</inline></reference>.
            The <reference internal="True" refuri="android_plugin#doc-android-plugin"><inline classes="std std-ref">Android plugin system</inline></reference> enables developers to create Godot Android plugins using Java or Kotlin code,
            which provides an interface to access and use Android APIs or third-party libraries in Godot projects from GDScript, C# or GDExtension.</paragraph>
        <literal_block force="False" highlight_args="{}" language="kotlin" linenos="False" xml:space="preserve">class MyAndroidSingleton(godot: Godot?) : GodotPlugin(godot) {
        @UsedByGodot
        fun doSomething(value: String) {
                // ...
        }
}</literal_block>
        <paragraph>Writing an Android plugin however requires knowledge of Java or Kotlin code, which most Godot developers do not have.
            As such there are many Android APIs and third-party libraries that don't have a Godot plugin that developers can interface with.
            In fact, this is one of the main reasons that developers cite for not being able to switch to Godot from other game engines.</paragraph>
        <paragraph>To address this, we've introduced a couple of tools in <strong>Godot 4.4</strong> to simplify the process for developers to access Android APIs and third-party libraries.</paragraph>
        <section ids="javaclasswrapper-godot-singleton" names="javaclasswrapper\ (godot\ singleton)">
            <title>JavaClassWrapper (Godot singleton)</title>
            <paragraph><literal>JavaClassWrapper</literal> is a <reference internal="True" refuri="../../../classes/class_javaclasswrapper#class-javaclasswrapper"><inline classes="std std-ref">Godot singleton</inline></reference> which allows
                creating instances of Java / Kotlin classes and calling methods on them using only GDScript, C# or GDExtension.</paragraph>
            <literal_block force="False" highlight_args="{}" language="gdscript" linenos="False" xml:space="preserve">var LocalDateTime = JavaClassWrapper.wrap("java.time.LocalDateTime")
var DateTimeFormatter = JavaClassWrapper.wrap("java.time.format.DateTimeFormatter")

var datetime = LocalDateTime.now()
var formatter = DateTimeFormatter.ofPattern("dd-MM-yyyy HH:mm:ss")

print(datetime.format(formatter))</literal_block>
            <paragraph>In the code snippet above, <literal>JavaClassWrapper</literal> is used from GDScript to access the Java <literal>LocalDateTime</literal> and <literal>DateTimeFormatter</literal> classes.
                Through <literal>JavaClassWrapper</literal>, we can call the Java classes methods directly from GDScript as if they were GDScript methods.</paragraph>
        </section>
        <section ids="androidruntime-plugin" names="androidruntime\ plugin">
            <title>AndroidRuntime plugin</title>
            <paragraph><literal>JavaClassWrapper</literal> is great, but to do many things on Android, you need access to various Android lifecycle / runtime objects.
                <literal>AndroidRuntime</literal> plugin is a <reference name="built-in Godot Android plugin" refuri="https://javadoc.io/doc/org.godotengine/godot/latest/org/godotengine/godot/plugin/AndroidRuntimePlugin.html">built-in Godot Android plugin</reference><target ids="built-in-godot-android-plugin" names="built-in\ godot\ android\ plugin" refuri="https://javadoc.io/doc/org.godotengine/godot/latest/org/godotengine/godot/plugin/AndroidRuntimePlugin.html"></target> that allows you to do this.</paragraph>
            <paragraph>Combining <literal>JavaClassWrapper</literal> and <literal>AndroidRuntime</literal> plugin allows developers to access and use Android APIs without switching away from GDScript, or using any tools aside from Godot itself.
                This is <strong>huge</strong> for the adoption of Godot for Android development:</paragraph>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph>If you need to do something simple, or only use a small part of a third-party library, you don't have to make a plugin</paragraph>
                </list_item>
                <list_item>
                    <paragraph>It allows developers to quickly integrate Android functionality</paragraph>
                </list_item>
                <list_item>
                    <paragraph>It allows developers to create Godot addons using only GDScript and <literal>JavaClassWrapper</literal> (no Java or Kotlin needed)</paragraph>
                </list_item>
            </bullet_list>
            <note>
                <paragraph>For exports using <literal>gradle</literal>, Godot will automatically include <literal>.jar</literal> or <literal>.aar</literal> files it find in the project <literal>addons</literal> directory.
                    So to use a third-party library, you can just drop its <literal>.jar</literal> or <literal>.aar</literal> file in the <literal>addons</literal> directory, and call its method directly from GDScript using <literal>JavaClassWrapper</literal>.</paragraph>
            </note>
            <section ids="example-show-an-android-toast" names="example:\ show\ an\ android\ toast">
                <title>Example: Show an Android toast</title>
                <literal_block force="False" highlight_args="{}" language="gdscript" linenos="False" xml:space="preserve"># Retrieve the AndroidRuntime singleton.
var android_runtime = Engine.get_singleton("AndroidRuntime")
if android_runtime:
    # Retrieve the Android Activity instance.
    var activity = android_runtime.getActivity()

    # Create a Godot Callable to wrap the toast display logic.
    var toast_callable = func():
        # Use JavaClassWrapper to retrieve the android.widget.Toast class, then make and show a toast using the class APIs.
        var ToastClass = JavaClassWrapper.wrap("android.widget.Toast")
        ToastClass.makeText(activity, "This is a test", ToastClass.LENGTH_LONG).show()

    # Wrap the Callable in a Java Runnable and run it on the Android UI thread to show the toast.
    activity.runOnUiThread(android_runtime.createRunnableFromGodotCallable(toast_callable))</literal_block>
            </section>
            <section ids="example-vibrate-the-device" names="example:\ vibrate\ the\ device">
                <title>Example: Vibrate the device</title>
                <literal_block force="False" highlight_args="{}" language="gdscript" linenos="False" xml:space="preserve"># Retrieve the AndroidRuntime singleton.
var android_runtime = Engine.get_singleton("AndroidRuntime")
if android_runtime:
    # Retrieve the Android Vibrator system service and check if the device supports it.
    var vibrator_service = android_runtime.getApplicationContext().getSystemService("vibrator")
    if vibrator_service and vibrator_service.hasVibrator():
        # Configure and run a VibrationEffect.
        var VibrationEffect = JavaClassWrapper.wrap("android.os.VibrationEffect")
        var effect = VibrationEffect.createOneShot(500, VibrationEffect.DEFAULT_AMPLITUDE)
        vibrator_service.vibrate(effect)</literal_block>
            </section>
            <section ids="example-accessing-inner-classes" names="example:\ accessing\ inner\ classes">
                <title>Example: Accessing inner classes</title>
                <paragraph>Java inner classes can be accessed using the <literal>$</literal> sign:</paragraph>
                <literal_block force="False" highlight_args="{}" language="gdscript" linenos="False" xml:space="preserve"># Accessing 'VERSION' class, which is an inner class from the 'android.os.Build' class.
var version = JavaClassWrapper.wrap("android.os.Build$VERSION")
var sdk_int = version.SDK_INT
if sdk_int == 30:
    # Do something specific on android 11 devices.
else:
    # All other devices</literal_block>
            </section>
            <section ids="example-calling-a-constructor" names="example:\ calling\ a\ constructor">
                <title>Example: Calling a constructor</title>
                <paragraph>A constructor is invoked by calling a method with the same name as the class.</paragraph>
                <paragraph>This example creates an intent to send a text:</paragraph>
                <literal_block force="False" highlight_args="{}" language="gdscript" linenos="False" xml:space="preserve"># Retrieve the AndroidRuntime singleton.
var android_runtime = Engine.get_singleton("AndroidRuntime")
if android_runtime:
    var Intent = JavaClassWrapper.wrap("android.content.Intent")
    var activity = android_runtime.getActivity()
    var intent = Intent.Intent() # Call the constructor.
    intent.setAction(Intent.ACTION_SEND)
    intent.putExtra(Intent.EXTRA_TEXT, "This is a test message.")
    intent.setType("text/plain")
    activity.startActivity(intent)</literal_block>
            </section>
            <section ids="example-saving-an-image-to-the-android-gallery" names="example:\ saving\ an\ image\ to\ the\ android\ gallery">
                <title>Example: Saving an image to the Android gallery</title>
                <literal_block force="False" highlight_args="{}" language="gdscript" linenos="False" xml:space="preserve"># Retrieve the AndroidRuntime singleton.
var android_runtime = Engine.get_singleton("AndroidRuntime")
if android_runtime:
    var Intent = JavaClassWrapper.wrap("android.content.Intent")
    var activity = android_runtime.getActivity()
    var intent = Intent.Intent()

    # Create the File and Uri.
    var Uri = JavaClassWrapper.wrap("android.net.Uri")
    var File = JavaClassWrapper.wrap("java.io.File")
    var file = File.File(file_path_to_image_here)
    var uri = Uri.fromFile(file)

    # Set Action and Data of Intent.
    intent.setAction(Intent.ACTION_MEDIA_SCANNER_SCAN_FILE)
    intent.setData(uri)

    # Broadcast it.
    activity.sendBroadcast(intent)</literal_block>
                <substitution_definition names="weblate_widget"><reference refuri="https://hosted.weblate.org/engage/godot-engine/?utm_source=widget"><image alt="Translation status" candidates="{'?': 'https://hosted.weblate.org/widgets/godot-engine/-/godot-docs/287x66-white.png'}" height="66" uri="https://hosted.weblate.org/widgets/godot-engine/-/godot-docs/287x66-white.png" width="287"></image></reference></substitution_definition>
            </section>
        </section>
    </section>
</document>
