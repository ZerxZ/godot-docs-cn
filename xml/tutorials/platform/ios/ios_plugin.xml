<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.21.2 -->
<document source="/home/runner/work/godot-docs-cn/godot-docs-cn/godot-docs/docs/tutorials/platform/ios/ios_plugin.rst" translation_progress="{'total': 0, 'translated': 0}" xmlns:c="https://www.sphinx-doc.org/" xmlns:changeset="https://www.sphinx-doc.org/" xmlns:citation="https://www.sphinx-doc.org/" xmlns:cpp="https://www.sphinx-doc.org/" xmlns:index="https://www.sphinx-doc.org/" xmlns:js="https://www.sphinx-doc.org/" xmlns:math="https://www.sphinx-doc.org/" xmlns:py="https://www.sphinx-doc.org/" xmlns:rst="https://www.sphinx-doc.org/" xmlns:std="https://www.sphinx-doc.org/">
    <target refid="doc-ios-plugin"></target>
    <section ids="creating-ios-plugins doc-ios-plugin" names="creating\ ios\ plugins doc_ios_plugin">
        <title>Creating iOS plugins</title>
        <paragraph>This page explains what iOS plugins can do for you, how to use an existing plugin, and the steps to code a new one.</paragraph>
        <paragraph>iOS plugins allow you to use third-party libraries and support iOS-specific features like In-App Purchases, GameCenter integration, ARKit support, and more.</paragraph>
        <section ids="loading-and-using-an-existing-plugin" names="loading\ and\ using\ an\ existing\ plugin">
            <title>Loading and using an existing plugin</title>
            <paragraph>An iOS plugin requires a <literal>.gdip</literal> configuration file, a binary file which can be either <literal>.a</literal> static library or <literal>.xcframework</literal> containing <literal>.a</literal> static libraries, and possibly other dependencies. To use it, you need to:</paragraph>
            <enumerated_list enumtype="arabic" prefix="" suffix=".">
                <list_item>
                    <paragraph>Copy the plugin's files to your Godot project's <literal>res://ios/plugins</literal> directory. You can also group files in a sub-directory, like <literal>res://ios/plugins/my_plugin</literal>.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>The Godot editor automatically detects and imports <literal>.gdip</literal> files inside <literal>res://ios/plugins</literal> and its subdirectories.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>You can find and activate detected plugins by going to Project -&gt; Export... -&gt; iOS and in the Options tab, scrolling to the Plugins section.</paragraph>
                </list_item>
            </enumerated_list>
            <image candidates="{'*': 'tutorials/platform/ios/img/ios_export_preset_plugins_section.png'}" original_uri="img/ios_export_preset_plugins_section.png" uri="tutorials/platform/ios/img/ios_export_preset_plugins_section.png"></image>
            <paragraph>When a plugin is active, you can access it in your code using <literal>Engine.get_singleton()</literal>:</paragraph>
            <literal_block force="False" language="gdscript" linenos="False" xml:space="preserve">if Engine.has_singleton("MyPlugin"):
    var singleton = Engine.get_singleton("MyPlugin")
    print(singleton.foo())</literal_block>
            <note>
                <paragraph>The plugin's files have to be in the <literal>res://ios/plugins/</literal> directory or a subdirectory, otherwise the Godot editor will not automatically detect them.</paragraph>
            </note>
        </section>
        <section ids="creating-an-ios-plugin" names="creating\ an\ ios\ plugin">
            <title>Creating an iOS plugin</title>
            <paragraph>At its core, a Godot iOS plugin is an iOS library (<emphasis>.a</emphasis> archive file or <emphasis>.xcframework</emphasis> containing static libraries) with the following requirements:</paragraph>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph>The library must have a dependency on the Godot engine headers.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>The library must come with a <literal>.gdip</literal> configuration file.</paragraph>
                </list_item>
            </bullet_list>
            <paragraph>An iOS plugin can have the same functionality as a Godot module but provides more flexibility and doesn't require to rebuild the engine.</paragraph>
            <paragraph>Here are the steps to get a plugin's development started. We recommend using <reference name="Xcode" refuri="https://developer.apple.com/develop/">Xcode</reference><target ids="xcode" names="xcode" refuri="https://developer.apple.com/develop/"></target> as your development environment.</paragraph>
            <seealso>
                <paragraph>The <reference name="Godot iOS Plugins" refuri="https://github.com/godotengine/godot-ios-plugins">Godot iOS Plugins</reference><target ids="godot-ios-plugins" names="godot\ ios\ plugins" refuri="https://github.com/godotengine/godot-ios-plugins"></target>.</paragraph>
                <paragraph>The <reference name="Godot iOS plugin template" refuri="https://github.com/naithar/godot_ios_plugin">Godot iOS plugin template</reference><target ids="godot-ios-plugin-template" names="godot\ ios\ plugin\ template" refuri="https://github.com/naithar/godot_ios_plugin"></target> gives you all the boilerplate you need to get your iOS plugin started.</paragraph>
            </seealso>
            <paragraph>To build an iOS plugin:</paragraph>
            <enumerated_list enumtype="arabic" prefix="" suffix=".">
                <list_item>
                    <paragraph>Create an Objective-C static library for your plugin inside Xcode.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Add the Godot engine header files as a dependency for your plugin library in <literal>HEADER_SEARCH_PATHS</literal>. You can find the setting inside the <literal>Build Settings</literal> tab:</paragraph>
                    <block_quote>
                        <bullet_list bullet="-">
                            <list_item>
                                <paragraph>Download the Godot engine source from the <reference name="Godot GitHub page" refuri="https://github.com/godotengine/godot">Godot GitHub page</reference><target ids="godot-github-page" names="godot\ github\ page" refuri="https://github.com/godotengine/godot"></target>.</paragraph>
                            </list_item>
                            <list_item>
                                <paragraph>Run SCons to generate headers. You can learn the process by reading <reference internal="True" refuri="../../../engine_details/development/compiling/compiling_for_ios#doc-compiling-for-ios"><inline classes="std std-ref">Compiling for iOS</inline></reference>. You don't have to wait for compilation to complete to move forward as headers are generated before the engine starts to compile.</paragraph>
                            </list_item>
                            <list_item>
                                <paragraph>You should use the same header files for iOS plugins and for the iOS export template.</paragraph>
                            </list_item>
                        </bullet_list>
                    </block_quote>
                </list_item>
                <list_item>
                    <paragraph>In the <literal>Build Settings</literal> tab, specify the compilation flags for your static library in <literal>OTHER_CFLAGS</literal>. The most important ones are <literal>-fcxx-modules</literal>, <literal>-fmodules</literal>, and <literal>-DDEBUG</literal> if you need debug support. Other flags should be the same you use to compile Godot. For instance:</paragraph>
                </list_item>
            </enumerated_list>
            <literal_block force="False" language="gdscript" linenos="False" xml:space="preserve">-DPTRCALL_ENABLED -DDEBUG_ENABLED -DDEBUG_MEMORY_ALLOC -DDISABLE_FORCED_INLINE -DTYPED_METHOD_BIND</literal_block>
            <enumerated_list enumtype="arabic" prefix="" start="4" suffix=".">
                <list_item>
                    <paragraph>Add the required logic for your plugin and build your library to generate a <literal>.a</literal> file. You will probably need to build both <literal>debug</literal> and <literal>release</literal> target <literal>.a</literal> files. Depending on your needs, pick either or both. If you need both debug and release <literal>.a</literal> files, their name should match following pattern: <literal>[PluginName].[TargetType].a</literal>. You can also build the static library with your SCons configuration.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>The iOS plugin system also supports <literal>.xcframework</literal> files. To generate one, you can use a command such as:</paragraph>
                </list_item>
            </enumerated_list>
            <literal_block force="False" language="gdscript" linenos="False" xml:space="preserve">xcodebuild -create-xcframework -library [DeviceLibrary].a -library [SimulatorLibrary].a -output [PluginName].xcframework</literal_block>
            <enumerated_list enumtype="arabic" prefix="" start="6" suffix=".">
                <list_item>
                    <paragraph>Create a Godot iOS Plugin configuration file to help the system detect and load your plugin:</paragraph>
                    <block_quote>
                        <bullet_list bullet="-">
                            <list_item>
                                <paragraph>The configuration file extension must be <literal>gdip</literal> (e.g.: <literal>MyPlugin.gdip</literal>).</paragraph>
                            </list_item>
                            <list_item>
                                <paragraph>The configuration file format is as follow:</paragraph>
                            </list_item>
                        </bullet_list>
                        <literal_block force="False" language="gdscript" linenos="False" xml:space="preserve">    [config]
    name="MyPlugin"
    binary="MyPlugin.a"

    initialization="init_my_plugin"
    deinitialization="deinit_my_plugin"

    [dependencies]
    linked=[]
    embedded=[]
    system=["Foundation.framework"]

    capabilities=["arkit", "metal"]

    files=["data.json"]

    linker_flags=["-ObjC"]

    [plist]
    PlistKeyWithDefaultType="Some Info.plist key you might need"
    StringPlistKey:string="String value"
    IntegerPlistKey:integer=42
    BooleanPlistKey:boolean=true
    RawPlistKey:raw="
    &lt;array&gt;
        &lt;string&gt;UIInterfaceOrientationPortrait&lt;/string&gt;
    &lt;/array&gt;
    "
    StringPlistKeyToInput:string_input="Type something"

The ``config`` section and fields are required and defined as follow:

    -   **name**: name of the plugin

    -   **binary**: this should be the filepath of the plugin library (``a`` or ``xcframework``) file.

        -   The filepath can be relative (e.g.: ``MyPlugin.a``, ``MyPlugin.xcframework``) in which case it's relative to the directory where the ``gdip`` file is located.
        -   The filepath can be absolute: ``res://some_path/MyPlugin.a`` or ``res://some_path/MyPlugin.xcframework``.
        -   In case you need multitarget library usage, the filename should be ``MyPlugin.a`` and ``.a`` files should be named as ``MyPlugin.release.a`` and ``MyPlugin.debug.a``.
        -   In case you use multitarget ``xcframework`` libraries, their filename in the configuration should be ``MyPlugin.xcframework``. The ``.xcframework`` files should be named as ``MyPlugin.release.xcframework`` and ``MyPlugin.debug.xcframework``.

The ``dependencies`` and ``plist`` sections are optional and defined as follow:

    -   **dependencies**:

        -   **linked**: contains a list of iOS frameworks that the iOS application should be linked with.

        -   **embedded**: contains a list of iOS frameworks or libraries that should be both linked and embedded into the resulting iOS application.

        -   **system**: contains a list of iOS system frameworks that are required for plugin.

        -   **capabilities**: contains a list of iOS capabilities that is required for plugin. A list of available capabilities can be found at `Apple UIRequiredDeviceCapabilities documentation page &lt;https://developer.apple.com/documentation/bundleresources/information_property_list/uirequireddevicecapabilities&gt;`_.

        -   **files**: contains a list of files that should be copied on export. This is useful for data files or images.

        -   **linker_flags**: contains a list of linker flags to add to the Xcode project when exporting the plugin.

    -   **plist**: should have keys and values that should be present in ``Info.plist`` file.

        -   Each line should follow pattern: ``KeyName:KeyType=KeyValue``
        -   Supported values for ``KeyType`` are ``string``, ``integer``, ``boolean``, ``raw``, ``string_input``
        -   If no type is used (e.g.: ``KeyName="KeyValue"``) ``string`` type will be used.
        -   If ``raw`` type is used value for corresponding key will be stored in ``Info.plist`` as is.
        -   If ``string_input`` type is used you will be able to modify value in Export window.</literal_block>
                    </block_quote>
                </list_item>
            </enumerated_list>
            <substitution_definition names="weblate_widget"><reference refuri="https://hosted.weblate.org/engage/godot-engine/?utm_source=widget"><image alt="Translation status" candidates="{'?': 'https://hosted.weblate.org/widgets/godot-engine/-/godot-docs/287x66-white.png'}" height="66" uri="https://hosted.weblate.org/widgets/godot-engine/-/godot-docs/287x66-white.png" width="287"></image></reference></substitution_definition>
        </section>
    </section>
</document>
