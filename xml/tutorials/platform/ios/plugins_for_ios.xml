<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.21.2 -->
<document source="/home/runner/work/godot-docs-cn/godot-docs-cn/godot-docs/docs/tutorials/platform/ios/plugins_for_ios.rst" translation_progress="{'total': 0, 'translated': 0}" xmlns:c="https://www.sphinx-doc.org/" xmlns:changeset="https://www.sphinx-doc.org/" xmlns:citation="https://www.sphinx-doc.org/" xmlns:cpp="https://www.sphinx-doc.org/" xmlns:index="https://www.sphinx-doc.org/" xmlns:js="https://www.sphinx-doc.org/" xmlns:math="https://www.sphinx-doc.org/" xmlns:py="https://www.sphinx-doc.org/" xmlns:rst="https://www.sphinx-doc.org/" xmlns:std="https://www.sphinx-doc.org/">
    <target refid="doc-plugins-for-ios"></target>
    <section ids="plugins-for-ios doc-plugins-for-ios" names="plugins\ for\ ios doc_plugins_for_ios">
        <title>Plugins for iOS</title>
        <paragraph>Godot provides StoreKit, GameCenter, iCloud services and other plugins.
            They are using same model of asynchronous calls explained below.</paragraph>
        <paragraph>ARKit and Camera access are also provided as plugins.</paragraph>
        <paragraph>Latest updates, documentation and source code can be found at <reference name="Godot iOS plugins repository" refuri="https://github.com/godotengine/godot-ios-plugins">Godot iOS plugins repository</reference><target ids="godot-ios-plugins-repository" names="godot\ ios\ plugins\ repository" refuri="https://github.com/godotengine/godot-ios-plugins"></target></paragraph>
        <section ids="accessing-plugin-singletons" names="accessing\ plugin\ singletons">
            <title>Accessing plugin singletons</title>
            <paragraph>To access plugin functionality, you first need to check that the plugin is
                exported and available by calling the <title_reference>Engine.has_singleton()</title_reference> function, which
                returns a registered singleton.</paragraph>
            <paragraph>Here's an example of how to do this in GDScript:</paragraph>
            <literal_block force="False" language="gdscript" linenos="False" xml:space="preserve">var in_app_store
var game_center

func _ready():
    if Engine.has_singleton("InAppStore"):
        in_app_store = Engine.get_singleton("InAppStore")
    else:
        print("iOS IAP plugin is not available on this platform.")

    if Engine.has_singleton("GameCenter"):
        game_center = Engine.get_singleton("GameCenter")
    else:
        print("iOS Game Center plugin is not available on this platform.")</literal_block>
        </section>
        <section ids="asynchronous-methods" names="asynchronous\ methods">
            <title>Asynchronous methods</title>
            <paragraph>When requesting an asynchronous operation, the method will look like
                this:</paragraph>
            <literal_block force="False" language="gdscript" linenos="False" xml:space="preserve">Error purchase(Variant params);</literal_block>
            <paragraph>The parameter will usually be a Dictionary, with the information
                necessary to make the request, and the call will have two phases. First,
                the method will immediately return an Error value. If the Error is not
                'OK', the call operation is completed, with an error probably caused
                locally (no internet connection, API incorrectly configured, etc). If
                the error value is 'OK', a response event will be produced and added to
                the 'pending events' queue. Example:</paragraph>
            <literal_block force="False" language="gdscript" linenos="False" xml:space="preserve">func on_purchase_pressed():
    var result = in_app_store.purchase({ "product_id": "my_product" })
    if result == OK:
        animation.play("busy") # show the "waiting for response" animation
    else:
        show_error()

# put this on a 1 second timer or something
func check_events():
    while in_app_store.get_pending_event_count() &gt; 0:
        var event = in_app_store.pop_pending_event()
        if event.type == "purchase":
            if event.result == "ok":
                show_success(event.product_id)
            else:
                show_error()</literal_block>
            <paragraph>Remember that when a call returns OK, the API will <emphasis>always</emphasis> produce an
                event through the pending_event interface, even if it's an error, or a
                network timeout, etc. You should be able to, for example, safely block
                the interface waiting for a reply from the server. If any of the APIs
                don't behave this way it should be treated as a bug.</paragraph>
            <paragraph>The pending event interface consists of two methods:</paragraph>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph><literal>get_pending_event_count()</literal>
                        Returns the number of pending events on the queue.</paragraph>
                </list_item>
                <list_item>
                    <paragraph><literal>Variant pop_pending_event()</literal>
                        Pops the first event from the queue and returns it.</paragraph>
                </list_item>
            </bullet_list>
        </section>
        <section ids="store-kit" names="store\ kit">
            <title>Store Kit</title>
            <paragraph>Implemented in <reference name="Godot iOS InAppStore plugin" refuri="https://github.com/godotengine/godot-ios-plugins/blob/master/plugins/inappstore/in_app_store.mm">Godot iOS InAppStore plugin</reference><target ids="godot-ios-inappstore-plugin" names="godot\ ios\ inappstore\ plugin" refuri="https://github.com/godotengine/godot-ios-plugins/blob/master/plugins/inappstore/in_app_store.mm"></target>.</paragraph>
            <paragraph>The Store Kit API is accessible through the <literal>InAppStore</literal> singleton.
                It is initialized automatically.</paragraph>
            <paragraph>The following methods are available and documented below:</paragraph>
            <literal_block force="False" language="gdscript" linenos="False" xml:space="preserve">   Error purchase(Variant params)
   Error request_product_info(Variant params)
   Error restore_purchases()
   void set_auto_finish_transaction(bool enable)
   void finish_transaction(String product_id)

and the pending events interface:

::

   int get_pending_event_count()
   Variant pop_pending_event()</literal_block>
            <section ids="purchase" names="purchase">
                <title><literal>purchase</literal></title>
                <paragraph>Purchases a product ID through the Store Kit API. You have to call <literal>finish_transaction(product_id)</literal> once you
                    receive a successful response or call <literal>set_auto_finish_transaction(true)</literal> prior to calling <literal>purchase()</literal>.
                    These two methods ensure the transaction is completed.</paragraph>
                <section dupnames="parameters" ids="parameters">
                    <title>Parameters</title>
                    <paragraph>Takes a dictionary as a parameter, with one field, <literal>product_id</literal>, a
                        string with your product ID. Example:</paragraph>
                    <literal_block force="False" language="gdscript" linenos="False" xml:space="preserve">var result = in_app_store.purchase({ "product_id": "my_product" })</literal_block>
                </section>
                <section dupnames="response\ event" ids="response-event">
                    <title>Response event</title>
                    <paragraph>The response event will be a dictionary with the following fields:</paragraph>
                    <paragraph>On error:</paragraph>
                    <literal_block force="False" language="gdscript" linenos="False" xml:space="preserve">{
  "type": "purchase",
  "result": "error",
  "product_id": "the product ID requested",
}</literal_block>
                    <paragraph>On success:</paragraph>
                    <literal_block force="False" language="gdscript" linenos="False" xml:space="preserve">{
  "type": "purchase",
  "result": "ok",
  "product_id": "the product ID requested",
}</literal_block>
                </section>
            </section>
            <section ids="request-product-info" names="request_product_info">
                <title><literal>request_product_info</literal></title>
                <paragraph>Requests the product info on a list of product IDs.</paragraph>
                <section dupnames="parameters" ids="id1">
                    <title>Parameters</title>
                    <paragraph>Takes a dictionary as a parameter, with a single <literal>product_ids</literal> key to which a
                        string array of product IDs is assigned. Example:</paragraph>
                    <literal_block force="False" language="gdscript" linenos="False" xml:space="preserve">var result = in_app_store.request_product_info({ "product_ids": ["my_product1", "my_product2"] })</literal_block>
                </section>
                <section dupnames="response\ event" ids="id2">
                    <title>Response event</title>
                    <paragraph>The response event will be a dictionary with the following fields:</paragraph>
                    <literal_block force="False" language="gdscript" linenos="False" xml:space="preserve">{
  "type": "product_info",
  "result": "ok",
  "invalid_ids": [ list of requested IDs that were invalid ],
  "ids": [ list of IDs that were valid ],
  "titles": [ list of valid product titles (corresponds with list of valid IDs) ],
  "descriptions": [ list of valid product descriptions ],
  "prices": [ list of valid product prices ],
  "localized_prices": [ list of valid product localized prices ],
}</literal_block>
                </section>
            </section>
            <section ids="restore-purchases" names="restore_purchases">
                <title><literal>restore_purchases</literal></title>
                <paragraph>Restores previously made purchases on user's account. This will create
                    response events for each previously purchased product ID.</paragraph>
                <section dupnames="response\ event" ids="id3">
                    <title>Response event</title>
                    <paragraph>The response events will be dictionaries with the following fields:</paragraph>
                    <literal_block force="False" language="gdscript" linenos="False" xml:space="preserve">{
  "type": "restore",
  "result": "ok",
  "product_id": "product ID of restored purchase",
}</literal_block>
                </section>
            </section>
            <section ids="set-auto-finish-transaction" names="set_auto_finish_transaction">
                <title><literal>set_auto_finish_transaction</literal></title>
                <paragraph>If set to <literal>true</literal>, once a purchase is successful, your purchase will be
                    finalized automatically. Call this method prior to calling <literal>purchase()</literal>.</paragraph>
                <section dupnames="parameters" ids="id4">
                    <title>Parameters</title>
                    <paragraph>Takes a boolean as a parameter which specifies if purchases should be
                        automatically finalized. Example:</paragraph>
                    <literal_block force="False" language="gdscript" linenos="False" xml:space="preserve">in_app_store.set_auto_finish_transaction(true)</literal_block>
                </section>
            </section>
            <section ids="finish-transaction" names="finish_transaction">
                <title><literal>finish_transaction</literal></title>
                <paragraph>If you don't want transactions to be automatically finalized, call this
                    method after you receive a successful purchase response.</paragraph>
                <section dupnames="parameters" ids="id5">
                    <title>Parameters</title>
                    <paragraph>Takes a string <literal>product_id</literal> as an argument. <literal>product_id</literal> specifies what product to
                        finalize the purchase on. Example:</paragraph>
                    <literal_block force="False" language="gdscript" linenos="False" xml:space="preserve">in_app_store.finish_transaction("my_product1")</literal_block>
                </section>
            </section>
        </section>
        <section ids="game-center" names="game\ center">
            <title>Game Center</title>
            <paragraph>Implemented in <reference name="Godot iOS GameCenter plugin" refuri="https://github.com/godotengine/godot-ios-plugins/blob/master/plugins/gamecenter/game_center.mm">Godot iOS GameCenter plugin</reference><target ids="godot-ios-gamecenter-plugin" names="godot\ ios\ gamecenter\ plugin" refuri="https://github.com/godotengine/godot-ios-plugins/blob/master/plugins/gamecenter/game_center.mm"></target>.</paragraph>
            <paragraph>The Game Center API is available through the <literal>GameCenter</literal> singleton. It
                has the following methods:</paragraph>
            <literal_block force="False" language="gdscript" linenos="False" xml:space="preserve">Error authenticate()
bool is_authenticated()
Error post_score(Variant score)
Error award_achievement(Variant params)
void reset_achievements()
void request_achievements()
void request_achievement_descriptions()
Error show_game_center(Variant params)
Error request_identity_verification_signature()</literal_block>
            <paragraph>and the pending events interface:</paragraph>
            <literal_block force="False" language="gdscript" linenos="False" xml:space="preserve">int get_pending_event_count()
Variant pop_pending_event()</literal_block>
            <section ids="authenticate" names="authenticate">
                <title><literal>authenticate</literal></title>
                <paragraph>Authenticates a user in Game Center.</paragraph>
                <section dupnames="response\ event" ids="id6">
                    <title>Response event</title>
                    <paragraph>The response event will be a dictionary with the following fields:</paragraph>
                    <paragraph>On error:</paragraph>
                    <literal_block force="False" language="gdscript" linenos="False" xml:space="preserve">{
  "type": "authentication",
  "result": "error",
  "error_code": the value from NSError::code,
  "error_description": the value from NSError::localizedDescription,
}</literal_block>
                    <paragraph>On success:</paragraph>
                    <literal_block force="False" language="gdscript" linenos="False" xml:space="preserve">{
  "type": "authentication",
  "result": "ok",
  "player_id": the value from GKLocalPlayer::playerID,
}</literal_block>
                </section>
            </section>
            <section ids="post-score" names="post_score">
                <title><literal>post_score</literal></title>
                <paragraph>Posts a score to a Game Center leaderboard.</paragraph>
                <section dupnames="parameters" ids="id7">
                    <title>Parameters</title>
                    <paragraph>Takes a dictionary as a parameter, with two fields:</paragraph>
                    <bullet_list bullet="-">
                        <list_item>
                            <paragraph><literal>score</literal> a float number</paragraph>
                        </list_item>
                        <list_item>
                            <paragraph><literal>category</literal> a string with the category name</paragraph>
                        </list_item>
                    </bullet_list>
                    <paragraph>Example:</paragraph>
                    <literal_block force="False" language="gdscript" linenos="False" xml:space="preserve">var result = game_center.post_score({ "score": 100, "category": "my_leaderboard", })</literal_block>
                </section>
                <section dupnames="response\ event" ids="id8">
                    <title>Response event</title>
                    <paragraph>The response event will be a dictionary with the following fields:</paragraph>
                    <paragraph>On error:</paragraph>
                    <literal_block force="False" language="gdscript" linenos="False" xml:space="preserve">{
  "type": "post_score",
  "result": "error",
  "error_code": the value from NSError::code,
  "error_description": the value from NSError::localizedDescription,
}</literal_block>
                    <paragraph>On success:</paragraph>
                    <literal_block force="False" language="gdscript" linenos="False" xml:space="preserve">{
  "type": "post_score",
  "result": "ok",
}</literal_block>
                </section>
            </section>
            <section ids="award-achievement" names="award_achievement">
                <title><literal>award_achievement</literal></title>
                <paragraph>Modifies the progress of a Game Center achievement.</paragraph>
                <section dupnames="parameters" ids="id9">
                    <title>Parameters</title>
                    <paragraph>Takes a Dictionary as a parameter, with 3 fields:</paragraph>
                    <bullet_list bullet="-">
                        <list_item>
                            <paragraph><literal>name</literal> (string) the achievement name</paragraph>
                        </list_item>
                        <list_item>
                            <paragraph><literal>progress</literal> (float) the achievement progress from 0.0 to 100.0
                                (passed to <literal>GKAchievement::percentComplete</literal>)</paragraph>
                        </list_item>
                        <list_item>
                            <paragraph><literal>show_completion_banner</literal> (bool) whether Game Center should display
                                an achievement banner at the top of the screen</paragraph>
                        </list_item>
                    </bullet_list>
                    <paragraph>Example:</paragraph>
                    <literal_block force="False" language="gdscript" linenos="False" xml:space="preserve">var result = award_achievement({ "name": "hard_mode_completed", "progress": 6.1 })</literal_block>
                </section>
                <section dupnames="response\ event" ids="id10">
                    <title>Response event</title>
                    <paragraph>The response event will be a dictionary with the following fields:</paragraph>
                    <paragraph>On error:</paragraph>
                    <literal_block force="False" language="gdscript" linenos="False" xml:space="preserve">{
  "type": "award_achievement",
  "result": "error",
  "error_code": the error code taken from NSError::code,
}</literal_block>
                    <paragraph>On success:</paragraph>
                    <literal_block force="False" language="gdscript" linenos="False" xml:space="preserve">{
  "type": "award_achievement",
  "result": "ok",
}</literal_block>
                </section>
            </section>
            <section ids="reset-achievements" names="reset_achievements">
                <title><literal>reset_achievements</literal></title>
                <paragraph>Clears all Game Center achievements. The function takes no parameters.</paragraph>
                <section dupnames="response\ event" ids="id11">
                    <title>Response event</title>
                    <paragraph>The response event will be a dictionary with the following fields:</paragraph>
                    <paragraph>On error:</paragraph>
                    <literal_block force="False" language="gdscript" linenos="False" xml:space="preserve">{
  "type": "reset_achievements",
  "result": "error",
  "error_code": the value from NSError::code,
}</literal_block>
                    <paragraph>On success:</paragraph>
                    <literal_block force="False" language="gdscript" linenos="False" xml:space="preserve">{
  "type": "reset_achievements",
  "result": "ok",
}</literal_block>
                </section>
            </section>
            <section ids="request-achievements" names="request_achievements">
                <title><literal>request_achievements</literal></title>
                <paragraph>Request all the Game Center achievements the player has made progress
                    on. The function takes no parameters.</paragraph>
                <section dupnames="response\ event" ids="id12">
                    <title>Response event</title>
                    <paragraph>The response event will be a dictionary with the following fields:</paragraph>
                    <paragraph>On error:</paragraph>
                    <literal_block force="False" language="gdscript" linenos="False" xml:space="preserve">{
  "type": "achievements",
  "result": "error",
  "error_code": the value from NSError::code,
}</literal_block>
                    <paragraph>On success:</paragraph>
                    <literal_block force="False" language="gdscript" linenos="False" xml:space="preserve">{
  "type": "achievements",
  "result": "ok",
  "names": [ list of the name of each achievement ],
  "progress": [ list of the progress made on each achievement ],
}</literal_block>
                </section>
            </section>
            <section ids="request-achievement-descriptions" names="request_achievement_descriptions">
                <title><literal>request_achievement_descriptions</literal></title>
                <paragraph>Request the descriptions of all existing Game Center achievements
                    regardless of progress. The function takes no parameters.</paragraph>
                <section dupnames="response\ event" ids="id13">
                    <title>Response event</title>
                    <paragraph>The response event will be a dictionary with the following fields:</paragraph>
                    <paragraph>On error:</paragraph>
                    <literal_block force="False" language="gdscript" linenos="False" xml:space="preserve">{
  "type": "achievement_descriptions",
  "result": "error",
  "error_code": the value from NSError::code,
}</literal_block>
                    <paragraph>On success:</paragraph>
                    <literal_block force="False" language="gdscript" linenos="False" xml:space="preserve">{
  "type": "achievement_descriptions",
  "result": "ok",
  "names": [ list of the name of each achievement ],
  "titles": [ list of the title of each achievement ],
  "unachieved_descriptions": [ list of the description of each achievement when it is unachieved ],
  "achieved_descriptions": [ list of the description of each achievement when it is achieved ],
  "maximum_points": [ list of the points earned by completing each achievement ],
  "hidden": [ list of booleans indicating whether each achievement is initially visible ],
  "replayable": [ list of booleans indicating whether each achievement can be earned more than once ],
}</literal_block>
                </section>
            </section>
            <section ids="show-game-center" names="show_game_center">
                <title><literal>show_game_center</literal></title>
                <paragraph>Displays the built-in Game Center overlay showing leaderboards,
                    achievements, and challenges.</paragraph>
                <section dupnames="parameters" ids="id14">
                    <title>Parameters</title>
                    <paragraph>Takes a Dictionary as a parameter, with two fields:</paragraph>
                    <bullet_list bullet="-">
                        <list_item>
                            <paragraph><literal>view</literal> (string) (optional) the name of the view to present. Accepts
                                "default", "leaderboards", "achievements", or "challenges". Defaults
                                to "default".</paragraph>
                        </list_item>
                        <list_item>
                            <paragraph><literal>leaderboard_name</literal> (string) (optional) the name of the leaderboard
                                to present. Only used when "view" is "leaderboards" (or "default" is
                                configured to show leaderboards). If not specified, Game Center will
                                display the aggregate leaderboard.</paragraph>
                        </list_item>
                    </bullet_list>
                    <paragraph>Examples:</paragraph>
                    <literal_block force="False" language="gdscript" linenos="False" xml:space="preserve">var result = show_game_center({ "view": "leaderboards", "leaderboard_name": "best_time_leaderboard" })
var result = show_game_center({ "view": "achievements" })</literal_block>
                </section>
                <section dupnames="response\ event" ids="id15">
                    <title>Response event</title>
                    <paragraph>The response event will be a dictionary with the following fields:</paragraph>
                    <paragraph>On close:</paragraph>
                    <literal_block force="False" language="gdscript" linenos="False" xml:space="preserve">{
  "type": "show_game_center",
  "result": "ok",
}</literal_block>
                    <substitution_definition names="weblate_widget"><reference refuri="https://hosted.weblate.org/engage/godot-engine/?utm_source=widget"><image alt="Translation status" candidates="{'?': 'https://hosted.weblate.org/widgets/godot-engine/-/godot-docs/287x66-white.png'}" height="66" uri="https://hosted.weblate.org/widgets/godot-engine/-/godot-docs/287x66-white.png" width="287"></image></reference></substitution_definition>
                </section>
            </section>
        </section>
    </section>
</document>
