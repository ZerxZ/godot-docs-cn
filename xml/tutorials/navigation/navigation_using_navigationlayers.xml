<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.21.2 -->
<document source="/home/runner/work/godot-docs-cn/godot-docs-cn/godot-docs/docs/tutorials/navigation/navigation_using_navigationlayers.rst" translation_progress="{'total': 0, 'translated': 0}" xmlns:c="https://www.sphinx-doc.org/" xmlns:changeset="https://www.sphinx-doc.org/" xmlns:citation="https://www.sphinx-doc.org/" xmlns:cpp="https://www.sphinx-doc.org/" xmlns:index="https://www.sphinx-doc.org/" xmlns:js="https://www.sphinx-doc.org/" xmlns:math="https://www.sphinx-doc.org/" xmlns:py="https://www.sphinx-doc.org/" xmlns:rst="https://www.sphinx-doc.org/" xmlns:std="https://www.sphinx-doc.org/">
    <target refid="doc-navigation-advanced-using-navigationlayers"></target>
    <section ids="using-navigationlayers doc-navigation-advanced-using-navigationlayers" names="using\ navigationlayers doc_navigation_advanced_using_navigationlayers">
        <title>Using NavigationLayers</title>
        <paragraph>NavigationLayers are an optional feature to further control which navigation meshes are considered in a path query.
            They work similar to how physics layers control collision between collision objects or how visual layers control what is rendered to the Viewport.</paragraph>
        <paragraph>NavigationLayers can be named in the <strong>ProjectSettings</strong> the same as physics layers or visual layers.</paragraph>
        <image candidates="{'*': 'tutorials/navigation/img/navigationlayers_naming.png'}" original_uri="img/navigationlayers_naming.png" uri="tutorials/navigation/img/navigationlayers_naming.png"></image>
        <paragraph>If a region has not a single compatible navigation layer with the <literal>navigation_layers</literal> parameter of a path query this regions navigation mesh will be skipped in pathfinding.
            See <reference internal="True" refuri="navigation_using_navigationpaths#doc-navigation-using-navigationpaths"><inline classes="std std-ref">Using NavigationPaths</inline></reference> for more information on querying the NavigationServer for paths.</paragraph>
        <paragraph>NavigationLayers are a single <literal>int</literal> value that is used as a <strong>bitmask</strong>.
            Many navigation related nodes have <literal>set_navigation_layer_value()</literal> and
            <literal>get_navigation_layer_value()</literal> functions to set and get a layer number directly
            without the need for more complex bitwise operations.</paragraph>
        <paragraph>In scripts the following helper functions can be used to work with the <literal>navigation_layers</literal> bitmask.</paragraph>
        <container classes="sphinx-tabs" type="tab-element">
            <div aria-label="Tabbed content" role="tablist">
                <button aria-controls="panel-0-MkQgR0RTY3JpcHQ=" aria-selected="true" classes="sphinx-tabs-tab code-tab group-tab" ids="tab-0-MkQgR0RTY3JpcHQ=" name="MkQgR0RTY3JpcHQ=" role="tab" tabindex="0">2D GDScript</button>
                <button aria-controls="panel-0-MkQgQyM=" aria-selected="false" classes="sphinx-tabs-tab code-tab group-tab" ids="tab-0-MkQgQyM=" name="MkQgQyM=" role="tab" tabindex="-1">2D C#</button>
                <button aria-controls="panel-0-M0QgR0RTY3JpcHQ=" aria-selected="false" classes="sphinx-tabs-tab code-tab group-tab" ids="tab-0-M0QgR0RTY3JpcHQ=" name="M0QgR0RTY3JpcHQ=" role="tab" tabindex="-1">3D GDScript</button>
                <button aria-controls="panel-0-M0QgQyM=" aria-selected="false" classes="sphinx-tabs-tab code-tab group-tab" ids="tab-0-M0QgQyM=" name="M0QgQyM=" role="tab" tabindex="-1">3D C#</button>
            </div>
            <div aria-labelledby="tab-0-MkQgR0RTY3JpcHQ=" classes="sphinx-tabs-panel code-tab group-tab" ids="panel-0-MkQgR0RTY3JpcHQ=" name="MkQgR0RTY3JpcHQ=" role="tabpanel" tabindex="0">
                <literal_block force="False" highlight_args="{}" language="gdscript" linenos="False" xml:space="preserve">func change_layers():
    var region: NavigationRegion2D = get_node("NavigationRegion2D")
    # enables 4-th layer for this region
    region.navigation_layers = enable_bitmask_inx(region.navigation_layers, 4)
    # disables 1-rst layer for this region
    region.navigation_layers = disable_bitmask_inx(region.navigation_layers, 1)

    var agent: NavigationAgent2D = get_node("NavigationAgent2D")
    # make future path queries of this agent ignore regions with 4-th layer
    agent.navigation_layers = disable_bitmask_inx(agent.navigation_layers, 4)

    var path_query_navigation_layers: int = 0
    path_query_navigation_layers = enable_bitmask_inx(path_query_navigation_layers, 2)
    # get a path that only considers 2-nd layer regions
    var path: PackedVector2Array = NavigationServer2D.map_get_path(
        map,
        start_position,
        target_position,
        true,
        path_query_navigation_layers
        )

static func is_bitmask_inx_enabled(_bitmask: int, _index: int) -&gt; bool:
    return _bitmask &amp; (1 &lt;&lt; _index) != 0

static func enable_bitmask_inx(_bitmask: int, _index: int) -&gt; int:
    return _bitmask | (1 &lt;&lt; _index)

static func disable_bitmask_inx(_bitmask: int, _index: int) -&gt; int:
    return _bitmask &amp; ~(1 &lt;&lt; _index)</literal_block>
            </div>
            <div aria-labelledby="tab-0-MkQgQyM=" classes="sphinx-tabs-panel code-tab group-tab" hidden="true" ids="panel-0-MkQgQyM=" name="MkQgQyM=" role="tabpanel" tabindex="0">
                <literal_block force="False" highlight_args="{}" language="csharp" linenos="False" xml:space="preserve">using Godot;

public partial class MyNode2D : Node2D
{
    private Rid _map;
    private Vector2 _startPosition;
    private Vector2 _targetPosition;

    private void ChangeLayers()
    {
        NavigationRegion2D region = GetNode&lt;NavigationRegion2D&gt;("NavigationRegion2D");
        // Enables the 4th layer for this region.
        region.NavigationLayers = EnableBitmaskInx(region.NavigationLayers, 4);
        // Disables the 1st layer for this region.
        region.NavigationLayers = DisableBitmaskInx(region.NavigationLayers, 1);

        NavigationAgent2D agent = GetNode&lt;NavigationAgent2D&gt;("NavigationAgent2D");
        // Make future path queries of this agent ignore regions with the 4th layer.
        agent.NavigationLayers = DisableBitmaskInx(agent.NavigationLayers, 4);

        uint pathQueryNavigationLayers = 0;
        pathQueryNavigationLayers = EnableBitmaskInx(pathQueryNavigationLayers, 2);
        // Get a path that only considers 2nd layer regions.
        Vector2[] path = NavigationServer2D.MapGetPath(
            _map,
            _startPosition,
            _targetPosition,
            true,
            pathQueryNavigationLayers
        );
    }

    private static bool IsBitmaskInxEnabled(uint bitmask, int index)
    {
        return (bitmask &amp; (1 &lt;&lt; index)) != 0;
    }

    private static uint EnableBitmaskInx(uint bitmask, int index)
    {
        return bitmask | (1u &lt;&lt; index);
    }

    private static uint DisableBitmaskInx(uint bitmask, int index)
    {
        return bitmask &amp; ~(1u &lt;&lt; index);
    }
}</literal_block>
            </div>
            <div aria-labelledby="tab-0-M0QgR0RTY3JpcHQ=" classes="sphinx-tabs-panel code-tab group-tab" hidden="true" ids="panel-0-M0QgR0RTY3JpcHQ=" name="M0QgR0RTY3JpcHQ=" role="tabpanel" tabindex="0">
                <literal_block force="False" highlight_args="{}" language="gdscript" linenos="False" xml:space="preserve">func change_layers():
    var region: NavigationRegion3D = get_node("NavigationRegion3D")
    # enables 4-th layer for this region
    region.navigation_layers = enable_bitmask_inx(region.navigation_layers, 4)
    # disables 1-rst layer for this region
    region.navigation_layers = disable_bitmask_inx(region.navigation_layers, 1)

    var agent: NavigationAgent3D = get_node("NavigationAgent3D")
    # make future path queries of this agent ignore regions with 4-th layer
    agent.navigation_layers = disable_bitmask_inx(agent.navigation_layers, 4)

    var path_query_navigation_layers: int = 0
    path_query_navigation_layers = enable_bitmask_inx(path_query_navigation_layers, 2)
    # get a path that only considers 2-nd layer regions
    var path: PackedVector3Array = NavigationServer3D.map_get_path(
        map,
        start_position,
        target_position,
        true,
        path_query_navigation_layers
        )

static func is_bitmask_inx_enabled(_bitmask: int, _index: int) -&gt; bool:
    return _bitmask &amp; (1 &lt;&lt; _index) != 0

static func enable_bitmask_inx(_bitmask: int, _index: int) -&gt; int:
    return _bitmask | (1 &lt;&lt; _index)

static func disable_bitmask_inx(_bitmask: int, _index: int) -&gt; int:
    return _bitmask &amp; ~(1 &lt;&lt; _index)</literal_block>
            </div>
            <div aria-labelledby="tab-0-M0QgQyM=" classes="sphinx-tabs-panel code-tab group-tab" hidden="true" ids="panel-0-M0QgQyM=" name="M0QgQyM=" role="tabpanel" tabindex="0">
                <literal_block force="False" highlight_args="{}" language="csharp" linenos="False" xml:space="preserve">using Godot;

public partial class MyNode3D : Node3D
{
    private Rid _map;
    private Vector3 _startPosition;
    private Vector3 _targetPosition;

    private void ChangeLayers()
    {
        NavigationRegion3D region = GetNode&lt;NavigationRegion3D&gt;("NavigationRegion3D");
        // Enables the 4th layer for this region.
        region.NavigationLayers = EnableBitmaskInx(region.NavigationLayers, 4);
        // Disables the 1st layer for this region.
        region.NavigationLayers = DisableBitmaskInx(region.NavigationLayers, 1);

        NavigationAgent3D agent = GetNode&lt;NavigationAgent3D&gt;("NavigationAgent2D");
        // Make future path queries of this agent ignore regions with the 4th layer.
        agent.NavigationLayers = DisableBitmaskInx(agent.NavigationLayers, 4);

        uint pathQueryNavigationLayers = 0;
        pathQueryNavigationLayers = EnableBitmaskInx(pathQueryNavigationLayers, 2);
        // Get a path that only considers 2nd layer regions.
        Vector3[] path = NavigationServer3D.MapGetPath(
            _map,
            _startPosition,
            _targetPosition,
            true,
            pathQueryNavigationLayers
        );
    }

    private static bool IsBitmaskInxEnabled(uint bitmask, int index)
    {
        return (bitmask &amp; (1 &lt;&lt; index)) != 0;
    }

    private static uint EnableBitmaskInx(uint bitmask, int index)
    {
        return bitmask | (1u &lt;&lt; index);
    }

    private static uint DisableBitmaskInx(uint bitmask, int index)
    {
        return bitmask &amp; ~(1u &lt;&lt; index);
    }
}</literal_block>
            </div>
        </container>
        <paragraph>Changing navigation layers for path queries is a performance friendly alternative to
            enabling / disabling entire navigation regions. Compared to region changes a
            navigation path query with different navigation layers does not
            trigger large scale updates on the NavigationServer.</paragraph>
        <paragraph>Changing the navigation layers of NavigationAgent nodes will have an immediate
            effect on the next path query. Changing the navigation layers of
            regions will have an effect after the next NavigationServer sync.</paragraph>
        <substitution_definition names="weblate_widget"><reference refuri="https://hosted.weblate.org/engage/godot-engine/?utm_source=widget"><image alt="Translation status" candidates="{'?': 'https://hosted.weblate.org/widgets/godot-engine/-/godot-docs/287x66-white.png'}" height="66" uri="https://hosted.weblate.org/widgets/godot-engine/-/godot-docs/287x66-white.png" width="287"></image></reference></substitution_definition>
    </section>
</document>
