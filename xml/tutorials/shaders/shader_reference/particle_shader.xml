<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.17.1 -->
<document source="/home/runner/work/godot-docs-cn/godot-docs-cn/godot-docs/docs/tutorials/shaders/shader_reference/particle_shader.rst" xmlns:c="https://www.sphinx-doc.org/" xmlns:changeset="https://www.sphinx-doc.org/" xmlns:citation="https://www.sphinx-doc.org/" xmlns:cpp="https://www.sphinx-doc.org/" xmlns:index="https://www.sphinx-doc.org/" xmlns:js="https://www.sphinx-doc.org/" xmlns:math="https://www.sphinx-doc.org/" xmlns:py="https://www.sphinx-doc.org/" xmlns:rst="https://www.sphinx-doc.org/" xmlns:std="https://www.sphinx-doc.org/">
    <target refid="doc-particle-shader"></target>
    <section ids="particle-shaders doc-particle-shader" names="particle\ shaders 粒子着色器 doc_particle_shader">
        <title>粒子着色器</title>
        <paragraph>Particle shaders are a special type of shader that runs before the object is
            drawn. They are used for calculating material properties such as color,
            position, and rotation. They are drawn with any regular material for CanvasItem
            or Spatial, depending on whether they are 2D or 3D.</paragraph>
        <paragraph>Particle shaders are unique because they are not used to draw the object itself;
            they are used to calculate particle properties, which are then used by a
            CanvasItem or Spatial shader. They contain two processor functions: <literal>start()</literal>
            and <literal>process()</literal>.</paragraph>
        <paragraph>Unlike other shader types, particle shaders keep the data that was output the
            previous frame. Therefore, particle shaders can be used for complex effects that
            take place over multiple frames.</paragraph>
        <note>
            <paragraph>Particle shaders are only available with GPU-based particle nodes
                (<reference internal="True" refuri="../../../classes/class_gpuparticles2d#class-gpuparticles2d"><inline classes="std std-ref">GPUParticles2D</inline></reference> and <reference internal="True" refuri="../../../classes/class_gpuparticles3d#class-gpuparticles3d"><inline classes="std std-ref">GPUParticles3D</inline></reference>).</paragraph>
            <paragraph>CPU-based particle nodes (<reference internal="True" refuri="../../../classes/class_cpuparticles2d#class-cpuparticles2d"><inline classes="std std-ref">CPUParticles2D</inline></reference> and
                <reference internal="True" refuri="../../../classes/class_cpuparticles3d#class-cpuparticles3d"><inline classes="std std-ref">CPUParticles3D</inline></reference>) are <emphasis>rendered</emphasis> on the GPU (which means they can
                use custom CanvasItem or Spatial shaders), but their motion is <emphasis>simulated</emphasis>
                on the CPU.</paragraph>
        </note>
        <section ids="render-modes" names="render\ modes 渲染模式">
            <title>渲染模式</title>
            <table>
                <tgroup cols="2">
                    <colspec colwidth="26"></colspec>
                    <colspec colwidth="43"></colspec>
                    <thead>
                        <row>
                            <entry>
                                <paragraph>渲染模式</paragraph>
                            </entry>
                            <entry>
                                <paragraph>描述</paragraph>
                            </entry>
                        </row>
                    </thead>
                    <tbody>
                        <row>
                            <entry>
                                <paragraph><strong>keep_data</strong></paragraph>
                            </entry>
                            <entry>
                                <paragraph>不要在重启时清除以前的数据.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><strong>disable_force</strong></paragraph>
                            </entry>
                            <entry>
                                <paragraph>Disable attractor force.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><strong>disable_velocity</strong></paragraph>
                            </entry>
                            <entry>
                                <paragraph>忽略 <strong>VELOCITY</strong> 值.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><strong>collision_use_scale</strong></paragraph>
                            </entry>
                            <entry>
                                <paragraph>为进行碰撞而缩放粒子的大小。</paragraph>
                            </entry>
                        </row>
                    </tbody>
                </tgroup>
            </table>
        </section>
        <section ids="built-ins" names="built-ins 内置">
            <title>内置</title>
            <paragraph>标记为 "in" 的值是只读的. 标记为 "out" 的值是可以选择写入的, 不一定包含合理的值. 标记为 "inout" 的值提供一个合理的默认值, 并且可以选择写入. 采样器不是写入的对象, 它们没有被标记.</paragraph>
        </section>
        <section ids="global-built-ins" names="global\ built-ins 全局内置">
            <title>全局内置</title>
            <paragraph>全局内置的功能随处可见, 包括自定义功能.</paragraph>
            <table>
                <tgroup cols="2">
                    <colspec colwidth="19"></colspec>
                    <colspec colwidth="88"></colspec>
                    <thead>
                        <row>
                            <entry>
                                <paragraph>内置</paragraph>
                            </entry>
                            <entry>
                                <paragraph>描述</paragraph>
                            </entry>
                        </row>
                    </thead>
                    <tbody>
                        <row>
                            <entry>
                                <paragraph>in float <strong>TIME</strong></paragraph>
                            </entry>
                            <entry>
                                <paragraph>全球时间, 以秒为单位.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>in float <strong>PI</strong></paragraph>
                            </entry>
                            <entry>
                                <paragraph>A <literal>PI</literal> constant (<literal>3.141592</literal>).
                                    A ration of circle's circumference to its diameter and amount of radians in half turn.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>in float <strong>TAU</strong></paragraph>
                            </entry>
                            <entry>
                                <paragraph>A <literal>TAU</literal> constant (<literal>6.283185</literal>).
                                    An equivalent of <literal>PI * 2</literal> and amount of radians in full turn.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>in float <strong>E</strong></paragraph>
                            </entry>
                            <entry>
                                <paragraph>A <literal>E</literal> constant (<literal>2.718281</literal>). Euler's number and a base of the natural logarithm.</paragraph>
                            </entry>
                        </row>
                    </tbody>
                </tgroup>
            </table>
        </section>
        <section ids="start-and-process-built-ins" names="start\ and\ process\ built-ins">
            <title>Start and Process built-ins</title>
            <paragraph>These properties can be accessed from both the <literal>start()</literal> and <literal>process()</literal> functions.</paragraph>
            <table>
                <tgroup cols="2">
                    <colspec colwidth="36"></colspec>
                    <colspec colwidth="137"></colspec>
                    <thead>
                        <row>
                            <entry>
                                <paragraph>函数</paragraph>
                            </entry>
                            <entry>
                                <paragraph>描述</paragraph>
                            </entry>
                        </row>
                    </thead>
                    <tbody>
                        <row>
                            <entry>
                                <paragraph>in float <strong>LIFETIME</strong></paragraph>
                            </entry>
                            <entry>
                                <paragraph>粒子寿命。</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>in float <strong>DELTA</strong></paragraph>
                            </entry>
                            <entry>
                                <paragraph>处理时间差。</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>in uint <strong>NUMBER</strong></paragraph>
                            </entry>
                            <entry>
                                <paragraph>发射开始后的唯一编号。</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>in uint <strong>INDEX</strong></paragraph>
                            </entry>
                            <entry>
                                <paragraph>粒子索引（在所有粒子范围内）。</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>in mat4 <strong>EMISSION_TRANSFORM</strong></paragraph>
                            </entry>
                            <entry>
                                <paragraph>发射器变换（用于非本地坐标系）。</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>in uint <strong>RANDOM_SEED</strong></paragraph>
                            </entry>
                            <entry>
                                <paragraph>随机种子，是随机的基础。</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>inout bool <strong>ACTIVE</strong></paragraph>
                            </entry>
                            <entry>
                                <paragraph><literal>true</literal> when the particle is active, can be set <literal>false</literal>.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>inout vec4 <strong>COLOR</strong></paragraph>
                            </entry>
                            <entry>
                                <paragraph>粒子的颜色, 可以写入Mesh的顶点函数中, 也可以访问.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>inout vec3 <strong>VELOCITY</strong></paragraph>
                            </entry>
                            <entry>
                                <paragraph>粒子速度, 可以修改.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>inout mat4 <strong>TRANSFORM</strong></paragraph>
                            </entry>
                            <entry>
                                <paragraph>粒子变换。</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>inout vec4 <strong>CUSTOM</strong></paragraph>
                            </entry>
                            <entry>
                                <paragraph>自定义粒子数据。网格的着色器可以使用 <strong>INSTANCE_CUSTOM</strong> 访问。</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>inout float <strong>MASS</strong></paragraph>
                            </entry>
                            <entry>
                                <paragraph>Particle mass, intended to be used with attractors. Equals <literal>1.0</literal> by default.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>in vec4 <strong>USERDATAX</strong></paragraph>
                            </entry>
                            <entry>
                                <paragraph>Vector that enables the integration of supplementary user-defined data into the particle process shader.
                                    <literal>USERDATAX</literal> are six built-ins identified by number, <literal>X</literal> can be numbers between 1 and 6.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>in uint <strong>FLAG_EMIT_POSITION</strong></paragraph>
                            </entry>
                            <entry>
                                <paragraph>A flag for using on the last argument of <literal>emit_subparticle</literal> function to assign a position to a new particle's transform.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>in uint <strong>FLAG_EMIT_ROT_SCALE</strong></paragraph>
                            </entry>
                            <entry>
                                <paragraph>A flag for using on the last argument of <literal>emit_subparticle</literal> function to assign the rotation and scale to a new particle's transform.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>in uint <strong>FLAG_EMIT_VELOCITY</strong></paragraph>
                            </entry>
                            <entry>
                                <paragraph>A flag for using on the last argument of <literal>emit_subparticle</literal> function to assign a velocity to a new particle.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>in uint <strong>FLAG_EMIT_COLOR</strong></paragraph>
                            </entry>
                            <entry>
                                <paragraph>A flag for using on the last argument of <literal>emit_subparticle</literal> function to assign a color to a new particle.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>in uint <strong>FLAG_EMIT_CUSTOM</strong></paragraph>
                            </entry>
                            <entry>
                                <paragraph>A flag for using on the last argument of <literal>emit_subparticle</literal> function to assign a custom data vector to a new particle.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>in vec3 <strong>EMITTER_VELOCITY</strong></paragraph>
                            </entry>
                            <entry>
                                <paragraph>Velocity of the Particles node.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>in float <strong>INTERPOLATE_TO_END</strong></paragraph>
                            </entry>
                            <entry>
                                <paragraph>Value of <literal>interp_to_end</literal> property of Particles node.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>in uint <strong>AMOUNT_RATIO</strong></paragraph>
                            </entry>
                            <entry>
                                <paragraph>Value of <literal>amount_ratio</literal> property of Particles node.</paragraph>
                            </entry>
                        </row>
                    </tbody>
                </tgroup>
            </table>
            <note>
                <paragraph>In order to use the <literal>COLOR</literal> variable in a StandardMaterial3D, set <literal>vertex_color_use_as_albedo</literal>
                    to <literal>true</literal>. In a ShaderMaterial, access it with the <literal>COLOR</literal> variable.</paragraph>
            </note>
        </section>
        <section ids="start-built-ins" names="start\ built-ins">
            <title>Start built-ins</title>
            <table>
                <tgroup cols="2">
                    <colspec colwidth="33"></colspec>
                    <colspec colwidth="183"></colspec>
                    <thead>
                        <row>
                            <entry>
                                <paragraph>内置</paragraph>
                            </entry>
                            <entry>
                                <paragraph>描述</paragraph>
                            </entry>
                        </row>
                    </thead>
                    <tbody>
                        <row>
                            <entry>
                                <paragraph>in bool <strong>RESTART_POSITION</strong></paragraph>
                            </entry>
                            <entry>
                                <paragraph><literal>true</literal> if particle is restarted, or emitted without a custom position (i.e. this particle was created by <literal>emit_subparticle()</literal> without the <literal>FLAG_EMIT_POSITION</literal> flag).</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>in bool <strong>RESTART_ROT_SCALE</strong></paragraph>
                            </entry>
                            <entry>
                                <paragraph><literal>true</literal> if particle is restarted, or emitted without a custom rotation or scale (i.e. this particle was created by <literal>emit_subparticle()</literal> without the <literal>FLAG_EMIT_ROT_SCALE</literal> flag).</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>in bool <strong>RESTART_VELOCITY</strong></paragraph>
                            </entry>
                            <entry>
                                <paragraph><literal>true</literal> if particle is restarted, or emitted without a custom velocity (i.e. this particle was created by <literal>emit_subparticle()</literal> without the <literal>FLAG_EMIT_VELOCITY</literal> flag).</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>in bool <strong>RESTART_COLOR</strong></paragraph>
                            </entry>
                            <entry>
                                <paragraph><literal>true</literal> if particle is restarted, or emitted without a custom color (i.e. this particle was created by <literal>emit_subparticle()</literal> without the <literal>FLAG_EMIT_COLOR</literal> flag).</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>in bool <strong>RESTART_CUSTOM</strong></paragraph>
                            </entry>
                            <entry>
                                <paragraph><literal>true</literal> if particle is restarted, or emitted without a custom property (i.e. this particle was created by <literal>emit_subparticle()</literal> without the <literal>FLAG_EMIT_CUSTOM</literal> flag).</paragraph>
                            </entry>
                        </row>
                    </tbody>
                </tgroup>
            </table>
        </section>
        <section ids="process-built-ins" names="process\ built-ins">
            <title>Process built-ins</title>
            <table>
                <tgroup cols="2">
                    <colspec colwidth="36"></colspec>
                    <colspec colwidth="101"></colspec>
                    <thead>
                        <row>
                            <entry>
                                <paragraph>内置</paragraph>
                            </entry>
                            <entry>
                                <paragraph>描述</paragraph>
                            </entry>
                        </row>
                    </thead>
                    <tbody>
                        <row>
                            <entry>
                                <paragraph>in bool <strong>RESTART</strong></paragraph>
                            </entry>
                            <entry>
                                <paragraph><literal>true</literal> if the current process frame is first for the particle.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>in bool <strong>COLLIDED</strong></paragraph>
                            </entry>
                            <entry>
                                <paragraph><literal>true</literal> when the particle has collided with a particle collider.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>in vec3 <strong>COLLISION_NORMAL</strong></paragraph>
                            </entry>
                            <entry>
                                <paragraph>A normal of the last collision. If there is no collision detected it is equal to <literal>vec3(0.0)</literal>.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>in float <strong>COLLISION_DEPTH</strong></paragraph>
                            </entry>
                            <entry>
                                <paragraph>A length of normal of the last collision. If there is no collision detected it is equal to <literal>0.0</literal>.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>in vec3 <strong>ATTRACTOR_FORCE</strong></paragraph>
                            </entry>
                            <entry>
                                <paragraph>A combined force of the attractors at the moment on that particle.</paragraph>
                            </entry>
                        </row>
                    </tbody>
                </tgroup>
            </table>
        </section>
        <section ids="process-functions" names="process\ functions">
            <title>Process functions</title>
            <paragraph><literal>emit_subparticle</literal> is currently the only custom function supported by
                particles shaders. It allows users to add a new particle with specified
                parameters from a sub-emitter. The newly created particle will only use the
                properties that match the <literal>flags</literal> parameter. For example, the
                following code will emit a particle with a specified position, velocity, and
                color, but unspecified rotation, scale, and custom value:</paragraph>
            <literal_block force="False" highlight_args="{}" language="glsl" linenos="False" xml:space="preserve">mat4 custom_transform = mat4(1.0);
custom_transform[3].xyz = vec3(10.5, 0.0, 4.0);
emit_subparticle(custom_transform, vec3(1.0, 0.5, 1.0), vec4(1.0, 0.0, 0.0, 1.0), vec4(1.0), FLAG_EMIT_POSITION | FLAG_EMIT_VELOCITY | FLAG_EMIT_COLOR);</literal_block>
            <table>
                <tgroup cols="2">
                    <colspec colwidth="92"></colspec>
                    <colspec colwidth="38"></colspec>
                    <thead>
                        <row>
                            <entry>
                                <paragraph>函数</paragraph>
                            </entry>
                            <entry>
                                <paragraph>描述</paragraph>
                            </entry>
                        </row>
                    </thead>
                    <tbody>
                        <row>
                            <entry>
                                <paragraph>bool <strong>emit_subparticle</strong> (mat4 xform, vec3 velocity, vec4 color, vec4 custom, uint flags)</paragraph>
                            </entry>
                            <entry>
                                <paragraph>Emits a particle from a sub-emitter.</paragraph>
                            </entry>
                        </row>
                    </tbody>
                </tgroup>
            </table>
            <substitution_definition names="weblate_widget"><reference refuri="https://hosted.weblate.org/engage/godot-engine/zh_CN/?utm_source=widget"><image alt="翻译状态" candidates="{'?': 'https://hosted.weblate.org/widgets/godot-engine/zh_CN/godot-docs/287x66-white.png'}" height="66" uri="https://hosted.weblate.org/widgets/godot-engine/zh_CN/godot-docs/287x66-white.png" width="287"></image></reference></substitution_definition>
        </section>
    </section>
</document>
