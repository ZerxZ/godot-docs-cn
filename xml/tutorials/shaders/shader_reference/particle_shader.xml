<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.21.2 -->
<document source="/home/runner/work/godot-docs-cn/godot-docs-cn/godot-docs/docs/tutorials/shaders/shader_reference/particle_shader.rst" translation_progress="{'total': 0, 'translated': 0}" xmlns:c="https://www.sphinx-doc.org/" xmlns:changeset="https://www.sphinx-doc.org/" xmlns:citation="https://www.sphinx-doc.org/" xmlns:cpp="https://www.sphinx-doc.org/" xmlns:index="https://www.sphinx-doc.org/" xmlns:js="https://www.sphinx-doc.org/" xmlns:math="https://www.sphinx-doc.org/" xmlns:py="https://www.sphinx-doc.org/" xmlns:rst="https://www.sphinx-doc.org/" xmlns:std="https://www.sphinx-doc.org/">
    <target refid="doc-particle-shader"></target>
    <section ids="particle-shaders doc-particle-shader" names="particle\ shaders doc_particle_shader">
        <title>Particle shaders</title>
        <paragraph>Particle shaders are a special type of shader that runs before the object is
            drawn. They are used for calculating material properties such as color,
            position, and rotation. They can be drawn with any regular material for CanvasItem
            or Spatial, depending on whether they are 2D or 3D.</paragraph>
        <paragraph>Particle shaders are unique because they are not used to draw the object itself;
            they are used to calculate particle properties, which are then used by a
            <reference internal="True" refuri="canvas_item_shader#doc-canvas-item-shader"><inline classes="std std-ref">CanvasItem</inline></reference> or <reference internal="True" refuri="spatial_shader#doc-spatial-shader"><inline classes="std std-ref">Spatial</inline></reference>
            shader. They contain two processor functions: <literal>start()</literal> and <literal>process()</literal>.</paragraph>
        <paragraph>Unlike other shader types, particle shaders keep the data that was output the
            previous frame. Therefore, particle shaders can be used for complex effects that
            take place over multiple frames.</paragraph>
        <note>
            <paragraph>Particle shaders are only available with GPU-based particle nodes
                (<reference internal="True" refuri="../../../classes/class_gpuparticles2d#class-gpuparticles2d"><inline classes="std std-ref">GPUParticles2D</inline></reference> and <reference internal="True" refuri="../../../classes/class_gpuparticles3d#class-gpuparticles3d"><inline classes="std std-ref">GPUParticles3D</inline></reference>).</paragraph>
            <paragraph>CPU-based particle nodes (<reference internal="True" refuri="../../../classes/class_cpuparticles2d#class-cpuparticles2d"><inline classes="std std-ref">CPUParticles2D</inline></reference> and
                <reference internal="True" refuri="../../../classes/class_cpuparticles3d#class-cpuparticles3d"><inline classes="std std-ref">CPUParticles3D</inline></reference>) are <emphasis>rendered</emphasis> on the GPU (which means they can
                use custom CanvasItem or Spatial shaders), but their motion is <emphasis>simulated</emphasis>
                on the CPU.</paragraph>
        </note>
        <section ids="render-modes" names="render\ modes">
            <title>Render modes</title>
            <table>
                <tgroup cols="2">
                    <colspec colwidth="26"></colspec>
                    <colspec colwidth="43"></colspec>
                    <thead>
                        <row>
                            <entry>
                                <paragraph>Render mode</paragraph>
                            </entry>
                            <entry>
                                <paragraph>Description</paragraph>
                            </entry>
                        </row>
                    </thead>
                    <tbody>
                        <row>
                            <entry>
                                <paragraph><strong>keep_data</strong></paragraph>
                            </entry>
                            <entry>
                                <paragraph>Do not clear previous data on restart.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><strong>disable_force</strong></paragraph>
                            </entry>
                            <entry>
                                <paragraph>Disable attractor force.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><strong>disable_velocity</strong></paragraph>
                            </entry>
                            <entry>
                                <paragraph>Ignore <literal>VELOCITY</literal> value.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><strong>collision_use_scale</strong></paragraph>
                            </entry>
                            <entry>
                                <paragraph>Scale the particle's size for collisions.</paragraph>
                            </entry>
                        </row>
                    </tbody>
                </tgroup>
            </table>
        </section>
        <section ids="built-ins" names="built-ins">
            <title>Built-ins</title>
            <paragraph>Values marked as <literal>in</literal> are read-only. Values marked as <literal>out</literal> can optionally be written to and will
                not necessarily contain sensible values. Values marked as <literal>inout</literal> provide a sensible default
                value, and can optionally be written to. Samplers cannot be written to so they are not marked.</paragraph>
        </section>
        <section ids="global-built-ins" names="global\ built-ins">
            <title>Global built-ins</title>
            <paragraph>Global built-ins are available everywhere, including custom functions.</paragraph>
            <table>
                <tgroup cols="2">
                    <colspec colwidth="19"></colspec>
                    <colspec colwidth="97"></colspec>
                    <thead>
                        <row>
                            <entry>
                                <paragraph>Built-in</paragraph>
                            </entry>
                            <entry>
                                <paragraph>Description</paragraph>
                            </entry>
                        </row>
                    </thead>
                    <tbody>
                        <row>
                            <entry>
                                <paragraph>in float <strong>TIME</strong></paragraph>
                            </entry>
                            <entry>
                                <paragraph>Global time since the engine has started, in seconds. It repeats after every <literal>3,600</literal>
                                    seconds (which can be changed with the
                                    <reference internal="True" refuri="../../../classes/class_projectsettings#class-projectsettings-property-rendering-limits-time-time-rollover-secs"><inline classes="std std-ref">rollover</inline></reference>
                                    setting). It's affected by
                                    <reference internal="True" refuri="../../../classes/class_engine#class-engine-property-time-scale"><inline classes="std std-ref">time_scale</inline></reference> but not by pausing. If you need a
                                    <literal>TIME</literal> variable that is not affected by time scale, add your own
                                    <reference internal="True" refuri="shading_language#doc-shading-language-global-uniforms"><inline classes="std std-ref">global shader uniform</inline></reference> and update it each
                                    frame.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>in float <strong>PI</strong></paragraph>
                            </entry>
                            <entry>
                                <paragraph>A <literal>PI</literal> constant (<literal>3.141592</literal>).
                                    The ratio of a circle's circumference to its diameter and the number of radians in a half turn.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>in float <strong>TAU</strong></paragraph>
                            </entry>
                            <entry>
                                <paragraph>A <literal>TAU</literal> constant (<literal>6.283185</literal>).
                                    Equivalent to <literal>PI * 2</literal> and the number of radians in a full turn.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>in float <strong>E</strong></paragraph>
                            </entry>
                            <entry>
                                <paragraph>An <literal>E</literal> constant (<literal>2.718281</literal>). Euler's number, the base of the natural logarithm.</paragraph>
                            </entry>
                        </row>
                    </tbody>
                </tgroup>
            </table>
        </section>
        <section ids="start-and-process-built-ins" names="start\ and\ process\ built-ins">
            <title>Start and Process built-ins</title>
            <paragraph>These properties can be accessed from both the <literal>start()</literal> and <literal>process()</literal> functions.</paragraph>
            <table>
                <tgroup cols="2">
                    <colspec colwidth="36"></colspec>
                    <colspec colwidth="137"></colspec>
                    <thead>
                        <row>
                            <entry>
                                <paragraph>Function</paragraph>
                            </entry>
                            <entry>
                                <paragraph>Description</paragraph>
                            </entry>
                        </row>
                    </thead>
                    <tbody>
                        <row>
                            <entry>
                                <paragraph>in float <strong>LIFETIME</strong></paragraph>
                            </entry>
                            <entry>
                                <paragraph>Particle lifetime.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>in float <strong>DELTA</strong></paragraph>
                            </entry>
                            <entry>
                                <paragraph>Delta process time.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>in uint <strong>NUMBER</strong></paragraph>
                            </entry>
                            <entry>
                                <paragraph>Unique number since emission start.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>in uint <strong>INDEX</strong></paragraph>
                            </entry>
                            <entry>
                                <paragraph>Particle index (from total particles).</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>in mat4 <strong>EMISSION_TRANSFORM</strong></paragraph>
                            </entry>
                            <entry>
                                <paragraph>Emitter transform (used for non-local systems).</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>in uint <strong>RANDOM_SEED</strong></paragraph>
                            </entry>
                            <entry>
                                <paragraph>Random seed used as base for random.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>inout bool <strong>ACTIVE</strong></paragraph>
                            </entry>
                            <entry>
                                <paragraph><literal>true</literal> when the particle is active, can be set to <literal>false</literal>.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>inout vec4 <strong>COLOR</strong></paragraph>
                            </entry>
                            <entry>
                                <paragraph>Particle color, can be written to and accessed in the mesh's vertex function.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>inout vec3 <strong>VELOCITY</strong></paragraph>
                            </entry>
                            <entry>
                                <paragraph>Particle velocity, can be modified.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>inout mat4 <strong>TRANSFORM</strong></paragraph>
                            </entry>
                            <entry>
                                <paragraph>Particle transform.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>inout vec4 <strong>CUSTOM</strong></paragraph>
                            </entry>
                            <entry>
                                <paragraph>Custom particle data. Accessible from the mesh's shader as <literal>INSTANCE_CUSTOM</literal>.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>inout float <strong>MASS</strong></paragraph>
                            </entry>
                            <entry>
                                <paragraph>Particle mass, intended to be used with attractors. <literal>1.0</literal> by default.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>in vec4 <strong>USERDATAX</strong></paragraph>
                            </entry>
                            <entry>
                                <paragraph>Vector that enables the integration of supplementary user-defined data into the particle process shader.
                                    <literal>USERDATAX</literal> are six built-ins identified by number, <literal>X</literal> can be numbers between 1 and 6, for example <literal>USERDATA3</literal>.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>in uint <strong>FLAG_EMIT_POSITION</strong></paragraph>
                            </entry>
                            <entry>
                                <paragraph>A flag for the last argument of the <literal>emit_subparticle()</literal> function to assign a position to a new particle's transform.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>in uint <strong>FLAG_EMIT_ROT_SCALE</strong></paragraph>
                            </entry>
                            <entry>
                                <paragraph>A flag for the last argument of the <literal>emit_subparticle()</literal> function to assign a rotation and scale to a new particle's transform.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>in uint <strong>FLAG_EMIT_VELOCITY</strong></paragraph>
                            </entry>
                            <entry>
                                <paragraph>A flag for the last argument of the <literal>emit_subparticle()</literal> function to assign a velocity to a new particle.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>in uint <strong>FLAG_EMIT_COLOR</strong></paragraph>
                            </entry>
                            <entry>
                                <paragraph>A flag for the last argument of the <literal>emit_subparticle()</literal> function to assign a color to a new particle.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>in uint <strong>FLAG_EMIT_CUSTOM</strong></paragraph>
                            </entry>
                            <entry>
                                <paragraph>A flag for the last argument of the <literal>emit_subparticle()</literal> function to assign a custom data vector to a new particle.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>in vec3 <strong>EMITTER_VELOCITY</strong></paragraph>
                            </entry>
                            <entry>
                                <paragraph>Velocity of the <reference internal="True" refuri="../../../classes/class_gpuparticles2d#class-gpuparticles2d"><inline classes="std std-ref">Particles2D</inline></reference> (<reference internal="True" refuri="../../../classes/class_gpuparticles3d#class-gpuparticles3d"><inline classes="std std-ref">3D</inline></reference>) node.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>in float <strong>INTERPOLATE_TO_END</strong></paragraph>
                            </entry>
                            <entry>
                                <paragraph>Value of the <reference internal="True" refuri="../../../classes/class_gpuparticles2d#class-gpuparticles2d-property-interp-to-end"><inline classes="std std-ref">interp_to_end</inline></reference>
                                    (<reference internal="True" refuri="../../../classes/class_gpuparticles3d#class-gpuparticles3d-property-interp-to-end"><inline classes="std std-ref">3D</inline></reference>) property of the Particles node.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>in uint <strong>AMOUNT_RATIO</strong></paragraph>
                            </entry>
                            <entry>
                                <paragraph>Value of the <reference internal="True" refuri="../../../classes/class_gpuparticles2d#class-gpuparticles2d-property-amount-ratio"><inline classes="std std-ref">amount_ratio</inline></reference>
                                    (<reference internal="True" refuri="../../../classes/class_gpuparticles3d#class-gpuparticles3d-property-amount-ratio"><inline classes="std std-ref">3D</inline></reference>) property of the Particles node.</paragraph>
                            </entry>
                        </row>
                    </tbody>
                </tgroup>
            </table>
            <note>
                <paragraph>In order to use the <literal>COLOR</literal> variable in a StandardMaterial3D, set <literal>vertex_color_use_as_albedo</literal>
                    to <literal>true</literal>. In a ShaderMaterial, access it with the <literal>COLOR</literal> variable.</paragraph>
            </note>
        </section>
        <section ids="start-built-ins" names="start\ built-ins">
            <title>Start built-ins</title>
            <table>
                <tgroup cols="2">
                    <colspec colwidth="33"></colspec>
                    <colspec colwidth="183"></colspec>
                    <thead>
                        <row>
                            <entry>
                                <paragraph>Built-in</paragraph>
                            </entry>
                            <entry>
                                <paragraph>Description</paragraph>
                            </entry>
                        </row>
                    </thead>
                    <tbody>
                        <row>
                            <entry>
                                <paragraph>in bool <strong>RESTART_POSITION</strong></paragraph>
                            </entry>
                            <entry>
                                <paragraph><literal>true</literal> if particle is restarted, or emitted without a custom position (i.e. this particle was created by <literal>emit_subparticle()</literal> without the <literal>FLAG_EMIT_POSITION</literal> flag).</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>in bool <strong>RESTART_ROT_SCALE</strong></paragraph>
                            </entry>
                            <entry>
                                <paragraph><literal>true</literal> if particle is restarted, or emitted without a custom rotation or scale (i.e. this particle was created by <literal>emit_subparticle()</literal> without the <literal>FLAG_EMIT_ROT_SCALE</literal> flag).</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>in bool <strong>RESTART_VELOCITY</strong></paragraph>
                            </entry>
                            <entry>
                                <paragraph><literal>true</literal> if particle is restarted, or emitted without a custom velocity (i.e. this particle was created by <literal>emit_subparticle()</literal> without the <literal>FLAG_EMIT_VELOCITY</literal> flag).</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>in bool <strong>RESTART_COLOR</strong></paragraph>
                            </entry>
                            <entry>
                                <paragraph><literal>true</literal> if particle is restarted, or emitted without a custom color (i.e. this particle was created by <literal>emit_subparticle()</literal> without the <literal>FLAG_EMIT_COLOR</literal> flag).</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>in bool <strong>RESTART_CUSTOM</strong></paragraph>
                            </entry>
                            <entry>
                                <paragraph><literal>true</literal> if particle is restarted, or emitted without a custom property (i.e. this particle was created by <literal>emit_subparticle()</literal> without the <literal>FLAG_EMIT_CUSTOM</literal> flag).</paragraph>
                            </entry>
                        </row>
                    </tbody>
                </tgroup>
            </table>
        </section>
        <section ids="process-built-ins" names="process\ built-ins">
            <title>Process built-ins</title>
            <table>
                <tgroup cols="2">
                    <colspec colwidth="36"></colspec>
                    <colspec colwidth="105"></colspec>
                    <thead>
                        <row>
                            <entry>
                                <paragraph>Built-in</paragraph>
                            </entry>
                            <entry>
                                <paragraph>Description</paragraph>
                            </entry>
                        </row>
                    </thead>
                    <tbody>
                        <row>
                            <entry>
                                <paragraph>in bool <strong>RESTART</strong></paragraph>
                            </entry>
                            <entry>
                                <paragraph><literal>true</literal> if the current process frame is the first for the particle.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>in bool <strong>COLLIDED</strong></paragraph>
                            </entry>
                            <entry>
                                <paragraph><literal>true</literal> when the particle has collided with a particle collider.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>in vec3 <strong>COLLISION_NORMAL</strong></paragraph>
                            </entry>
                            <entry>
                                <paragraph>A normal of the last collision. If there is no collision detected it is equal to <literal>(0.0, 0.0, 0.0)</literal>.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>in float <strong>COLLISION_DEPTH</strong></paragraph>
                            </entry>
                            <entry>
                                <paragraph>A length of the normal of the last collision. If there is no collision detected it is equal to <literal>0.0</literal>.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>in vec3 <strong>ATTRACTOR_FORCE</strong></paragraph>
                            </entry>
                            <entry>
                                <paragraph>A combined force of the attractors at the moment on that particle.</paragraph>
                            </entry>
                        </row>
                    </tbody>
                </tgroup>
            </table>
        </section>
        <section ids="process-functions" names="process\ functions">
            <title>Process functions</title>
            <paragraph><literal>emit_subparticle()</literal> is currently the only custom function supported by
                particle shaders. It allows users to add a new particle with specified
                parameters from a sub-emitter. The newly created particle will only use the
                properties that match the <literal>flags</literal> parameter. For example, the
                following code will emit a particle with a specified position, velocity, and
                color, but unspecified rotation, scale, and custom value:</paragraph>
            <literal_block force="False" highlight_args="{}" language="glsl" linenos="False" xml:space="preserve">mat4 custom_transform = mat4(1.0);
custom_transform[3].xyz = vec3(10.5, 0.0, 4.0);
emit_subparticle(custom_transform, vec3(1.0, 0.5, 1.0), vec4(1.0, 0.0, 0.0, 1.0), vec4(1.0), FLAG_EMIT_POSITION | FLAG_EMIT_VELOCITY | FLAG_EMIT_COLOR);</literal_block>
            <table>
                <tgroup cols="2">
                    <colspec colwidth="92"></colspec>
                    <colspec colwidth="38"></colspec>
                    <thead>
                        <row>
                            <entry>
                                <paragraph>Function</paragraph>
                            </entry>
                            <entry>
                                <paragraph>Description</paragraph>
                            </entry>
                        </row>
                    </thead>
                    <tbody>
                        <row>
                            <entry>
                                <paragraph>bool <strong>emit_subparticle</strong> (mat4 xform, vec3 velocity, vec4 color, vec4 custom, uint flags)</paragraph>
                            </entry>
                            <entry>
                                <paragraph>Emits a particle from a sub-emitter.</paragraph>
                            </entry>
                        </row>
                    </tbody>
                </tgroup>
            </table>
            <substitution_definition names="weblate_widget"><reference refuri="https://hosted.weblate.org/engage/godot-engine/?utm_source=widget"><image alt="Translation status" candidates="{'?': 'https://hosted.weblate.org/widgets/godot-engine/-/godot-docs/287x66-white.png'}" height="66" uri="https://hosted.weblate.org/widgets/godot-engine/-/godot-docs/287x66-white.png" width="287"></image></reference></substitution_definition>
        </section>
    </section>
</document>
