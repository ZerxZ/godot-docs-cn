<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.21.2 -->
<document source="/home/runner/work/godot-docs-cn/godot-docs-cn/godot-docs/docs/tutorials/assets_pipeline/retargeting_3d_skeletons.rst" translation_progress="{'total': 0, 'translated': 0}" xmlns:c="https://www.sphinx-doc.org/" xmlns:changeset="https://www.sphinx-doc.org/" xmlns:citation="https://www.sphinx-doc.org/" xmlns:cpp="https://www.sphinx-doc.org/" xmlns:index="https://www.sphinx-doc.org/" xmlns:js="https://www.sphinx-doc.org/" xmlns:math="https://www.sphinx-doc.org/" xmlns:py="https://www.sphinx-doc.org/" xmlns:rst="https://www.sphinx-doc.org/" xmlns:std="https://www.sphinx-doc.org/">
    <target refid="doc-retargeting-3d-skeletons"></target>
    <section ids="retargeting-3d-skeletons doc-retargeting-3d-skeletons" names="retargeting\ 3d\ skeletons doc_retargeting_3d_skeletons">
        <title>Retargeting 3D Skeletons</title>
        <section ids="to-share-animations-among-multiple-skeletons" names="to\ share\ animations\ among\ multiple\ skeletons">
            <title>To share animations among multiple Skeletons</title>
            <paragraph>Godot has Position/Rotation/Scale 3D tracks (which this document calls "Transform" tracks)
                with Nodepaths to bones for Skeleton bone animation. This means you can't
                share animations between multiple Skeletons just by using the same bone
                names.</paragraph>
            <paragraph>Godot allows each bone to have a parent-child relationship and can have rotation
                and scale as well as position, which means that bones that share a name can still
                have different Transform values.</paragraph>
            <paragraph>The Skeleton stores the Transform values necessary for the default pose as Bone Rest.
                If Bone Pose is equal to Bone Rest, it means that the Skeleton is in the default pose.</paragraph>
            <note>
                <paragraph>Godot 3 and Godot 4 have different Bone Pose behaviors.
                    In Godot 3, Bone Pose is relative to Bone Rest, but in Godot 4,
                    it includes Bone Rest. See this
                    <reference name="article" refuri="https://godotengine.org/article/animation-data-redesign-40">article</reference>
                    for more information.</paragraph>
            </note>
            <paragraph>Skeletal models have different Bone Rests depending on the environment from
                which they were exported. For example, the bones of a glTF model output from Blender
                have "Edit Bone Orientation" as the Bone Rest rotation. However, there are skeletal
                models without any Bone Rest rotations, such as the glTF model output from Maya.</paragraph>
            <paragraph>To share animations in Godot, it is necessary to match Bone Rests as well as Bone Names
                to remove unwanted tracks in some cases. You can do that using the scene importer.</paragraph>
        </section>
        <section ids="options-for-retargeting" names="options\ for\ retargeting">
            <title>Options for Retargeting</title>
            <section ids="bone-map" names="bone\ map">
                <title>Bone Map</title>
                <paragraph>When you select the Skeleton3D node in the advanced scene import menu, a menu will appear
                    on the right-hand side containing the "Retarget" section. The Retarget section has a single
                    property <literal>bone_map</literal>.</paragraph>
                <image candidates="{'*': 'tutorials/assets_pipeline/img/retargeting1.webp'}" original_uri="img/retargeting1.webp" uri="tutorials/assets_pipeline/img/retargeting1.webp"></image>
                <paragraph>With the Skeleton node selected, first set up a new <reference internal="True" refuri="../../classes/class_bonemap#class-bonemap"><inline classes="std std-ref">BoneMap</inline></reference> and <reference internal="True" refuri="../../classes/class_skeletonprofile#class-skeletonprofile"><inline classes="std std-ref">SkeletonProfile</inline></reference>.
                    Godot has a preset called <reference internal="True" refuri="../../classes/class_skeletonprofilehumanoid#class-skeletonprofilehumanoid"><inline classes="std std-ref">SkeletonProfileHumanoid</inline></reference> for humanoid models.
                    This tutorial proceeds with the assumption that you are using <reference internal="True" refuri="../../classes/class_skeletonprofilehumanoid#class-skeletonprofilehumanoid"><inline classes="std std-ref">SkeletonProfileHumanoid</inline></reference>.</paragraph>
                <note>
                    <paragraph>If you need a profile that is different from <reference internal="True" refuri="../../classes/class_skeletonprofilehumanoid#class-skeletonprofilehumanoid"><inline classes="std std-ref">SkeletonProfileHumanoid</inline></reference>, you can export
                        a <reference internal="True" refuri="../../classes/class_skeletonprofile#class-skeletonprofile"><inline classes="std std-ref">SkeletonProfile</inline></reference> from the editor by selecting a Skeleton3D and using the <strong>Skeleton3D</strong> menu in the 3D viewport's toolbar.</paragraph>
                </note>
                <paragraph>When you use <reference internal="True" refuri="../../classes/class_skeletonprofilehumanoid#class-skeletonprofilehumanoid"><inline classes="std std-ref">SkeletonProfileHumanoid</inline></reference>, auto-mapping will be performed when the
                    <reference internal="True" refuri="../../classes/class_skeletonprofile#class-skeletonprofile"><inline classes="std std-ref">SkeletonProfile</inline></reference> is set. If the auto-mapping does not work well, you can map bones manually.</paragraph>
                <image candidates="{'*': 'tutorials/assets_pipeline/img/retargeting2.webp'}" original_uri="img/retargeting2.webp" uri="tutorials/assets_pipeline/img/retargeting2.webp"></image>
                <paragraph>Any missing, duplicate or incorrect parent-child relationship mappings will be indicated
                    by a magenta / red button (depending on the editor setting). It does not block the import process,
                    but it warns that animations may not be shared correctly.</paragraph>
                <note>
                    <paragraph>The auto-mapping uses pattern matching for the bone names. So we recommend
                        to use common English names for bones.</paragraph>
                </note>
                <paragraph>After you set up the <literal>bone_map</literal>, several options are available in the sections below.</paragraph>
                <image candidates="{'*': 'tutorials/assets_pipeline/img/retargeting3.webp'}" original_uri="img/retargeting3.webp" uri="tutorials/assets_pipeline/img/retargeting3.webp"></image>
            </section>
            <section ids="remove-tracks" names="remove\ tracks">
                <title>Remove Tracks</title>
                <paragraph>If you import resources as an <reference internal="True" refuri="../../classes/class_animationlibrary#class-animationlibrary"><inline classes="std std-ref">AnimationLibrary</inline></reference> that will be shared, we recommend to enable these options.
                    However, if you import resources as scenes, these should be disabled in some cases.
                    For example, if you import a character with animated accessories,
                    these options may cause the accessories to not animate.</paragraph>
                <section ids="except-bone-transform" names="except\ bone\ transform">
                    <title>Except Bone Transform</title>
                    <paragraph>Removes any tracks except the bone Transform track from the animations.</paragraph>
                </section>
                <section ids="unimportant-positions" names="unimportant\ positions">
                    <title>Unimportant Positions</title>
                    <paragraph>Removes Position tracks other than <literal>root_bone</literal> and <literal>scale_base_bone</literal>
                        defined in <reference internal="True" refuri="../../classes/class_skeletonprofile#class-skeletonprofile"><inline classes="std std-ref">SkeletonProfile</inline></reference> from the animations. In <reference internal="True" refuri="../../classes/class_skeletonprofilehumanoid#class-skeletonprofilehumanoid"><inline classes="std std-ref">SkeletonProfileHumanoid</inline></reference>,
                        this means that to remove Position tracks other than "Root" and "Hips".
                        Since Godot 4, animations include Bone Rest in the Transform value. If you disable this option,
                        the animation may change the body shape unpredictably.</paragraph>
                </section>
                <section ids="unmapped-bones" names="unmapped\ bones">
                    <title>Unmapped Bones</title>
                    <paragraph>Removes unmapped bone Transform tracks from the animations.</paragraph>
                </section>
            </section>
            <section ids="bone-renamer" names="bone\ renamer">
                <title>Bone Renamer</title>
                <section ids="rename-bones" names="rename\ bones">
                    <title>Rename Bones</title>
                    <paragraph>Rename the mapped bones.</paragraph>
                </section>
                <section ids="unique-node" names="unique\ node">
                    <title>Unique Node</title>
                    <paragraph>Makes Skeleton a unique node with the name specified in the <literal>skeleton_name</literal>.
                        This allows the animation track paths to be unified independent of the scene hierarchy.</paragraph>
                </section>
            </section>
            <section ids="rest-fixer" names="rest\ fixer">
                <title>Rest Fixer</title>
                <paragraph>Reference poses defined in <reference internal="True" refuri="../../classes/class_skeletonprofilehumanoid#class-skeletonprofilehumanoid"><inline classes="std std-ref">SkeletonProfileHumanoid</inline></reference> have the following rules:</paragraph>
                <bullet_list bullet="*">
                    <list_item>
                        <paragraph>The humanoid is T-pose</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>The humanoid is facing +Z in the Right-Handed Y-UP Coordinate System</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>The humanoid should not have a Transform as Node</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>Directs the +Y axis from the parent joint to the child joint</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>+X rotation bends the joint like a muscle contracting</paragraph>
                    </list_item>
                </bullet_list>
                <paragraph>These rules are convenient definitions for blend animation and Inverse Kinematics (IK).
                    If your model does not match this definition, you need to fix it with these options.</paragraph>
                <section ids="apply-node-transform" names="apply\ node\ transform">
                    <title>Apply Node Transform</title>
                    <paragraph>If the asset is not exported correctly for sharing, the imported Skeleton may have
                        a Transform as a Node. For example, a glTF exported from Blender with no "Apply Transform"
                        executed is one such case. It looks like the model matches the definition,
                        but the internal Transforms are different from the definition.
                        This option fixes such models by applying Transforms on import.</paragraph>
                    <note>
                        <paragraph>If the imported scene contains objects other than Skeletons, this option may have a negative effect.</paragraph>
                    </note>
                </section>
                <section ids="normalize-position-tracks" names="normalize\ position\ tracks">
                    <title>Normalize Position Tracks</title>
                    <paragraph>Position track is used mostly for model movement, but sharing the moving animation
                        between models with different heights may cause the appearance of slipping
                        due to the difference in stride length. This option normalizes the Position track values
                        based on the <literal>scale_base_bone</literal> height. The <literal>scale_base_bone</literal> height is stored
                        in the Skeleton as the <literal>motion_scale</literal>, and the normalized Position track values is
                        multiplied by that value on playback. If this option is disabled, the Position tracks
                        is not normalized and the Skeleton's <literal>motion_scale</literal> is always imported as <literal>1.0</literal>.</paragraph>
                    <paragraph>With <reference internal="True" refuri="../../classes/class_skeletonprofilehumanoid#class-skeletonprofilehumanoid"><inline classes="std std-ref">SkeletonProfileHumanoid</inline></reference>, <literal>scale_base_bone</literal> is "Hips", therefore the Hips' height is used as the <literal>motion_scale</literal>.</paragraph>
                </section>
                <section ids="overwrite-axis" names="overwrite\ axis">
                    <title>Overwrite Axis</title>
                    <paragraph>Unifies the models' Bone Rests by overwriting it to match the reference poses defined in the <reference internal="True" refuri="../../classes/class_skeletonprofile#class-skeletonprofile"><inline classes="std std-ref">SkeletonProfile</inline></reference>.</paragraph>
                    <note>
                        <paragraph>This is the most important option for sharing animations in Godot 4,
                            but be aware that this option can produce horrible results <strong>if the original Bone Rest set externally is important</strong>.
                            If you want to share animations with keeping the original Bone Rest,
                            consider to use the <reference name="Realtime Retarget Module" refuri="https://github.com/TokageItLab/realtime_retarget">Realtime Retarget Module</reference>.</paragraph>
                    </note>
                </section>
                <section ids="fix-silhouette" names="fix\ silhouette">
                    <title>Fix Silhouette</title>
                    <paragraph>Attempts to make the model's silhouette match that of the reference poses defined in the <reference internal="True" refuri="../../classes/class_skeletonprofile#class-skeletonprofile"><inline classes="std std-ref">SkeletonProfile</inline></reference>,
                        such as T-Pose. This cannot fix silhouettes which are too different, and it may not work for fixing bone roll.</paragraph>
                    <paragraph>With <reference internal="True" refuri="../../classes/class_skeletonprofilehumanoid#class-skeletonprofilehumanoid"><inline classes="std std-ref">SkeletonProfileHumanoid</inline></reference>, this option does not need to be enabled for T-pose models,
                        but should be enabled for A-pose models. However in that case, the fixed foot results
                        may be bad depending on the heel height of the model, so it may be necessary to add
                        the <reference internal="True" refuri="../../classes/class_skeletonprofile#class-skeletonprofile"><inline classes="std std-ref">SkeletonProfile</inline></reference> bone names you do not want fixed in the <literal>filter</literal> array, as in the below example.</paragraph>
                    <image candidates="{'*': 'tutorials/assets_pipeline/img/retargeting4.webp'}" original_uri="img/retargeting4.webp" uri="tutorials/assets_pipeline/img/retargeting4.webp"></image>
                    <paragraph>Also, for models with bent knees or feet, it may be necessary to adjust the <literal>scale_base_bone</literal> height.
                        For that, you can use <literal>base_height_adjustment</literal> option.</paragraph>
                    <substitution_definition names="weblate_widget"><reference refuri="https://hosted.weblate.org/engage/godot-engine/?utm_source=widget"><image alt="Translation status" candidates="{'?': 'https://hosted.weblate.org/widgets/godot-engine/-/godot-docs/287x66-white.png'}" height="66" uri="https://hosted.weblate.org/widgets/godot-engine/-/godot-docs/287x66-white.png" width="287"></image></reference></substitution_definition>
                </section>
            </section>
        </section>
    </section>
</document>
