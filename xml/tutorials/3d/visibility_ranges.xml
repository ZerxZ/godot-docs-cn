<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.21.2 -->
<document source="/home/runner/work/godot-docs-cn/godot-docs-cn/godot-docs/docs/tutorials/3d/visibility_ranges.rst" translation_progress="{'total': 0, 'translated': 0}" xmlns:c="https://www.sphinx-doc.org/" xmlns:changeset="https://www.sphinx-doc.org/" xmlns:citation="https://www.sphinx-doc.org/" xmlns:cpp="https://www.sphinx-doc.org/" xmlns:index="https://www.sphinx-doc.org/" xmlns:js="https://www.sphinx-doc.org/" xmlns:math="https://www.sphinx-doc.org/" xmlns:py="https://www.sphinx-doc.org/" xmlns:rst="https://www.sphinx-doc.org/" xmlns:std="https://www.sphinx-doc.org/">
    <target refid="doc-visibility-ranges"></target>
    <section ids="visibility-ranges-hlod doc-visibility-ranges" names="visibility\ ranges\ (hlod) doc_visibility_ranges">
        <title>Visibility ranges (HLOD)</title>
        <paragraph>Along with <reference internal="True" refuri="mesh_lod#doc-mesh-lod"><inline classes="std std-ref">Mesh level of detail (LOD)</inline></reference> and <reference internal="True" refuri="occlusion_culling#doc-occlusion-culling"><inline classes="std std-ref">Occlusion culling</inline></reference>,
            visibility ranges are another tool to improve performance in large,
            complex 3D scenes.</paragraph>
        <paragraph>On this page, you'll learn:</paragraph>
        <bullet_list bullet="-">
            <list_item>
                <paragraph>What visibility ranges can do and which scenarios they are useful in.</paragraph>
            </list_item>
            <list_item>
                <paragraph>How to set up visibility ranges (manual LOD) in Godot.</paragraph>
            </list_item>
            <list_item>
                <paragraph>How to tune visibility ranges for best performance and quality.</paragraph>
            </list_item>
        </bullet_list>
        <seealso>
            <paragraph>If you only need meshes to become less detailed over distance, but don't have
                manually authored LOD meshes, consider relying on automatic
                <reference internal="True" refuri="mesh_lod#doc-mesh-lod"><inline classes="std std-ref">Mesh level of detail (LOD)</inline></reference> instead.</paragraph>
            <paragraph>Note that automatic mesh LOD and visibility ranges can be used at the same
                time, even on the same mesh.</paragraph>
        </seealso>
        <section ids="how-it-works" names="how\ it\ works">
            <title>How it works</title>
            <paragraph>Visibility ranges can be used with any node that inherits from GeometryInstance3D.
                This means they can be used not only with MeshInstance3D and MultiMeshInstance3D
                for artist-controlled <abbreviation explanation="Hierarchical Level of Detail">HLOD</abbreviation>, but also
                GPUParticles3D, CPUParticles3D, Label3D, Sprite3D, AnimatedSprite3D and CSGShape3D.</paragraph>
            <paragraph>Since visibility ranges are configured on a per-node basis, this makes it possible
                to use different node types as part of a <abbreviation explanation="Level of Detail">LOD</abbreviation> system.
                For example, you could display a MeshInstance3D representing a tree when up close,
                and replace it with a Sprite3D impostor in the distance to improve performance.</paragraph>
            <paragraph>The benefit of <abbreviation explanation="Hierarchical Level of Detail">HLOD</abbreviation> over a traditional
                <abbreviation explanation="Level of Detail">LOD</abbreviation> system is its hierarchical nature. A single larger
                mesh can replace several smaller meshes, so that the number of draw calls can be
                reduced at a distance, but culling opportunities can be preserved when up close.
                For example, you can have a group of houses that uses individual MeshInstance3D
                nodes (one for each house) when up close, but turns into a single MeshInstance3D
                that represents a less detailed group of houses (or use a MultiMeshInstance3D).</paragraph>
            <paragraph>Lastly, visibility ranges can also be used to fade certain objects entirely when
                the camera gets too close or too far. This can be used for gameplay purposes,
                but also to reduce visual clutter. For example, Label3D nodes can be faded using
                visibility ranges when they're too far away to be readable or relevant to the
                player.</paragraph>
        </section>
        <section ids="setting-up-visibility-range" names="setting\ up\ visibility\ range">
            <title>Setting up visibility range</title>
            <paragraph>This is a quick-start guide for configuring a basic LOD system. After following
                this guide, this LOD system will display a SphereMesh when up close and a
                BoxMesh when the camera is far away enough. A small hysteresis margin is also
                configured via the <strong>Begin Margin</strong> and <strong>End Margin</strong> properties. This prevents
                LODs from popping back and forth too quickly when the camera is moving at the
                "edge" of the LOD transition.</paragraph>
            <paragraph>The visibility range properties can be found in the <strong>Visibility Range</strong> section
                of the GeometryInstance3D inspector after selecting the MeshInstance3D Node.</paragraph>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph>Add a Node3D node that will be used to group the two MeshInstance3D nodes
                        together.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Add a first MeshInstance3D node as a child of the Node3D. Assign a new
                        SphereMesh to its Mesh property.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Set the first MeshInstance3D's visibility range <strong>End</strong> to <literal>10.0</literal> and <strong>End
                            Margin</strong> to <literal>1.0</literal>.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Add a second MeshInstance3D node as a child of the Node3D. Assign a new
                        BoxMesh to its Mesh property.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Set the second MeshInstance3D's visibility range <strong>Begin</strong> to <literal>10.0</literal> and
                        <strong>Begin Margin</strong> to <literal>1.0</literal>.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Move the camera away and back towards the object. Notice how the object will
                        transition from a sphere to a box as the camera moves away.</paragraph>
                </list_item>
            </bullet_list>
        </section>
        <section ids="visibility-range-properties" names="visibility\ range\ properties">
            <title>Visibility range properties</title>
            <paragraph>In the inspector of any node that inherits from GeometryInstance3D, you can adjust
                the following properties in the GeometryInstance3D's <strong>Visibility Range</strong> section:</paragraph>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph><strong>Begin:</strong> The instance will be hidden when the camera is closer to the
                        <emphasis>center of the instance's AABB</emphasis> (axis-aligned bounding box) than this value (in 3D units).</paragraph>
                </list_item>
                <list_item>
                    <paragraph><strong>Begin Margin:</strong> The hysteresis or alpha fade transition distance to use for
                        the close-up transition (in 3D units). The behavior of this property depends
                        on <strong>Fade Mode</strong>.</paragraph>
                </list_item>
                <list_item>
                    <paragraph><strong>End:</strong> The instance will be hidden when the camera is further away from the
                        <emphasis>center of the instance's AABB</emphasis> than this value (in 3D units).</paragraph>
                </list_item>
                <list_item>
                    <paragraph><strong>End Margin:</strong> The hysteresis or alpha fade transition distance to use for
                        the far-away transition (in 3D units). The behavior of this property depends
                        on <strong>Fade Mode</strong>.</paragraph>
                </list_item>
                <list_item>
                    <paragraph><strong>Fade Mode:</strong> Controls how the transition between LOD levels should be performed.
                        See below for details.</paragraph>
                </list_item>
            </bullet_list>
            <target refid="doc-visibility-ranges-fade-mode"></target>
            <section ids="fade-mode doc-visibility-ranges-fade-mode" names="fade\ mode doc_visibility_ranges_fade_mode">
                <title>Fade mode</title>
                <note>
                    <paragraph>The fade mode chosen only has a visible impact if either
                        <strong>Visibility Range &gt; Begin Margin</strong> or <strong>Visibility Range &gt; End Margin</strong> is
                        greater than <literal>0.0</literal>.</paragraph>
                </note>
                <paragraph>In the inspector's <strong>Visibility Range</strong> section, there are 3 fade modes to
                    choose from:</paragraph>
                <bullet_list bullet="-">
                    <list_item>
                        <paragraph><strong>Disabled:</strong> Uses hysteresis to switch between LOD levels instantly. This
                            prevents situations where LOD levels are switched back and forth quickly when
                            the player moves forward and then backward at the LOD transition point. The
                            hysteresis distance is determined by <strong>Visibility Range &gt; Begin Margin</strong> and
                            <strong>Visibility Range &gt; End Margin</strong>. This mode provides the best performance as
                            it doesn't force rendering to become transparent during the fade transition.</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph><strong>Self:</strong> Uses alpha blending to smoothly fade between LOD levels. The node
                            will fade-out itself when reaching the limits of its own visibility range. The
                            fade transition distance is determined by <strong>Visibility Range &gt; Begin Margin</strong>
                            and <strong>Visibility Range &gt; End Margin</strong>. This mode forces transparent rendering
                            on the object during its fade transition, so it has a performance impact.</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph><strong>Dependencies:</strong> Uses alpha blending to smoothly fade between LOD levels. The
                            node will fade-in its dependencies when reaching the limits of its own
                            visibility range. The fade transition distance is determined by <strong>Visibility
                                Range &gt; Begin Margin</strong> and <strong>Visibility Range &gt; End Margin</strong>. This mode forces
                            transparent rendering on the object during its fade transition, so it has a
                            performance impact. This mode is intended for hierarchical LOD systems using
                            <reference internal="True" refid="doc-visibility-ranges-visibility-parent"><inline classes="std std-ref">Visibility parent</inline></reference>. It acts
                            the same as <strong>Self</strong> if visibility ranges are used to perform non-hierarchical
                            LOD.</paragraph>
                    </list_item>
                </bullet_list>
                <target refid="doc-visibility-ranges-visibility-parent"></target>
            </section>
            <section ids="visibility-parent doc-visibility-ranges-visibility-parent" names="visibility\ parent doc_visibility_ranges_visibility_parent">
                <title>Visibility parent</title>
                <paragraph>The <strong>Visibility Parent</strong> property makes it easier to set up
                    <abbreviation explanation="Hierarchical Level of Detail">HLOD</abbreviation>. It allows automatically hiding
                    child nodes if its parent is visible given its current visibility range properties.</paragraph>
                <note>
                    <paragraph>The target of <strong>Visibility Parent</strong> <emphasis>must</emphasis> inherit from
                        <reference internal="True" refuri="../../classes/class_geometryinstance3d#class-geometryinstance3d"><inline classes="std std-ref">GeometryInstance3D</inline></reference>.</paragraph>
                    <paragraph>Despite its name, the <strong>Visibility Parent</strong> property <emphasis>can</emphasis> point to a node
                        that is not a parent of the node in the scene tree. However, it is
                        impossible to point <strong>Visibility Parent</strong> towards a child node, as this
                        creates a dependency cycle which is not supported. You will get an error
                        message in the Output panel if a dependency cycle occurs.</paragraph>
                </note>
                <paragraph>Given the following scene tree (where all nodes inherit from GeometryInstance3D):</paragraph>
                <literal_block force="False" language="gdscript" linenos="False" xml:space="preserve">┖╴BatchOfHouses
    ┠╴House1
    ┠╴House2
    ┠╴House3
    ┖╴House4</literal_block>
                <paragraph>In this example, <emphasis>BatchOfHouses</emphasis> is a large mesh designed to represent all child
                    nodes when viewed at a distance. <emphasis>House1</emphasis> to <emphasis>House4</emphasis> are smaller
                    MeshInstance3Ds representing individual houses. To configure HLOD in this
                    example, we only need to configure two things:</paragraph>
                <bullet_list bullet="-">
                    <list_item>
                        <paragraph>Set <strong>Visibility Range Begin</strong> to a number greater than <title_reference>0.0</title_reference> so that
                            <emphasis>BatchOfHouses</emphasis> only appears when far away enough from the camera. Below this
                            distance, we want <emphasis>House1</emphasis> to <emphasis>House4</emphasis> to be displayed instead.</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>On <emphasis>House1</emphasis> to <emphasis>House4</emphasis>, assign the <strong>Visibility Parent</strong> property to <emphasis>BatchOfHouses</emphasis>.</paragraph>
                    </list_item>
                </bullet_list>
                <paragraph>This makes it easier to perform further adjustments, as you don't need to adjust
                    the <strong>Visibility Range Begin</strong> of <emphasis>BatchOfHouses</emphasis> and <strong>Visibility Range End</strong>
                    of <emphasis>House1</emphasis> to <emphasis>House4</emphasis>.</paragraph>
                <paragraph>Fade mode is automatically handled by the <strong>Visibility Parent</strong> property, so
                    that the child nodes only become hidden once the parent node is fully faded out.
                    This is done to minimize visible pop-in. Depending on your <abbreviation explanation="Hierarchical Level of Detail">HLOD</abbreviation> setup, you may want to try both the <strong>Self</strong> and
                    <strong>Dependencies</strong> <reference internal="True" refid="doc-visibility-ranges-fade-mode"><inline classes="std std-ref">fade modes</inline></reference>.</paragraph>
                <note>
                    <paragraph>Nodes hidden via the <strong>Visible</strong> property are essentially removed from the
                        visibility dependency tree, so dependent instances will not take the hidden
                        node or its ancestors into account.</paragraph>
                    <paragraph>In practice, this means that if the target of the <strong>Visibility Parent</strong> node
                        is hidden by setting its <strong>Visible</strong> property to <literal>false</literal>, the node will
                        not be hidden according to the <strong>Visibility Range Begin</strong> value specified in
                        the visibility parent.</paragraph>
                </note>
            </section>
        </section>
        <section ids="configuration-tips" names="configuration\ tips">
            <title>Configuration tips</title>
            <section ids="use-simpler-materials-at-a-distance-to-improve-performance" names="use\ simpler\ materials\ at\ a\ distance\ to\ improve\ performance">
                <title>Use simpler materials at a distance to improve performance</title>
                <paragraph>One way to further improve performance is to use simpler materials for distant
                    LOD meshes. While using LOD meshes will reduce the number of vertices that need
                    to be rendered, the per-pixel shading load for materials remains identical.
                    However, per-pixel shading load is regularly a bottleneck on the GPU in complex
                    3D scenes. One way to reduce this shading load on the GPU is to use simpler
                    materials when they don't make much of a visual difference.</paragraph>
                <paragraph>Performance gains when doing so should be carefully measured, as
                    increasing the number of <emphasis>unique</emphasis> materials in a scene has a performance cost on
                    its own. Still, using simpler materials for distant LOD meshes can still result
                    in a net performance gain as a result of the fewer per-pixel calculations
                    required.</paragraph>
                <paragraph>For example, on the materials used by distant LOD meshes, you can disable
                    expensive material features such as:</paragraph>
                <bullet_list bullet="-">
                    <list_item>
                        <paragraph>Normal Map (especially on mobile platforms)</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>Rim</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>Clearcoat</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>Anisotropy</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>Height</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>Subsurface Scattering</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>Back Lighting</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>Refraction</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>Proximity Fade</paragraph>
                    </list_item>
                </bullet_list>
            </section>
            <section ids="use-dithering-for-lod-transitions" names="use\ dithering\ for\ lod\ transitions">
                <title>Use dithering for LOD transitions</title>
                <paragraph>Godot currently only supports alpha-based fading for visibility ranges. You can
                    however use dithering instead by using several different materials for different
                    LOD levels.</paragraph>
                <paragraph>There are two advantages to using dithering over alpha blending for LOD transitions:</paragraph>
                <bullet_list bullet="-">
                    <list_item>
                        <paragraph>Higher performance, as dithering transparency is faster to render compared to
                            alpha blending.</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>No visual glitches due to
                            <reference internal="True" refuri="3d_rendering_limitations#doc-3d-rendering-limitations-transparency-sorting"><inline classes="std std-ref">transparency sorting issues</inline></reference>
                            during LOD transitions.</paragraph>
                    </list_item>
                </bullet_list>
                <paragraph>The downside of dithering is that a "noisy" pattern is visible during LOD fade
                    transitions. This may not be as noticeable at higher viewport resolutions or
                    when temporal antialiasing is enabled.</paragraph>
                <paragraph>Also, as distance fade in BaseMaterial3D only supports fading up close <emphasis>or</emphasis>
                    fading when far away, this setup is best used with only two LODs as part of the
                    setup.</paragraph>
                <bullet_list bullet="-">
                    <list_item>
                        <paragraph>Ensure <strong>Begin Margin</strong> and <strong>End Margin</strong> is set to <literal>0.0</literal> on both
                            MeshInstance3D nodes, as hysteresis or alpha fade are not desired here.</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>On both MeshInstance3D nodes, <emphasis>decrease</emphasis> <strong>Begin</strong> by the desired fade transition
                            distance and <emphasis>increase</emphasis> <strong>End</strong> by the same distance. This is required for the
                            dithering transition to actually be visible.</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>On the MeshInstance3D that is displayed up close, edit its material in the inspector.
                            Set its <strong>Distance Fade</strong> mode to <strong>Object Dither</strong>. Set <strong>Min Distance</strong> to
                            the same value as the visibility range <strong>End</strong>. Set <strong>Max Distance</strong> to the
                            same value <emphasis>minus</emphasis> the fade transition distance.</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>On the MeshInstance3D that is displayed far away, edit its material in the inspector.
                            Set its <strong>Distance Fade</strong> mode to <strong>Object Dither</strong>. Set <strong>Min Distance</strong> to
                            the same value as the visibility range <strong>Begin</strong>. Set <strong>Max Distance</strong> to the
                            same value <emphasis>plus</emphasis> the fade transition distance.</paragraph>
                    </list_item>
                </bullet_list>
                <substitution_definition names="weblate_widget"><reference refuri="https://hosted.weblate.org/engage/godot-engine/?utm_source=widget"><image alt="Translation status" candidates="{'?': 'https://hosted.weblate.org/widgets/godot-engine/-/godot-docs/287x66-white.png'}" height="66" uri="https://hosted.weblate.org/widgets/godot-engine/-/godot-docs/287x66-white.png" width="287"></image></reference></substitution_definition>
            </section>
        </section>
    </section>
</document>
