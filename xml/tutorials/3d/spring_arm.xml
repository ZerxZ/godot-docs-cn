<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.21.2 -->
<document source="/home/runner/work/godot-docs-cn/godot-docs-cn/godot-docs/docs/tutorials/3d/spring_arm.rst" translation_progress="{'total': 0, 'translated': 0}" xmlns:c="https://www.sphinx-doc.org/" xmlns:changeset="https://www.sphinx-doc.org/" xmlns:citation="https://www.sphinx-doc.org/" xmlns:cpp="https://www.sphinx-doc.org/" xmlns:index="https://www.sphinx-doc.org/" xmlns:js="https://www.sphinx-doc.org/" xmlns:math="https://www.sphinx-doc.org/" xmlns:py="https://www.sphinx-doc.org/" xmlns:rst="https://www.sphinx-doc.org/" xmlns:std="https://www.sphinx-doc.org/">
    <target refid="doc-spring-arm"></target>
    <section ids="third-person-camera-with-spring-arm doc-spring-arm" names="third-person\ camera\ with\ spring\ arm doc_spring_arm">
        <title>Third-person camera with spring arm</title>
        <section ids="introduction" names="introduction">
            <title>Introduction</title>
            <paragraph>3D games will often have a third-person camera that follows and
                rotates around something such as a player character or a vehicle.</paragraph>
            <paragraph>In Godot, this can be done by setting a <reference internal="True" refuri="../../classes/class_camera3d#class-camera3d"><inline classes="std std-ref">Camera3D</inline></reference> as a child of a node.
                However, if you try this without any extra steps, you'll notice that the camera clips through geometry and hides the scene.</paragraph>
            <paragraph>This is where the <reference internal="True" refuri="../../classes/class_springarm3d#class-springarm3d"><inline classes="std std-ref">SpringArm3D</inline></reference> node comes in.</paragraph>
        </section>
        <section ids="what-is-a-spring-arm" names="what\ is\ a\ spring\ arm?">
            <title>What is a spring arm?</title>
            <paragraph>A spring arm has two main components that affect its behavior.</paragraph>
            <paragraph>The "length" of the spring arm is how far from its global position to check for collisions:</paragraph>
            <image candidates="{'*': 'tutorials/3d/img/spring_arm_position_length.webp'}" original_uri="img/spring_arm_position_length.webp" uri="tutorials/3d/img/spring_arm_position_length.webp"></image>
            <paragraph>The "shape" of the spring arm is what it uses to check for collisions. The spring arm will "sweep" this shape from its origin out towards its length.</paragraph>
            <image candidates="{'*': 'tutorials/3d/img/spring_arm_shape.webp'}" original_uri="img/spring_arm_shape.webp" uri="tutorials/3d/img/spring_arm_shape.webp"></image>
            <paragraph>The spring arm tries to keep all of its children at the end of its length. When the shape collides with something, the children are instead placed at or near that collision point:</paragraph>
            <image candidates="{'*': 'tutorials/3d/img/spring_arm_children.webp'}" original_uri="img/spring_arm_children.webp" uri="tutorials/3d/img/spring_arm_children.webp"></image>
        </section>
        <section ids="spring-arm-with-a-camera" names="spring\ arm\ with\ a\ camera">
            <title>Spring arm with a camera</title>
            <paragraph>When a camera is placed as a child of a spring arm, a pyramid representing the camera will be used as the shape.</paragraph>
            <paragraph>This pyramid represents the <strong>near plane</strong> of the camera:</paragraph>
            <image candidates="{'*': 'tutorials/3d/img/spring_arm_camera_shape.webp'}" original_uri="img/spring_arm_camera_shape.webp" uri="tutorials/3d/img/spring_arm_camera_shape.webp"></image>
            <note>
                <paragraph>If the spring arm is given a specific shape, then that shape will <strong>always</strong> be used.</paragraph>
                <paragraph>The camera's shape is only used if the camera is a <strong>direct child</strong> of the spring arm.</paragraph>
                <paragraph>If no shape is provided and the camera is not a direct child, the spring arm will fall back to using a ray cast which is inaccurate for camera collisions and not recommended.</paragraph>
            </note>
            <paragraph>Every physics process frame, the spring arm will perform a motion cast to check if anything is collided with:</paragraph>
            <image candidates="{'*': 'tutorials/3d/img/spring_arm_camera_motion_cast.webp'}" original_uri="img/spring_arm_camera_motion_cast.webp" uri="tutorials/3d/img/spring_arm_camera_motion_cast.webp"></image>
            <paragraph>When the shape hits something, the camera will be placed at or near the collision point:</paragraph>
            <image candidates="{'*': 'tutorials/3d/img/spring_arm_camera_collision.webp'}" original_uri="img/spring_arm_camera_collision.webp" uri="tutorials/3d/img/spring_arm_camera_collision.webp"></image>
        </section>
        <section ids="setting-up-the-spring-arm-and-camera" names="setting\ up\ the\ spring\ arm\ and\ camera">
            <title>Setting up the spring arm and camera</title>
            <paragraph>Let's add a spring arm camera setup to the platformer demo.</paragraph>
            <note>
                <paragraph>You can download the Platformer 3D demo on <reference name="GitHub" refuri="https://github.com/godotengine/godot-demo-projects/tree/master/3d/platformer">GitHub</reference><target ids="github" names="github" refuri="https://github.com/godotengine/godot-demo-projects/tree/master/3d/platformer"></target> or using the <reference name="Asset Library" refuri="https://godotengine.org/asset-library/asset/2748">Asset Library</reference><target ids="asset-library" names="asset\ library" refuri="https://godotengine.org/asset-library/asset/2748"></target>.</paragraph>
            </note>
            <paragraph>In general, for a third-person camera setup, you will have three nodes as children of the node that you're following:</paragraph>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph><title_reference>Node3D</title_reference> (the "pivot point" for the camera)</paragraph>
                    <block_quote>
                        <bullet_list bullet="-">
                            <list_item>
                                <paragraph><title_reference>SpringArm3D</title_reference></paragraph>
                                <block_quote>
                                    <bullet_list bullet="-">
                                        <list_item>
                                            <paragraph><title_reference>Camera3D</title_reference></paragraph>
                                        </list_item>
                                    </bullet_list>
                                </block_quote>
                            </list_item>
                        </bullet_list>
                    </block_quote>
                </list_item>
            </bullet_list>
            <paragraph>Open the <literal>player/player.tscn</literal> scene. Set these up as children of our player and give them unique names so we can find them in our script. <strong>Make sure to delete the existing camera node!</strong></paragraph>
            <image candidates="{'*': 'tutorials/3d/img/spring_arm_editor_setup.webp'}" original_uri="img/spring_arm_editor_setup.webp" uri="tutorials/3d/img/spring_arm_editor_setup.webp"></image>
            <paragraph>Let's move the pivot point up by <literal>2</literal> on the Y-axis so that it's not on the ground:</paragraph>
            <image candidates="{'*': 'tutorials/3d/img/spring_arm_pivot_setup.webp'}" original_uri="img/spring_arm_pivot_setup.webp" uri="tutorials/3d/img/spring_arm_pivot_setup.webp"></image>
            <paragraph>Give the spring arm a length of <literal>3</literal> so that it is placed behind the character:</paragraph>
            <image candidates="{'*': 'tutorials/3d/img/spring_arm_length_setup.webp'}" original_uri="img/spring_arm_length_setup.webp" uri="tutorials/3d/img/spring_arm_length_setup.webp"></image>
            <note>
                <paragraph>Leave the <strong>Shape</strong> of the spring arm as <literal>&lt;empty&gt;</literal>. This way, it will use the camera's pyramid shape.</paragraph>
                <paragraph>If you want, you can also try other shapes - a sphere is a common choice since it slides smoothly along edges.</paragraph>
            </note>
            <paragraph>Update the top of <literal>player/player.gd</literal> to grab the camera and the pivot points by their unique names:</paragraph>
            <container classes="literal-block-wrapper" ids="id1" literal_block="True">
                <caption>player/player.gd</caption>
                <literal_block force="False" highlight_args="{}" language="gdscript" linenos="False" xml:space="preserve"># Comment out this existing camera line.
# @onready var _camera := $Target/Camera3D as Camera3D

@onready var _camera := %Camera3D as Camera3D
@onready var _camera_pivot := %CameraPivot as Node3D</literal_block>
            </container>
            <paragraph>Add an <literal>_unhandled_input</literal> function to check for camera movement and then rotate the pivot point accordingly:</paragraph>
            <container classes="literal-block-wrapper" ids="id2" literal_block="True">
                <caption>player/player.gd</caption>
                <literal_block force="False" highlight_args="{}" language="gdscript" linenos="False" xml:space="preserve">@export_range(0.0, 1.0) var mouse_sensitivity = 0.01
@export var tilt_limit = deg_to_rad(75)


func _unhandled_input(event: InputEvent) -&gt; void:
    if event is InputEventMouseMotion:
        _camera_pivot.rotation.x -= event.relative.y * mouse_sensitivity
        # Prevent the camera from rotating too far up or down.
        _camera_pivot.rotation.x = clampf(_camera_pivot.rotation.x, -tilt_limit, tilt_limit)
        _camera_pivot.rotation.y += -event.relative.x * mouse_sensitivity</literal_block>
            </container>
            <paragraph>By rotating the pivot point, the spring arm will also be rotated and it will change where the camera is positioned.
                Run the game and notice that mouse movement now rotates the camera around the character. If the camera moves into a wall, it collides with it.</paragraph>
            <video_node align="default" alt="Camera attached to a spring arm colliding with walls" autoplay="True" caption="" controls="True" controlslist="" figwidth="" height="" klass="" loop="True" muted="True" playsinline="False" poster="" preload="auto" sources="['tutorials/3d/video/spring_arm_camera.webm',\ 'video/webm',\ False]" width="">
            </video_node>
            <substitution_definition names="weblate_widget"><reference refuri="https://hosted.weblate.org/engage/godot-engine/?utm_source=widget"><image alt="Translation status" candidates="{'?': 'https://hosted.weblate.org/widgets/godot-engine/-/godot-docs/287x66-white.png'}" height="66" uri="https://hosted.weblate.org/widgets/godot-engine/-/godot-docs/287x66-white.png" width="287"></image></reference></substitution_definition>
        </section>
    </section>
</document>
