<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.17.1 -->
<document source="/home/runner/work/godot-docs-cn/godot-docs-cn/godot-docs/docs/tutorials/3d/variable_rate_shading.rst" xmlns:c="https://www.sphinx-doc.org/" xmlns:changeset="https://www.sphinx-doc.org/" xmlns:citation="https://www.sphinx-doc.org/" xmlns:cpp="https://www.sphinx-doc.org/" xmlns:index="https://www.sphinx-doc.org/" xmlns:js="https://www.sphinx-doc.org/" xmlns:math="https://www.sphinx-doc.org/" xmlns:py="https://www.sphinx-doc.org/" xmlns:rst="https://www.sphinx-doc.org/" xmlns:std="https://www.sphinx-doc.org/">
    <target refid="doc-variable-rate-shading"></target>
    <section ids="variable-rate-shading doc-variable-rate-shading" names="variable\ rate\ shading 可变速率着色 doc_variable_rate_shading">
        <title>可变速率着色</title>
        <section ids="what-is-variable-rate-shading" names="what\ is\ variable\ rate\ shading? 什么是可变速率着色？">
            <title>什么是可变速率着色？</title>
            <paragraph>在现代 3D 渲染引擎中，着色器比以前复杂得多。基于物理的渲染、实时全局照明和屏幕空间效果的出现，增加了渲染每帧时必须执行的 <emphasis>每像素</emphasis> 着色的数量。此外，屏幕分辨率也大幅提升，1440p 和 4K 已成为常见的目标分辨率。因此，场景渲染中的总着色成本通常代表着渲染每帧所花费的大量时间。</paragraph>
            <paragraph>可变速率着色 (VRS，variable rate shading) 是一种通过降低 <emphasis>每像素</emphasis> 着色（也称为 <emphasis>片段</emphasis> 着色）的分辨率来降低着色成本的方法，同时保持渲染几何体的原始分辨率。这意味着几何边缘仍然像没有 VRS 时一样锋利。 VRS 可以与任何 <reference internal="True" refuri="3d_antialiasing#doc-3d-antialiasing"><inline classes="std std-ref">3D 抗锯齿</inline></reference> 技术（MSAA、FXAA、TAA、SSAA）结合使用。</paragraph>
            <paragraph>VRS 允许以本地方式指定着色质量，这使得视口的某些部分可以比其他部分接收更详细的着色。这在虚拟现实 (VR) 中特别有用，可实现 <emphasis>注视点渲染</emphasis> （foveated rendering），其中视口的中心比其边缘更详细。</paragraph>
            <paragraph>这是使用本页底部链接的密度图，先禁用，然后启用速率着色渲染的场景：</paragraph>
            <figure align="center" ids="id1">
                <image alt="在纹理场景中禁用可变速率着色" candidates="{'*': 'tutorials/3d/img/variable_rate_shading_textured_disabled.webp'}" uri="tutorials/3d/img/variable_rate_shading_textured_disabled.webp"></image>
                <caption>在纹理场景中禁用可变速率着色</caption>
            </figure>
            <figure align="center" ids="id2">
                <image alt="在纹理场景中启用可变速率着色（质量较低但性能较高）" candidates="{'*': 'tutorials/3d/img/variable_rate_shading_textured_enabled.webp'}" uri="tutorials/3d/img/variable_rate_shading_textured_enabled.webp"></image>
                <caption>在纹理场景中启用可变速率着色（质量较低但性能较高）</caption>
            </figure>
            <paragraph>当在具有低频细节的场景（例如具有风格化/低多边形艺术风格的场景）中使用时，可以实现类似的性能增益，但视觉质量的降低较小：</paragraph>
            <figure align="center" ids="id3">
                <image alt="在无纹理场景中禁用可变速率着色" candidates="{'*': 'tutorials/3d/img/variable_rate_shading_untextured_disabled.webp'}" uri="tutorials/3d/img/variable_rate_shading_untextured_disabled.webp"></image>
                <caption>在无纹理场景中禁用可变速率着色</caption>
            </figure>
            <figure align="center" ids="id4">
                <image alt="在无纹理场景中启用可变速率着色（质量较低但性能较高）" candidates="{'*': 'tutorials/3d/img/variable_rate_shading_untextured_enabled.webp'}" uri="tutorials/3d/img/variable_rate_shading_untextured_enabled.webp"></image>
                <caption>在无纹理场景中启用可变速率着色（质量较低但性能较高）</caption>
            </figure>
        </section>
        <section ids="hardware-support" names="hardware\ support 硬件支持">
            <title>硬件支持</title>
            <paragraph>可变速率着色仅在特定 GPU 上受支持：</paragraph>
            <paragraph><strong>桌面端：</strong></paragraph>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph>NVIDIA Turing 及更新版本（包括 GTX 1600 系列）</paragraph>
                </list_item>
                <list_item>
                    <paragraph>AMD RDNA2 及更新版本（集成和专用 GPU – 包括 Steam Deck）</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Intel Arc Alchemist 及更新版本 <strong>（仅限专用 GPU）</strong></paragraph>
                    <bullet_list bullet="-">
                        <list_item>
                            <paragraph>英特尔集成显卡不支持可变速率着色。</paragraph>
                        </list_item>
                    </bullet_list>
                </list_item>
            </bullet_list>
            <paragraph><strong>移动端 SoC：</strong></paragraph>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph>骁龙（Snapdragon） 888 及更新版本</paragraph>
                </list_item>
                <list_item>
                    <paragraph>MediaTek 天玑 9000 及更新版本</paragraph>
                </list_item>
                <list_item>
                    <paragraph>ARM Mali-G615 及更新版本</paragraph>
                </list_item>
            </bullet_list>
            <paragraph>截至 2023 年 1 月，Apple 和 Raspberry Pi GPU 仍不支持可变速率着色。</paragraph>
        </section>
        <section ids="using-variable-rate-shading-in-godot" names="using\ variable\ rate\ shading\ in\ godot 在\ godot\ 中使用可变速率着色">
            <title>在 Godot 中使用可变速率着色</title>
            <note>
                <paragraph>Forward+ 和 Forward 移动渲染方法都支持可变速率着色。 VRS 可用于 pancake（非 XR）和 XR 显示模式。</paragraph>
                <paragraph>兼容渲染方法<strong>不支持</strong>可变速率着色。</paragraph>
            </note>
            <paragraph>在高级项目设置中， <strong>渲染 &gt; VRS</strong> 部分提供了控制根视口上可变速率着色的设置：</paragraph>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph><strong>模式：</strong> 控制可变速率着色模式。 <strong>Disabled</strong> 禁用可变速率着色。 <strong>Texture</strong> 使用手动创作的纹理来设置着色密度（请参阅下面的属性）。 <strong>XR</strong> 自动生成适合虚拟/增强现实中的注视点渲染的纹理。</paragraph>
                </list_item>
                <list_item>
                    <paragraph><strong>纹理：</strong> 用于控制根视口上的着色密度的纹理。仅当 <strong>Mode</strong> 为 <strong>Texture</strong> 时使用。</paragraph>
                </list_item>
            </bullet_list>
            <paragraph>对于自定义视口，必须手动将 VRS 模式和纹理设置到 <reference internal="True" refuri="../../classes/class_viewport#class-viewport"><inline classes="std std-ref">Viewport</inline></reference> 节点。</paragraph>
            <note>
                <paragraph>在不受支持的硬件上，启用可变速率着色时不会出现视觉差异。你可以通过使用 <literal>--verbose</literal> <reference internal="True" refuri="../editor/command_line_tutorial#doc-command-line-tutorial"><inline classes="std std-ref">命令行参数</inline></reference> 运行编辑器或项目来检查硬件是否支持可变速率着色。</paragraph>
            </note>
            <section ids="creating-a-vrs-density-map" names="creating\ a\ vrs\ density\ map 创建\ vrs\ 密度图">
                <title>创建 VRS 密度图</title>
                <paragraph>如果使用 <strong>Texture</strong> VRS 模式， <emphasis>必须</emphasis> 设置要用作密度贴图的纹理。否则，将看不到任何效果。</paragraph>
                <paragraph>你可以使用图像编辑器手动创建自己的 VRS 密度图，或使用其他方法生成它（例如，在 CPU 上使用 Image 类，或在 GPU 上使用着色器）。但是，动态生成 VRS 图像时请注意其性能影响。如果选择动态生成，请确保 VRS 图像生成过程足够快，以避免超出 VRS 的性能增益。</paragraph>
                <paragraph>纹理必须遵循以下规则：</paragraph>
                <bullet_list bullet="-">
                    <list_item>
                        <paragraph>纹理 <emphasis>必须</emphasis> 使用无损压缩格式，以便颜色可以精确匹配。</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>以下 VRS 密度映射到各种颜色，较亮的颜色表示较低级别的着色精度：</paragraph>
                    </list_item>
                </bullet_list>
                <table>
                    <tgroup cols="3">
                        <colspec colwidth="22"></colspec>
                        <colspec colwidth="32"></colspec>
                        <colspec colwidth="33"></colspec>
                        <thead>
                            <row>
                                <entry>
                                    <paragraph>密度</paragraph>
                                </entry>
                                <entry>
                                    <paragraph>Color</paragraph>
                                </entry>
                                <entry>
                                    <paragraph>注释</paragraph>
                                </entry>
                            </row>
                        </thead>
                        <tbody>
                            <row>
                                <entry>
                                    <paragraph>1×1（细节最高）</paragraph>
                                </entry>
                                <entry>
                                    <paragraph><literal>rgb(0, 0, 0) - #000000</literal></paragraph>
                                </entry>
                                <entry>
                                </entry>
                            </row>
                            <row>
                                <entry>
                                    <paragraph>1×2</paragraph>
                                </entry>
                                <entry>
                                    <paragraph><literal>rgb(0, 85, 0) - #005500</literal></paragraph>
                                </entry>
                                <entry>
                                </entry>
                            </row>
                            <row>
                                <entry>
                                    <paragraph>2×1</paragraph>
                                </entry>
                                <entry>
                                    <paragraph><literal>rgb(85, 0, 0) - #550000</literal></paragraph>
                                </entry>
                                <entry>
                                </entry>
                            </row>
                            <row>
                                <entry>
                                    <paragraph>2×2</paragraph>
                                </entry>
                                <entry>
                                    <paragraph><literal>rgb(85, 85, 0) - #555500</literal></paragraph>
                                </entry>
                                <entry>
                                </entry>
                            </row>
                            <row>
                                <entry>
                                    <paragraph>2×4</paragraph>
                                </entry>
                                <entry>
                                    <paragraph><literal>rgb(85, 170, 0) - #55aa00</literal></paragraph>
                                </entry>
                                <entry>
                                </entry>
                            </row>
                            <row>
                                <entry>
                                    <paragraph>4×2</paragraph>
                                </entry>
                                <entry>
                                    <paragraph><literal>rgb(170, 85, 0) - #aa5500</literal></paragraph>
                                </entry>
                                <entry>
                                </entry>
                            </row>
                            <row>
                                <entry>
                                    <paragraph>4×4</paragraph>
                                </entry>
                                <entry>
                                    <paragraph><literal>rgb(170, 170, 0) - #aaaa00</literal></paragraph>
                                </entry>
                                <entry>
                                </entry>
                            </row>
                            <row>
                                <entry>
                                    <paragraph>4×8</paragraph>
                                </entry>
                                <entry>
                                    <paragraph><literal>rgb(170, 255, 0) - #aaff00</literal></paragraph>
                                </entry>
                                <entry>
                                    <paragraph>大多数硬件不支持。</paragraph>
                                </entry>
                            </row>
                            <row>
                                <entry>
                                    <paragraph>8×4</paragraph>
                                </entry>
                                <entry>
                                    <paragraph><literal>rgb(255, 170, 0) - #ffaa00</literal></paragraph>
                                </entry>
                                <entry>
                                    <paragraph>大多数硬件不支持。</paragraph>
                                </entry>
                            </row>
                            <row>
                                <entry>
                                    <paragraph>8×8（细节最低）</paragraph>
                                </entry>
                                <entry>
                                    <paragraph><literal>rgb(255, 255, 0) - #ffff00</literal></paragraph>
                                </entry>
                                <entry>
                                    <paragraph>大多数硬件不支持。</paragraph>
                                </entry>
                            </row>
                        </tbody>
                    </tgroup>
                </table>
                <paragraph>例如，此 VRS 密度纹理在视口中心提供最高的着色密度，在角落提供最低的着色密度：</paragraph>
                <figure align="center" ids="id5">
                    <image alt="VRS 密度贴图纹理示例，模拟注视点渲染" candidates="{'*': 'tutorials/3d/img/variable_rate_shading_texture_example.webp'}" uri="tutorials/3d/img/variable_rate_shading_texture_example.webp"></image>
                    <caption>VRS 密度贴图纹理示例，模拟注视点渲染</caption>
                </figure>
                <paragraph>VRS 密度纹理没有尺寸或纵横比要求。但是，使用大于视口分辨率除以 GPU 的 <emphasis>图块大小</emphasis> 的 VRS 密度图并没有任何好处。切片大小决定了可以与其他切片分开更改着色密度的最小像素区域。在大多数 GPU 上，此图块大小为 8×8 像素。你可以通过使用 <literal>--verbose</literal> 命令行参数运行 Godot 来查看图块大小，正如 VRS 调试信息中打印的那样。</paragraph>
                <paragraph>因此，建议保持使用相对较低的分辨率，例如 256×256（方形）或 480×270（16:9）。根据你的使用案例，与项目中最常见的视口纵横比（例如 16:9）相匹配的纹理相比，方形纹理可能更合适。</paragraph>
                <tip>
                    <paragraph>使用可变速率着色时，你可以使用负 <reference internal="True" refuri="resolution_scaling#doc-resolution-scaling-mipmap-bias"><inline classes="std std-ref">纹理 mipmap LOD 偏置</inline></reference> 来减少着色率降低的区域的模糊度。</paragraph>
                    <paragraph>请注意，纹理 LOD 偏置是全局设置的，因此这也会影响具有完整着色率的视口区域。不要使用太低的值，否则纹理将会显得有颗粒感。</paragraph>
                </tip>
            </section>
            <section ids="performance-comparison" names="performance\ comparison 性能比较">
                <title>性能比较</title>
                <paragraph>为了了解 VRS 在理论上可以提高多少性能，以下是与本页顶部显示的纹理示例场景的性能比较。使用本页上提供的 VRS 密度图示例。</paragraph>
                <paragraph>结果是在配备 NVIDIA 525.60.11 驱动程序的 GeForce RTX 4090 上收集的。</paragraph>
                <table>
                    <tgroup cols="4">
                        <colspec colwidth="21"></colspec>
                        <colspec colwidth="14"></colspec>
                        <colspec colwidth="13"></colspec>
                        <colspec colwidth="25"></colspec>
                        <thead>
                            <row>
                                <entry>
                                    <paragraph>Resolution</paragraph>
                                </entry>
                                <entry>
                                    <paragraph>启用 VRS</paragraph>
                                </entry>
                                <entry>
                                    <paragraph>禁用 VRS</paragraph>
                                </entry>
                                <entry>
                                    <paragraph>性能提升</paragraph>
                                </entry>
                            </row>
                        </thead>
                        <tbody>
                            <row>
                                <entry>
                                    <paragraph>1920×1080（全高清）</paragraph>
                                </entry>
                                <entry>
                                    <paragraph>2832 FPS</paragraph>
                                </entry>
                                <entry>
                                    <paragraph>3136 FPS</paragraph>
                                </entry>
                                <entry>
                                    <paragraph>+10.7%</paragraph>
                                </entry>
                            </row>
                            <row>
                                <entry>
                                    <paragraph>2560×1440（QHD）</paragraph>
                                </entry>
                                <entry>
                                    <paragraph>2008 FPS</paragraph>
                                </entry>
                                <entry>
                                    <paragraph>2256 FPS</paragraph>
                                </entry>
                                <entry>
                                    <paragraph>+12.3%</paragraph>
                                </entry>
                            </row>
                            <row>
                                <entry>
                                    <paragraph>3840×2160（4K）</paragraph>
                                </entry>
                                <entry>
                                    <paragraph>1236 FPS</paragraph>
                                </entry>
                                <entry>
                                    <paragraph>1436 FPS</paragraph>
                                </entry>
                                <entry>
                                    <paragraph>+16.2%</paragraph>
                                </entry>
                            </row>
                            <row>
                                <entry>
                                    <paragraph>7680×4320（8K）</paragraph>
                                </entry>
                                <entry>
                                    <paragraph>384 FPS</paragraph>
                                </entry>
                                <entry>
                                    <paragraph>473 FPS</paragraph>
                                </entry>
                                <entry>
                                    <paragraph>+23.1%</paragraph>
                                </entry>
                            </row>
                        </tbody>
                    </tgroup>
                </table>
                <paragraph>在性能改进方面，可变速率着色在更高的目标分辨率下更有利。在高分辨率下，视觉质量的下降也不太明显。</paragraph>
                <note>
                    <paragraph>对于非 VR 游戏，你可能需要使用比本示例中使用的更不激进的 VRS 纹理。因此，有效的性能提升将会降低。</paragraph>
                </note>
                <substitution_definition names="weblate_widget"><reference refuri="https://hosted.weblate.org/engage/godot-engine/zh_CN/?utm_source=widget"><image alt="翻译状态" candidates="{'?': 'https://hosted.weblate.org/widgets/godot-engine/zh_CN/godot-docs/287x66-white.png'}" height="66" uri="https://hosted.weblate.org/widgets/godot-engine/zh_CN/godot-docs/287x66-white.png" width="287"></image></reference></substitution_definition>
            </section>
        </section>
    </section>
</document>
