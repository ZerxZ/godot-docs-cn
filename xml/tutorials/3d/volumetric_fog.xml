<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.21.2 -->
<document source="/home/runner/work/godot-docs-cn/godot-docs-cn/godot-docs/docs/tutorials/3d/volumetric_fog.rst" translation_progress="{'total': 0, 'translated': 0}" xmlns:c="https://www.sphinx-doc.org/" xmlns:changeset="https://www.sphinx-doc.org/" xmlns:citation="https://www.sphinx-doc.org/" xmlns:cpp="https://www.sphinx-doc.org/" xmlns:index="https://www.sphinx-doc.org/" xmlns:js="https://www.sphinx-doc.org/" xmlns:math="https://www.sphinx-doc.org/" xmlns:py="https://www.sphinx-doc.org/" xmlns:rst="https://www.sphinx-doc.org/" xmlns:std="https://www.sphinx-doc.org/">
    <target refid="doc-volumetric-fog"></target>
    <section ids="volumetric-fog-and-fog-volumes doc-volumetric-fog" names="volumetric\ fog\ and\ fog\ volumes doc_volumetric_fog">
        <title>Volumetric fog and fog volumes</title>
        <note>
            <paragraph>Volumetric fog is only supported in the Forward+ renderer, not the Mobile or
                Compatibility renderers.</paragraph>
        </note>
        <paragraph>As described in <reference internal="True" refuri="environment_and_post_processing#doc-environment-and-post-processing"><inline classes="std std-ref">Environment and post-processing</inline></reference>, Godot supports
            various visual effects including two types of fog: traditional (non-volumetric)
            fog and volumetric fog. Traditional fog affects the entire scene at once and
            cannot be customized with <reference internal="True" refuri="../shaders/shader_reference/fog_shader#doc-fog-shader"><inline classes="std std-ref">Fog shaders</inline></reference>.</paragraph>
        <paragraph>Volumetric fog can be used at the same time as non-volumetric fog if desired.</paragraph>
        <paragraph>On this page, you'll learn:</paragraph>
        <bullet_list bullet="-">
            <list_item>
                <paragraph>How to set up volumetric fog in Godot.</paragraph>
            </list_item>
            <list_item>
                <paragraph>What fog volumes are and how they differ from "global" volumetric fog.</paragraph>
            </list_item>
        </bullet_list>
        <seealso>
            <paragraph>You can see how volumetric fog works in action using the
                <reference name="Volumetric Fog demo project" refuri="https://github.com/godotengine/godot-demo-projects/tree/master/3d/volumetric_fog">Volumetric Fog demo project</reference>.</paragraph>
        </seealso>
        <paragraph>Here is a comparison between traditional fog (which does not interact with lighting)
            and volumetric fog, which is able to interact with lighting:</paragraph>
        <image candidates="{'*': 'tutorials/3d/img/volumetric_fog_comparison.png'}" original_uri="img/volumetric_fog_comparison.png" uri="tutorials/3d/img/volumetric_fog_comparison.png"></image>
        <section ids="volumetric-fog-properties" names="volumetric\ fog\ properties">
            <title>Volumetric fog properties</title>
            <paragraph>After enabling volumetric fog in the WorldEnvironment node's Environment
                resource, you can edit the following properties:</paragraph>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph><strong>Density:</strong> The base <emphasis>exponential</emphasis> density of the volumetric fog. Set this to
                        the lowest density you want to have globally. FogVolumes can be used to add to
                        or subtract from this density in specific areas. A value of <literal>0.0</literal> disables
                        global volumetric fog while allowing FogVolumes to display volumetric fog in
                        specific areas. Fog rendering is exponential as in real life.</paragraph>
                </list_item>
                <list_item>
                    <paragraph><strong>Albedo:</strong> The Color of the volumetric fog when interacting with lights. Mist
                        and fog have an albedo close to white (<literal>Color(1, 1, 1, 1)</literal>) while smoke
                        has a darker albedo.</paragraph>
                </list_item>
                <list_item>
                    <paragraph><strong>Emission:</strong> The emitted light from the volumetric fog. Even with emission,
                        volumetric fog will not cast light onto other surfaces. Emission is useful to
                        establish an ambient color. As the volumetric fog effect uses
                        single-scattering only, fog tends to need a little bit of emission to soften
                        the harsh shadows.</paragraph>
                </list_item>
                <list_item>
                    <paragraph><strong>Emission Energy:</strong> The brightness of the emitted light from the volumetric
                        fog.</paragraph>
                </list_item>
                <list_item>
                    <paragraph><strong>GI Inject:</strong> Scales the strength of Global Illumination used in the
                        volumetric fog's albedo color. A value of <literal>0.0</literal> means that Global
                        Illumination will not impact the volumetric fog. This has a small performance
                        cost when set above <literal>0.0</literal>.</paragraph>
                </list_item>
                <list_item>
                    <paragraph><strong>Anisotropy:</strong> The direction of scattered light as it goes through the
                        volumetric fog. A value close to <literal>1.0</literal> means almost all light is scattered
                        forward. A value close to <literal>0.0</literal> means light is scattered equally in all
                        directions. A value close to <literal>-1.0</literal> means light is scattered mostly
                        backward. Fog and mist scatter light slightly forward, while smoke scatters
                        light equally in all directions.</paragraph>
                </list_item>
                <list_item>
                    <paragraph><strong>Length:</strong> The distance over which the volumetric fog is computed. Increase
                        to compute fog over a greater range, decrease to add more detail when a long
                        range is not needed. For best quality fog, keep this as low as possible.</paragraph>
                </list_item>
                <list_item>
                    <paragraph><strong>Detail Spread:</strong> The distribution of size down the length of the froxel
                        buffer. A higher value compresses the froxels closer to the camera and places
                        more detail closer to the camera.</paragraph>
                </list_item>
                <list_item>
                    <paragraph><strong>Ambient Inject:</strong> Scales the strength of ambient light used in the
                        volumetric fog. A value of <literal>0.0</literal> means that ambient light will not impact
                        the volumetric fog. This has a small performance cost when set above <literal>0.0</literal>.</paragraph>
                </list_item>
                <list_item>
                    <paragraph><strong>Sky Affect:</strong> Controls how much volumetric fog should be drawn onto the
                        background sky. If set to <literal>0.0</literal>, volumetric fog won't affect sky rendering
                        at all (including FogVolumes).</paragraph>
                </list_item>
            </bullet_list>
            <paragraph>Two additional properties are offered in the <strong>Temporal Reprojection</strong> section:</paragraph>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph><strong>Temporal Reprojection &gt; Enabled:</strong> Enables temporal reprojection in the
                        volumetric fog. Temporal reprojection blends the current frame's volumetric
                        fog with the last frame's volumetric fog to smooth out jagged edges. The
                        performance cost is minimal, however it does lead to moving FogVolumes and
                        Light3Ds "ghosting" and leaving a trail behind them. When temporal
                        reprojection is enabled, try to avoid moving FogVolumes or Light3Ds too fast.
                        Short-lived dynamic lighting effects should have <strong>Volumetric Fog Energy</strong> set
                        to <literal>0.0</literal> to avoid ghosting.</paragraph>
                </list_item>
                <list_item>
                    <paragraph><strong>Temporal Reprojection &gt; Amount:</strong> The amount by which to blend the last
                        frame with the current frame. A higher number results in smoother volumetric
                        fog, but makes "ghosting" much worse. A lower value reduces ghosting but can
                        result in the per-frame temporal jitter becoming visible.</paragraph>
                </list_item>
            </bullet_list>
            <note>
                <paragraph>Unlike non-volumetric fog, volumetric fog has a <emphasis>finite</emphasis> range. This means
                    volumetric fog cannot entirely cover a large world, as it will eventually
                    stop being rendered in the distance.</paragraph>
                <paragraph>If you wish to hide distant areas from the player, it's recommended to
                    enable both non-volumetric fog and volumetric fog at the same time, and
                    adjust their density accordingly.</paragraph>
            </note>
        </section>
        <section ids="light-interaction-with-volumetric-fog" names="light\ interaction\ with\ volumetric\ fog">
            <title>Light interaction with volumetric fog</title>
            <paragraph>To simulate fog light scattering behavior in real life, all light types will
                interact with volumetric fog. How much each light will affect volumetric fog can
                be adjusted using the <strong>Volumetric Fog Energy</strong> property on each light. Enabling
                shadows on a light will also make those shadows visible on volumetric fog.</paragraph>
            <paragraph>If fog light interaction is not desired for artistic reasons, this can be
                globally disabled by setting <strong>Volumetric Fog &gt; Albedo</strong> to a pure black color
                in the Environment resource. Fog light interaction can also be disabled for
                specific lights by setting its <strong>Volumetric Fog Energy</strong> to <literal>0</literal>. Doing so will
                also improve performance slightly by excluding the light from volumetric fog
                computations.</paragraph>
        </section>
        <section ids="using-volumetric-fog-as-a-volumetric-lighting-solution" names="using\ volumetric\ fog\ as\ a\ volumetric\ lighting\ solution">
            <title>Using volumetric fog as a volumetric lighting solution</title>
            <paragraph>While not physically accurate, it is possible to tune volumetric fog's settings
                to work as volumetric <emphasis>lighting</emphasis> solution. This means that unlit parts of the
                environment will not be darkened anymore by fog, but light will still be able to
                make fog brighter in specific areas.</paragraph>
            <paragraph>This can be done by setting volumetric fog density to the lowest permitted value
                <emphasis>greater than zero</emphasis> (<literal>0.0001</literal>), then increasing the <strong>Volumetric Fog Energy</strong>
                property on lights to much higher values than the default to compensate. Values
                between <literal>200.0</literal> and <literal>5000.0</literal> usually work well for this.</paragraph>
            <image candidates="{'*': 'tutorials/3d/img/volumetric_fog_lighting.png'}" original_uri="img/volumetric_fog_lighting.png" uri="tutorials/3d/img/volumetric_fog_lighting.png"></image>
        </section>
        <section ids="balancing-performance-and-quality" names="balancing\ performance\ and\ quality">
            <title>Balancing performance and quality</title>
            <paragraph>There are a few project settings available to adjust volumetric fog performance
                and quality:</paragraph>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph><strong>Rendering &gt; Environment &gt; Volumetric Fog &gt; Volume Size:</strong> Base size used to
                        determine size of froxel buffer in the camera X-axis and Y-axis. The final
                        size is scaled by the aspect ratio of the screen, so actual values may differ
                        from what is set. Set a larger size for more detailed fog, set a smaller size
                        for better performance.</paragraph>
                </list_item>
                <list_item>
                    <paragraph><strong>Rendering &gt; Environment &gt; Volumetric Fog &gt; Volume Depth:</strong> Number of slices
                        to use along the depth of the froxel buffer for volumetric fog. A lower number
                        will be more efficient, but may result in artifacts appearing during camera
                        movement.</paragraph>
                </list_item>
                <list_item>
                    <paragraph><strong>Rendering &gt; Environment &gt; Volumetric Fog &gt; Use Filter:</strong> Enables filtering
                        of the volumetric fog effect prior to integration. This substantially blurs
                        the fog which reduces fine details, but also smooths out harsh edges and
                        aliasing artifacts. Disable when more detail is required.</paragraph>
                </list_item>
            </bullet_list>
            <note>
                <paragraph>Volumetric fog can cause banding to appear on the viewport, especially at
                    higher density levels. See <reference internal="True" refuri="3d_rendering_limitations#doc-3d-rendering-limitations-color-banding"><inline classes="std std-ref">Color banding</inline></reference>
                    for guidance on reducing banding.</paragraph>
            </note>
        </section>
        <section ids="using-fog-volumes-for-local-volumetric-fog" names="using\ fog\ volumes\ for\ local\ volumetric\ fog">
            <title>Using fog volumes for local volumetric fog</title>
            <paragraph>Sometimes, you want fog to be constrained to specific areas. Conversely, you may
                want to have global volumetric fog, but fog should be excluded from certain
                areas. Both approaches can be followed using FogVolume nodes.</paragraph>
            <paragraph>Here's a quick start guide to using FogVolumes:</paragraph>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph>Make sure <strong>Volumetric Fog</strong> is enabled in the Environment properties. If
                        global volumetric fog is undesired, set its <strong>Density</strong> to <literal>0.0</literal>.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Create a FogVolume node.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Assign a new FogMaterial to the FogVolume node's <strong>Material</strong> property.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>In the FogMaterial, set <strong>Density</strong> to a positive value to increase density
                        within the FogVolume, or a negative value to subtract the density from global
                        volumetric fog.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Configure the FogVolume's extents and shape as needed.</paragraph>
                </list_item>
            </bullet_list>
            <note>
                <paragraph>Thin fog volumes may appear to flicker when the camera moves or rotates.
                    This can be alleviated by increasing the
                    <strong>Rendering &gt; Environment &gt; Volumetric Fog &gt; Volume Depth</strong> project setting
                    (at a performance cost) or by decreasing <strong>Length</strong> in the Environment
                    volumetric fog properties (at no performance cost, but at the cost of lower
                    fog range). Alternatively, the FogVolume can be made thicker and use a lower
                    density in the <strong>Material</strong>.</paragraph>
            </note>
        </section>
        <section ids="fogvolume-properties" names="fogvolume\ properties">
            <title>FogVolume properties</title>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph><strong>Extents:</strong> The size of the FogVolume when <strong>Shape</strong> is <strong>Ellipsoid</strong>,
                        <strong>Cone</strong>, <strong>Cylinder</strong> or <strong>Box</strong>. If <strong>Shape</strong> is <strong>Cone</strong> or <strong>Cylinder</strong>,
                        the cone/cylinder will be adjusted to fit within the extents. Non-uniform
                        scaling of cone/cylinder shapes via the <strong>Extents</strong> property is not supported,
                        but you can scale the FogVolume node instead.</paragraph>
                </list_item>
                <list_item>
                    <paragraph><strong>Shape:</strong> The shape of the FogVolume. This can be set to <strong>Ellipsoid</strong>,
                        <strong>Cone</strong>, <strong>Cylinder</strong>, <strong>Box</strong> or <strong>World</strong> (acts as global volumetric fog).</paragraph>
                </list_item>
                <list_item>
                    <paragraph><strong>Material:</strong> The material used by the FogVolume. Can be either a
                        built-in FogMaterial or a custom ShaderMaterial (<reference internal="True" refuri="../shaders/shader_reference/fog_shader#doc-fog-shader"><inline classes="std std-ref">Fog shaders</inline></reference>).</paragraph>
                </list_item>
            </bullet_list>
            <paragraph>After choosing <strong>New FogMaterial</strong> in the <strong>Material</strong> property, you can adjust
                the following properties in FogMaterial:</paragraph>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph><strong>Density:</strong> The density of the FogVolume. Denser objects are more opaque, but
                        may suffer from under-sampling artifacts that look like stripes. Negative
                        values can be used to subtract fog from other FogVolumes or global volumetric
                        fog.</paragraph>
                </list_item>
                <list_item>
                    <paragraph><strong>Albedo:</strong> The single-scattering Color of the FogVolume. Internally, member
                        albedo is converted into single-scattering, which is additively blended with
                        other FogVolumes and global volumetric fog's <strong>Albedo</strong>.</paragraph>
                </list_item>
                <list_item>
                    <paragraph><strong>Emission:</strong> The Color of the light emitted by the FogVolume. Emitted light
                        will not cast light or shadows on other objects, but can be useful for
                        modulating the Color of the FogVolume independently from light sources.</paragraph>
                </list_item>
                <list_item>
                    <paragraph><strong>Height Falloff:</strong> The rate by which the height-based fog decreases in
                        density as height increases in world space. A high falloff will result in a
                        sharp transition, while a low falloff will result in a smoother transition.
                        A value of <literal>0.0</literal> results in uniform-density fog. The height threshold is
                        determined by the height of the associated FogVolume.</paragraph>
                </list_item>
                <list_item>
                    <paragraph><strong>Edge Fade:</strong> The hardness of the edges of the FogVolume. A higher value will
                        result in softer edges, while a lower value will result in harder edges.</paragraph>
                </list_item>
                <list_item>
                    <paragraph><strong>Density Texture:</strong> The 3D texture that is used to scale the member density
                        of the FogVolume. This can be used to vary fog density within the FogVolume
                        with any kind of static pattern. For animated effects, consider using a custom
                        <reference internal="True" refuri="../shaders/shader_reference/fog_shader#doc-fog-shader"><inline classes="std std-ref">fog shader</inline></reference>.
                        You can import any image as a 3D texture by
                        <reference internal="True" refuri="../assets_pipeline/importing_images#doc-importing-images-changing-import-type"><inline classes="std std-ref">changing its import type in the Import dock</inline></reference>.</paragraph>
                </list_item>
            </bullet_list>
            <section ids="using-3d-noise-density-textures" names="using\ 3d\ noise\ density\ textures">
                <title>Using 3D noise density textures</title>
                <paragraph>Since Godot 4.1, there is a NoiseTexture3D resource that can be used to
                    procedurally generate 3D noise. This is well-suited to FogMaterial density
                    textures, which can result in more detailed fog effects:</paragraph>
                <figure ids="id1">
                    <image alt="FogMaterial comparison (without and with density texture)" candidates="{'*': 'tutorials/3d/img/volumetric_fog_fog_material_density_texture.webp'}" original_uri="img/volumetric_fog_fog_material_density_texture.webp" uri="tutorials/3d/img/volumetric_fog_fog_material_density_texture.webp"></image>
                    <caption>Screenshot taken with <strong>Volume Size</strong> project setting set to 192 to make
                        high-frequency detail more visible in the fog.</caption>
                </figure>
                <paragraph>To do so, select the <strong>Density Texture</strong> property and choose <strong>New NoiseTexture3D</strong>.
                    Edit this NoiseTexture3D by clicking it, then click <strong>Noise</strong> at the bottom of the
                    NoiseTexture3D properties and choose <strong>New FastNoiseLite</strong>. Adjust the noise texture's
                    width, height and depth according to your fog volume's dimensions.</paragraph>
                <paragraph>To improve performance, it's recommended to use low texture sizes (64×64×64 or lower),
                    as high-frequency detail is difficult to notice in a FogVolume. If you wish to represent
                    more detailed density variations, you will need to increase
                    <strong>Rendering &gt; Environment &gt; Volumetric Fog &gt; Volume Size</strong> in the project settings,
                    which has a performance cost.</paragraph>
                <note>
                    <paragraph>NoiseTexture3D's <strong>Color Ramp</strong> affects FogMaterial density textures, but
                        since only the texture's red channel is sampled, only the color ramp's red
                        channel will affect the resulting density.</paragraph>
                    <paragraph>However, using a color ramp will <emphasis>not</emphasis> tint the fog volume according to the
                        texture. You would need to use a custom shader that reads a Texture3D to
                        achieve this.</paragraph>
                </note>
            </section>
        </section>
        <section ids="custom-fogvolume-shaders" names="custom\ fogvolume\ shaders">
            <title>Custom FogVolume shaders</title>
            <paragraph>This page only covers the built-in settings offered by FogMaterial. If you need
                to customize fog behavior within a FogVolume node (such as creating animated fog),
                FogVolume nodes' appearance can be customized using <reference internal="True" refuri="../shaders/shader_reference/fog_shader#doc-fog-shader"><inline classes="std std-ref">Fog shaders</inline></reference>.</paragraph>
        </section>
        <section ids="faking-volumetric-fog-using-quads" names="faking\ volumetric\ fog\ using\ quads">
            <title>Faking volumetric fog using quads</title>
            <paragraph>In some cases, it may be better to use specially configured QuadMeshes as an
                alternative to volumetric fog:</paragraph>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph>Quads work with any rendering method, including Mobile and Compatibility.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Quads do not require temporal reprojection to look smooth, which makes
                        them suited to fast-moving dynamic effects such as lasers. They can also
                        represent small details which volumetric fog cannot do efficiently.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Quads generally have a lower performance cost than volumetric fog.</paragraph>
                </list_item>
            </bullet_list>
            <paragraph>This approach has a few downsides though:</paragraph>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph>The fog effect has less realistic falloff, especially if the camera enters the fog.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Transparency sorting issues may occur when sprites overlap.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Performance will not necessarily be better than volumetric fog if there are
                        lots of sprites close to the camera.</paragraph>
                </list_item>
            </bullet_list>
            <paragraph>To create a QuadMesh-based fog sprite:</paragraph>
            <enumerated_list enumtype="arabic" prefix="" suffix=".">
                <list_item>
                    <paragraph>Create a MeshInstance3D node with a QuadMesh resource in the <strong>Mesh</strong>
                        property. Set the size as desired.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Create a new StandardMaterial3D in the mesh's <strong>Material</strong> property.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>In the StandardMaterial3D, set <strong>Shading &gt; Shading Mode</strong> to <strong>Unshaded</strong>,
                        <strong>Billboard &gt; Mode</strong> to <strong>Enabled</strong>, enable <strong>Proximity Fade</strong> and set
                        <strong>Distance Fade</strong> to <strong>Pixel Alpha</strong>.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Set the <strong>Albedo &gt; Texture</strong> to the texture below (right-click and choose <strong>Save as…</strong>):</paragraph>
                    <image candidates="{'*': 'tutorials/3d/img/volumetric_fog_quad_mesh_texture.webp'}" original_uri="img/volumetric_fog_quad_mesh_texture.webp" uri="tutorials/3d/img/volumetric_fog_quad_mesh_texture.webp"></image>
                </list_item>
                <list_item>
                    <paragraph><emphasis>After</emphasis> setting the albedo texture, go to the Import dock, select the texture
                        and change its compression mode to <strong>Lossless</strong> to improve quality.</paragraph>
                </list_item>
            </enumerated_list>
            <paragraph>The fog's color is set using the <strong>Albedo &gt; Color</strong> property; its density is set
                using the color's alpha channel. For best results, you will have to adjust
                <strong>Proximity Fade &gt; Distance</strong> and <strong>Distance Fade &gt; Max Distance</strong> depending on
                the size of your QuadMesh.</paragraph>
            <paragraph>Optionally, billboarding may be left disabled if you place the quad in a way
                where all of its corners are in solid geometry. This can be useful for fogging
                large planes that the camera cannot enter, such as bottomless pits.</paragraph>
            <substitution_definition names="weblate_widget"><reference refuri="https://hosted.weblate.org/engage/godot-engine/?utm_source=widget"><image alt="Translation status" candidates="{'?': 'https://hosted.weblate.org/widgets/godot-engine/-/godot-docs/287x66-white.png'}" height="66" uri="https://hosted.weblate.org/widgets/godot-engine/-/godot-docs/287x66-white.png" width="287"></image></reference></substitution_definition>
        </section>
    </section>
</document>
