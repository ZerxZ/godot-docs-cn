<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.17.1 -->
<document source="/home/runner/work/godot-docs-cn/godot-docs-cn/godot-docs/docs/tutorials/3d/volumetric_fog.rst" xmlns:c="https://www.sphinx-doc.org/" xmlns:changeset="https://www.sphinx-doc.org/" xmlns:citation="https://www.sphinx-doc.org/" xmlns:cpp="https://www.sphinx-doc.org/" xmlns:index="https://www.sphinx-doc.org/" xmlns:js="https://www.sphinx-doc.org/" xmlns:math="https://www.sphinx-doc.org/" xmlns:py="https://www.sphinx-doc.org/" xmlns:rst="https://www.sphinx-doc.org/" xmlns:std="https://www.sphinx-doc.org/">
    <target refid="doc-volumetric-fog"></target>
    <section ids="volumetric-fog-and-fog-volumes doc-volumetric-fog" names="volumetric\ fog\ and\ fog\ volumes 体积雾和雾体积 doc_volumetric_fog">
        <title>体积雾和雾体积</title>
        <note>
            <paragraph>只有“集群 Forward”渲染后端支持体积雾，“Forward 移动”和“兼容”不支持。</paragraph>
        </note>
        <paragraph><reference internal="True" refuri="environment_and_post_processing#doc-environment-and-post-processing"><inline classes="std std-ref">环境和后期处理</inline></reference> 中已经介绍过，Godot 支持的各种视觉效果中包含两种雾：传统（非体积）雾和体积雾。传统雾会影响整个场景，无法使用 <reference internal="True" refuri="../shaders/shader_reference/fog_shader#doc-fog-shader"><inline classes="std std-ref">雾着色器</inline></reference> 进行自定义。</paragraph>
        <paragraph>如果需要，体积雾可以和非体积雾一同使用。</paragraph>
        <paragraph>你会在这个页面中学习到：</paragraph>
        <bullet_list bullet="-">
            <list_item>
                <paragraph>如何在 Godot 中设置体积雾。</paragraph>
            </list_item>
            <list_item>
                <paragraph>雾体积是什么，和“全局”体积雾有什么区别。</paragraph>
            </list_item>
        </bullet_list>
        <seealso>
            <paragraph>你可以使用 <reference name="体积雾演示项目" refuri="https://github.com/godotengine/godot-demo-projects/tree/master/3d/volumetric_fog">体积雾演示项目</reference> 来查看体积雾的实际工作原理。</paragraph>
        </seealso>
        <paragraph>以下是传统雾（不与光照交互）和体积雾（能够与光照交互）之间的比较：</paragraph>
        <image candidates="{'*': 'tutorials/3d/img/volumetric_fog_comparison.png'}" uri="tutorials/3d/img/volumetric_fog_comparison.png"></image>
        <section ids="volumetric-fog-properties" names="volumetric\ fog\ properties 体积雾属性">
            <title>体积雾属性</title>
            <paragraph>在 WorldEnvironment 节点的 Environment 资源中启用体积雾之后，可以编辑以下属性：</paragraph>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph><strong>Density：</strong>密度。体积雾的基础<emphasis>指数</emphasis>密度。请将这个值设置为你想要的全局最低密度。可以在特定区域中使用 FogVolume 来增加或减少这个密度。设为 <literal>0.0</literal> 会禁用全局体积雾，但仍然可以在特定区域中使用 FogVolume 来显示体积雾。雾的渲染呈指数效果，和现实生活中一致。</paragraph>
                </list_item>
                <list_item>
                    <paragraph><strong>Albedo：</strong>反照率。体积雾在与灯光交互时的颜色。雾的反照率接近于白色（<literal>Color(1, 1, 1, 1)</literal>），而烟的反照率要更暗一些。</paragraph>
                </list_item>
                <list_item>
                    <paragraph><strong>Emission：</strong>自发光。体积雾发出的光。启用了自发光的体积雾并不会向其它表面发射光线。自发光常用于实现环境光。因为体积雾效果只使用单散射，所以雾需要有一点点自发光才能柔化阴影。</paragraph>
                </list_item>
                <list_item>
                    <paragraph><strong>Emission Energy：</strong>自发光能量。体积雾发出的光的亮度。</paragraph>
                </list_item>
                <list_item>
                    <paragraph><strong>GI Inject：</strong>GI 注入。对体积雾在全局光照中使用的反照率颜色强度进行缩放。设为 <literal>0.0</literal> 意味着全局光照不影响体积雾。设为大于 <literal>0.0</literal> 的值时对影响略有影响。</paragraph>
                </list_item>
                <list_item>
                    <paragraph><strong>各向异性(Anisotropy)：</strong> 散射光穿过体积雾时的方向。 接近 <literal>1.0</literal> 的值意味着几乎所有光都向前散射。 接近 <literal>0.0</literal> 的值意味着光在各个方向上均匀散射。 接近 <literal>-1.0</literal> 的值意味着光大部分向后散射。 雾和薄雾将光线稍微向前散射，而烟雾则将光线均匀地向各个方向散射。</paragraph>
                </list_item>
                <list_item>
                    <paragraph><strong>长度(Length)：</strong> 计算体积雾的距离。 增加以在更大范围内计算雾，减少以在不需要长范围时添加更多细节。 为了获得最佳质量的雾，请将其保持尽可能低。</paragraph>
                </list_item>
                <list_item>
                    <paragraph><strong>细节分布(Detail Spread)：</strong> froxel 缓冲区长度上的大小分布。 较高的值会压缩 Froxels 使其更靠近相机，并将更多细节放置在更靠近相机的位置。</paragraph>
                </list_item>
                <list_item>
                    <paragraph><strong>环境注入(Ambient Inject)：</strong> 缩放体积雾中使用的环境光的强度。 值 <literal>0.0</literal> 表示环境光不会影响体积雾。 当设置高于 <literal>0.0</literal> 时，性能成本很小。</paragraph>
                </list_item>
                <list_item>
                    <paragraph><strong>天空影响(Sky Affect:)：</strong> 控制应在背景天空上绘制多少体积雾。 如果设置为 <literal>0.0</literal> ，体积雾根本不会影响天空渲染（包括 FogVolumes）。</paragraph>
                </list_item>
            </bullet_list>
            <paragraph><strong>时间重投影</strong> 部分提供了两个附加属性：</paragraph>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph><strong>时间重投影 &gt; 已启用：</strong> 在体积雾中启用时间重投影。 时间重投影将当前帧的体积雾与上一帧的体积雾混合以平滑锯齿状边缘。 性能成本很小，但它确实会导致移动 FogVolume 和 Light3D 出现“重影”并留下痕迹。 启用时间重投影时，尽量避免 FogVolume 或 Light3D 移动得太快。 短暂的动态照明效果应将**体积雾能量**设置为 <literal>0.0</literal> 以避免重影。</paragraph>
                </list_item>
                <list_item>
                    <paragraph><strong>时间重投影 &gt; 数量：</strong> 最后一帧与当前帧的混合量。 数值越高，体积雾越平滑，但“重影”会更严重。 较低的值可减少重影，但会导致每帧时间抖动变得可见。</paragraph>
                </list_item>
            </bullet_list>
            <note>
                <paragraph>与非体积雾不同，体积雾具有 <emphasis>有限</emphasis> 范围。 这意味着体积雾无法完全覆盖一个大世界，因为它最终将停止在远处渲染。</paragraph>
                <paragraph>如果你希望对玩家隐藏较远的区域，建议同时启用非体积雾和体积雾，并相应地调整其密度。</paragraph>
            </note>
        </section>
        <section ids="light-interaction-with-volumetric-fog" names="light\ interaction\ with\ volumetric\ fog 光与体积雾的交互">
            <title>光与体积雾的交互</title>
            <paragraph>为了模拟现实生活中的雾光散射行为，所有光类型都将与体积雾相互作用。 每个灯光对体积雾的影响程度可以使用每个灯光的 <strong>体积雾能量</strong> 属性进行调整。 在灯光上启用阴影也会使这些阴影在体积雾中可见。</paragraph>
            <paragraph>如果出于艺术原因不需要雾灯交互，可以通过在环境资源中将**体积雾 &gt; 反照率**设置为纯黑色来全局禁用雾灯交互。 还可以通过将其**体积雾能量**设置为 <literal>0</literal> 来禁用特定灯光的雾灯交互。 这样做还可以通过从体积雾计算中排除光线来稍微提高性能。</paragraph>
        </section>
        <section ids="using-volumetric-fog-as-a-volumetric-lighting-solution" names="using\ volumetric\ fog\ as\ a\ volumetric\ lighting\ solution 使用体积雾作为体积照明解决方案">
            <title>使用体积雾作为体积照明解决方案</title>
            <paragraph>虽然物理上不准确，但可以调整体积雾的设置以用作体积 <emphasis>照明</emphasis> 解决方案。 这意味着环境中未照亮的部分将不再因雾而变暗，但光仍然能够使特定区域的雾变得更亮。</paragraph>
            <paragraph>这可以通过将体积雾密度设置为最低允许值*大于零*（ <literal>0.0001</literal> ），然后将灯光的“体积雾能量”属性增加到比默认值高得多的值来进行补偿。 <literal>10000</literal> 和 <literal>100000</literal> 之间的值通常对此效果很好。</paragraph>
            <image candidates="{'*': 'tutorials/3d/img/volumetric_fog_lighting.png'}" uri="tutorials/3d/img/volumetric_fog_lighting.png"></image>
        </section>
        <section ids="balancing-performance-and-quality" names="balancing\ performance\ and\ quality 平衡性能与质量">
            <title>平衡性能与质量</title>
            <paragraph>有一些项目设置可用于调整体积雾性能和质量：</paragraph>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph><strong>渲染 &gt; 环境 &gt; 体积雾 &gt; 体积大小：</strong> 用于确定相机 X 轴和 Y 轴中 froxel 缓冲区大小的基本大小。 最终尺寸会根据屏幕的宽高比进行缩放，因此实际值可能与设置值有所不同。 设置较大的尺寸以获得更详细的雾，设置较小的尺寸以获得更好的性能。</paragraph>
                </list_item>
                <list_item>
                    <paragraph><strong>渲染 &gt; 环境 &gt; 体积雾 &gt; 体积深度：</strong> 沿着体积雾的 froxel 缓冲区深度使用的切片数量。 数字越低效率越高，但可能会导致相机移动期间出现伪影。</paragraph>
                </list_item>
                <list_item>
                    <paragraph><strong>渲染 &gt; 环境 &gt; 体积雾 &gt; 使用过滤器：</strong> 在集成之前启用体积雾效果的过滤。 这大大模糊了雾，减少了精细细节，但也平滑了粗糙的边缘和锯齿伪影。 当需要更多详细信息时禁用。</paragraph>
                </list_item>
            </bullet_list>
            <note>
                <paragraph>体积雾会导致视口中出现色带，尤其是在密度较高的情况下。请参阅 <reference internal="True" refuri="3d_rendering_limitations#doc-3d-rendering-limitations-color-banding"><inline classes="std std-ref">带状颜色</inline></reference>，了解如何减少条带。</paragraph>
            </note>
        </section>
        <section ids="using-fog-volumes-for-local-volumetric-fog" names="using\ fog\ volumes\ for\ local\ volumetric\ fog 使用雾体积进行局部体积雾">
            <title>使用雾体积进行局部体积雾</title>
            <paragraph>有时，你希望将雾限制在特定区域。 相反地，你可能希望拥有全局体积雾，但应将雾排除在某些区域之外。 这两种方法都可以使用 FogVolume 节点来遵循。</paragraph>
            <paragraph>以下是使用 FogVolumes 的快速入门指南：</paragraph>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph>确保在环境属性中启用 <strong>体积雾</strong> 。 如果不需要全局体积雾，请将其 <strong>密度</strong> 设置为 <literal>0.0</literal> 。</paragraph>
                </list_item>
                <list_item>
                    <paragraph>创建自定义节点。</paragraph>
                </list_item>
                <list_item>
                    <paragraph>将新的 FogMaterial 分配给 FogVolume 节点的 <strong>Material</strong> 属性。</paragraph>
                </list_item>
                <list_item>
                    <paragraph>在 FogMaterial 中，将 <strong>密度</strong> 设置为正值以增加 FogVolume 内的密度，或设置为负值以从全局体积雾中减去密度。</paragraph>
                </list_item>
                <list_item>
                    <paragraph>根据需要配置 FogVolume 的范围和形状。</paragraph>
                </list_item>
            </bullet_list>
            <note>
                <paragraph>当相机移动或旋转时，薄雾体积可能会出现闪烁。 这可以通过增加 <strong>渲染 &gt; 环境 &gt; 体积雾 &gt; 体积深度</strong> 项目设置（以性能成本）或通过减少环境体积雾属性中的<strong>长度</strong>（没有性能成本，但以性能为代价）来缓解。或者，可以将 FogVolume 做得更厚，并在 <strong>Material</strong>（材质）中使用较低的密度。</paragraph>
            </note>
        </section>
        <section ids="fogvolume-properties" names="fogvolume\ properties fogvolume\ 属性">
            <title>FogVolume 属性</title>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph><strong>Extents：</strong> （范围）当 <strong>Shape</strong> 为 <strong>Ellipsoid</strong> 、 <strong>Cone</strong> 、 <strong>Cylinder</strong> 或 <strong>Box</strong> 时 FogVolume 的大小。 如果 <strong>形状</strong> 是 <strong>圆锥体</strong> 或 <strong>圆柱体</strong> ，圆锥体/圆柱体将被调整以适应范围。 不支持通过 <strong>Extents</strong> 属性对圆锥体/圆柱体形状进行非均匀缩放，但你可以改为缩放 FogVolume 节点。</paragraph>
                </list_item>
                <list_item>
                    <paragraph><strong>Shape：</strong> （形状）FogVolume 的形状。 可以设置为 <strong>Ellipsoid</strong> （椭球体）、 <strong>Cone</strong> （锥体）、 <strong>Cylinder</strong> （圆柱体）、 <strong>Box</strong> （盒子）或 <strong>World</strong> （充当全局体积雾）。</paragraph>
                </list_item>
                <list_item>
                    <paragraph><strong>Material：</strong> FogVolume 使用的材质。 可以是内置 FogMaterial 或自定义 ShaderMaterial ( <reference internal="True" refuri="../shaders/shader_reference/fog_shader#doc-fog-shader"><inline classes="std std-ref">雾着色器</inline></reference> )。</paragraph>
                </list_item>
            </bullet_list>
            <paragraph>在 <strong>Material</strong> 属性中选择 <strong>新建 FogMaterial</strong> 后，你可以在 FogMaterial 中调整以下属性：</paragraph>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph><strong>Density：</strong> FogVolume 的密度。 密度较大的对象更加不透明，但可能会出现看起来像条纹的采样不足的伪影。 负值可用于从其他 FogVolume 或全局体积雾中减去雾。</paragraph>
                </list_item>
                <list_item>
                    <paragraph><strong>Albedo：</strong> （反照率）FogVolume 的单散射颜色。 在内部，成员反照率转换为单散射，与其他 FogVolume 和全局体积雾的 <strong>Albedo</strong> 相加混合。</paragraph>
                </list_item>
                <list_item>
                    <paragraph><strong>Emission：</strong> （自发光）FogVolume 发出的光的颜色。 发射的光不会在其他对象上投射光或阴影，但可用于独立于光源调制 FogVolume 的颜色。</paragraph>
                </list_item>
                <list_item>
                    <paragraph><strong>Height Falloff：</strong> （高度衰减）随着世界空间中高度的增加，基于高度的雾密度降低的速率。 高衰减将导致急剧的过渡，而低衰减将导致更平滑的过渡。 值 <literal>0.0</literal> 会产生均匀密度的雾。 高度阈值由关联的 FogVolume 的高度确定。</paragraph>
                </list_item>
                <list_item>
                    <paragraph><strong>Edge Fade：</strong> （边缘淡入淡出）FogVolume 边缘的硬度。 较高的值将导致较柔和的边缘，而较低的值将导致较硬的边缘。</paragraph>
                </list_item>
                <list_item>
                    <paragraph><strong>Density Texture：</strong>（密度纹理）用于缩放 FogVolume 的成员密度的 3D 纹理。 这可用于通过任何类型的静态图案来改变 FogVolume 内的雾密度。 对于动画效果，请考虑使用自定义<reference internal="True" refuri="../shaders/shader_reference/fog_shader#doc-fog-shader"><inline classes="std std-ref">雾着色器</inline></reference>。你可以<reference internal="True" refuri="../assets_pipeline/importing_images#doc-importing-images-changing-import-type"><inline classes="std std-ref">在“导入”面板中更改其导入类型</inline></reference>，将任何图像导入为 3D 纹理。</paragraph>
                </list_item>
            </bullet_list>
            <section ids="using-3d-noise-density-textures" names="using\ 3d\ noise\ density\ textures 使用\ 3d\ 噪声密度纹理">
                <title>使用 3D 噪声密度纹理</title>
                <paragraph>从 Godot 4.1 开始，有一个 NoiseTexture3D 资源可用于按程序生成 3D 噪声。 这非常适合 FogMaterial 密度纹理，可以产生更详细的雾效果：</paragraph>
                <figure ids="id1">
                    <image alt="FogMaterial 比较（没有和有密度纹理的情况）" candidates="{'*': 'tutorials/3d/img/volumetric_fog_fog_material_density_texture.webp'}" uri="tutorials/3d/img/volumetric_fog_fog_material_density_texture.webp"></image>
                    <caption>屏幕截图是在 <strong>体积大小</strong> 项目设置设置为 192 时拍摄的，以使高频细节在雾中更加明显。</caption>
                </figure>
                <paragraph>为此，请选择 <strong>Density Texture</strong> 属性，然后选择 <strong>New NoiseTexture3D</strong> 。 单击此 NoiseTexture3D 对其进行编辑，然后单击 NoiseTexture3D 属性底部的 <strong>Noise</strong> 并选择 <strong>New FastNoiseLite</strong> 。 根据雾体积的尺寸调整噪波纹理的宽度、高度和深度。</paragraph>
                <paragraph>为了提高性能，建议使用较小的纹理尺寸（64×64×64 或更低），因为在 FogVolume 中很难注意到高频细节。 如果你希望表示更详细的密度变化，则需要在项目设置中增加 <strong>渲染 &gt; 环境 &gt; 体积雾 &gt; 体积大小</strong> ，这会产生性能成本。</paragraph>
                <note>
                    <paragraph>NoiseTexture3D 的 <strong>颜色渐变</strong> 影响 FogMaterial 密度纹理，但由于仅对纹理的红色通道进行采样，因此只有颜色渐变的红色通道会影响生成的密度。</paragraph>
                    <paragraph>然而，使用颜色渐变将 <emphasis>不会</emphasis> 根据纹理对雾体积进行着色。 你需要使用读取 Texture3D 的自定义着色器来实现此目的。</paragraph>
                </note>
            </section>
        </section>
        <section ids="custom-fogvolume-shaders" names="custom\ fogvolume\ shaders 自定义\ fogvolume\ 着色器">
            <title>自定义 FogVolume 着色器</title>
            <paragraph>本页面仅涵盖 FogMaterial 提供的内置设置。 如果你需要在 FogVolume 节点内自定义雾行为（例如创建动画雾），可以使用 <reference internal="True" refuri="../shaders/shader_reference/fog_shader#doc-fog-shader"><inline classes="std std-ref">雾着色器</inline></reference> 自定义 FogVolume 节点的外观。</paragraph>
        </section>
        <section ids="faking-volumetric-fog-using-quads" names="faking\ volumetric\ fog\ using\ quads 使用\ quad（四方形）\ 伪造体积雾">
            <title>使用 Quad（四方形） 伪造体积雾</title>
            <paragraph>在某些情况下，最好使用专门配置的 QuadMeshes 作为体积雾的替代方案：</paragraph>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph>Quads 可与任何渲染方法配合使用，包括Forward+，移动和兼容模式。</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Quads 不需要时间重投影即可看起来平滑，这使得它们适合快速移动的动态效果，例如激光。 它们还可以表示体积雾无法有效实现的小细节。</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Quads 通常比体积雾具有更低的性能成本。</paragraph>
                </list_item>
            </bullet_list>
            <paragraph>但这种方法有一些缺点：</paragraph>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph>雾效果的衰减不太真实，尤其是当相机进入雾中时。</paragraph>
                </list_item>
                <list_item>
                    <paragraph>当精灵重叠时，可能会出现透明度排序问题。</paragraph>
                </list_item>
                <list_item>
                    <paragraph>若相机附近有很多精灵，性能不一定比体积雾好。</paragraph>
                </list_item>
            </bullet_list>
            <paragraph>创建一个基于 QuadMesh 的雾精灵：</paragraph>
            <enumerated_list enumtype="arabic" prefix="" suffix=".">
                <list_item>
                    <paragraph>在 <strong>Mesh</strong> 属性中创建一个具有 QuadMesh 资源的 MeshInstance3D 节点。 根据需要设置尺寸。</paragraph>
                </list_item>
                <list_item>
                    <paragraph>在网格的 <strong>Material</strong> 属性中创建一个新的 StandardMaterial3D。</paragraph>
                </list_item>
                <list_item>
                    <paragraph>在 StandardMaterial3D 中，将 <strong>着色&gt; 着色模式</strong> 设置为 <strong>不着色</strong> ， <strong>公告板&gt; 模式</strong> 设置为 <strong>启用</strong> ，启用 <strong>临近淡出</strong> 并将 <strong>距离淡出</strong> 设置为 <strong>像素Alpha</strong> 。</paragraph>
                </list_item>
                <list_item>
                    <paragraph>将 <strong>反照率 &gt; 纹理</strong> 设置为下面的纹理（右键单击并选择 <strong>另存为...</strong> ）：</paragraph>
                    <image candidates="{'*': 'tutorials/3d/img/volumetric_fog_quad_mesh_texture.webp'}" uri="tutorials/3d/img/volumetric_fog_quad_mesh_texture.webp"></image>
                </list_item>
                <list_item>
                    <paragraph>设置反照率纹理 <emphasis>之后</emphasis> ，转到导入面板，选择纹理并将其压缩模式更改为 <strong>无损</strong> 以提高质量。</paragraph>
                </list_item>
            </enumerated_list>
            <paragraph>雾的颜色使用 <strong>反照率&gt; 颜色</strong> 属性设置； 它的密度是使用颜色的 Alpha 通道设置的。 为了获得最佳结果，你必须根据 QuadMesh 的大小调整 <strong>临近淡出 &gt; 距离</strong> 和 <strong>距离淡出 &gt; 最大距离</strong> 。</paragraph>
            <paragraph>或者，如果你将四边形放置在其所有角都处于实体几何形状中的方式，则可以禁用公告板。 这对于相机无法进入的大型平面（例如无底坑）中的雾效非常有用。</paragraph>
            <substitution_definition names="weblate_widget"><reference refuri="https://hosted.weblate.org/engage/godot-engine/zh_CN/?utm_source=widget"><image alt="翻译状态" candidates="{'?': 'https://hosted.weblate.org/widgets/godot-engine/zh_CN/godot-docs/287x66-white.png'}" height="66" uri="https://hosted.weblate.org/widgets/godot-engine/zh_CN/godot-docs/287x66-white.png" width="287"></image></reference></substitution_definition>
        </section>
    </section>
</document>
