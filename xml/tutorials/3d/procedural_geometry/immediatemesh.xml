<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.21.2 -->
<document source="/home/runner/work/godot-docs-cn/godot-docs-cn/godot-docs/docs/tutorials/3d/procedural_geometry/immediatemesh.rst" translation_progress="{'total': 0, 'translated': 0}" xmlns:c="https://www.sphinx-doc.org/" xmlns:changeset="https://www.sphinx-doc.org/" xmlns:citation="https://www.sphinx-doc.org/" xmlns:cpp="https://www.sphinx-doc.org/" xmlns:index="https://www.sphinx-doc.org/" xmlns:js="https://www.sphinx-doc.org/" xmlns:math="https://www.sphinx-doc.org/" xmlns:py="https://www.sphinx-doc.org/" xmlns:rst="https://www.sphinx-doc.org/" xmlns:std="https://www.sphinx-doc.org/">
    <target refid="doc-immediatemesh"></target>
    <section ids="using-immediatemesh doc-immediatemesh" names="using\ immediatemesh doc_immediatemesh">
        <title>Using ImmediateMesh</title>
        <paragraph>The <reference internal="True" refuri="../../../classes/class_immediatemesh#class-immediatemesh"><inline classes="std std-ref">ImmediateMesh</inline></reference> is a convenient tool to create
            dynamic geometry using an OpenGL 1.x-style API. Which makes it both approachable
            to use and efficient for meshes which need to be updated every frame.</paragraph>
        <paragraph>Generating complex geometry (several thousand vertices) with this tool is inefficient, even if it's
            done only once. Instead, it is designed to generate simple geometry that changes every frame.</paragraph>
        <paragraph>First, you need to create a <reference internal="True" refuri="../../../classes/class_meshinstance3d#class-meshinstance3d"><inline classes="std std-ref">MeshInstance3D</inline></reference> and add
            an <reference internal="True" refuri="../../../classes/class_immediatemesh#class-immediatemesh"><inline classes="std std-ref">ImmediateMesh</inline></reference> to it in the Inspector.</paragraph>
        <paragraph>Next, add a script to the MeshInstance3D. The code for the ImmediateMesh should
            go in the <literal>_process()</literal> function if you want it to update each frame, or in the
            <literal>_ready()</literal> function if you want to create the mesh once and not update it. If
            you only generate a surface once, the ImmediateMesh is just as efficient as any
            other kind of mesh as the generated mesh is cached and reused.</paragraph>
        <paragraph>To begin generating geometry you must call <literal>surface_begin()</literal>.
            <literal>surface_begin()</literal> takes a <literal>PrimitiveType</literal> as an argument. <literal>PrimitiveType</literal>
            instructs the GPU how to arrange the primitive based on the vertices given
            whether it is triangles, lines, points, etc. A complete list can be found under
            the <reference internal="True" refuri="../../../classes/class_mesh#class-mesh"><inline classes="std std-ref">Mesh</inline></reference> class reference page.</paragraph>
        <paragraph>Once you have called <literal>surface_begin()</literal> you are ready to start adding vertices.
            You add vertices one at a time. First you add vertex specific attributes such as
            normals or UVs using <literal>surface_set_****()</literal> (e.g. <literal>surface_set_normal()</literal>).
            Then you call <literal>surface_add_vertex()</literal> to add a vertex with those attributes.
            For example:</paragraph>
        <container classes="sphinx-tabs" type="tab-element">
            <div aria-label="Tabbed content" role="tablist">
                <button aria-controls="panel-0-R0RTY3JpcHQ=" aria-selected="true" classes="sphinx-tabs-tab code-tab group-tab" ids="tab-0-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tab" tabindex="0">GDScript</button>
            </div>
            <div aria-labelledby="tab-0-R0RTY3JpcHQ=" classes="sphinx-tabs-panel code-tab group-tab" ids="panel-0-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tabpanel" tabindex="0">
                <literal_block force="False" highlight_args="{}" language="gdscript" linenos="False" xml:space="preserve"># Add a vertex with normal and uv.
surface_set_normal(Vector3(0, 1, 0))
surface_set_uv(Vector2(1, 1))
surface_add_vertex(Vector3(0, 0, 1))</literal_block>
            </div>
        </container>
        <paragraph>Only attributes added before the call to <literal>surface_add_vertex()</literal> will be
            included in that vertex. If you add an attribute twice before calling
            <literal>surface_add_vertex()</literal>, only the second call will be used.</paragraph>
        <paragraph>Finally, once you have added all your vertices call <literal>surface_end()</literal> to signal
            that you have finished generating the surface. You can call <literal>surface_begin()</literal>
            and <literal>surface_end()</literal> multiple times to generate multiple surfaces for the mesh.</paragraph>
        <paragraph>The example code below draws a single triangle in the <literal>_ready()</literal> function.</paragraph>
        <container classes="sphinx-tabs" type="tab-element">
            <div aria-label="Tabbed content" role="tablist">
                <button aria-controls="panel-1-R0RTY3JpcHQ=" aria-selected="true" classes="sphinx-tabs-tab code-tab group-tab" ids="tab-1-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tab" tabindex="0">GDScript</button>
            </div>
            <div aria-labelledby="tab-1-R0RTY3JpcHQ=" classes="sphinx-tabs-panel code-tab group-tab" ids="panel-1-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tabpanel" tabindex="0">
                <literal_block force="False" highlight_args="{}" language="gdscript" linenos="False" xml:space="preserve">extends MeshInstance3D

func _ready():
    # Begin draw.
    mesh.surface_begin(Mesh.PRIMITIVE_TRIANGLES)

    # Prepare attributes for add_vertex.
    mesh.surface_set_normal(Vector3(0, 0, 1))
    mesh.surface_set_uv(Vector2(0, 0))
    # Call last for each vertex, adds the above attributes.
    mesh.surface_add_vertex(Vector3(-1, -1, 0))

    mesh.surface_set_normal(Vector3(0, 0, 1))
    mesh.surface_set_uv(Vector2(0, 1))
    mesh.surface_add_vertex(Vector3(-1, 1, 0))

    mesh.surface_set_normal(Vector3(0, 0, 1))
    mesh.surface_set_uv(Vector2(1, 1))
    mesh.surface_add_vertex(Vector3(1, 1, 0))

    # End drawing.
    mesh.surface_end()</literal_block>
            </div>
        </container>
        <paragraph>The ImmediateMesh can also be used across frames. Each time you call
            <literal>surface_begin()</literal> and <literal>surface_end()</literal>, you are adding a new surface to the
            ImmediateMesh. If you want to recreate the mesh from scratch each frame, call
            <literal>clear_surfaces()</literal> before calling <literal>surface_begin()</literal>.</paragraph>
        <container classes="sphinx-tabs" type="tab-element">
            <div aria-label="Tabbed content" role="tablist">
                <button aria-controls="panel-2-R0RTY3JpcHQ=" aria-selected="true" classes="sphinx-tabs-tab code-tab group-tab" ids="tab-2-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tab" tabindex="0">GDScript</button>
            </div>
            <div aria-labelledby="tab-2-R0RTY3JpcHQ=" classes="sphinx-tabs-panel code-tab group-tab" ids="panel-2-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tabpanel" tabindex="0">
                <literal_block force="False" highlight_args="{}" language="gdscript" linenos="False" xml:space="preserve">extends MeshInstance3D

func _process(delta):

    # Clean up before drawing.
    mesh.clear_surfaces()

    # Begin draw.
    mesh.surface_begin(Mesh.PRIMITIVE_TRIANGLES)

    # Draw mesh.

    # End drawing.
    mesh.surface_end()</literal_block>
            </div>
        </container>
        <paragraph>The above code will dynamically create and draw a single surface each frame.</paragraph>
        <substitution_definition names="weblate_widget"><reference refuri="https://hosted.weblate.org/engage/godot-engine/?utm_source=widget"><image alt="Translation status" candidates="{'?': 'https://hosted.weblate.org/widgets/godot-engine/-/godot-docs/287x66-white.png'}" height="66" uri="https://hosted.weblate.org/widgets/godot-engine/-/godot-docs/287x66-white.png" width="287"></image></reference></substitution_definition>
    </section>
</document>
