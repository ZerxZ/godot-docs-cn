<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.21.2 -->
<document source="/home/runner/work/godot-docs-cn/godot-docs-cn/godot-docs/docs/tutorials/3d/global_illumination/using_voxel_gi.rst" translation_progress="{'total': 0, 'translated': 0}" xmlns:c="https://www.sphinx-doc.org/" xmlns:changeset="https://www.sphinx-doc.org/" xmlns:citation="https://www.sphinx-doc.org/" xmlns:cpp="https://www.sphinx-doc.org/" xmlns:index="https://www.sphinx-doc.org/" xmlns:js="https://www.sphinx-doc.org/" xmlns:math="https://www.sphinx-doc.org/" xmlns:py="https://www.sphinx-doc.org/" xmlns:rst="https://www.sphinx-doc.org/" xmlns:std="https://www.sphinx-doc.org/">
    <target refid="doc-using-voxel-gi"></target>
    <section ids="using-voxel-global-illumination doc-using-voxel-gi" names="using\ voxel\ global\ illumination doc_using_voxel_gi">
        <title>Using Voxel global illumination</title>
        <paragraph>VoxelGI is a form of fully real-time global illumination, intended to be used
            for small/medium-scale 3D scenes. VoxelGI is fairly demanding on the GPU, so
            it's best used when targeting dedicated graphics cards.</paragraph>
        <important>
            <paragraph>VoxelGI is only supported when using the Forward+ renderer, not the Mobile or
                Compatibility renderers.</paragraph>
        </important>
        <seealso>
            <paragraph>Not sure if VoxelGI is suited to your needs?
                See <reference internal="True" refuri="introduction_to_global_illumination#doc-introduction-to-global-illumination-comparison"><inline classes="std std-ref">Which global illumination technique should I use?</inline></reference>
                for a comparison of GI techniques available in Godot 4.</paragraph>
        </seealso>
        <section ids="visual-comparison" names="visual\ comparison">
            <title>Visual comparison</title>
            <figure ids="id1">
                <image alt="VoxelGI disabled." candidates="{'*': 'tutorials/3d/global_illumination/img/gi_none.webp'}" original_uri="img/gi_none.webp" uri="tutorials/3d/global_illumination/img/gi_none.webp"></image>
                <caption>VoxelGI disabled.</caption>
            </figure>
            <figure ids="id2">
                <image alt="VoxelGI enabled." candidates="{'*': 'tutorials/3d/global_illumination/img/gi_voxel_gi.webp'}" original_uri="img/gi_voxel_gi.webp" uri="tutorials/3d/global_illumination/img/gi_voxel_gi.webp"></image>
                <caption>VoxelGI enabled.</caption>
            </figure>
        </section>
        <section ids="setting-up-voxelgi" names="setting\ up\ voxelgi">
            <title>Setting up VoxelGI</title>
            <enumerated_list enumtype="arabic" prefix="" suffix=".">
                <list_item>
                    <paragraph>Make sure your static level geometry is imported with the Light Baking option
                        set to <strong>Static</strong> or <strong>Static Lightmaps</strong> in the Import dock.
                        For manually added MeshInstance3D nodes, make sure the <strong>Global Illumination &gt; Mode</strong>
                        property is set to <strong>Static</strong> in the inspector.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Create a VoxelGI node in the Scene tree dock.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Move the VoxelGI node to the center of the area you want it to cover by
                        dragging the manipulation gizmo in the 3D viewport. Then adjust the VoxelGI's
                        extents by dragging the red points in the 3D viewport (or enter values in the
                        inspector). Make sure the VoxelGI's extents aren't unnecessarily large, or
                        quality will suffer.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Select the VoxelGI node and click <strong>Bake</strong> at the top of the 3D editor viewport.
                        This will take at least a few seconds to complete (depending on the number of VoxelGI
                        subdivisions and scene complexity).</paragraph>
                </list_item>
            </enumerated_list>
            <paragraph>If at least one mesh contained within the VoxelGI's extents has its global
                illumination mode set to <strong>Static</strong>, you should see indirect lighting appear
                within the scene.</paragraph>
            <note>
                <paragraph>To avoid bloating text-based scene files with large amounts of binary data,
                    make sure the VoxelGIData resource is <emphasis>always</emphasis> saved to an external binary file.
                    This file must be saved with a <literal>.res</literal> (binary resource) extension instead of
                    <literal>.tres</literal> (text-based resource).
                    Using an external binary resource for VoxelGIData will keep your text-based
                    scene small while ensuring it loads and saves quickly.</paragraph>
            </note>
        </section>
        <section ids="voxelgi-node-properties" names="voxelgi\ node\ properties">
            <title>VoxelGI node properties</title>
            <paragraph>The following properties can be adjusted in the VoxelGI node inspector before
                baking:</paragraph>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph><strong>Subdiv:</strong> Higher values result in more precise indirect lighting, at the cost
                        of lower performance, longer bake times and increased storage requirements.</paragraph>
                </list_item>
                <list_item>
                    <paragraph><strong>Extents:</strong> Represents the size of the box in which indirect lighting should
                        be baked. Extents are centered around the VoxelGI node's origin.</paragraph>
                </list_item>
            </bullet_list>
            <paragraph>The following properties can be adjusted in the VoxelGIData <emphasis>resource</emphasis> that is
                contained within a VoxelGI node after it has been baked:</paragraph>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph><strong>Dynamic Range:</strong> The maximum brightness that can be represented in indirect lighting.
                        Higher values make it possible to represent brighter indirect light,
                        at the cost of lower precision (which can result in visible banding).
                        If in doubt, leave this unchanged.</paragraph>
                </list_item>
                <list_item>
                    <paragraph><strong>Energy:</strong> The indirect lighting's overall energy. This also effects the energy
                        of direct lighting emitted by meshes with emissive materials.</paragraph>
                </list_item>
                <list_item>
                    <paragraph><strong>Bias:</strong> Optional bias added to lookups into the voxel buffer at runtime.
                        This helps avoid self-occlusion artifacts.</paragraph>
                </list_item>
                <list_item>
                    <paragraph><strong>Normal Bias:</strong> Similar to <strong>Bias</strong>, but offsets the lookup into the voxel buffer
                        by the surface normal. This also helps avoid self-occlusion artifacts. Higher
                        values reduce self-reflections visible in non-rough materials, at the cost of
                        more visible light leaking and flatter-looking indirect lighting. To
                        prioritize hiding self-reflections over lighting quality, set <strong>Bias</strong> to
                        <literal>0.0</literal> and <strong>Normal Bias</strong> to a value between <literal>1.0</literal> and <literal>2.0</literal>.</paragraph>
                </list_item>
                <list_item>
                    <paragraph><strong>Propagation:</strong> The energy factor to use for bounced indirect lighting.
                        Higher values will result in brighter, more diffuse lighting
                        (which may end up looking too flat). When <strong>Use Two Bounces</strong> is enabled,
                        you may want to decrease <strong>Propagation</strong> to compensate for the overall brighter
                        indirect lighting.</paragraph>
                </list_item>
                <list_item>
                    <paragraph><strong>Use Two Bounces:</strong> If enabled, lighting will bounce twice instead of just once.
                        This results in more realistic-looking indirect lighting, and makes indirect lighting
                        visible in reflections as well. Enabling this generally has no noticeable performance cost.</paragraph>
                </list_item>
                <list_item>
                    <paragraph><strong>Interior:</strong> If enabled, environment sky lighting will not be taken into account by VoxelGI.
                        This should be enabled in indoor scenes to avoid light leaking from the environment.</paragraph>
                </list_item>
            </bullet_list>
        </section>
        <section ids="voxelgi-interaction-with-lights-and-objects" names="voxelgi\ interaction\ with\ lights\ and\ objects">
            <title>VoxelGI interaction with lights and objects</title>
            <paragraph>To ensure correct visuals when using VoxelGI, you must configure your meshes
                and lights' global illumination properties according to their <emphasis>purpose</emphasis> in the
                scene (static or dynamic).</paragraph>
            <paragraph>There are 3 global illumination modes available for meshes:</paragraph>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph><strong>Disabled:</strong> The mesh won't be taken into account for VoxelGI baking.
                        The mesh will <emphasis>receive</emphasis> indirect lighting from the scene, but it will not
                        <emphasis>contribute</emphasis> indirect lighting to the scene.</paragraph>
                </list_item>
                <list_item>
                    <paragraph><strong>Static (default):</strong> The mesh will be taken into account for VoxelGI baking. The mesh will
                        both receive <emphasis>and</emphasis> contribute indirect lighting to the scene. If the mesh
                        is changed in any way after baking, the VoxelGI node must be baked again.
                        Otherwise, indirect lighting will look incorrect.</paragraph>
                </list_item>
                <list_item>
                    <paragraph><strong>Dynamic:</strong> The mesh won't be taken into account for VoxelGI baking, but it will
                        still receive <emphasis>and</emphasis> contribute indirect lighting to the scene in real-time.
                        This option is much slower compared to <strong>Static</strong>. Only use the <strong>Dynamic</strong>
                        global illumination mode on large meshes that will change significantly during gameplay.</paragraph>
                </list_item>
            </bullet_list>
            <note>
                <paragraph>For meshes with the <strong>Static</strong> bake mode, the VoxelGI baking system is not able
                    to make use of custom shaders (<reference internal="True" refuri="../../../classes/class_shadermaterial#class-shadermaterial"><inline classes="std std-ref">ShaderMaterial</inline></reference>). These meshes will be
                    considered to be pure black, only acting as light blockers. You can make
                    VoxelGI take custom shaders into account by using the <strong>Dynamic</strong> bake mode
                    for these objects, but this has a performance cost.</paragraph>
                <paragraph>For <reference internal="True" refuri="../../../classes/class_basematerial3d#class-basematerial3d"><inline classes="std std-ref">BaseMaterial3D</inline></reference>, some properties are currently ignored during baking.
                    This can impact visuals if the material's albedo or emission texture was designed
                    around using certain UV mappings:</paragraph>
                <bullet_list bullet="-">
                    <list_item>
                        <paragraph><strong>UV1 &gt; Offset</strong></paragraph>
                    </list_item>
                    <list_item>
                        <paragraph><strong>UV1 &gt; Scale</strong></paragraph>
                    </list_item>
                    <list_item>
                        <paragraph><strong>UV1 &gt; Triplanar</strong></paragraph>
                    </list_item>
                    <list_item>
                        <paragraph><strong>Emission &gt; On UV2</strong></paragraph>
                    </list_item>
                </bullet_list>
            </note>
            <paragraph>Additionally, there are 3 bake modes available for lights
                (DirectionalLight3D, OmniLight3D and SpotLight3D):</paragraph>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph><strong>Disabled:</strong> The light won't be taken into account for VoxelGI baking.
                        The light won't contribute indirect lighting to the scene.</paragraph>
                </list_item>
                <list_item>
                    <paragraph><strong>Static:</strong> The light will be taken into account for VoxelGI baking.
                        The light will contribute indirect lighting to the scene. If the light
                        is changed in any way after baking, the VoxelGI node must be baked again or
                        indirect lighting will look incorrect. If in doubt, use this mode for level lighting.</paragraph>
                </list_item>
                <list_item>
                    <paragraph><strong>Dynamic (default):</strong> The light won't be taken into account for VoxelGI baking,
                        but it will still contribute indirect lighting to the scene in real-time.
                        This option is slower compared to <strong>Static</strong>. Only use the <strong>Dynamic</strong> global
                        illumination mode on lights that will change significantly during gameplay.</paragraph>
                </list_item>
            </bullet_list>
            <note>
                <paragraph>The amount of indirect energy emitted by a light depends on its color,
                    energy <emphasis>and</emphasis> indirect energy properties. To make a specific light emit more
                    or less indirect energy without affecting the amount of direct light emitted
                    by the light, adjust the <strong>Indirect Energy</strong> property in the Light3D inspector.</paragraph>
            </note>
            <seealso>
                <paragraph>See <reference internal="True" refuri="introduction_to_global_illumination#doc-introduction-to-global-illumination-gi-mode-recommendations"><inline classes="std std-ref">Which global illumination mode should I use on meshes and lights?</inline></reference>
                    for general usage recommendations.</paragraph>
            </seealso>
        </section>
        <section ids="adjusting-voxelgi-performance-and-quality" names="adjusting\ voxelgi\ performance\ and\ quality">
            <title>Adjusting VoxelGI performance and quality</title>
            <paragraph>Since VoxelGI is relatively demanding, it will perform best on systems with recent
                dedicated GPUs. On older dedicated GPUs and integrated graphics,
                tweaking the settings is necessary to achieve reasonable performance.</paragraph>
            <paragraph>In the Project Settings' <strong>Rendering &gt; Global Illumination</strong> section,
                VoxelGI quality can also be adjusted in two ways:</paragraph>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph><strong>Voxel Gi &gt; Quality:</strong> If set to <strong>Low</strong>
                        instead of <strong>High</strong>, voxel cone tracing will only use 4 taps instead of 6.
                        This speeds up rendering at the cost of less pronounced ambient occlusion.</paragraph>
                </list_item>
                <list_item>
                    <paragraph><strong>Gi &gt; Use Half Resolution:</strong> If enabled, both VoxelGI and SDFGI will have
                        their GI buffer rendering at halved resolution. For instance, when rendering
                        in 3840×2160, the GI buffer will be computed at a 1920×1080 resolution.
                        Enabling this option saves a lot of GPU time, but it can introduce visible
                        aliasing around thin details.</paragraph>
                </list_item>
            </bullet_list>
            <paragraph>Note that the <strong>Advanced</strong> toggle must be enabled in the project settings dialog
                for the above settings to be visible.</paragraph>
            <paragraph>Additionally, VoxelGI can be disabled entirely by hiding the VoxelGI node.
                This can be used for comparison purposes or to improve performance on low-end systems.</paragraph>
        </section>
        <section ids="reducing-voxelgi-light-leaks-and-artifacts" names="reducing\ voxelgi\ light\ leaks\ and\ artifacts">
            <title>Reducing VoxelGI light leaks and artifacts</title>
            <paragraph>After baking VoxelGI, you may notice indirect light is leaking at some spots
                in your level geometry. This can be remedied in several ways:</paragraph>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph>For both light leaking and artifacts, try moving or rotating the VoxelGI node
                        then bake it again.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>To combat light leaking in general, ensure your level geometry is fully sealed.
                        This is best done in the 3D modeling software used to design the level,
                        but primitive MeshInstance3D nodes with their global illumination mode set to
                        <strong>Static</strong> can also be used.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>To combat light leaking with thin geometry, it's recommended to make the geometry
                        in question thicker. If this is not possible, then add a primitive MeshInstance3D
                        node with its global illumination mode set to <strong>Static</strong>. Bake VoxelGI again,
                        then hide the primitive MeshInstance3D node (it will still be taken into account by VoxelGI).
                        For optimal results, the MeshInstance3D should have a material whose color
                        matches the original thin geometry.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>To combat artifacts that can appear on reflective surfaces, try increasing
                        <strong>Bias</strong> and/or <strong>Normal Bias</strong> in the VoxelGIData resource as described above.
                        Do not increase these values too high, or light leaking will become more pronounced.</paragraph>
                </list_item>
            </bullet_list>
            <paragraph>If you notice VoxelGI nodes popping in and out of existence as the camera moves,
                this is most likely because the engine is rendering too many VoxelGI instances
                at once. Godot is limited to rendering 8 VoxelGI nodes at once, which means up
                to 8 instances can be in the camera view before some of them will start
                flickering.</paragraph>
            <paragraph>Additionally, for performance reasons, Godot can only blend between 2 VoxelGI
                nodes at a given pixel on the screen. If you have more than 2 VoxelGI nodes
                overlapping, global illumination may appear to flicker as the camera moves or
                rotates.</paragraph>
            <substitution_definition names="weblate_widget"><reference refuri="https://hosted.weblate.org/engage/godot-engine/?utm_source=widget"><image alt="Translation status" candidates="{'?': 'https://hosted.weblate.org/widgets/godot-engine/-/godot-docs/287x66-white.png'}" height="66" uri="https://hosted.weblate.org/widgets/godot-engine/-/godot-docs/287x66-white.png" width="287"></image></reference></substitution_definition>
        </section>
    </section>
</document>
