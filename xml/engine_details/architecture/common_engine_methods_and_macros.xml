<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.21.2 -->
<document source="/home/runner/work/godot-docs-cn/godot-docs-cn/godot-docs/docs/engine_details/architecture/common_engine_methods_and_macros.rst" translation_progress="{'total': 0, 'translated': 0}" xmlns:c="https://www.sphinx-doc.org/" xmlns:changeset="https://www.sphinx-doc.org/" xmlns:citation="https://www.sphinx-doc.org/" xmlns:cpp="https://www.sphinx-doc.org/" xmlns:index="https://www.sphinx-doc.org/" xmlns:js="https://www.sphinx-doc.org/" xmlns:math="https://www.sphinx-doc.org/" xmlns:py="https://www.sphinx-doc.org/" xmlns:rst="https://www.sphinx-doc.org/" xmlns:std="https://www.sphinx-doc.org/">
    <target refid="doc-common-engine-methods-and-macros"></target>
    <section ids="common-engine-methods-and-macros doc-common-engine-methods-and-macros" names="common\ engine\ methods\ and\ macros doc_common_engine_methods_and_macros">
        <title>Common engine methods and macros</title>
        <paragraph>Godot's C++ codebase makes use of dozens of custom methods and macros which are
            used in almost every file. This page is geared towards beginner contributors,
            but it can also be useful for those writing custom C++ modules.</paragraph>
        <section ids="print-text" names="print\ text">
            <title>Print text</title>
            <literal_block force="False" highlight_args="{}" language="cpp" linenos="False" xml:space="preserve">// Prints a message to standard output.
print_line("Message");

// Non-String arguments are automatically converted to String for printing.
// If passing several arguments, they will be concatenated together with a
// space between each argument.
print_line("There are", 123, "nodes");

// Prints a message to standard output, but only when the engine
// is started with the `--verbose` command line argument.
print_verbose("Message");

// Prints a rich-formatted message using BBCode to standard output.
// This supports a subset of BBCode tags supported by RichTextLabel
// and will also appear formatted in the editor Output panel.
// On Windows, this requires Windows 10 or later to work in the terminal.
print_line_rich("[b]Bold[/b], [color=red]Red text[/color]")

// Prints a formatted error or warning message with a trace.
ERR_PRINT("Message");
WARN_PRINT("Message");

// Prints an error or warning message only once per session.
// This can be used to avoid spamming the console output.
ERR_PRINT_ONCE("Message");
WARN_PRINT_ONCE("Message");</literal_block>
            <paragraph>If you need to add placeholders in your messages, use format strings as
                described below.</paragraph>
        </section>
        <section ids="format-a-string" names="format\ a\ string">
            <title>Format a string</title>
            <paragraph>The <literal>vformat()</literal> function returns a formatted <reference internal="True" refuri="../../classes/class_string#class-string"><inline classes="std std-ref">String</inline></reference>. It behaves
                in a way similar to C's <literal>sprintf()</literal>:</paragraph>
            <literal_block force="False" highlight_args="{}" language="cpp" linenos="False" xml:space="preserve">vformat("My name is %s.", "Godette");
vformat("%d bugs on the wall!", 1234);
vformat("Pi is approximately %f.", 3.1416);

// Converts the resulting String into a `const char *`.
// You may need to do this if passing the result as an argument
// to a method that expects a `const char *` instead of a String.
vformat("My name is %s.", "Godette").utf8().get_data();</literal_block>
            <paragraph>In most cases, try to use <literal>vformat()</literal> instead of string concatenation as it
                makes for more readable code.</paragraph>
        </section>
        <section ids="convert-an-integer-or-float-to-a-string" names="convert\ an\ integer\ or\ float\ to\ a\ string">
            <title>Convert an integer or float to a string</title>
            <paragraph>This is not needed when printing numbers using <literal>print_line()</literal>, but you may
                still need to perform manual conversion for some other use cases.</paragraph>
            <literal_block force="False" highlight_args="{}" language="cpp" linenos="False" xml:space="preserve">// Stores the string "42" using integer-to-string conversion.
String int_to_string = itos(42);

// Stores the string "123.45" using real-to-string conversion.
String real_to_string = rtos(123.45);</literal_block>
        </section>
        <section ids="internationalize-a-string" names="internationalize\ a\ string">
            <title>Internationalize a string</title>
            <paragraph>There are two types of internationalization in Godot's codebase:</paragraph>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph><literal>TTR()</literal>: <strong>Editor ("tools") translations</strong> will only be processed in the
                        editor. If a user uses the same text in one of their projects, it won't be
                        translated if they provide a translation for it. When contributing to the
                        engine, this is generally the macro you should use for localizable strings.</paragraph>
                </list_item>
                <list_item>
                    <paragraph><literal>RTR()</literal>: <strong>Runtime translations</strong> will be automatically localized in
                        projects if they provide a translation for the given string. This kind of
                        translation shouldn't be used in editor-only code.</paragraph>
                </list_item>
            </bullet_list>
            <literal_block force="False" highlight_args="{}" language="cpp" linenos="False" xml:space="preserve">// Returns the translated string that matches the user's locale settings.
// Translations are located in `editor/translations`.
// The localization template is generated automatically; don't modify it.
TTR("Exit the editor?");</literal_block>
            <paragraph>To insert placeholders in localizable strings, wrap the localization macro in a
                <literal>vformat()</literal> call as follows:</paragraph>
            <literal_block force="False" highlight_args="{}" language="cpp" linenos="False" xml:space="preserve">String file_path = "example.txt";
vformat(TTR("Couldn't open \"%s\" for reading."), file_path);</literal_block>
            <note>
                <paragraph>When using <literal>vformat()</literal> and a translation macro together, always wrap the
                    translation macro in <literal>vformat()</literal>, not the other way around. Otherwise, the
                    string will never match the translation as it will have the placeholder
                    already replaced when it's passed to TranslationServer.</paragraph>
            </note>
        </section>
        <section ids="clamp-a-value" names="clamp\ a\ value">
            <title>Clamp a value</title>
            <paragraph>Godot provides macros for clamping a value with a lower bound (<literal>MAX</literal>), an
                upper bound (<literal>MIN</literal>) or both (<literal>CLAMP</literal>):</paragraph>
            <literal_block force="False" highlight_args="{}" language="cpp" linenos="False" xml:space="preserve">int a = 3;
int b = 5;

MAX(b, 6); // 6
MIN(2, a); // 2
CLAMP(a, 10, 30); // 10</literal_block>
            <paragraph>This works with any type that can be compared to other values (like <literal>int</literal> and
                <literal>float</literal>).</paragraph>
        </section>
        <section ids="microbenchmarking" names="microbenchmarking">
            <title>Microbenchmarking</title>
            <paragraph>If you want to benchmark a piece of code but don't know how to use a profiler,
                use this snippet:</paragraph>
            <literal_block force="False" highlight_args="{}" language="cpp" linenos="False" xml:space="preserve">uint64_t begin = Time::get_singleton()-&gt;get_ticks_usec();

// Your code here...

uint64_t end = Time::get_singleton()-&gt;get_ticks_usec();
print_line(vformat("Snippet took %d microseconds", end - begin));</literal_block>
            <paragraph>This will print the time spent between the <literal>begin</literal> declaration and the <literal>end</literal>
                declaration.</paragraph>
            <note>
                <paragraph>You may have to <literal>#include "core/os/time.h"</literal> if it's not present already.</paragraph>
                <paragraph>When opening a pull request, make sure to remove this snippet as well as the
                    include if it wasn't there previously.</paragraph>
            </note>
        </section>
        <section ids="get-project-editor-settings" names="get\ project/editor\ settings">
            <title>Get project/editor settings</title>
            <paragraph>There are four macros available for this:</paragraph>
            <literal_block force="False" highlight_args="{}" language="cpp" linenos="False" xml:space="preserve">// Returns the specified project setting's value,
// defaulting to `false` if it doesn't exist.
GLOBAL_DEF("section/subsection/value", false);

// Returns the specified editor setting's value,
// defaulting to "Untitled" if it doesn't exist.
EDITOR_DEF("section/subsection/value", "Untitled");</literal_block>
            <paragraph>If a default value has been specified elsewhere, don't specify it again to avoid
                repetition:</paragraph>
            <literal_block force="False" highlight_args="{}" language="cpp" linenos="False" xml:space="preserve">// Returns the value of the project setting.
GLOBAL_GET("section/subsection/value");
// Returns the value of the editor setting.
EDITOR_GET("section/subsection/value");</literal_block>
            <paragraph>It's recommended to use <literal>GLOBAL_DEF</literal>/<literal>EDITOR_DEF</literal> only once per setting and
                use <literal>GLOBAL_GET</literal>/<literal>EDITOR_GET</literal> in all other places where it's referenced.</paragraph>
            <target refid="doc-common-engine-methods-and-macros-error-macros"></target>
        </section>
        <section ids="error-macros doc-common-engine-methods-and-macros-error-macros" names="error\ macros doc_common_engine_methods_and_macros_error_macros">
            <title>Error macros</title>
            <paragraph>Godot features many error macros to make error reporting more convenient.</paragraph>
            <warning>
                <paragraph>Conditions in error macros work in the <strong>opposite</strong> way of GDScript's
                    built-in <literal>assert()</literal> function. An error is reached if the condition inside
                    evaluates to <literal>true</literal>, not <literal>false</literal>.</paragraph>
            </warning>
            <note>
                <paragraph>Only variants with custom messages are documented here, as these should
                    always be used in new contributions. Make sure the custom message provided
                    includes enough information for people to diagnose the issue, even if they
                    don't know C++. In case a method was passed invalid arguments, you can print
                    the invalid value in question to ease debugging.</paragraph>
                <paragraph>For internal error checking where displaying a human-readable message isn't
                    necessary, remove <literal>_MSG</literal> at the end of the macro name and don't supply a
                    message argument.</paragraph>
                <paragraph>Also, always try to return processable data so the engine can keep running
                    well.</paragraph>
            </note>
            <literal_block force="False" highlight_args="{}" language="cpp" linenos="False" xml:space="preserve">// Conditionally prints an error message and returns from the function.
// Use this in methods which don't return a value.
ERR_FAIL_COND_MSG(!mesh.is_valid(), vformat("Couldn't load mesh at: %s", path));

// Conditionally prints an error message and returns `0` from the function.
// Use this in methods which must return a value.
ERR_FAIL_COND_V_MSG(rect.x &lt; 0 || rect.y &lt; 0, 0,
        "Couldn't calculate the rectangle's area.");

// Prints an error message if `index` is &lt; 0 or &gt;= `SomeEnum::QUALITY_MAX`,
// then returns from the function.
ERR_FAIL_INDEX_MSG(index, SomeEnum::QUALITY_MAX,
        vformat("Invalid quality: %d. See SomeEnum for allowed values.", index));

// Prints an error message if `index` is &lt; 0 &gt;= `some_array.size()`,
// then returns `-1` from the function.
ERR_FAIL_INDEX_V_MSG(index, some_array.size(), -1,
        vformat("Item %d is out of bounds.", index));

// Unconditionally prints an error message and returns from the function.
// Only use this if you need to perform complex error checking.
if (!complex_error_checking_routine()) {
    ERR_FAIL_MSG("Couldn't reload the filesystem cache.");
}

// Unconditionally prints an error message and returns `false` from the function.
// Only use this if you need to perform complex error checking.
if (!complex_error_checking_routine()) {
    ERR_FAIL_V_MSG(false, "Couldn't parse the input arguments.");
}

// Crashes the engine. This should generally never be used
// except for testing crash handling code. Godot's philosophy
// is to never crash, both in the editor and in exported projects.
CRASH_NOW_MSG("Can't predict the future! Aborting.");</literal_block>
            <seealso>
                <paragraph>See <reference name="core/error/error_macros.h" refuri="https://github.com/godotengine/godot/blob/master/core/error/error_macros.h">core/error/error_macros.h</reference>
                    in Godot's codebase for more information about each error macro.</paragraph>
                <paragraph>Some functions return an error code (materialized by a return type of
                    <literal>Error</literal>). This value can be returned directly from an error macro.
                    See the list of available error codes in
                    <reference name="core/error/error_list.h" refuri="https://github.com/godotengine/godot/blob/master/core/error/error_list.h">core/error/error_list.h</reference>.</paragraph>
            </seealso>
            <substitution_definition names="weblate_widget"><reference refuri="https://hosted.weblate.org/engage/godot-engine/?utm_source=widget"><image alt="Translation status" candidates="{'?': 'https://hosted.weblate.org/widgets/godot-engine/-/godot-docs/287x66-white.png'}" height="66" uri="https://hosted.weblate.org/widgets/godot-engine/-/godot-docs/287x66-white.png" width="287"></image></reference></substitution_definition>
        </section>
    </section>
</document>
