<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.21.2 -->
<document source="/home/runner/work/godot-docs-cn/godot-docs-cn/godot-docs/docs/engine_details/development/debugging/profiling/tracing_profilers.rst" translation_progress="{'total': 0, 'translated': 0}" xmlns:c="https://www.sphinx-doc.org/" xmlns:changeset="https://www.sphinx-doc.org/" xmlns:citation="https://www.sphinx-doc.org/" xmlns:cpp="https://www.sphinx-doc.org/" xmlns:index="https://www.sphinx-doc.org/" xmlns:js="https://www.sphinx-doc.org/" xmlns:math="https://www.sphinx-doc.org/" xmlns:py="https://www.sphinx-doc.org/" xmlns:rst="https://www.sphinx-doc.org/" xmlns:std="https://www.sphinx-doc.org/">
    <target refid="doc-tracing-profilers"></target>
    <section ids="tracing-profilers doc-tracing-profilers" names="tracing\ profilers doc_tracing_profilers">
        <title>Tracing Profilers</title>
        <paragraph>Godot currently supports two tracing profilers:
            <reference name="Tracy" refuri="https://github.com/wolfpld/tracy">Tracy</reference> and <reference name="Perfetto" refuri="https://perfetto.dev">Perfetto</reference>.</paragraph>
        <paragraph>In order to use either of them, you'll need to build the engine from source.
            If you've never done this before, please read
            <reference internal="True" refuri="../../compiling/index#doc-compiling-index"><inline classes="std std-ref">these docs</inline></reference> for the platform you want to profile on.
            You'll need to perform the same steps here, but with some additional arguments
            for <literal>scons</literal>.</paragraph>
        <target refid="doc-tracy-profiler"></target>
        <section ids="tracy-for-windows-linux-and-macos doc-tracy-profiler" names="tracy\ for\ windows,\ linux,\ and\ macos doc_tracy_profiler">
            <title>Tracy for Windows, Linux, and macOS</title>
            <paragraph>Tracy is an Open Source profiler that runs on a wide variety of platforms,
                including Windows, Linux, and macOS. While it is primarily a tracing profiler,
                it can also periodically sample data like a
                <reference internal="True" refuri="sampling_profilers#doc-sampling-profilers"><inline classes="std std-ref">sampling profiler</inline></reference>, giving some of the benefits
                of both approaches.</paragraph>
            <section ids="build-godot-with-tracy-support" names="build\ godot\ with\ tracy\ support">
                <title>Build Godot with Tracy support</title>
                <paragraph>First, clone the latest version of the Tracy source code ("0.13.0" at the
                    time of writing) using Git:</paragraph>
                <literal_block force="False" highlight_args="{}" language="shell" linenos="False" xml:space="preserve">git clone -b v0.13.0 --single-branch https://github.com/wolfpld/tracy.git</literal_block>
                <paragraph>This will create a <literal>tracy</literal> directory - you can place this anywhere.</paragraph>
                <paragraph>Next, build the release templates for your platform using <literal>scons</literal>, but adding
                    the <literal>profiler=tracy profiler_path=path/to/tracy</literal> arguments with the real path
                    to the <literal>tracy</literal> directory, as well as <literal>debug_symbols=yes</literal> to allow Tracy's
                    sampling features to work.</paragraph>
                <note>
                    <paragraph>You don't have to build release templates, you could also build debug
                        templates, or even the editor. However, it's generally recommended to
                        profile release templates, because that is the version your players will
                        use, and it will perform differently than other types of builds.</paragraph>
                </note>
                <paragraph>For example, to build release templates for Windows:</paragraph>
                <literal_block force="False" highlight_args="{}" language="shell" linenos="False" xml:space="preserve">scons platform=windows target=template_release debug_symbols=yes profiler=tracy profiler_path=path/to/tracy</literal_block>
            </section>
            <section ids="get-the-tracy-server" names='get\ the\ tracy\ "server"'>
                <title>Get the Tracy "server"</title>
                <paragraph>In Tracy terminology, the application you are profiling is the "client", and
                    the one receiving the data is the "server".</paragraph>
                <paragraph>If you are on Windows, you can download a pre-built <literal>tracy-profiler.exe</literal>
                    from the Tracy <reference name="releases page" refuri="https://github.com/wolfpld/tracy/releases">releases page</reference><target ids="releases-page" names="releases\ page" refuri="https://github.com/wolfpld/tracy/releases"></target>.</paragraph>
                <paragraph>However, if you're on Linux or macOS, you'll either need to find a pre-built
                    binary from a package manager (like <literal>brew</literal> or <literal>nix</literal>), or build it from
                    source yourself.</paragraph>
                <note>
                    <paragraph>If you do use a pre-built binary, be sure to use the same version that
                        you used when building Godot.</paragraph>
                </note>
                <section ids="build-the-tracy-server-from-source" names="build\ the\ tracy\ server\ from\ source">
                    <title>Build the Tracy server from source</title>
                    <paragraph>In order to build Tracy, you'll need to install <literal>cmake</literal>, which can be
                        downloaded from the <reference name="CMake website" refuri="https://cmake.org/download/">CMake website</reference><target ids="cmake-website" names="cmake\ website" refuri="https://cmake.org/download/"></target>, or
                        possibly installed via a package manager (like <literal>brew</literal> or <literal>nix</literal>).</paragraph>
                    <paragraph>The full instructions for building Tracy from source can be found in the
                        <reference name="Tracy manual" refuri="https://github.com/wolfpld/tracy/releases/latest/download/tracy.pdf">Tracy manual</reference><target ids="tracy-manual" names="tracy\ manual" refuri="https://github.com/wolfpld/tracy/releases/latest/download/tracy.pdf"></target>,
                        but here is the TL;DR:</paragraph>
                    <literal_block force="False" highlight_args="{}" language="shell" linenos="False" xml:space="preserve"># On Linux, Tracy uses Wayland by default, so if you use X11 add -DLEGACY=1
cmake -B profiler/build -S profiler -DCMAKE_BUILD_TYPE=Release
cmake --build profiler/build --config Release --parallel</literal_block>
                    <paragraph>This will place the binary at <literal>tracy/profiler/build/tracy-profiler</literal> or
                        <literal>tracy/profiler/build/tracy-profiler.exe</literal> (on Windows).</paragraph>
                </section>
            </section>
            <section dupnames="record\ a\ trace" ids="record-a-trace">
                <title>Record a trace</title>
                <paragraph>Launch the Tracy server - you'll see something like this:</paragraph>
                <image candidates="{'*': 'engine_details/development/debugging/profiling/img/cpp_profiler_tracy_start.webp'}" original_uri="img/cpp_profiler_tracy_start.webp" uri="engine_details/development/debugging/profiling/img/cpp_profiler_tracy_start.webp"></image>
                <paragraph>Press "connect". This will ensure tracy makes a connection immediately when
                    the game launches. If you forget to press "connect", Tracy will store system
                    events in RAM, which can quickly blow up your memory usage (see the
                    <literal>TRACY_ON_DEMAND</literal> documentation).</paragraph>
                <paragraph>Now, export your game using the release templates you built above, and run it.
                    As soon as both are running, and you have pressed the "Connect" button in
                    Tracy, you'll see data coming in:</paragraph>
                <image candidates="{'*': 'engine_details/development/debugging/profiling/img/cpp_profiler_tracy_recording.webp'}" original_uri="img/cpp_profiler_tracy_recording.webp" uri="engine_details/development/debugging/profiling/img/cpp_profiler_tracy_recording.webp"></image>
                <paragraph>When you think you've gathered enough data, press the "Stop" button. If you
                    clicked somewhere and the box with the "Stop" button disappeared, you can
                    click the top-left most icon to bring it back.</paragraph>
            </section>
            <section dupnames="examining\ the\ trace" ids="examining-the-trace">
                <title>Examining the trace</title>
                <paragraph>Here are some of the basic controls:</paragraph>
                <bullet_list bullet="-">
                    <list_item>
                        <paragraph>Zoom in/out with the mouse wheel</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>Right click and drag to move forward/backward on the timeline</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>In the top bar, click the left and right arrow buttons by "Frames" to move a single frame on the timeline</paragraph>
                    </list_item>
                </bullet_list>
                <paragraph>To learn more, see the
                    <reference name="Tracy manual" refuri="https://github.com/wolfpld/tracy/releases/latest/download/tracy.pdf">Tracy manual</reference><target dupnames="tracy\ manual" ids="id1" refuri="https://github.com/wolfpld/tracy/releases/latest/download/tracy.pdf"></target>.</paragraph>
            </section>
        </section>
        <section ids="perfetto-for-android" names="perfetto\ for\ android">
            <title>Perfetto for Android</title>
            <paragraph>Perfetto is the default tracing system for Android. In fact, its system tracing
                service has been built into the platform since Android 9.</paragraph>
            <section ids="build-godot-with-perfetto-support" names="build\ godot\ with\ perfetto\ support">
                <title>Build Godot with Perfetto support</title>
                <paragraph>First, clone the latest version of the Perfetto source code ("53.0" at the
                    time of writing) using Git:</paragraph>
                <literal_block force="False" highlight_args="{}" language="shell" linenos="False" xml:space="preserve">git clone -b v53.0 --single-branch https://github.com/google/perfetto.git</literal_block>
                <paragraph>This will create a <literal>perfetto</literal> directory - you can place this anywhere.</paragraph>
                <paragraph>Next, build the Android debug or release templates for your architecture using
                    <literal>scons</literal> (per <reference internal="True" refuri="../../compiling/compiling_for_android#doc-compiling-for-android"><inline classes="std std-ref">Compiling for Android</inline></reference>), but
                    adding the <literal>profiler=perfetto profiler_path=path/to/perfetto</literal> arguments with
                    the real path to the <literal>perfetto</literal> directory.</paragraph>
                <note>
                    <paragraph>It's generally recommended to profile release templates, because that is
                        the version your players will use, and it will perform differently than
                        other types of builds. However, in the case of Android, it can sometimes
                        be useful to use debug templates, because Godot can only do remote
                        debugging of games exported from debug templates.</paragraph>
                </note>
                <paragraph>For example, to build the release templates for arm64:</paragraph>
                <literal_block force="False" highlight_args="{}" language="shell" linenos="False" xml:space="preserve">scons platform=android target=template_release arch=arm64 generate_android_binaries=yes profiler=perfetto profiler_path=path/to/perfetto</literal_block>
            </section>
            <section ids="configuration" names="configuration">
                <title>Configuration</title>
                <paragraph>Perfetto requires a configuration file to tell it which events to track.</paragraph>
                <paragraph>Create a file called <literal>godot.config</literal> inside of the <literal>perfetto</literal> directory
                    with this content:</paragraph>
                <literal_block force="False" highlight_args="{}" language="text" linenos="False" xml:space="preserve"># Trace for 10 seconds.
duration_ms: 10000

buffers {
    size_kb: 32768
    fill_policy: RING_BUFFER
}

# Write to file once every second to prevent overflowing the buffer.
write_into_file: true
file_write_period_ms: 1000

# Track events in the "godot" category.
data_sources {
    config {
        name: "track_event"
        track_event_config {
            enabled_categories: "godot"
        }
    }
}</literal_block>
            </section>
            <section dupnames="record\ a\ trace" ids="id2">
                <title>Record a trace</title>
                <paragraph>Finally, launch your game on an Android device using the export templates you
                    built earlier.</paragraph>
                <paragraph>When you're ready to record a trace (for example, when you've hit the part of
                    your game that is exhibiting performance issues), you can use this script that
                    comes with the Perfetto source code:</paragraph>
                <literal_block force="False" highlight_args="{}" language="shell" linenos="False" xml:space="preserve">cd perfetto
./tools/record_android_trace -c godot.config</literal_block>
                <paragraph>This will record for 10 seconds (per the configuration), or until you press
                    <literal classes="kbd">Ctrl + C</literal>.</paragraph>
            </section>
            <section dupnames="examining\ the\ trace" ids="id3">
                <title>Examining the trace</title>
                <paragraph>As soon as that script exits, it will launch the Perfetto UI in a web browser.</paragraph>
                <paragraph>To see the Godot events, expand the row for your application by clicking on its
                    Android "Unique Name" (Perfetto will also include some events from system
                    services in the trace).</paragraph>
                <image candidates="{'*': 'engine_details/development/debugging/profiling/img/cpp_profiler_perfetto.webp'}" original_uri="img/cpp_profiler_perfetto.webp" uri="engine_details/development/debugging/profiling/img/cpp_profiler_perfetto.webp"></image>
                <paragraph>Then you can use the <literal>WASD</literal> keys to navigate the graph:</paragraph>
                <bullet_list bullet="-">
                    <list_item>
                        <paragraph>Press <literal classes="kbd">A</literal> or <literal classes="kbd">D</literal> to navigate forward or backward along the timeline</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>Press <literal classes="kbd">W</literal> or <literal classes="kbd">S</literal> to zoom in or out</paragraph>
                    </list_item>
                </bullet_list>
                <paragraph>You'll probably need to zoom a bit before you're able to see the individual
                    events from Godot.</paragraph>
                <paragraph>To learn more, see the
                    <reference name="Perfetto UI documentation" refuri="https://perfetto.dev/docs/visualization/perfetto-ui">Perfetto UI documentation</reference><target ids="perfetto-ui-documentation" names="perfetto\ ui\ documentation" refuri="https://perfetto.dev/docs/visualization/perfetto-ui"></target>.</paragraph>
                <substitution_definition names="weblate_widget"><reference refuri="https://hosted.weblate.org/engage/godot-engine/?utm_source=widget"><image alt="Translation status" candidates="{'?': 'https://hosted.weblate.org/widgets/godot-engine/-/godot-docs/287x66-white.png'}" height="66" uri="https://hosted.weblate.org/widgets/godot-engine/-/godot-docs/287x66-white.png" width="287"></image></reference></substitution_definition>
            </section>
        </section>
    </section>
</document>
