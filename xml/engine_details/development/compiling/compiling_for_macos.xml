<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.21.2 -->
<document source="/home/runner/work/godot-docs-cn/godot-docs-cn/godot-docs/docs/engine_details/development/compiling/compiling_for_macos.rst" translation_progress="{'total': 0, 'translated': 0}" xmlns:c="https://www.sphinx-doc.org/" xmlns:changeset="https://www.sphinx-doc.org/" xmlns:citation="https://www.sphinx-doc.org/" xmlns:cpp="https://www.sphinx-doc.org/" xmlns:index="https://www.sphinx-doc.org/" xmlns:js="https://www.sphinx-doc.org/" xmlns:math="https://www.sphinx-doc.org/" xmlns:py="https://www.sphinx-doc.org/" xmlns:rst="https://www.sphinx-doc.org/" xmlns:std="https://www.sphinx-doc.org/">
    <target refid="doc-compiling-for-macos"></target>
    <section ids="compiling-for-macos doc-compiling-for-macos" names="compiling\ for\ macos doc_compiling_for_macos">
        <title>Compiling for macOS</title>
        <note>
            <paragraph>This page describes how to compile macOS editor and export template binaries from source.
                If you're looking to export your project to macOS instead, read <reference internal="True" refuri="../../../tutorials/export/exporting_for_macos#doc-exporting-for-macos"><inline classes="std std-ref">Exporting for macOS</inline></reference>.</paragraph>
        </note>
        <section ids="requirements" names="requirements">
            <title>Requirements</title>
            <paragraph>For compiling under macOS, the following is required:</paragraph>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph><reference name="Python 3.8+" refuri="https://www.python.org/downloads/macos/">Python 3.8+</reference><target ids="python-3-8" names="python\ 3.8+" refuri="https://www.python.org/downloads/macos/"></target>.</paragraph>
                </list_item>
                <list_item>
                    <paragraph><reference name="SCons 4.0+" refuri="https://scons.org/pages/download.html">SCons 4.0+</reference><target ids="scons-4-0" names="scons\ 4.0+" refuri="https://scons.org/pages/download.html"></target> build system.</paragraph>
                </list_item>
                <list_item>
                    <paragraph><reference name="Xcode" refuri="https://apps.apple.com/us/app/xcode/id497799835">Xcode</reference><target ids="xcode" names="xcode" refuri="https://apps.apple.com/us/app/xcode/id497799835"></target>
                        (or the more lightweight Command Line Tools for Xcode).</paragraph>
                </list_item>
                <list_item>
                    <paragraph><reference name="Vulkan SDK" refuri="https://sdk.lunarg.com/sdk/download/latest/mac/vulkan-sdk.dmg">Vulkan SDK</reference><target ids="vulkan-sdk" names="vulkan\ sdk" refuri="https://sdk.lunarg.com/sdk/download/latest/mac/vulkan-sdk.dmg"></target>
                        for MoltenVK (macOS doesn't support Vulkan out of the box).
                        The latest Vulkan SDK version can be installed quickly by running
                        <literal>misc/scripts/install_vulkan_sdk_macos.sh</literal> within the Godot source repository.</paragraph>
                </list_item>
            </bullet_list>
            <note>
                <paragraph>If you have <reference name="Homebrew" refuri="https://brew.sh/">Homebrew</reference><target ids="homebrew" names="homebrew" refuri="https://brew.sh/"></target> installed, you can easily
                    install SCons using the following command:</paragraph>
                <literal_block force="False" language="shell" linenos="False" xml:space="preserve">brew install scons</literal_block>
                <paragraph>Installing Homebrew will also fetch the Command Line Tools
                    for Xcode automatically if you don't have them already.</paragraph>
                <paragraph>Similarly, if you have <reference name="MacPorts" refuri="https://www.macports.org/">MacPorts</reference><target ids="macports" names="macports" refuri="https://www.macports.org/"></target>
                    installed, you can easily install SCons using the
                    following command:</paragraph>
                <literal_block force="False" language="shell" linenos="False" xml:space="preserve">sudo port install scons</literal_block>
            </note>
            <seealso>
                <paragraph>To get the Godot source code for compiling, see
                    <reference internal="True" refuri="getting_source#doc-getting-source"><inline classes="std std-ref">Getting the source</inline></reference>.</paragraph>
                <paragraph>For a general overview of SCons usage for Godot, see
                    <reference internal="True" refuri="introduction_to_the_buildsystem#doc-introduction-to-the-buildsystem"><inline classes="std std-ref">Introduction to the buildsystem</inline></reference>.</paragraph>
            </seealso>
        </section>
        <section ids="compiling" names="compiling">
            <title>Compiling</title>
            <paragraph>Start a terminal, go to the root directory of the engine source code.</paragraph>
            <paragraph>To compile for Intel (x86-64) powered Macs, use:</paragraph>
            <literal_block force="False" language="shell" linenos="False" xml:space="preserve">scons platform=macos arch=x86_64</literal_block>
            <paragraph>To compile for Apple Silicon (ARM64) powered Macs, use:</paragraph>
            <literal_block force="False" language="shell" linenos="False" xml:space="preserve">scons platform=macos arch=arm64</literal_block>
            <tip>
                <paragraph>If you are compiling Godot to make changes or contribute to the engine,
                    you may want to use the SCons options <literal>dev_build=yes</literal> or <literal>dev_mode=yes</literal>.
                    See <reference internal="True" refuri="introduction_to_the_buildsystem#doc-introduction-to-the-buildsystem-development-and-production-aliases"><inline classes="std std-ref">Development and production aliases</inline></reference>
                    for more info.</paragraph>
            </tip>
            <paragraph>If all goes well, the resulting binary executable will be placed in the
                <literal>bin/</literal> subdirectory. This executable file contains the whole engine and
                runs without any dependencies. Executing it will bring up the Project
                Manager.</paragraph>
            <note>
                <paragraph>Using a standalone editor executable is not recommended, it should be always packaged into a
                    <literal>.app</literal> bundle to avoid UI activation issues.</paragraph>
            </note>
            <note>
                <paragraph>If you want to use separate editor settings for your own Godot builds
                    and official releases, you can enable
                    <reference internal="True" refuri="../../../tutorials/io/data_paths#doc-data-paths-self-contained-mode"><inline classes="std std-ref">Self-contained mode</inline></reference> by creating a file called
                    <literal>._sc_</literal> or <literal>_sc_</literal> in the <literal>bin/</literal> folder.</paragraph>
            </note>
        </section>
        <section ids="compiling-with-accesskit-support" names="compiling\ with\ accesskit\ support">
            <title>Compiling with AccessKit support</title>
            <paragraph>AccessKit provides support for screen readers.</paragraph>
            <paragraph>By default, Godot is built with AccessKit dynamically linked. You can use it by placing
                <literal>accesskit.dylib</literal> alongside the standalone executable or in the app bundle's <literal>Frameworks</literal> folder.</paragraph>
            <note>
                <paragraph>You can use dynamically linked AccessKit with export templates as well, rename
                    the DYLIB to <literal>accesskit.{architecture}.dylib</literal>
                    and place them inside the export template app bundle <literal>Frameworks</literal> folder, and the
                    libraries will be automatically copied during the export process.</paragraph>
            </note>
            <paragraph>To compile Godot with statically linked AccessKit:</paragraph>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph>Download the pre-built static libraries from <reference name="godot-accesskit-c-static library" refuri="https://github.com/godotengine/godot-accesskit-c-static/releases">godot-accesskit-c-static library</reference><target ids="godot-accesskit-c-static-library" names="godot-accesskit-c-static\ library" refuri="https://github.com/godotengine/godot-accesskit-c-static/releases"></target>, and unzip them.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>When building Godot, add <literal>accesskit_sdk_path={path}</literal> to tell SCons where to look for the AccessKit libraries:</paragraph>
                    <block_quote>
                        <literal_block force="False" language="shell" linenos="False" xml:space="preserve">scons platform=macos accesskit_sdk_path=&lt;...&gt;</literal_block>
                    </block_quote>
                </list_item>
            </bullet_list>
            <note>
                <paragraph>You can optionally build the godot-angle-static libraries yourself with
                    the following steps:</paragraph>
                <enumerated_list enumtype="arabic" prefix="" suffix=".">
                    <list_item>
                        <paragraph>Clone the <reference name="godot-accesskit-c-static" refuri="https://github.com/godotengine/godot-accesskit-c-static/">godot-accesskit-c-static</reference><target ids="godot-accesskit-c-static" names="godot-accesskit-c-static" refuri="https://github.com/godotengine/godot-accesskit-c-static/"></target>
                            directory and navigate to it.</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>Run the following command:</paragraph>
                    </list_item>
                </enumerated_list>
                <literal_block force="False" language="shell" linenos="False" xml:space="preserve">cd accesskit-c
cmake -S . -B build -DCMAKE_BUILD_TYPE=Release
cmake --build build
cmake --install build</literal_block>
                <paragraph>The AccessKit static library should be built using the same compiler you are
                    using for building Godot.</paragraph>
            </note>
            <section ids="automatic-app-bundle-creation" names="automatic\ .app\ bundle\ creation">
                <title>Automatic <literal>.app</literal> bundle creation</title>
                <paragraph>To automatically create a <literal>.app</literal> bundle like in the official builds, use the <literal>generate_bundle=yes</literal> option on the <emphasis>last</emphasis>
                    SCons command used to build editor:</paragraph>
                <literal_block force="False" language="shell" linenos="False" xml:space="preserve">scons platform=macos arch=x86_64
scons platform=macos arch=arm64 generate_bundle=yes</literal_block>
            </section>
            <section ids="manual-app-bundle-creation" names="manual\ .app\ bundle\ creation">
                <title>Manual <literal>.app</literal> bundle creation</title>
                <paragraph>To support both architectures in a single "Universal 2" binary,
                    run the above two commands and then use <literal>lipo</literal> to bundle them together:</paragraph>
                <literal_block force="False" language="shell" linenos="False" xml:space="preserve">lipo -create bin/godot.macos.editor.x86_64 bin/godot.macos.editor.arm64 -output bin/godot.macos.editor.universal</literal_block>
                <paragraph>To create a <literal>.app</literal> bundle, you need to use the template located in <literal>misc/dist/macos_tools.app</literal>. Typically, for an optimized
                    editor binary built with <literal>dev_build=yes</literal>:</paragraph>
                <literal_block force="False" language="shell" linenos="False" xml:space="preserve">cp -r misc/dist/macos_tools.app ./bin/Godot.app
mkdir -p bin/Godot.app/Contents/MacOS
cp bin/godot.macos.editor.universal bin/Godot.app/Contents/MacOS/Godot
chmod +x bin/Godot.app/Contents/MacOS/Godot
codesign --force --timestamp --options=runtime --entitlements misc/dist/macos/editor.entitlements -s - bin/Godot.app</literal_block>
                <note>
                    <paragraph>If you are building the <literal>master</literal> branch, you also need to include support
                        for the MoltenVK Vulkan portability library. By default, it will be linked
                        statically from your installation of the Vulkan SDK for macOS.
                        You can also choose to link it dynamically by passing <literal>use_volk=yes</literal> and
                        including the dynamic library in your <literal>.app</literal> bundle:</paragraph>
                    <literal_block force="False" language="shell" linenos="False" xml:space="preserve">mkdir -p &lt;Godot bundle name&gt;.app/Contents/Frameworks
cp &lt;Vulkan SDK path&gt;/macOS/lib/libMoltenVK.dylib &lt;Godot bundle name&gt;.app/Contents/Frameworks/libMoltenVK.dylib</literal_block>
                </note>
            </section>
        </section>
        <section ids="running-a-headless-server-build" names="running\ a\ headless/server\ build">
            <title>Running a headless/server build</title>
            <paragraph>To run in <emphasis>headless</emphasis> mode which provides editor functionality to export
                projects in an automated manner, use the normal build:</paragraph>
            <literal_block force="False" language="shell" linenos="False" xml:space="preserve">scons platform=macos target=editor</literal_block>
            <paragraph>And then use the <literal>--headless</literal> command line argument:</paragraph>
            <literal_block force="False" language="shell" linenos="False" xml:space="preserve">./bin/godot.macos.editor.x86_64 --headless</literal_block>
            <paragraph>To compile a debug <emphasis>server</emphasis> build which can be used with
                <reference internal="True" refuri="../../../tutorials/editor/command_line_tutorial#doc-command-line-tutorial"><inline classes="std std-ref">remote debugging tools</inline></reference>, use:</paragraph>
            <literal_block force="False" language="shell" linenos="False" xml:space="preserve">scons platform=macos target=template_debug</literal_block>
            <paragraph>To compile a release <emphasis>server</emphasis> build which is optimized to run dedicated game servers, use:</paragraph>
            <literal_block force="False" language="shell" linenos="False" xml:space="preserve">scons platform=macos target=template_release production=yes</literal_block>
        </section>
        <section ids="building-export-templates" names="building\ export\ templates">
            <title>Building export templates</title>
            <paragraph>To build macOS export templates, you have to compile using the targets without
                the editor: <literal>target=template_release</literal> (release template) and
                <literal>target=template_debug</literal>.</paragraph>
            <paragraph>Official templates are <emphasis>Universal 2</emphasis> binaries which support both ARM64 and Intel
                x86_64 architectures.</paragraph>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph>To support ARM64 (Apple Silicon) + Intel x86_64:</paragraph>
                    <block_quote>
                        <literal_block force="False" language="shell" linenos="False" xml:space="preserve">scons platform=macos target=template_debug arch=arm64
scons platform=macos target=template_release arch=arm64
scons platform=macos target=template_debug arch=x86_64
scons platform=macos target=template_release arch=x86_64 generate_bundle=yes</literal_block>
                    </block_quote>
                </list_item>
                <list_item>
                    <paragraph>To support ARM64 (Apple Silicon) only (smaller file size, but less compatible with older hardware):</paragraph>
                    <block_quote>
                        <literal_block force="False" language="shell" linenos="False" xml:space="preserve">scons platform=macos target=template_debug arch=arm64
scons platform=macos target=template_release arch=arm64 generate_bundle=yes</literal_block>
                    </block_quote>
                </list_item>
            </bullet_list>
            <paragraph>To create a <literal>.app</literal> bundle like in the official builds, you need to use the
                template located in <literal>misc/dist/macos_template.app</literal>. This process can be automated by using
                the <literal>generate_bundle=yes</literal> option on the <emphasis>last</emphasis> SCons command used to build export templates
                (so that all binaries can be included). This will create a <literal>godot_macos.zip</literal> file in <literal>bin/</literal>
                and additionally takes care of calling <literal>lipo</literal> to create a <emphasis>Universal 2</emphasis> binary from two separate
                ARM64 and x86_64 binaries (if both were compiled beforehand).</paragraph>
            <note>
                <paragraph>You also need to include support for the MoltenVK Vulkan portability
                    library. By default, it will be linked statically from your installation of
                    the Vulkan SDK for macOS. You can also choose to link it dynamically by
                    passing <literal>use_volk=yes</literal> and including the dynamic library in your <literal>.app</literal>
                    bundle:</paragraph>
                <literal_block force="False" language="shell" linenos="False" xml:space="preserve">mkdir -p macos_template.app/Contents/Frameworks
cp &lt;Vulkan SDK path&gt;/macOS/libs/libMoltenVK.dylib macos_template.app/Contents/Frameworks/libMoltenVK.dylib</literal_block>
                <paragraph>In most cases, static linking should be preferred as it makes distribution
                    easier. The main upside of dynamic linking is that it allows updating
                    MoltenVK without having to recompile export templates.</paragraph>
            </note>
            <paragraph>If you created the <literal>.app</literal> manually, you can zip the <literal>macos_template.app</literal> folder
                to reproduce the <literal>macos.zip</literal> template from the official Godot distribution:</paragraph>
            <literal_block force="False" language="shell" linenos="False" xml:space="preserve">zip -r9 macos.zip macos_template.app</literal_block>
            <paragraph>To use your custom export templates, you can select the <literal>godot_macos.zip</literal> file in
                the advanced options of your export presets:</paragraph>
            <image candidates="{'*': 'engine_details/development/compiling/img/mactemplates.webp'}" original_uri="img/mactemplates.webp" uri="engine_details/development/compiling/img/mactemplates.webp"></image>
            <paragraph>Alternatively, if you want all your presets to use your custom export template, you
                can rename the <literal>godot_macos.zip</literal> file to <literal>macos.zip</literal> and move it to the default
                location for export templates:</paragraph>
            <definition_list>
                <definition_list_item>
                    <term>::</term>
                    <definition>
                        <paragraph>~/Library/Application Support/Godot/export_templates/&lt;GODOT_VERSION&gt;/macos.zip</paragraph>
                    </definition>
                </definition_list_item>
            </definition_list>
        </section>
        <section ids="cross-compiling-for-macos-from-linux" names="cross-compiling\ for\ macos\ from\ linux">
            <title>Cross-compiling for macOS from Linux</title>
            <paragraph>It is possible to compile for macOS in a Linux environment (and maybe also in
                Windows using the Windows Subsystem for Linux). For that, you'll need to install
                <reference name="OSXCross" refuri="https://github.com/tpoechtrager/osxcross">OSXCross</reference> to be able to use macOS
                as a target. First, follow the instructions to install it:</paragraph>
            <paragraph>Clone the <reference name="OSXCross repository" refuri="https://github.com/tpoechtrager/osxcross">OSXCross repository</reference>
                somewhere on your machine (or download a ZIP file and extract it somewhere), e.g.:</paragraph>
            <literal_block force="False" language="shell" linenos="False" xml:space="preserve">git clone --depth=1 https://github.com/tpoechtrager/osxcross.git "$HOME/osxcross"</literal_block>
            <enumerated_list enumtype="arabic" prefix="" suffix=".">
                <list_item>
                    <paragraph>Follow the instructions to package the SDK:
                        <reference refuri="https://github.com/tpoechtrager/osxcross#packaging-the-sdk">https://github.com/tpoechtrager/osxcross#packaging-the-sdk</reference></paragraph>
                </list_item>
                <list_item>
                    <paragraph>Follow the instructions to install OSXCross:
                        <reference refuri="https://github.com/tpoechtrager/osxcross#installation">https://github.com/tpoechtrager/osxcross#installation</reference></paragraph>
                </list_item>
            </enumerated_list>
            <paragraph>After that, you will need to define the <literal>OSXCROSS_ROOT</literal> as the path to
                the OSXCross installation (the same place where you cloned the
                repository/extracted the zip), e.g.:</paragraph>
            <literal_block force="False" language="shell" linenos="False" xml:space="preserve">export OSXCROSS_ROOT="$HOME/osxcross"</literal_block>
            <paragraph>Now you can compile with SCons like you normally would:</paragraph>
            <literal_block force="False" language="shell" linenos="False" xml:space="preserve">scons platform=macos</literal_block>
            <paragraph>If you have an OSXCross SDK version different from the one expected by the SCons buildsystem, you can specify a custom one with the <literal>osxcross_sdk</literal> argument:</paragraph>
            <literal_block force="False" language="shell" linenos="False" xml:space="preserve">scons platform=macos osxcross_sdk=darwin15</literal_block>
        </section>
        <section ids="troubleshooting" names="troubleshooting">
            <title>Troubleshooting</title>
            <section ids="fatal-error-cstdint-file-not-found" names="fatal\ error:\ 'cstdint'\ file\ not\ found">
                <title>Fatal error: 'cstdint' file not found</title>
                <paragraph>If you get a compilation error of this form early on, it's likely because
                    the Xcode command line tools installation needs to be repaired after
                    a macOS or Xcode update:</paragraph>
                <literal_block force="False" highlight_args="{}" language="text" linenos="False" xml:space="preserve">./core/typedefs.h:45:10: fatal error: 'cstdint' file not found
45 | #include &lt;cstdint&gt;
   |          ^~~~~~~~~</literal_block>
                <paragraph>Run these two commands to reinstall Xcode command line tools
                    (enter your administrator password as needed):</paragraph>
                <literal_block force="False" language="shell" linenos="False" xml:space="preserve">sudo rm -rf /Library/Developer/CommandLineTools
sudo xcode-select --install</literal_block>
                <paragraph>If it still does not work, try updating Xcode from the Mac App Store and try again.</paragraph>
                <substitution_definition names="weblate_widget"><reference refuri="https://hosted.weblate.org/engage/godot-engine/?utm_source=widget"><image alt="Translation status" candidates="{'?': 'https://hosted.weblate.org/widgets/godot-engine/-/godot-docs/287x66-white.png'}" height="66" uri="https://hosted.weblate.org/widgets/godot-engine/-/godot-docs/287x66-white.png" width="287"></image></reference></substitution_definition>
            </section>
        </section>
    </section>
</document>
