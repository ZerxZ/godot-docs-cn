<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.21.2 -->
<document source="/home/runner/work/godot-docs-cn/godot-docs-cn/godot-docs/docs/engine_details/development/compiling/compiling_for_android.rst" translation_progress="{'total': 0, 'translated': 0}" xmlns:c="https://www.sphinx-doc.org/" xmlns:changeset="https://www.sphinx-doc.org/" xmlns:citation="https://www.sphinx-doc.org/" xmlns:cpp="https://www.sphinx-doc.org/" xmlns:index="https://www.sphinx-doc.org/" xmlns:js="https://www.sphinx-doc.org/" xmlns:math="https://www.sphinx-doc.org/" xmlns:py="https://www.sphinx-doc.org/" xmlns:rst="https://www.sphinx-doc.org/" xmlns:std="https://www.sphinx-doc.org/">
    <target refid="doc-compiling-for-android"></target>
    <section ids="compiling-for-android doc-compiling-for-android" names="compiling\ for\ android doc_compiling_for_android">
        <title>Compiling for Android</title>
        <seealso>
            <paragraph>This page describes how to compile Android export template binaries from source.
                If you're looking to export your project to Android instead, read <reference internal="True" refuri="../../../tutorials/export/exporting_for_android#doc-exporting-for-android"><inline classes="std std-ref">Exporting for Android</inline></reference>.</paragraph>
        </seealso>
        <section ids="note" names="note">
            <title>Note</title>
            <paragraph>In most cases, using the built-in deployer and export templates is good
                enough. Compiling the Android APK manually is mostly useful for custom
                builds or custom packages for the deployer.</paragraph>
            <paragraph>Also, you still need to follow the steps mentioned in the
                <reference internal="True" refuri="../../../tutorials/export/exporting_for_android#doc-exporting-for-android"><inline classes="std std-ref">Exporting for Android</inline></reference> tutorial before attempting to build
                a custom export template.</paragraph>
        </section>
        <section ids="requirements" names="requirements">
            <title>Requirements</title>
            <paragraph>For compiling under Windows, Linux or macOS, the following is required:</paragraph>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph><reference name="Python 3.8+" refuri="https://www.python.org/downloads/">Python 3.8+</reference><target ids="python-3-8" names="python\ 3.8+" refuri="https://www.python.org/downloads/"></target>.</paragraph>
                </list_item>
                <list_item>
                    <paragraph><reference name="SCons 4.0+" refuri="https://scons.org/pages/download.html">SCons 4.0+</reference><target ids="scons-4-0" names="scons\ 4.0+" refuri="https://scons.org/pages/download.html"></target> build system.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Android SDK</paragraph>
                    <block_quote>
                        <bullet_list bullet="-">
                            <list_item>
                                <paragraph>To install the Android SDK, follow the steps here &lt;<reference refuri="https://docs.godotengine.org/en/stable/tutorials/export/exporting_for_android.html">https://docs.godotengine.org/en/stable/tutorials/export/exporting_for_android.html</reference>&gt;_.</paragraph>
                            </list_item>
                            <list_item>
                                <paragraph>On Linux, <strong>do not use an Android SDK provided by your distribution's repositories</strong> as it will often be outdated.</paragraph>
                            </list_item>
                            <list_item>
                                <paragraph>On macOS, <strong>do not use an Android SDK provided by Homebrew</strong> as it will not be installed in a unified location.</paragraph>
                            </list_item>
                        </bullet_list>
                    </block_quote>
                </list_item>
                <list_item>
                    <paragraph>Gradle (will be downloaded and installed automatically if missing).</paragraph>
                </list_item>
                <list_item>
                    <paragraph>JDK 17 (either OpenJDK or Oracle JDK).</paragraph>
                    <block_quote>
                        <bullet_list bullet="-">
                            <list_item>
                                <paragraph>You can download a build from <reference name="Adoptium" refuri="https://adoptium.net/temurin/releases?variant=openjdk17&amp;version=17&amp;os=any&amp;arch=any">Adoptium</reference><target ids="adoptium" names="adoptium" refuri="https://adoptium.net/temurin/releases?variant=openjdk17&amp;version=17&amp;os=any&amp;arch=any"></target>.</paragraph>
                            </list_item>
                        </bullet_list>
                    </block_quote>
                </list_item>
            </bullet_list>
            <seealso>
                <paragraph>To get the Godot source code for compiling, see
                    <reference internal="True" refuri="getting_source#doc-getting-source"><inline classes="std std-ref">Getting the source</inline></reference>.</paragraph>
                <paragraph>For a general overview of SCons usage for Godot, see
                    <reference internal="True" refuri="introduction_to_the_buildsystem#doc-introduction-to-the-buildsystem"><inline classes="std std-ref">Introduction to the buildsystem</inline></reference>.</paragraph>
            </seealso>
            <target refid="doc-android-setting-up-the-buildsystem"></target>
        </section>
        <section ids="setting-up-the-buildsystem doc-android-setting-up-the-buildsystem" names="setting\ up\ the\ buildsystem doc_android_setting_up_the_buildsystem">
            <title>Setting up the buildsystem</title>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph>Set the environment variable <literal>ANDROID_HOME</literal> to point to the Android
                        SDK. If you downloaded the Android command-line tools, this would be
                        the folder where you extracted the contents of the ZIP archive.</paragraph>
                    <block_quote>
                        <bullet_list bullet="-">
                            <list_item>
                                <paragraph>Windows: Press <literal classes="kbd">Windows + R</literal>, type "control system",
                                    then click on <strong>Advanced system settings</strong> in the left pane,
                                    then click on <strong>Environment variables</strong> on the window that appears.</paragraph>
                            </list_item>
                            <list_item>
                                <paragraph>Linux or macOS: Add the text <literal>export ANDROID_HOME="/path/to/android-sdk"</literal>
                                    to your <literal>.bashrc</literal> or <literal>.zshrc</literal> where <literal>/path/to/android-sdk</literal> points to
                                    the root of the SDK directories.</paragraph>
                            </list_item>
                        </bullet_list>
                    </block_quote>
                </list_item>
                <list_item>
                    <paragraph>After setting up the SDK and environment variables, be sure to
                        <strong>restart your terminal</strong> to apply the changes. If you are using
                        an IDE with an integrated terminal, you need to restart the IDE.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Run <literal>scons platform=android</literal>. If this fails, go back and check the steps.
                        If you completed the setup correctly, the NDK will begin downloading.
                        If you are trying to compile GDExtension, you need to first compile
                        the engine to download the NDK, then you can compile GDExtension.</paragraph>
                </list_item>
            </bullet_list>
        </section>
        <section ids="building-the-export-templates" names="building\ the\ export\ templates">
            <title>Building the export templates</title>
            <paragraph>Godot needs three export templates for Android: the optimized "release"
                template (<literal>android_release.apk</literal>), the debug template (<literal>android_debug.apk</literal>),
                and the Gradle build template (<literal>android_source.zip</literal>).
                As Google requires all APKs to include ARMv8 (64-bit) libraries since August 2019,
                the commands below build templates containing both ARMv7 and ARMv8 libraries.</paragraph>
            <paragraph>Compiling the standard export templates is done by calling SCons from the Godot
                root directory with the following arguments:</paragraph>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph>Release template (used when exporting with <strong>Debugging Enabled</strong> unchecked)</paragraph>
                </list_item>
            </bullet_list>
            <literal_block force="False" language="shell" linenos="False" xml:space="preserve">scons platform=android target=template_release arch=arm32
scons platform=android target=template_release arch=arm64 generate_android_binaries=yes</literal_block>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph>Debug template (used when exporting with <strong>Debugging Enabled</strong> checked)</paragraph>
                </list_item>
            </bullet_list>
            <literal_block force="False" language="shell" linenos="False" xml:space="preserve">scons platform=android target=template_debug arch=arm32
scons platform=android target=template_debug arch=arm64 generate_android_binaries=yes</literal_block>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph>(<strong>Optional</strong>) Dev template (used when troubleshooting)</paragraph>
                </list_item>
            </bullet_list>
            <literal_block force="False" language="shell" linenos="False" xml:space="preserve">scons platform=android target=template_debug arch=arm32 dev_build=yes
scons platform=android target=template_debug arch=arm64 dev_build=yes generate_android_binaries=yes</literal_block>
            <paragraph>The resulting templates will be located under the <literal>bin</literal> directory:</paragraph>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph><literal>bin/android_release.apk</literal> for the release template</paragraph>
                </list_item>
                <list_item>
                    <paragraph><literal>bin/android_debug.apk</literal> for the debug template</paragraph>
                </list_item>
                <list_item>
                    <paragraph><literal>bin/android_dev.apk</literal> for the dev template</paragraph>
                </list_item>
                <list_item>
                    <paragraph><literal>bin/android_source.zip</literal> for the Gradle build template</paragraph>
                </list_item>
            </bullet_list>
            <note>
                <bullet_list bullet="-">
                    <list_item>
                        <paragraph>If you are changing the list of architectures you're building, remember to add <literal>generate_android_binaries=yes</literal> to the <emphasis>last</emphasis> architecture you're building, so that the template files are generated after the build.</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>To include debug symbols in the generated templates, add the <literal>debug_symbols=yes</literal> parameters to the SCons command.</paragraph>
                        <block_quote>
                            <bullet_list bullet="-">
                                <list_item>
                                    <paragraph>Note that you can include <literal>separate_debug_symbols=yes</literal> to generate the debug symbols in a separate <literal>*-native-debug-symbols.zip</literal> file.</paragraph>
                                </list_item>
                            </bullet_list>
                        </block_quote>
                    </list_item>
                </bullet_list>
            </note>
            <seealso>
                <paragraph>If you want to enable Vulkan validation layers, see
                    <reference internal="True" refuri="../debugging/vulkan/vulkan_validation_layers#doc-vulkan-validation-layers-android"><inline classes="std std-ref">Vulkan validation layers on Android</inline></reference>.</paragraph>
            </seealso>
            <section ids="adding-support-for-x86-devices" names="adding\ support\ for\ x86\ devices">
                <title>Adding support for x86 devices</title>
                <paragraph>If you also want to include support for x86 and x86_64 devices, run the SCons
                    command a third and fourth time with the <literal>arch=x86_32</literal>, and
                    <literal>arch=x86_64</literal> arguments before building the APK with Gradle. For
                    example, for the release template:</paragraph>
                <literal_block force="False" language="shell" linenos="False" xml:space="preserve">scons platform=android target=template_release arch=arm32
scons platform=android target=template_release arch=arm64
scons platform=android target=template_release arch=x86_32
scons platform=android target=template_release arch=x86_64 generate_android_binaries=yes</literal_block>
                <paragraph>This will create template binaries that works on all platforms.
                    The final binary size of exported projects will depend on the platforms you choose
                    to support when exporting; in other words, unused platforms will be removed from
                    the binary.</paragraph>
            </section>
            <section ids="cleaning-the-generated-export-templates" names="cleaning\ the\ generated\ export\ templates">
                <title>Cleaning the generated export templates</title>
                <paragraph>You can use the following commands to remove the generated export templates:</paragraph>
                <literal_block force="False" language="shell" linenos="False" xml:space="preserve">cd platform/android/java
# On Windows
.\gradlew clean
# On Linux and macOS
./gradlew clean</literal_block>
            </section>
        </section>
        <section ids="using-the-export-templates" names="using\ the\ export\ templates">
            <title>Using the export templates</title>
            <paragraph>Godot needs release and debug binaries that were compiled against the same
                version/commit as the editor. If you are using official binaries
                for the editor, make sure to install the matching export templates,
                or build your own from the same version.</paragraph>
            <paragraph>When exporting your game, Godot uses the templates as a base, and updates their content as needed.</paragraph>
            <section ids="installing-the-templates" names="installing\ the\ templates">
                <title>Installing the templates</title>
                <paragraph>The newly-compiled templates (<literal>android_debug.apk</literal>
                    , <literal>android_release.apk</literal>, and <literal>android_source.zip</literal>) must be copied to Godot's templates folder
                    with their respective names. The templates folder can be located in:</paragraph>
                <bullet_list bullet="-">
                    <list_item>
                        <paragraph>Windows: <literal>%APPDATA%\Godot\export_templates\&lt;version&gt;\</literal></paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>Linux: <literal>$HOME/.local/share/godot/export_templates/&lt;version&gt;/</literal></paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>macOS: <literal>$HOME/Library/Application Support/Godot/export_templates/&lt;version&gt;/</literal></paragraph>
                    </list_item>
                </bullet_list>
                <paragraph><literal>&lt;version&gt;</literal> is of the form <literal>major.minor[.patch].status</literal> using values from
                    <literal>version.py</literal> in your Godot source repository (e.g. <literal>4.1.3.stable</literal> or <literal>4.2.dev</literal>).
                    You also need to write this same version string to a <literal>version.txt</literal> file located
                    next to your export templates.</paragraph>
                <comment xml:space="preserve">TODO: Move these paths to a common reference page</comment>
                <paragraph>However, if you are writing your custom modules or custom C++ code, you
                    might instead want to configure your template binaries as custom export templates
                    in the project export menu. You must have <strong>Advanced Options</strong> enabled to set this.</paragraph>
                <image candidates="{'*': 'engine_details/development/compiling/img/andtemplates.webp'}" original_uri="img/andtemplates.webp" uri="engine_details/development/compiling/img/andtemplates.webp"></image>
                <paragraph>You don't even need to copy them, you can just reference the resulting
                    file in the <literal>bin\</literal> directory of your Godot source folder, so that the
                    next time you build you will automatically have the custom templates
                    referenced.</paragraph>
            </section>
        </section>
        <section ids="building-the-godot-editor" names="building\ the\ godot\ editor">
            <title>Building the Godot editor</title>
            <paragraph>Compiling the editor is done by calling SCons from the Godot
                root directory with the following arguments:</paragraph>
            <literal_block force="False" language="shell" linenos="False" xml:space="preserve">scons platform=android arch=arm32 production=yes target=editor
scons platform=android arch=arm64 production=yes target=editor
scons platform=android arch=x86_32 production=yes target=editor
scons platform=android arch=x86_64 production=yes target=editor generate_android_binaries=yes</literal_block>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph>You can add the <literal>dev_build=yes</literal> parameter to generate a dev build of the Godot editor.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>You can add the <literal>debug_symbols=yes</literal> parameters to include the debug symbols in the generated build.</paragraph>
                    <block_quote>
                        <bullet_list bullet="-">
                            <list_item>
                                <paragraph>Note that you can include <literal>separate_debug_symbols=yes</literal> to the <emphasis>last</emphasis> architecture you're building, to generate the debug symbols in a separate <literal>*-native-debug-symbols.zip</literal> file.</paragraph>
                            </list_item>
                        </bullet_list>
                    </block_quote>
                </list_item>
                <list_item>
                    <paragraph>You can skip certain architectures depending on your target device to speed up compilation.</paragraph>
                </list_item>
            </bullet_list>
            <paragraph>Remember to add <literal>generate_android_binaries=yes</literal> to the <emphasis>last</emphasis> architecture you're building, so that binaries are generated after the build.</paragraph>
            <paragraph>The resulting binaries will be located under <literal>bin/android_editor_builds/</literal>.</paragraph>
        </section>
        <section ids="removing-the-editor-binaries" names="removing\ the\ editor\ binaries">
            <title>Removing the Editor binaries</title>
            <paragraph>You can use the following commands to remove the generated editor binaries:</paragraph>
            <literal_block force="False" language="shell" linenos="False" xml:space="preserve"> cd platform/android/java
 # On Windows
.\gradlew clean
# On Linux and macOS
./gradlew clean</literal_block>
        </section>
        <section ids="installing-the-godot-editor-apk" names="installing\ the\ godot\ editor\ apk">
            <title>Installing the Godot editor APK</title>
            <paragraph>With an Android device with Developer Options enabled, connect the Android device to your computer via its charging cable to a USB/USB-C port.
                Open up a Terminal/Command Prompt and run the following commands from the root directory with the following arguments:</paragraph>
            <literal_block force="False" language="shell" linenos="False" xml:space="preserve">adb install ./bin/android_editor_builds/android_editor-android-debug.apk</literal_block>
        </section>
        <section ids="troubleshooting" names="troubleshooting">
            <title>Troubleshooting</title>
            <section ids="platform-doesn-t-appear-in-scons" names="platform\ doesn't\ appear\ in\ scons">
                <title>Platform doesn't appear in SCons</title>
                <paragraph>Double-check that you've set the <literal>ANDROID_HOME</literal>
                    environment variable. This is required for the platform to appear in SCons'
                    list of detected platforms.
                    See <reference internal="True" refid="doc-android-setting-up-the-buildsystem"><inline classes="std std-ref">Setting up the buildsystem</inline></reference>
                    for more information.</paragraph>
            </section>
            <section ids="application-not-installed" names="application\ not\ installed">
                <title>Application not installed</title>
                <paragraph>Android might complain the application is not correctly installed.
                    If so:</paragraph>
                <bullet_list bullet="-">
                    <list_item>
                        <paragraph>Check that the debug keystore is properly generated.</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>Check that the jarsigner executable is from JDK 8.</paragraph>
                    </list_item>
                </bullet_list>
                <paragraph>If it still fails, open a command line and run <reference name="logcat" refuri="https://developer.android.com/studio/command-line/logcat">logcat</reference><target ids="logcat" names="logcat" refuri="https://developer.android.com/studio/command-line/logcat"></target>:</paragraph>
                <literal_block force="False" language="shell" linenos="False" xml:space="preserve">adb logcat</literal_block>
                <paragraph>Then check the output while the application is installed;
                    the error message should be presented there.
                    Seek assistance if you can't figure it out.</paragraph>
            </section>
            <section ids="application-exits-immediately" names="application\ exits\ immediately">
                <title>Application exits immediately</title>
                <paragraph>If the application runs but exits immediately, this might be due to
                    one of the following reasons:</paragraph>
                <bullet_list bullet="-">
                    <list_item>
                        <paragraph>Make sure to use export templates that match your editor version; if
                            you use a new Godot version, you <emphasis>have</emphasis> to update the templates too.</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph><literal>libgodot_android.so</literal> is not in <literal>libs/&lt;arch&gt;/</literal>
                            where <literal>&lt;arch&gt;</literal> is the device's architecture.</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>The device's architecture does not match the exported one(s).
                            Make sure your templates were built for that device's architecture,
                            and that the export settings included support for that architecture.</paragraph>
                    </list_item>
                </bullet_list>
                <paragraph>In any case, <literal>adb logcat</literal> should also show the cause of the error.</paragraph>
                <substitution_definition names="weblate_widget"><reference refuri="https://hosted.weblate.org/engage/godot-engine/?utm_source=widget"><image alt="Translation status" candidates="{'?': 'https://hosted.weblate.org/widgets/godot-engine/-/godot-docs/287x66-white.png'}" height="66" uri="https://hosted.weblate.org/widgets/godot-engine/-/godot-docs/287x66-white.png" width="287"></image></reference></substitution_definition>
            </section>
        </section>
    </section>
</document>
